/*
 * BIMWINNER.viewer V3.0.0
 *
 * A WebGL-based IFC Viewer for threejs,it is modified for BimWInner
 * http://www.bimwinner.com
 *
 * Built on 2017-10-11
 *
 * todo
 * Copyright 2017, wgb
 * 
 *
 */

"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)===a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1});var BIMWINNER={CLASS:"BIMWINNER",VERSION_NUMBER:"3.0.0",VERSION_STATE:"Dev",_isArray:function(a){return a&&!a.propertyIsEnumerable("length")&&"object"==typeof a&&"number"==typeof a.length},_isString:function(a){return"string"==typeof a||a instanceof String},_copy:function(a){return this._apply(a,{})},_apply:function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_applyIf:function(a,b){for(var c in a)a.hasOwnProperty(c)&&(void 0!==b[c]&&null!==b[c]||(b[c]=a[c]));return b},Class:function(a,b){var c=null,d=b||a;c="function"==typeof d.__construct?d.__construct:"function"==typeof a.prototype.__construct?function(){a.prototype.__construct.apply(this,arguments)}:function(){};var e=c;if("undefined"==typeof b)e.prototype=d;else{var f=function(){};f.prototype=jQuery.extend({},a.prototype),jQuery.extend(f.prototype,b),e.prototype=new f}return e}};BIMWINNER.Pinyin=function(){var a=function(a){this.initialize(a)},b={checkPolyphone:!1,charcase:"default"};a.fn=a.prototype={init:function(a){this.options=c(b,a)},initialize:function(a){this.init(a),this.char_dict="YDYQSXMWZSSXJBYMGCCZQPSSQBYCDSCDQLDYLYBSSJGYZZJJFKCCLZDHWDWZJLJPFYYNWJJTMYHZWZHFLZPPQHGSCYYYNJQYXXGJHHSDSJNKKTMOMLCRXYPSNQSECCQZGGLLYJLMYZZSECYKYYHQWJSSGGYXYZYJWWKDJHYCHMYXJTLXJYQBYXZLDWRDJRWYSRLDZJPCBZJJBRCFTLECZSTZFXXZHTRQHYBDLYCZSSYMMRFMYQZPWWJJYFCRWFDFZQPYDDWYXKYJAWJFFXYPSFTZYHHYZYSWCJYXSCLCXXWZZXNBGNNXBXLZSZSBSGPYSYZDHMDZBQBZCWDZZYYTZHBTSYYBZGNTNXQYWQSKBPHHLXGYBFMJEBJHHGQTJCYSXSTKZHLYCKGLYSMZXYALMELDCCXGZYRJXSDLTYZCQKCNNJWHJTZZCQLJSTSTBNXBTYXCEQXGKWJYFLZQLYHYXSPSFXLMPBYSXXXYDJCZYLLLSJXFHJXPJBTFFYABYXBHZZBJYZLWLCZGGBTSSMDTJZXPTHYQTGLJSCQFZKJZJQNLZWLSLHDZBWJNCJZYZSQQYCQYRZCJJWYBRTWPYFTWEXCSKDZCTBZHYZZYYJXZCFFZZMJYXXSDZZOTTBZLQWFCKSZSXFYRLNYJMBDTHJXSQQCCSBXYYTSYFBXDZTGBCNSLCYZZPSAZYZZSCJCSHZQYDXLBPJLLMQXTYDZXSQJTZPXLCGLQTZWJBHCTSYJSFXYEJJTLBGXSXJMYJQQPFZASYJNTYDJXKJCDJSZCBARTDCLYJQMWNQNCLLLKBYBZZSYHQQLTWLCCXTXLLZNTYLNEWYZYXCZXXGRKRMTCNDNJTSYYSSDQDGHSDBJGHRWRQLYBGLXHLGTGXBQJDZPYJSJYJCTMRNYMGRZJCZGJMZMGXMPRYXKJNYMSGMZJYMKMFXMLDTGFBHCJHKYLPFMDXLQJJSMTQGZSJLQDLDGJYCALCMZCSDJLLNXDJFFFFJCZFMZFFPFKHKGDPSXKTACJDHHZDDCRRCFQYJKQCCWJDXHWJLYLLZGCFCQDSMLZPBJJPLSBCJGGDCKKDEZSQCCKJGCGKDJTJDLZYCXKLQSCGJCLTFPCQCZGWPJDQYZJJBYJHSJDZWGFSJGZKQCCZLLPSPKJGQJHZZLJPLGJGJJTHJJYJZCZMLZLYQBGJWMLJKXZDZNJQSYZMLJLLJKYWXMKJLHSKJGBMCLYYMKXJQLBMLLKMDXXKWYXYSLMLPSJQQJQXYXFJTJDXMXXLLCXQBSYJBGWYMBGGBCYXPJYGPEPFGDJGBHBNSQJYZJKJKHXQFGQZKFHYGKHDKLLSDJQXPQYKYBNQSXQNSZSWHBSXWHXWBZZXDMNSJBSBKBBZKLYLXGWXDRWYQZMYWSJQLCJXXJXKJEQXSCYETLZHLYYYSDZPAQYZCMTLSHTZCFYZYXYLJSDCJQAGYSLCQLYYYSHMRQQKLDXZSCSSSYDYCJYSFSJBFRSSZQSBXXPXJYSDRCKGJLGDKZJZBDKTCSYQPYHSTCLDJDHMXMCGXYZHJDDTMHLTXZXYLYMOHYJCLTYFBQQXPFBDFHHTKSQHZYYWCNXXCRWHOWGYJLEGWDQCWGFJYCSNTMYTOLBYGWQWESJPWNMLRYDZSZTXYQPZGCWXHNGPYXSHMYQJXZTDPPBFYHZHTJYFDZWKGKZBLDNTSXHQEEGZZYLZMMZYJZGXZXKHKSTXNXXWYLYAPSTHXDWHZYMPXAGKYDXBHNHXKDPJNMYHYLPMGOCSLNZHKXXLPZZLBMLSFBHHGYGYYGGBHSCYAQTYWLXTZQCEZYDQDQMMHTKLLSZHLSJZWFYHQSWSCWLQAZYNYTLSXTHAZNKZZSZZLAXXZWWCTGQQTDDYZTCCHYQZFLXPSLZYGPZSZNGLNDQTBDLXGTCTAJDKYWNSYZLJHHZZCWNYYZYWMHYCHHYXHJKZWSXHZYXLYSKQYSPSLYZWMYPPKBYGLKZHTYXAXQSYSHXASMCHKDSCRSWJPWXSGZJLWWSCHSJHSQNHCSEGNDAQTBAALZZMSSTDQJCJKTSCJAXPLGGXHHGXXZCXPDMMHLDGTYBYSJMXHMRCPXXJZCKZXSHMLQXXTTHXWZFKHCCZDYTCJYXQHLXDHYPJQXYLSYYDZOZJNYXQEZYSQYAYXWYPDGXDDXSPPYZNDLTWRHXYDXZZJHTCXMCZLHPYYYYMHZLLHNXMYLLLMDCPPXHMXDKYCYRDLTXJCHHZZXZLCCLYLNZSHZJZZLNNRLWHYQSNJHXYNTTTKYJPYCHHYEGKCTTWLGQRLGGTGTYGYHPYHYLQYQGCWYQKPYYYTTTTLHYHLLTYTTSPLKYZXGZWGPYDSSZZDQXSKCQNMJJZZBXYQMJRTFFBTKHZKBXLJJKDXJTLBWFZPPTKQTZTGPDGNTPJYFALQMKGXBDCLZFHZCLLLLADPMXDJHLCCLGYHDZFGYDDGCYYFGYDXKSSEBDHYKDKDKHNAXXYBPBYYHXZQGAFFQYJXDMLJCSQZLLPCHBSXGJYNDYBYQSPZWJLZKSDDTACTBXZDYZYPJZQSJNKKTKNJDJGYYPGTLFYQKASDNTCYHBLWDZHBBYDWJRYGKZYHEYYFJMSDTYFZJJHGCXPLXHLDWXXJKYTCYKSSSMTWCTTQZLPBSZDZWZXGZAGYKTYWXLHLSPBCLLOQMMZSSLCMBJCSZZKYDCZJGQQDSMCYTZQQLWZQZXSSFPTTFQMDDZDSHDTDWFHTDYZJYQJQKYPBDJYYXTLJHDRQXXXHAYDHRJLKLYTWHLLRLLRCXYLBWSRSZZSYMKZZHHKYHXKSMDSYDYCJPBZBSQLFCXXXNXKXWYWSDZYQOGGQMMYHCDZTTFJYYBGSTTTYBYKJDHKYXBELHTYPJQNFXFDYKZHQKZBYJTZBXHFDXKDASWTAWAJLDYJSFHBLDNNTNQJTJNCHXFJSRFWHZFMDRYJYJWZPDJKZYJYMPCYZNYNXFBYTFYFWYGDBNZZZDNYTXZEMMQBSQEHXFZMBMFLZZSRXYMJGSXWZJSPRYDJSJGXHJJGLJJYNZZJXHGXKYMLPYYYCXYTWQZSWHWLYRJLPXSLSXMFSWWKLCTNXNYNPSJSZHDZEPTXMYYWXYYSYWLXJQZQXZDCLEEELMCPJPCLWBXSQHFWWTFFJTNQJHJQDXHWLBYZNFJLALKYYJLDXHHYCSTYYWNRJYXYWTRMDRQHWQCMFJDYZMHMYYXJWMYZQZXTLMRSPWWCHAQBXYGZYPXYYRRCLMPYMGKSJSZYSRMYJSNXTPLNBAPPYPYLXYYZKYNLDZYJZCZNNLMZHHARQMPGWQTZMXXMLLHGDZXYHXKYXYCJMFFYYHJFSBSSQLXXNDYCANNMTCJCYPRRNYTYQNYYMBMSXNDLYLYSLJRLXYSXQMLLYZLZJJJKYZZCSFBZXXMSTBJGNXYZHLXNMCWSCYZYFZLXBRNNNYLBNRTGZQYSATSWRYHYJZMZDHZGZDWYBSSCSKXSYHYTXXGCQGXZZSHYXJSCRHMKKBXCZJYJYMKQHZJFNBHMQHYSNJNZYBKNQMCLGQHWLZNZSWXKHLJHYYBQLBFCDSXDLDSPFZPSKJYZWZXZDDXJSMMEGJSCSSMGCLXXKYYYLNYPWWWGYDKZJGGGZGGSYCKNJWNJPCXBJJTQTJWDSSPJXZXNZXUMELPXFSXTLLXCLJXJJLJZXCTPSWXLYDHLYQRWHSYCSQYYBYAYWJJJQFWQCQQCJQGXALDBZZYJGKGXPLTZYFXJLTPADKYQHPMATLCPDCKBMTXYBHKLENXDLEEGQDYMSAWHZMLJTWYGXLYQZLJEEYYBQQFFNLYXRDSCTGJGXYYNKLLYQKCCTLHJLQMKKZGCYYGLLLJDZGYDHZWXPYSJBZKDZGYZZHYWYFQYTYZSZYEZZLYMHJJHTSMQWYZLKYYWZCSRKQYTLTDXWCTYJKLWSQZWBDCQYNCJSRSZJLKCDCDTLZZZACQQZZDDXYPLXZBQJYLZLLLQDDZQJYJYJZYXNYYYNYJXKXDAZWYRDLJYYYRJLXLLDYXJCYWYWNQCCLDDNYYYNYCKCZHXXCCLGZQJGKWPPCQQJYSBZZXYJSQPXJPZBSBDSFNSFPZXHDWZTDWPPTFLZZBZDMYYPQJRSDZSQZSQXBDGCPZSWDWCSQZGMDHZXMWWFYBPDGPHTMJTHZSMMBGZMBZJCFZWFZBBZMQCFMBDMCJXLGPNJBBXGYHYYJGPTZGZMQBQTCGYXJXLWZKYDPDYMGCFTPFXYZTZXDZXTGKMTYBBCLBJASKYTSSQYYMSZXFJEWLXLLSZBQJJJAKLYLXLYCCTSXMCWFKKKBSXLLLLJYXTYLTJYYTDPJHNHNNKBYQNFQYYZBYYESSESSGDYHFHWTCJBSDZZTFDMXHCNJZYMQWSRYJDZJQPDQBBSTJGGFBKJBXTGQHNGWJXJGDLLTHZHHYYYYYYSXWTYYYCCBDBPYPZYCCZYJPZYWCBDLFWZCWJDXXHYHLHWZZXJTCZLCDPXUJCZZZLYXJJTXPHFXWPYWXZPTDZZBDZCYHJHMLXBQXSBYLRDTGJRRCTTTHYTCZWMXFYTWWZCWJWXJYWCSKYBZSCCTZQNHXNWXXKHKFHTSWOCCJYBCMPZZYKBNNZPBZHHZDLSYDDYTYFJPXYNGFXBYQXCBHXCPSXTYZDMKYSNXSXLHKMZXLYHDHKWHXXSSKQYHHCJYXGLHZXCSNHEKDTGZXQYPKDHEXTYKCNYMYYYPKQYYYKXZLTHJQTBYQHXBMYHSQCKWWYLLHCYYLNNEQXQWMCFBDCCMLJGGXDQKTLXKGNQCDGZJWYJJLYHHQTTTNWCHMXCXWHWSZJYDJCCDBQCDGDNYXZTHCQRXCBHZTQCBXWGQWYYBXHMBYMYQTYEXMQKYAQYRGYZSLFYKKQHYSSQYSHJGJCNXKZYCXSBXYXHYYLSTYCXQTHYSMGSCPMMGCCCCCMTZTASMGQZJHKLOSQYLSWTMXSYQKDZLJQQYPLSYCZTCQQPBBQJZCLPKHQZYYXXDTDDTSJCXFFLLCHQXMJLWCJCXTSPYCXNDTJSHJWXDQQJSKXYAMYLSJHMLALYKXCYYDMNMDQMXMCZNNCYBZKKYFLMCHCMLHXRCJJHSYLNMTJZGZGYWJXSRXCWJGJQHQZDQJDCJJZKJKGDZQGJJYJYLXZXXCDQHHHEYTMHLFSBDJSYYSHFYSTCZQLPBDRFRZTZYKYWHSZYQKWDQZRKMSYNBCRXQBJYFAZPZZEDZCJYWBCJWHYJBQSZYWRYSZPTDKZPFPBNZTKLQYHBBZPNPPTYZZYBQNYDCPJMMCYCQMCYFZZDCMNLFPBPLNGQJTBTTNJZPZBBZNJKLJQYLNBZQHKSJZNGGQSZZKYXSHPZSNBCGZKDDZQANZHJKDRTLZLSWJLJZLYWTJNDJZJHXYAYNCBGTZCSSQMNJPJYTYSWXZFKWJQTKHTZPLBHSNJZSYZBWZZZZLSYLSBJHDWWQPSLMMFBJDWAQYZTCJTBNNWZXQXCDSLQGDSDPDZHJTQQPSWLYYJZLGYXYZLCTCBJTKTYCZJTQKBSJLGMGZDMCSGPYNJZYQYYKNXRPWSZXMTNCSZZYXYBYHYZAXYWQCJTLLCKJJTJHGDXDXYQYZZBYWDLWQCGLZGJGQRQZCZSSBCRPCSKYDZNXJSQGXSSJMYDNSTZTPBDLTKZWXQWQTZEXNQCZGWEZKSSBYBRTSSSLCCGBPSZQSZLCCGLLLZXHZQTHCZMQGYZQZNMCOCSZJMMZSQPJYGQLJYJPPLDXRGZYXCCSXHSHGTZNLZWZKJCXTCFCJXLBMQBCZZWPQDNHXLJCTHYZLGYLNLSZZPCXDSCQQHJQKSXZPBAJYEMSMJTZDXLCJYRYYNWJBNGZZTMJXLTBSLYRZPYLSSCNXPHLLHYLLQQZQLXYMRSYCXZLMMCZLTZSDWTJJLLNZGGQXPFSKYGYGHBFZPDKMWGHCXMSGDXJMCJZDYCABXJDLNBCDQYGSKYDQTXDJJYXMSZQAZDZFSLQXYJSJZYLBTXXWXQQZBJZUFBBLYLWDSLJHXJYZJWTDJCZFQZQZZDZSXZZQLZCDZFJHYSPYMPQZMLPPLFFXJJNZZYLSJEYQZFPFZKSYWJJJHRDJZZXTXXGLGHYDXCSKYSWMMZCWYBAZBJKSHFHJCXMHFQHYXXYZFTSJYZFXYXPZLCHMZMBXHZZSXYFYMNCWDABAZLXKTCSHHXKXJJZJSTHYGXSXYYHHHJWXKZXSSBZZWHHHCWTZZZPJXSNXQQJGZYZYWLLCWXZFXXYXYHXMKYYSWSQMNLNAYCYSPMJKHWCQHYLAJJMZXHMMCNZHBHXCLXTJPLTXYJHDYYLTTXFSZHYXXSJBJYAYRSMXYPLCKDUYHLXRLNLLSTYZYYQYGYHHSCCSMZCTZQXKYQFPYYRPFFLKQUNTSZLLZMWWTCQQYZWTLLMLMPWMBZSSTZRBPDDTLQJJBXZCSRZQQYGWCSXFWZLXCCRSZDZMCYGGDZQSGTJSWLJMYMMZYHFBJDGYXCCPSHXNZCSBSJYJGJMPPWAFFYFNXHYZXZYLREMZGZCYZSSZDLLJCSQFNXZKPTXZGXJJGFMYYYSNBTYLBNLHPFZDCYFBMGQRRSSSZXYSGTZRNYDZZCDGPJAFJFZKNZBLCZSZPSGCYCJSZLMLRSZBZZLDLSLLYSXSQZQLYXZLSKKBRXBRBZCYCXZZZEEYFGKLZLYYHGZSGZLFJHGTGWKRAAJYZKZQTSSHJJXDCYZUYJLZYRZDQQHGJZXSSZBYKJPBFRTJXLLFQWJHYLQTYMBLPZDXTZYGBDHZZRBGXHWNJTJXLKSCFSMWLSDQYSJTXKZSCFWJLBXFTZLLJZLLQBLSQMQQCGCZFPBPHZCZJLPYYGGDTGWDCFCZQYYYQYSSCLXZSKLZZZGFFCQNWGLHQYZJJCZLQZZYJPJZZBPDCCMHJGXDQDGDLZQMFGPSYTSDYFWWDJZJYSXYYCZCYHZWPBYKXRYLYBHKJKSFXTZJMMCKHLLTNYYMSYXYZPYJQYCSYCWMTJJKQYRHLLQXPSGTLYYCLJSCPXJYZFNMLRGJJTYZBXYZMSJYJHHFZQMSYXRSZCWTLRTQZSSTKXGQKGSPTGCZNJSJCQCXHMXGGZTQYDJKZDLBZSXJLHYQGGGTHQSZPYHJHHGYYGKGGCWJZZYLCZLXQSFTGZSLLLMLJSKCTBLLZZSZMMNYTPZSXQHJCJYQXYZXZQZCPSHKZZYSXCDFGMWQRLLQXRFZTLYSTCTMJCXJJXHJNXTNRZTZFQYHQGLLGCXSZSJDJLJCYDSJTLNYXHSZXCGJZYQPYLFHDJSBPCCZHJJJQZJQDYBSSLLCMYTTMQTBHJQNNYGKYRQYQMZGCJKPDCGMYZHQLLSLLCLMHOLZGDYYFZSLJCQZLYLZQJESHNYLLJXGJXLYSYYYXNBZLJSSZCQQCJYLLZLTJYLLZLLBNYLGQCHXYYXOXCXQKYJXXXYKLXSXXYQXCYKQXQCSGYXXYQXYGYTQOHXHXPYXXXULCYEYCHZZCBWQBBWJQZSCSZSSLZYLKDESJZWMYMCYTSDSXXSCJPQQSQYLYYZYCMDJDZYWCBTJSYDJKCYDDJLBDJJSODZYSYXQQYXDHHGQQYQHDYXWGMMMAJDYBBBPPBCMUUPLJZSMTXERXJMHQNUTPJDCBSSMSSSTKJTSSMMTRCPLZSZMLQDSDMJMQPNQDXCFYNBFSDQXYXHYAYKQYDDLQYYYSSZBYDSLNTFQTZQPZMCHDHCZCWFDXTMYQSPHQYYXSRGJCWTJTZZQMGWJJTJHTQJBBHWZPXXHYQFXXQYWYYHYSCDYDHHQMNMTMWCPBSZPPZZGLMZFOLLCFWHMMSJZTTDHZZYFFYTZZGZYSKYJXQYJZQBHMBZZLYGHGFMSHPZFZSNCLPBQSNJXZSLXXFPMTYJYGBXLLDLXPZJYZJYHHZCYWHJYLSJEXFSZZYWXKZJLUYDTMLYMQJPWXYHXSKTQJEZRPXXZHHMHWQPWQLYJJQJJZSZCPHJLCHHNXJLQWZJHBMZYXBDHHYPZLHLHLGFWLCHYYTLHJXCJMSCPXSTKPNHQXSRTYXXTESYJCTLSSLSTDLLLWWYHDHRJZSFGXTSYCZYNYHTDHWJSLHTZDQDJZXXQHGYLTZPHCSQFCLNJTCLZPFSTPDYNYLGMJLLYCQHYSSHCHYLHQYQTMZYPBYWRFQYKQSYSLZDQJMPXYYSSRHZJNYWTQDFZBWWTWWRXCWHGYHXMKMYYYQMSMZHNGCEPMLQQMTCWCTMMPXJPJJHFXYYZSXZHTYBMSTSYJTTQQQYYLHYNPYQZLCYZHZWSMYLKFJXLWGXYPJYTYSYXYMZCKTTWLKSMZSYLMPWLZWXWQZSSAQSYXYRHSSNTSRAPXCPWCMGDXHXZDZYFJHGZTTSBJHGYZSZYSMYCLLLXBTYXHBBZJKSSDMALXHYCFYGMQYPJYCQXJLLLJGSLZGQLYCJCCZOTYXMTMTTLLWTGPXYMZMKLPSZZZXHKQYSXCTYJZYHXSHYXZKXLZWPSQPYHJWPJPWXQQYLXSDHMRSLZZYZWTTCYXYSZZSHBSCCSTPLWSSCJCHNLCGCHSSPHYLHFHHXJSXYLLNYLSZDHZXYLSXLWZYKCLDYAXZCMDDYSPJTQJZLNWQPSSSWCTSTSZLBLNXSMNYYMJQBQHRZWTYYDCHQLXKPZWBGQYBKFCMZWPZLLYYLSZYDWHXPSBCMLJBSCGBHXLQHYRLJXYSWXWXZSLDFHLSLYNJLZYFLYJYCDRJLFSYZFSLLCQYQFGJYHYXZLYLMSTDJCYHBZLLNWLXXYGYYHSMGDHXXHHLZZJZXCZZZCYQZFNGWPYLCPKPYYPMCLQKDGXZGGWQBDXZZKZFBXXLZXJTPJPTTBYTSZZDWSLCHZHSLTYXHQLHYXXXYYZYSWTXZKHLXZXZPYHGCHKCFSYHUTJRLXFJXPTZTWHPLYXFCRHXSHXKYXXYHZQDXQWULHYHMJTBFLKHTXCWHJFWJCFPQRYQXCYYYQYGRPYWSGSUNGWCHKZDXYFLXXHJJBYZWTSXXNCYJJYMSWZJQRMHXZWFQSYLZJZGBHYNSLBGTTCSYBYXXWXYHXYYXNSQYXMQYWRGYQLXBBZLJSYLPSYTJZYHYZAWLRORJMKSCZJXXXYXCHDYXRYXXJDTSQFXLYLTSFFYXLMTYJMJUYYYXLTZCSXQZQHZXLYYXZHDNBRXXXJCTYHLBRLMBRLLAXKYLLLJLYXXLYCRYLCJTGJCMTLZLLCYZZPZPCYAWHJJFYBDYYZSMPCKZDQYQPBPCJPDCYZMDPBCYYDYCNNPLMTMLRMFMMGWYZBSJGYGSMZQQQZTXMKQWGXLLPJGZBQCDJJJFPKJKCXBLJMSWMDTQJXLDLPPBXCWRCQFBFQJCZAHZGMYKPHYYHZYKNDKZMBPJYXPXYHLFPNYYGXJDBKXNXHJMZJXSTRSTLDXSKZYSYBZXJLXYSLBZYSLHXJPFXPQNBYLLJQKYGZMCYZZYMCCSLCLHZFWFWYXZMWSXTYNXJHPYYMCYSPMHYSMYDYSHQYZCHMJJMZCAAGCFJBBHPLYZYLXXSDJGXDHKXXTXXNBHRMLYJSLTXMRHNLXQJXYZLLYSWQGDLBJHDCGJYQYCMHWFMJYBMBYJYJWYMDPWHXQLDYGPDFXXBCGJSPCKRSSYZJMSLBZZJFLJJJLGXZGYXYXLSZQYXBEXYXHGCXBPLDYHWETTWWCJMBTXCHXYQXLLXFLYXLLJLSSFWDPZSMYJCLMWYTCZPCHQEKCQBWLCQYDPLQPPQZQFJQDJHYMMCXTXDRMJWRHXCJZYLQXDYYNHYYHRSLSRSYWWZJYMTLTLLGTQCJZYABTCKZCJYCCQLJZQXALMZYHYWLWDXZXQDLLQSHGPJFJLJHJABCQZDJGTKHSSTCYJLPSWZLXZXRWGLDLZRLZXTGSLLLLZLYXXWGDZYGBDPHZPBRLWSXQBPFDWOFMWHLYPCBJCCLDMBZPBZZLCYQXLDOMZBLZWPDWYYGDSTTHCSQSCCRSSSYSLFYBFNTYJSZDFNDPDHDZZMBBLSLCMYFFGTJJQWFTMTPJWFNLBZCMMJTGBDZLQLPYFHYYMJYLSDCHDZJWJCCTLJCLDTLJJCPDDSQDSSZYBNDBJLGGJZXSXNLYCYBJXQYCBYLZCFZPPGKCXZDZFZTJJFJSJXZBNZYJQTTYJYHTYCZHYMDJXTTMPXSPLZCDWSLSHXYPZGTFMLCJTYCBPMGDKWYCYZCDSZZYHFLYCTYGWHKJYYLSJCXGYWJCBLLCSNDDBTZBSCLYZCZZSSQDLLMQYYHFSLQLLXFTYHABXGWNYWYYPLLSDLDLLBJCYXJZMLHLJDXYYQYTDLLLBUGBFDFBBQJZZMDPJHGCLGMJJPGAEHHBWCQXAXHHHZCHXYPHJAXHLPHJPGPZJQCQZGJJZZUZDMQYYBZZPHYHYBWHAZYJHYKFGDPFQSDLZMLJXKXGALXZDAGLMDGXMWZQYXXDXXPFDMMSSYMPFMDMMKXKSYZYSHDZKXSYSMMZZZMSYDNZZCZXFPLSTMZDNMXCKJMZTYYMZMZZMSXHHDCZJEMXXKLJSTLWLSQLYJZLLZJSSDPPMHNLZJCZYHMXXHGZCJMDHXTKGRMXFWMCGMWKDTKSXQMMMFZZYDKMSCLCMPCGMHSPXQPZDSSLCXKYXTWLWJYAHZJGZQMCSNXYYMMPMLKJXMHLMLQMXCTKZMJQYSZJSYSZHSYJZJCDAJZYBSDQJZGWZQQXFKDMSDJLFWEHKZQKJPEYPZYSZCDWYJFFMZZYLTTDZZEFMZLBNPPLPLPEPSZALLTYLKCKQZKGENQLWAGYXYDPXLHSXQQWQCQXQCLHYXXMLYCCWLYMQYSKGCHLCJNSZKPYZKCQZQLJPDMDZHLASXLBYDWQLWDNBQCRYDDZTJYBKBWSZDXDTNPJDTCTQDFXQQMGNXECLTTBKPWSLCTYQLPWYZZKLPYGZCQQPLLKCCYLPQMZCZQCLJSLQZDJXLDDHPZQDLJJXZQDXYZQKZLJCYQDYJPPYPQYKJYRMPCBYMCXKLLZLLFQPYLLLMBSGLCYSSLRSYSQTMXYXZQZFDZUYSYZTFFMZZSMZQHZSSCCMLYXWTPZGXZJGZGSJSGKDDHTQGGZLLBJDZLCBCHYXYZHZFYWXYZYMSDBZZYJGTSMTFXQYXQSTDGSLNXDLRYZZLRYYLXQHTXSRTZNGZXBNQQZFMYKMZJBZYMKBPNLYZPBLMCNQYZZZSJZHJCTZKHYZZJRDYZHNPXGLFZTLKGJTCTSSYLLGZRZBBQZZKLPKLCZYSSUYXBJFPNJZZXCDWXZYJXZZDJJKGGRSRJKMSMZJLSJYWQSKYHQJSXPJZZZLSNSHRNYPZTWCHKLPSRZLZXYJQXQKYSJYCZTLQZYBBYBWZPQDWWYZCYTJCJXCKCWDKKZXSGKDZXWWYYJQYYTCYTDLLXWKCZKKLCCLZCQQDZLQLCSFQCHQHSFSMQZZLNBJJZBSJHTSZDYSJQJPDLZCDCWJKJZZLPYCGMZWDJJBSJQZSYZYHHXJPBJYDSSXDZNCGLQMBTSFSBPDZDLZNFGFJGFSMPXJQLMBLGQCYYXBQKDJJQYRFKZTJDHCZKLBSDZCFJTPLLJGXHYXZCSSZZXSTJYGKGCKGYOQXJPLZPBPGTGYJZGHZQZZLBJLSQFZGKQQJZGYCZBZQTLDXRJXBSXXPZXHYZYCLWDXJJHXMFDZPFZHQHQMQGKSLYHTYCGFRZGNQXCLPDLBZCSCZQLLJBLHBZCYPZZPPDYMZZSGYHCKCPZJGSLJLNSCDSLDLXBMSTLDDFJMKDJDHZLZXLSZQPQPGJLLYBDSZGQLBZLSLKYYHZTTNTJYQTZZPSZQZTLLJTYYLLQLLQYZQLBDZLSLYYZYMDFSZSNHLXZNCZQZPBWSKRFBSYZMTHBLGJPMCZZLSTLXSHTCSYZLZBLFEQHLXFLCJLYLJQCBZLZJHHSSTBRMHXZHJZCLXFNBGXGTQJCZTMSFZKJMSSNXLJKBHSJXNTNLZDNTLMSJXGZJYJCZXYJYJWRWWQNZTNFJSZPZSHZJFYRDJSFSZJZBJFZQZZHZLXFYSBZQLZSGYFTZDCSZXZJBQMSZKJRHYJZCKMJKHCHGTXKXQGLXPXFXTRTYLXJXHDTSJXHJZJXZWZLCQSBTXWXGXTXXHXFTSDKFJHZYJFJXRZSDLLLTQSQQZQWZXSYQTWGWBZCGZLLYZBCLMQQTZHZXZXLJFRMYZFLXYSQXXJKXRMQDZDMMYYBSQBHGZMWFWXGMXLZPYYTGZYCCDXYZXYWGSYJYZNBHPZJSQSYXSXRTFYZGRHZTXSZZTHCBFCLSYXZLZQMZLMPLMXZJXSFLBYZMYQHXJSXRXSQZZZSSLYFRCZJRCRXHHZXQYDYHXSJJHZCXZBTYNSYSXJBQLPXZQPYMLXZKYXLXCJLCYSXXZZLXDLLLJJYHZXGYJWKJRWYHCPSGNRZLFZWFZZNSXGXFLZSXZZZBFCSYJDBRJKRDHHGXJLJJTGXJXXSTJTJXLYXQFCSGSWMSBCTLQZZWLZZKXJMLTMJYHSDDBXGZHDLBMYJFRZFSGCLYJBPMLYSMSXLSZJQQHJZFXGFQFQBPXZGYYQXGZTCQWYLTLGWSGWHRLFSFGZJMGMGBGTJFSYZZGZYZAFLSSPMLPFLCWBJZCLJJMZLPJJLYMQDMYYYFBGYGYZMLYZDXQYXRQQQHSYYYQXYLJTYXFSFSLLGNQCYHYCWFHCCCFXPYLYPLLZYXXXXXKQHHXSHJZCFZSCZJXCPZWHHHHHAPYLQALPQAFYHXDYLUKMZQGGGDDESRNNZLTZGCHYPPYSQJJHCLLJTOLNJPZLJLHYMHEYDYDSQYCDDHGZUNDZCLZYZLLZNTNYZGSLHSLPJJBDGWXPCDUTJCKLKCLWKLLCASSTKZZDNQNTTLYYZSSYSSZZRYLJQKCQDHHCRXRZYDGRGCWCGZQFFFPPJFZYNAKRGYWYQPQXXFKJTSZZXSWZDDFBBXTBGTZKZNPZZPZXZPJSZBMQHKCYXYLDKLJNYPKYGHGDZJXXEAHPNZKZTZCMXCXMMJXNKSZQNMNLWBWWXJKYHCPSTMCSQTZJYXTPCTPDTNNPGLLLZSJLSPBLPLQHDTNJNLYYRSZFFJFQWDPHZDWMRZCCLODAXNSSNYZRESTYJWJYJDBCFXNMWTTBYLWSTSZGYBLJPXGLBOCLHPCBJLTMXZLJYLZXCLTPNCLCKXTPZJSWCYXSFYSZDKNTLBYJCYJLLSTGQCBXRYZXBXKLYLHZLQZLNZCXWJZLJZJNCJHXMNZZGJZZXTZJXYCYYCXXJYYXJJXSSSJSTSSTTPPGQTCSXWZDCSYFPTFBFHFBBLZJCLZZDBXGCXLQPXKFZFLSYLTUWBMQJHSZBMDDBCYSCCLDXYCDDQLYJJWMQLLCSGLJJSYFPYYCCYLTJANTJJPWYCMMGQYYSXDXQMZHSZXPFTWWZQSWQRFKJLZJQQYFBRXJHHFWJJZYQAZMYFRHCYYBYQWLPEXCCZSTYRLTTDMQLYKMBBGMYYJPRKZNPBSXYXBHYZDJDNGHPMFSGMWFZMFQMMBCMZZCJJLCNUXYQLMLRYGQZCYXZLWJGCJCGGMCJNFYZZJHYCPRRCMTZQZXHFQGTJXCCJEAQCRJYHPLQLSZDJRBCQHQDYRHYLYXJSYMHZYDWLDFRYHBPYDTSSCNWBXGLPZMLZZTQSSCPJMXXYCSJYTYCGHYCJWYRXXLFEMWJNMKLLSWTXHYYYNCMMCWJDQDJZGLLJWJRKHPZGGFLCCSCZMCBLTBHBQJXQDSPDJZZGKGLFQYWBZYZJLTSTDHQHCTCBCHFLQMPWDSHYYTQWCNZZJTLBYMBPDYYYXSQKXWYYFLXXNCWCXYPMAELYKKJMZZZBRXYYQJFLJPFHHHYTZZXSGQQMHSPGDZQWBWPJHZJDYSCQWZKTXXSQLZYYMYSDZGRXCKKUJLWPYSYSCSYZLRMLQSYLJXBCXTLWDQZPCYCYKPPPNSXFYZJJRCEMHSZMSXLXGLRWGCSTLRSXBZGBZGZTCPLUJLSLYLYMTXMTZPALZXPXJTJWTCYYZLBLXBZLQMYLXPGHDSLSSDMXMBDZZSXWHAMLCZCPJMCNHJYSNSYGCHSKQMZZQDLLKABLWJXSFMOCDXJRRLYQZKJMYBYQLYHETFJZFRFKSRYXFJTWDSXXSYSQJYSLYXWJHSNLXYYXHBHAWHHJZXWMYLJCSSLKYDZTXBZSYFDXGXZJKHSXXYBSSXDPYNZWRPTQZCZENYGCXQFJYKJBZMLJCMQQXUOXSLYXXLYLLJDZBTYMHPFSTTQQWLHOKYBLZZALZXQLHZWRRQHLSTMYPYXJJXMQSJFNBXYXYJXXYQYLTHYLQYFMLKLJTMLLHSZWKZHLJMLHLJKLJSTLQXYLMBHHLNLZXQJHXCFXXLHYHJJGBYZZKBXSCQDJQDSUJZYYHZHHMGSXCSYMXFEBCQWWRBPYYJQTYZCYQYQQZYHMWFFHGZFRJFCDPXNTQYZPDYKHJLFRZXPPXZDBBGZQSTLGDGYLCQMLCHHMFYWLZYXKJLYPQHSYWMQQGQZMLZJNSQXJQSYJYCBEHSXFSZPXZWFLLBCYYJDYTDTHWZSFJMQQYJLMQXXLLDTTKHHYBFPWTYYSQQWNQWLGWDEBZWCMYGCULKJXTMXMYJSXHYBRWFYMWFRXYQMXYSZTZZTFYKMLDHQDXWYYNLCRYJBLPSXCXYWLSPRRJWXHQYPHTYDNXHHMMYWYTZCSQMTSSCCDALWZTCPQPYJLLQZYJSWXMZZMMYLMXCLMXCZMXMZSQTZPPQQBLPGXQZHFLJJHYTJSRXWZXSCCDLXTYJDCQJXSLQYCLZXLZZXMXQRJMHRHZJBHMFLJLMLCLQNLDXZLLLPYPSYJYSXCQQDCMQJZZXHNPNXZMEKMXHYKYQLXSXTXJYYHWDCWDZHQYYBGYBCYSCFGPSJNZDYZZJZXRZRQJJYMCANYRJTLDPPYZBSTJKXXZYPFDWFGZZRPYMTNGXZQBYXNBUFNQKRJQZMJEGRZGYCLKXZDSKKNSXKCLJSPJYYZLQQJYBZSSQLLLKJXTBKTYLCCDDBLSPPFYLGYDTZJYQGGKQTTFZXBDKTYYHYBBFYTYYBCLPDYTGDHRYRNJSPTCSNYJQHKLLLZSLYDXXWBCJQSPXBPJZJCJDZFFXXBRMLAZHCSNDLBJDSZBLPRZTSWSBXBCLLXXLZDJZSJPYLYXXYFTFFFBHJJXGBYXJPMMMPSSJZJMTLYZJXSWXTYLEDQPJMYGQZJGDJLQJWJQLLSJGJGYGMSCLJJXDTYGJQJQJCJZCJGDZZSXQGSJGGCXHQXSNQLZZBXHSGZXCXYLJXYXYYDFQQJHJFXDHCTXJYRXYSQTJXYEFYYSSYYJXNCYZXFXMSYSZXYYSCHSHXZZZGZZZGFJDLTYLNPZGYJYZYYQZPBXQBDZTZCZYXXYHHSQXSHDHGQHJHGYWSZTMZMLHYXGEBTYLZKQWYTJZRCLEKYSTDBCYKQQSAYXCJXWWGSBHJYZYDHCSJKQCXSWXFLTYNYZPZCCZJQTZWJQDZZZQZLJJXLSBHPYXXPSXSHHEZTXFPTLQYZZXHYTXNCFZYYHXGNXMYWXTZSJPTHHGYMXMXQZXTSBCZYJYXXTYYZYPCQLMMSZMJZZLLZXGXZAAJZYXJMZXWDXZSXZDZXLEYJJZQBHZWZZZQTZPSXZTDSXJJJZNYAZPHXYYSRNQDTHZHYYKYJHDZXZLSWCLYBZYECWCYCRYLCXNHZYDZYDYJDFRJJHTRSQTXYXJRJHOJYNXELXSFSFJZGHPZSXZSZDZCQZBYYKLSGSJHCZSHDGQGXYZGXCHXZJWYQWGYHKSSEQZZNDZFKWYSSTCLZSTSYMCDHJXXYWEYXCZAYDMPXMDSXYBSQMJMZJMTZQLPJYQZCGQHXJHHLXXHLHDLDJQCLDWBSXFZZYYSCHTYTYYBHECXHYKGJPXHHYZJFXHWHBDZFYZBCAPNPGNYDMSXHMMMMAMYNBYJTMPXYYMCTHJBZYFCGTYHWPHFTWZZEZSBZEGPFMTSKFTYCMHFLLHGPZJXZJGZJYXZSBBQSCZZLZCCSTPGXMJSFTCCZJZDJXCYBZLFCJSYZFGSZLYBCWZZBYZDZYPSWYJZXZBDSYUXLZZBZFYGCZXBZHZFTPBGZGEJBSTGKDMFHYZZJHZLLZZGJQZLSFDJSSCBZGPDLFZFZSZYZYZSYGCXSNXXCHCZXTZZLJFZGQSQYXZJQDCCZTQCDXZJYQJQCHXZTDLGSCXZSYQJQTZWLQDQZTQCHQQJZYEZZZPBWKDJFCJPZTYPQYQTTYNLMBDKTJZPQZQZZFPZSBNJLGYJDXJDZZKZGQKXDLPZJTCJDQBXDJQJSTCKNXBXZMSLYJCQMTJQWWCJQNJNLLLHJCWQTBZQYDZCZPZZDZYDDCYZZZCCJTTJFZDPRRTZTJDCQTQZDTJNPLZBCLLCTZSXKJZQZPZLBZRBTJDCXFCZDBCCJJLTQQPLDCGZDBBZJCQDCJWYNLLZYZCCDWLLXWZLXRXNTQQCZXKQLSGDFQTDDGLRLAJJTKUYMKQLLTZYTDYYCZGJWYXDXFRSKSTQTENQMRKQZHHQKDLDAZFKYPBGGPZREBZZYKZZSPEGJXGYKQZZZSLYSYYYZWFQZYLZZLZHWCHKYPQGNPGBLPLRRJYXCCSYYHSFZFYBZYYTGZXYLXCZWXXZJZBLFFLGSKHYJZEYJHLPLLLLCZGXDRZELRHGKLZZYHZLYQSZZJZQLJZFLNBHGWLCZCFJYSPYXZLZLXGCCPZBLLCYBBBBUBBCBPCRNNZCZYRBFSRLDCGQYYQXYGMQZWTZYTYJXYFWTEHZZJYWLCCNTZYJJZDEDPZDZTSYQJHDYMBJNYJZLXTSSTPHNDJXXBYXQTZQDDTJTDYYTGWSCSZQFLSHLGLBCZPHDLYZJYCKWTYTYLBNYTSDSYCCTYSZYYEBHEXHQDTWNYGYCLXTSZYSTQMYGZAZCCSZZDSLZCLZRQXYYELJSBYMXSXZTEMBBLLYYLLYTDQYSHYMRQWKFKBFXNXSBYCHXBWJYHTQBPBSBWDZYLKGZSKYHXQZJXHXJXGNLJKZLYYCDXLFYFGHLJGJYBXQLYBXQPQGZTZPLNCYPXDJYQYDYMRBESJYYHKXXSTMXRCZZYWXYQYBMCLLYZHQYZWQXDBXBZWZMSLPDMYSKFMZKLZCYQYCZLQXFZZYDQZPZYGYJYZMZXDZFYFYTTQTZHGSPCZMLCCYTZXJCYTJMKSLPZHYSNZLLYTPZCTZZCKTXDHXXTQCYFKSMQCCYYAZHTJPCYLZLYJBJXTPNYLJYYNRXSYLMMNXJSMYBCSYSYLZYLXJJQYLDZLPQBFZZBLFNDXQKCZFYWHGQMRDSXYCYTXNQQJZYYPFZXDYZFPRXEJDGYQBXRCNFYYQPGHYJDYZXGRHTKYLNWDZNTSMPKLBTHBPYSZBZTJZSZZJTYYXZPHSSZZBZCZPTQFZMYFLYPYBBJQXZMXXDJMTSYSKKBJZXHJCKLPSMKYJZCXTMLJYXRZZQSLXXQPYZXMKYXXXJCLJPRMYYGADYSKQLSNDHYZKQXZYZTCGHZTLMLWZYBWSYCTBHJHJFCWZTXWYTKZLXQSHLYJZJXTMPLPYCGLTBZZTLZJCYJGDTCLKLPLLQPJMZPAPXYZLKKTKDZCZZBNZDYDYQZJYJGMCTXLTGXSZLMLHBGLKFWNWZHDXUHLFMKYSLGXDTWWFRJEJZTZHYDXYKSHWFZCQSHKTMQQHTZHYMJDJSKHXZJZBZZXYMPAGQMSTPXLSKLZYNWRTSQLSZBPSPSGZWYHTLKSSSWHZZLYYTNXJGMJSZSUFWNLSOZTXGXLSAMMLBWLDSZYLAKQCQCTMYCFJBSLXCLZZCLXXKSBZQCLHJPSQPLSXXCKSLNHPSFQQYTXYJZLQLDXZQJZDYYDJNZPTUZDSKJFSLJHYLZSQZLBTXYDGTQFDBYAZXDZHZJNHHQBYKNXJJQCZMLLJZKSPLDYCLBBLXKLELXJLBQYCXJXGCNLCQPLZLZYJTZLJGYZDZPLTQCSXFDMNYCXGBTJDCZNBGBQYQJWGKFHTNPYQZQGBKPBBYZMTJDYTBLSQMPSXTBNPDXKLEMYYCJYNZCTLDYKZZXDDXHQSHDGMZSJYCCTAYRZLPYLTLKXSLZCGGEXCLFXLKJRTLQJAQZNCMBYDKKCXGLCZJZXJHPTDJJMZQYKQSECQZDSHHADMLZFMMZBGNTJNNLGBYJBRBTMLBYJDZXLCJLPLDLPCQDHLXZLYCBLCXZZJADJLNZMMSSSMYBHBSQKBHRSXXJMXSDZNZPXLGBRHWGGFCXGMSKLLTSJYYCQLTSKYWYYHYWXBXQYWPYWYKQLSQPTNTKHQCWDQKTWPXXHCPTHTWUMSSYHBWCRWXHJMKMZNGWTMLKFGHKJYLSYYCXWHYECLQHKQHTTQKHFZLDXQWYZYYDESBPKYRZPJFYYZJCEQDZZDLATZBBFJLLCXDLMJSSXEGYGSJQXCWBXSSZPDYZCXDNYXPPZYDLYJCZPLTXLSXYZYRXCYYYDYLWWNZSAHJSYQYHGYWWAXTJZDAXYSRLTDPSSYYFNEJDXYZHLXLLLZQZSJNYQYQQXYJGHZGZCYJCHZLYCDSHWSHJZYJXCLLNXZJJYYXNFXMWFPYLCYLLABWDDHWDXJMCXZTZPMLQZHSFHZYNZTLLDYWLSLXHYMMYLMBWWKYXYADTXYLLDJPYBPWUXJMWMLLSAFDLLYFLBHHHBQQLTZJCQJLDJTFFKMMMBYTHYGDCQRDDWRQJXNBYSNWZDBYYTBJHPYBYTTJXAAHGQDQTMYSTQXKBTZPKJLZRBEQQSSMJJBDJOTGTBXPGBKTLHQXJJJCTHXQDWJLWRFWQGWSHCKRYSWGFTGYGBXSDWDWRFHWYTJJXXXJYZYSLPYYYPAYXHYDQKXSHXYXGSKQHYWFDDDPPLCJLQQEEWXKSYYKDYPLTJTHKJLTCYYHHJTTPLTZZCDLTHQKZXQYSTEEYWYYZYXXYYSTTJKLLPZMCYHQGXYHSRMBXPLLNQYDQHXSXXWGDQBSHYLLPJJJTHYJKYPPTHYYKTYEZYENMDSHLCRPQFDGFXZPSFTLJXXJBSWYYSKSFLXLPPLBBBLBSFXFYZBSJSSYLPBBFFFFSSCJDSTZSXZRYYSYFFSYZYZBJTBCTSBSDHRTJJBYTCXYJEYLXCBNEBJDSYXYKGSJZBXBYTFZWGENYHHTHZHHXFWGCSTBGXKLSXYWMTMBYXJSTZSCDYQRCYTWXZFHMYMCXLZNSDJTTTXRYCFYJSBSDYERXJLJXBBDEYNJGHXGCKGSCYMBLXJMSZNSKGXFBNBPTHFJAAFXYXFPXMYPQDTZCXZZPXRSYWZDLYBBKTYQPQJPZYPZJZNJPZJLZZFYSBTTSLMPTZRTDXQSJEHBZYLZDHLJSQMLHTXTJECXSLZZSPKTLZKQQYFSYGYWPCPQFHQHYTQXZKRSGTTSQCZLPTXCDYYZXSQZSLXLZMYCPCQBZYXHBSXLZDLTCDXTYLZJYYZPZYZLTXJSJXHLPMYTXCQRBLZSSFJZZTNJYTXMYJHLHPPLCYXQJQQKZZSCPZKSWALQSBLCCZJSXGWWWYGYKTJBBZTDKHXHKGTGPBKQYSLPXPJCKBMLLXDZSTBKLGGQKQLSBKKTFXRMDKBFTPZFRTBBRFERQGXYJPZSSTLBZTPSZQZSJDHLJQLZBPMSMMSXLQQNHKNBLRDDNXXDHDDJCYYGYLXGZLXSYGMQQGKHBPMXYXLYTQWLWGCPBMQXCYZYDRJBHTDJYHQSHTMJSBYPLWHLZFFNYPMHXXHPLTBQPFBJWQDBYGPNZTPFZJGSDDTQSHZEAWZZYLLTYYBWJKXXGHLFKXDJTMSZSQYNZGGSWQSPHTLSSKMCLZXYSZQZXNCJDQGZDLFNYKLJCJLLZLMZZNHYDSSHTHZZLZZBBHQZWWYCRZHLYQQJBEYFXXXWHSRXWQHWPSLMSSKZTTYGYQQWRSLALHMJTQJSMXQBJJZJXZYZKXBYQXBJXSHZTSFJLXMXZXFGHKZSZGGYLCLSARJYHSLLLMZXELGLXYDJYTLFBHBPNLYZFBBHPTGJKWETZHKJJXZXXGLLJLSTGSHJJYQLQZFKCGNNDJSSZFDBCTWWSEQFHQJBSAQTGYPQLBXBMMYWXGSLZHGLZGQYFLZBYFZJFRYSFMBYZHQGFWZSYFYJJPHZBYYZFFWODGRLMFTWLBZGYCQXCDJYGZYYYYTYTYDWEGAZYHXJLZYYHLRMGRXXZCLHNELJJTJTPWJYBJJBXJJTJTEEKHWSLJPLPSFYZPQQBDLQJJTYYQLYZKDKSQJYYQZLDQTGJQYZJSUCMRYQTHTEJMFCTYHYPKMHYZWJDQFHYYXWSHCTXRLJHQXHCCYYYJLTKTTYTMXGTCJTZAYYOCZLYLBSZYWJYTSJYHBYSHFJLYGJXXTMZYYLTXXYPZLXYJZYZYYPNHMYMDYYLBLHLSYYQQLLNJJYMSOYQBZGDLYXYLCQYXTSZEGXHZGLHWBLJHEYXTWQMAKBPQCGYSHHEGQCMWYYWLJYJHYYZLLJJYLHZYHMGSLJLJXCJJYCLYCJPCPZJZJMMYLCQLNQLJQJSXYJMLSZLJQLYCMMHCFMMFPQQMFYLQMCFFQMMMMHMZNFHHJGTTHHKHSLNCHHYQDXTMMQDCYZYXYQMYQYLTDCYYYZAZZCYMZYDLZFFFMMYCQZWZZMABTBYZTDMNZZGGDFTYPCGQYTTSSFFWFDTZQSSYSTWXJHXYTSXXYLBYQHWWKXHZXWZNNZZJZJJQJCCCHYYXBZXZCYZTLLCQXYNJYCYYCYNZZQYYYEWYCZDCJYCCHYJLBTZYYCQWMPWPYMLGKDLDLGKQQBGYCHJXY",this.full_dict={a:"啊阿锕",ai:"埃挨哎唉哀皑癌蔼矮艾碍爱隘诶捱嗳嗌嫒瑷暧砹锿霭",an:"鞍氨安俺按暗岸胺案谙埯揞犴庵桉铵鹌顸黯",ang:"肮昂盎",ao:"凹敖熬翱袄傲奥懊澳坳拗嗷噢岙廒遨媪骜聱螯鏊鳌鏖",ba:"芭捌扒叭吧笆八疤巴拔跋靶把耙坝霸罢爸茇菝萆捭岜灞杷钯粑鲅魃",bai:"白柏百摆佰败拜稗薜掰鞴",ban:"斑班搬扳般颁板版扮拌伴瓣半办绊阪坂豳钣瘢癍舨",bang:"邦帮梆榜膀绑棒磅蚌镑傍谤蒡螃",bao:"苞胞包褒雹保堡饱宝抱报暴豹鲍爆勹葆宀孢煲鸨褓趵龅",bo:"剥薄玻菠播拨钵波博勃搏铂箔伯帛舶脖膊渤泊驳亳蕃啵饽檗擘礴钹鹁簸跛",bei:"杯碑悲卑北辈背贝钡倍狈备惫焙被孛陂邶埤蓓呗怫悖碚鹎褙鐾",ben:"奔苯本笨畚坌锛",beng:"崩绷甭泵蹦迸唪嘣甏",bi:"逼鼻比鄙笔彼碧蓖蔽毕毙毖币庇痹闭敝弊必辟壁臂避陛匕仳俾芘荜荸吡哔狴庳愎滗濞弼妣婢嬖璧贲畀铋秕裨筚箅篦舭襞跸髀",bian:"鞭边编贬扁便变卞辨辩辫遍匾弁苄忭汴缏煸砭碥稹窆蝙笾鳊",biao:"标彪膘表婊骠飑飙飚灬镖镳瘭裱鳔",bie:"鳖憋别瘪蹩鳘",bin:"彬斌濒滨宾摈傧浜缤玢殡膑镔髌鬓",bing:"兵冰柄丙秉饼炳病并禀邴摒绠枋槟燹",bu:"捕卜哺补埠不布步簿部怖拊卟逋瓿晡钚醭",ca:"擦嚓礤",cai:"猜裁材才财睬踩采彩菜蔡",can:"餐参蚕残惭惨灿骖璨粲黪",cang:"苍舱仓沧藏伧",cao:"操糙槽曹草艹嘈漕螬艚",ce:"厕策侧册测刂帻恻",ceng:"层蹭噌",cha:"插叉茬茶查碴搽察岔差诧猹馇汊姹杈楂槎檫钗锸镲衩",chai:"拆柴豺侪茈瘥虿龇",chan:"搀掺蝉馋谗缠铲产阐颤冁谄谶蒇廛忏潺澶孱羼婵嬗骣觇禅镡裣蟾躔",chang:"昌猖场尝常长偿肠厂敞畅唱倡伥鬯苌菖徜怅惝阊娼嫦昶氅鲳",chao:"超抄钞朝嘲潮巢吵炒怊绉晁耖",che:"车扯撤掣彻澈坼屮砗",chen:"郴臣辰尘晨忱沉陈趁衬称谌抻嗔宸琛榇肜胂碜龀",cheng:"撑城橙成呈乘程惩澄诚承逞骋秤埕嵊徵浈枨柽樘晟塍瞠铖裎蛏酲",chi:"吃痴持匙池迟弛驰耻齿侈尺赤翅斥炽傺墀芪茌搋叱哧啻嗤彳饬沲媸敕胝眙眵鸱瘛褫蚩螭笞篪豉踅踟魑",chong:"充冲虫崇宠茺忡憧铳艟",chou:"抽酬畴踌稠愁筹仇绸瞅丑俦圳帱惆溴妯瘳雠鲋",chu:"臭初出橱厨躇锄雏滁除楚础储矗搐触处亍刍憷绌杵楮樗蜍蹰黜",chuan:"揣川穿椽传船喘串掾舛惴遄巛氚钏镩舡",chuang:"疮窗幢床闯创怆",chui:"吹炊捶锤垂陲棰槌",chun:"春椿醇唇淳纯蠢促莼沌肫朐鹑蝽",chuo:"戳绰蔟辶辍镞踔龊",ci:"疵茨磁雌辞慈瓷词此刺赐次荠呲嵯鹚螅糍趑",cong:"聪葱囱匆从丛偬苁淙骢琮璁枞",cu:"凑粗醋簇猝殂蹙",cuan:"蹿篡窜汆撺昕爨",cui:"摧崔催脆瘁粹淬翠萃悴璀榱隹",cun:"村存寸磋忖皴",cuo:"撮搓措挫错厝脞锉矬痤鹾蹉躜",da:"搭达答瘩打大耷哒嗒怛妲疸褡笪靼鞑",dai:"呆歹傣戴带殆代贷袋待逮怠埭甙呔岱迨逯骀绐玳黛",dan:"耽担丹单郸掸胆旦氮但惮淡诞弹蛋亻儋卩萏啖澹檐殚赕眈瘅聃箪",dang:"当挡党荡档谠凼菪宕砀铛裆",dao:"刀捣蹈倒岛祷导到稻悼道盗叨啁忉洮氘焘忑纛",de:"德得的锝",deng:"蹬灯登等瞪凳邓噔嶝戥磴镫簦",di:"堤低滴迪敌笛狄涤翟嫡抵底地蒂第帝弟递缔氐籴诋谛邸坻莜荻嘀娣柢棣觌砥碲睇镝羝骶",dian:"颠掂滇碘点典靛垫电佃甸店惦奠淀殿丶阽坫埝巅玷癜癫簟踮",diao:"碉叼雕凋刁掉吊钓调轺铞蜩粜貂",die:"跌爹碟蝶迭谍叠佚垤堞揲喋渫轶牒瓞褶耋蹀鲽鳎",ding:"丁盯叮钉顶鼎锭定订丢仃啶玎腚碇町铤疔耵酊",dong:"东冬董懂动栋侗恫冻洞垌咚岽峒夂氡胨胴硐鸫",dou:"兜抖斗陡豆逗痘蔸钭窦窬蚪篼酡",du:"都督毒犊独读堵睹赌杜镀肚度渡妒芏嘟渎椟橐牍蠹笃髑黩",duan:"端短锻段断缎彖椴煅簖",dui:"堆兑队对怼憝碓",dun:"墩吨蹲敦顿囤钝盾遁炖砘礅盹镦趸",duo:"掇哆多夺垛躲朵跺舵剁惰堕咄哚缍柁铎裰踱",e:"蛾峨鹅俄额讹娥恶厄扼遏鄂饿噩谔垩垭苊莪萼呃愕屙婀轭曷腭硪锇锷鹗颚鳄",en:"恩蒽摁唔嗯",er:"而儿耳尔饵洱二贰迩珥铒鸸鲕",fa:"发罚筏伐乏阀法珐垡砝",fan:"藩帆番翻樊矾钒繁凡烦反返范贩犯饭泛蘩幡犭梵攵燔畈蹯",fang:"坊芳方肪房防妨仿访纺放匚邡彷钫舫鲂",fei:"菲非啡飞肥匪诽吠肺废沸费芾狒悱淝妃绋绯榧腓斐扉祓砩镄痱蜚篚翡霏鲱",fen:"芬酚吩氛分纷坟焚汾粉奋份忿愤粪偾瀵棼愍鲼鼢",feng:"丰封枫蜂峰锋风疯烽逢冯缝讽奉凤俸酆葑沣砜",fu:"佛否夫敷肤孵扶拂辐幅氟符伏俘服浮涪福袱弗甫抚辅俯釜斧脯腑府腐赴副覆赋复傅付阜父腹负富讣附妇缚咐匐凫郛芙苻茯莩菔呋幞滏艴孚驸绂桴赙黻黼罘稃馥虍蚨蜉蝠蝮麸趺跗鳆",ga:"噶嘎蛤尬呷尕尜旮钆",gai:"该改概钙盖溉丐陔垓戤赅胲",gan:"干甘杆柑竿肝赶感秆敢赣坩苷尴擀泔淦澉绀橄旰矸疳酐",gang:"冈刚钢缸肛纲岗港戆罡颃筻",gong:"杠工攻功恭龚供躬公宫弓巩汞拱贡共蕻廾咣珙肱蚣蛩觥",gao:"篙皋高膏羔糕搞镐稿告睾诰郜蒿藁缟槔槁杲锆",ge:"哥歌搁戈鸽胳疙割革葛格阁隔铬个各鬲仡哿塥嗝纥搿膈硌铪镉袼颌虼舸骼髂",gei:"给",gen:"根跟亘茛哏艮",geng:"耕更庚羹埂耿梗哽赓鲠",gou:"钩勾沟苟狗垢构购够佝诟岣遘媾缑觏彀鸲笱篝鞲",gu:"辜菇咕箍估沽孤姑鼓古蛊骨谷股故顾固雇嘏诂菰哌崮汩梏轱牯牿胍臌毂瞽罟钴锢瓠鸪鹄痼蛄酤觚鲴骰鹘",gua:"刮瓜剐寡挂褂卦诖呱栝鸹",guai:"乖拐怪哙",guan:"棺关官冠观管馆罐惯灌贯倌莞掼涫盥鹳鳏",guang:"光广逛犷桄胱疒",gui:"瑰规圭硅归龟闺轨鬼诡癸桂柜跪贵刽匦刿庋宄妫桧炅晷皈簋鲑鳜",gun:"辊滚棍丨衮绲磙鲧",guo:"锅郭国果裹过馘蠃埚掴呙囗帼崞猓椁虢锞聒蜮蜾蝈",ha:"哈",hai:"骸孩海氦亥害骇咴嗨颏醢",han:"酣憨邯韩含涵寒函喊罕翰撼捍旱憾悍焊汗汉邗菡撖阚瀚晗焓颔蚶鼾",hen:"夯痕很狠恨",hang:"杭航沆绗珩桁",hao:"壕嚎豪毫郝好耗号浩薅嗥嚆濠灏昊皓颢蚝",he:"呵喝荷菏核禾和何合盒貉阂河涸赫褐鹤贺诃劾壑藿嗑嗬阖盍蚵翮",hei:"嘿黑",heng:"哼亨横衡恒訇蘅",hong:"轰哄烘虹鸿洪宏弘红黉讧荭薨闳泓",hou:"喉侯猴吼厚候后堠後逅瘊篌糇鲎骺",hu:"呼乎忽瑚壶葫胡蝴狐糊湖弧虎唬护互沪户冱唿囫岵猢怙惚浒滹琥槲轷觳烀煳戽扈祜鹕鹱笏醐斛",hua:"花哗华猾滑画划化话劐浍骅桦铧稞",huai:"槐徊怀淮坏还踝",huan:"欢环桓缓换患唤痪豢焕涣宦幻郇奂垸擐圜洹浣漶寰逭缳锾鲩鬟",huang:"荒慌黄磺蝗簧皇凰惶煌晃幌恍谎隍徨湟潢遑璜肓癀蟥篁鳇",hui:"灰挥辉徽恢蛔回毁悔慧卉惠晦贿秽会烩汇讳诲绘诙茴荟蕙哕喙隳洄彗缋珲晖恚虺蟪麾",hun:"荤昏婚魂浑混诨馄阍溷缗",huo:"豁活伙火获或惑霍货祸攉嚯夥钬锪镬耠蠖",ji:"击圾基机畸稽积箕肌饥迹激讥鸡姬绩缉吉极棘辑籍集及急疾汲即嫉级挤几脊己蓟技冀季伎祭剂悸济寄寂计记既忌际妓继纪居丌乩剞佶佴脔墼芨芰萁蒺蕺掎叽咭哜唧岌嵴洎彐屐骥畿玑楫殛戟戢赍觊犄齑矶羁嵇稷瘠瘵虮笈笄暨跻跽霁鲚鲫髻麂",jia:"嘉枷夹佳家加荚颊贾甲钾假稼价架驾嫁伽郏拮岬浃迦珈戛胛恝铗镓痂蛱笳袈跏",jian:"歼监坚尖笺间煎兼肩艰奸缄茧检柬碱硷拣捡简俭剪减荐槛鉴践贱见键箭件健舰剑饯渐溅涧建僭谏谫菅蒹搛囝湔蹇謇缣枧柙楗戋戬牮犍毽腱睑锏鹣裥笕箴翦趼踺鲣鞯",jiang:"僵姜将浆江疆蒋桨奖讲匠酱降茳洚绛缰犟礓耩糨豇",jiao:"蕉椒礁焦胶交郊浇骄娇嚼搅铰矫侥脚狡角饺缴绞剿教酵轿较叫佼僬茭挢噍峤徼姣纟敫皎鹪蛟醮跤鲛",jie:"窖揭接皆秸街阶截劫节桔杰捷睫竭洁结解姐戒藉芥界借介疥诫届偈讦诘喈嗟獬婕孑桀獒碣锴疖袷颉蚧羯鲒骱髫",jin:"巾筋斤金今津襟紧锦仅谨进靳晋禁近烬浸尽卺荩堇噤馑廑妗缙瑾槿赆觐钅锓衿矜",jing:"劲荆兢茎睛晶鲸京惊精粳经井警景颈静境敬镜径痉靖竟竞净刭儆阱菁獍憬泾迳弪婧肼胫腈旌",jiong:"炯窘冂迥扃",jiu:"揪究纠玖韭久灸九酒厩救旧臼舅咎就疚僦啾阄柩桕鹫赳鬏",ju:"鞠拘狙疽驹菊局咀矩举沮聚拒据巨具距踞锯俱句惧炬剧倨讵苣苴莒掬遽屦琚枸椐榘榉橘犋飓钜锔窭裾趄醵踽龃雎鞫",juan:"捐鹃娟倦眷卷绢鄄狷涓桊蠲锩镌隽",jue:"撅攫抉掘倔爵觉决诀绝厥劂谲矍蕨噘崛獗孓珏桷橛爝镢蹶觖",jun:"均菌钧军君峻俊竣浚郡骏捃狻皲筠麇",ka:"喀咖卡佧咔胩",ke:"咯坷苛柯棵磕颗科壳咳可渴克刻客课岢恪溘骒缂珂轲氪瞌钶疴窠蝌髁",kai:"开揩楷凯慨剀垲蒈忾恺铠锎",kan:"刊堪勘坎砍看侃凵莰莶戡龛瞰",kang:"康慷糠扛抗亢炕坑伉闶钪",kao:"考拷烤靠尻栲犒铐",ken:"肯啃垦恳垠裉颀",keng:"吭忐铿",kong:"空恐孔控倥崆箜",kou:"抠口扣寇芤蔻叩眍筘",ku:"枯哭窟苦酷库裤刳堀喾绔骷",kua:"夸垮挎跨胯侉",kuai:"块筷侩快蒯郐蒉狯脍",kuan:"宽款髋",kuang:"匡筐狂框矿眶旷况诓诳邝圹夼哐纩贶",kui:"亏盔岿窥葵奎魁傀馈愧溃馗匮夔隗揆喹喟悝愦阕逵暌睽聩蝰篑臾跬",kun:"坤昆捆困悃阃琨锟醌鲲髡",kuo:"括扩廓阔蛞",la:"垃拉喇蜡腊辣啦剌摺邋旯砬瘌",lai:"莱来赖崃徕涞濑赉睐铼癞籁",lan:"蓝婪栏拦篮阑兰澜谰揽览懒缆烂滥啉岚懔漤榄斓罱镧褴",lang:"琅榔狼廊郎朗浪莨蒗啷阆锒稂螂",lao:"捞劳牢老佬姥酪烙涝唠崂栳铑铹痨醪",le:"勒乐肋仂叻嘞泐鳓",lei:"雷镭蕾磊累儡垒擂类泪羸诔荽咧漯嫘缧檑耒酹",ling:"棱冷拎玲菱零龄铃伶羚凌灵陵岭领另令酃塄苓呤囹泠绫柃棂瓴聆蛉翎鲮",leng:"楞愣",li:"厘梨犁黎篱狸离漓理李里鲤礼莉荔吏栗丽厉励砾历利傈例俐痢立粒沥隶力璃哩俪俚郦坜苈莅蓠藜捩呖唳喱猁溧澧逦娌嫠骊缡珞枥栎轹戾砺詈罹锂鹂疠疬蛎蜊蠡笠篥粝醴跞雳鲡鳢黧",lian:"俩联莲连镰廉怜涟帘敛脸链恋炼练挛蔹奁潋濂娈琏楝殓臁膦裢蠊鲢",liang:"粮凉梁粱良两辆量晾亮谅墚椋踉靓魉",liao:"撩聊僚疗燎寥辽潦了撂镣廖料蓼尥嘹獠寮缭钌鹩耢",lie:"列裂烈劣猎冽埒洌趔躐鬣",lin:"琳林磷霖临邻鳞淋凛赁吝蔺嶙廪遴檩辚瞵粼躏麟",liu:"溜琉榴硫馏留刘瘤流柳六抡偻蒌泖浏遛骝绺旒熘锍镏鹨鎏","long":"龙聋咙笼窿隆垄拢陇弄垅茏泷珑栊胧砻癃",lou:"楼娄搂篓漏陋喽嵝镂瘘耧蝼髅",lu:"芦卢颅庐炉掳卤虏鲁麓碌露路赂鹿潞禄录陆戮垆摅撸噜泸渌漉璐栌橹轳辂辘氇胪镥鸬鹭簏舻鲈",lv:"驴吕铝侣旅履屡缕虑氯律率滤绿捋闾榈膂稆褛",luan:"峦孪滦卵乱栾鸾銮",lue:"掠略锊",lun:"轮伦仑沦纶论囵",luo:"萝螺罗逻锣箩骡裸落洛骆络倮荦摞猡泺椤脶镙瘰雒",ma:"妈麻玛码蚂马骂嘛吗唛犸嬷杩麽",mai:"埋买麦卖迈脉劢荬咪霾",man:"瞒馒蛮满蔓曼慢漫谩墁幔缦熳镘颟螨鳗鞔",mang:"芒茫盲忙莽邙漭朦硭蟒",meng:"氓萌蒙檬盟锰猛梦孟勐甍瞢懵礞虻蜢蠓艋艨黾",miao:"猫苗描瞄藐秒渺庙妙喵邈缈缪杪淼眇鹋蜱",mao:"茅锚毛矛铆卯茂冒帽貌贸侔袤勖茆峁瑁昴牦耄旄懋瞀蛑蝥蟊髦",me:"么",mei:"玫枚梅酶霉煤没眉媒镁每美昧寐妹媚坶莓嵋猸浼湄楣镅鹛袂魅",men:"门闷们扪玟焖懑钔",mi:"眯醚靡糜迷谜弥米秘觅泌蜜密幂芈冖谧蘼嘧猕獯汨宓弭脒敉糸縻麋",mian:"棉眠绵冕免勉娩缅面沔湎腼眄",mie:"蔑灭咩蠛篾",min:"民抿皿敏悯闽苠岷闵泯珉",ming:"明螟鸣铭名命冥茗溟暝瞑酩",miu:"谬",mo:"摸摹蘑模膜磨摩魔抹末莫墨默沫漠寞陌谟茉蓦馍嫫镆秣瘼耱蟆貊貘",mou:"谋牟某厶哞婺眸鍪",mu:"拇牡亩姆母墓暮幕募慕木目睦牧穆仫苜呒沐毪钼",na:"拿哪呐钠那娜纳内捺肭镎衲箬",nai:"氖乃奶耐奈鼐艿萘柰",nan:"南男难囊喃囡楠腩蝻赧",nao:"挠脑恼闹孬垴猱瑙硇铙蛲",ne:"淖呢讷",nei:"馁",nen:"嫩能枘恁",ni:"妮霓倪泥尼拟你匿腻逆溺伲坭猊怩滠昵旎祢慝睨铌鲵",nian:"蔫拈年碾撵捻念廿辇黏鲇鲶",niang:"娘酿",niao:"鸟尿茑嬲脲袅",nie:"捏聂孽啮镊镍涅乜陧蘖嗫肀颞臬蹑",nin:"您柠",ning:"狞凝宁拧泞佞蓥咛甯聍",niu:"牛扭钮纽狃忸妞蚴",nong:"脓浓农侬",nu:"奴努怒呶帑弩胬孥驽",nv:"女恧钕衄",nuan:"暖",nuenue:"虐",nue:"疟谑",nuo:"挪懦糯诺傩搦喏锘",ou:"哦欧鸥殴藕呕偶沤怄瓯耦",pa:"啪趴爬帕怕琶葩筢",pai:"拍排牌徘湃派俳蒎",pan:"攀潘盘磐盼畔判叛爿泮袢襻蟠蹒",pang:"乓庞旁耪胖滂逄",pao:"抛咆刨炮袍跑泡匏狍庖脬疱",pei:"呸胚培裴赔陪配佩沛掊辔帔淠旆锫醅霈",pen:"喷盆湓",peng:"砰抨烹澎彭蓬棚硼篷膨朋鹏捧碰坯堋嘭怦蟛",pi:"砒霹批披劈琵毗啤脾疲皮匹痞僻屁譬丕陴邳郫圮鼙擗噼庀媲纰枇甓睥罴铍痦癖疋蚍貔",pian:"篇偏片骗谝骈犏胼褊翩蹁",piao:"飘漂瓢票剽嘌嫖缥殍瞟螵",pie:"撇瞥丿苤氕",pin:"拼频贫品聘拚姘嫔榀牝颦",ping:"乒坪苹萍平凭瓶评屏俜娉枰鲆",po:"坡泼颇婆破魄迫粕叵鄱溥珀钋钷皤笸",pou:"剖裒踣",pu:"扑铺仆莆葡菩蒲埔朴圃普浦谱曝瀑匍噗濮璞氆镤镨蹼",qi:"期欺栖戚妻七凄漆柒沏其棋奇歧畦崎脐齐旗祈祁骑起岂乞企启契砌器气迄弃汽泣讫亟亓圻芑萋葺嘁屺岐汔淇骐绮琪琦杞桤槭欹祺憩碛蛴蜞綦綮趿蹊鳍麒",qia:"掐恰洽葜",qian:"牵扦钎铅千迁签仟谦乾黔钱钳前潜遣浅谴堑嵌欠歉佥阡芊芡荨掮岍悭慊骞搴褰缱椠肷愆钤虔箝",qiang:"枪呛腔羌墙蔷强抢嫱樯戗炝锖锵镪襁蜣羟跫跄",qiao:"橇锹敲悄桥瞧乔侨巧鞘撬翘峭俏窍劁诮谯荞愀憔缲樵毳硗跷鞒",qie:"切茄且怯窃郄唼惬妾挈锲箧",qin:"钦侵亲秦琴勤芹擒禽寝沁芩蓁蕲揿吣嗪噙溱檎螓衾",qing:"青轻氢倾卿清擎晴氰情顷请庆倩苘圊檠磬蜻罄箐謦鲭黥",qiong:"琼穷邛茕穹筇銎",qiu:"秋丘邱球求囚酋泅俅氽巯艽犰湫逑遒楸赇鸠虬蚯蝤裘糗鳅鼽",qu:"趋区蛆曲躯屈驱渠取娶龋趣去诎劬蕖蘧岖衢阒璩觑氍祛磲癯蛐蠼麴瞿黢",quan:"圈颧权醛泉全痊拳犬券劝诠荃獾悛绻辁畎铨蜷筌鬈",que:"缺炔瘸却鹊榷确雀阙悫",qun:"裙群逡",ran:"然燃冉染苒髯",rang:"瓤壤攘嚷让禳穰",rao:"饶扰绕荛娆桡",ruo:"惹若弱",re:"热偌",ren:"壬仁人忍韧任认刃妊纫仞荏葚饪轫稔衽",reng:"扔仍",ri:"日",rong:"戎茸蓉荣融熔溶容绒冗嵘狨缛榕蝾",rou:"揉柔肉糅蹂鞣",ru:"茹蠕儒孺如辱乳汝入褥蓐薷嚅洳溽濡铷襦颥",ruan:"软阮朊",rui:"蕊瑞锐芮蕤睿蚋",run:"闰润",sa:"撒洒萨卅仨挲飒",sai:"腮鳃塞赛噻",san:"三叁伞散彡馓氵毵糁霰",sang:"桑嗓丧搡磉颡",sao:"搔骚扫嫂埽臊瘙鳋",se:"瑟色涩啬铩铯穑",sen:"森",seng:"僧",sha:"莎砂杀刹沙纱傻啥煞脎歃痧裟霎鲨",shai:"筛晒酾",shan:"珊苫杉山删煽衫闪陕擅赡膳善汕扇缮剡讪鄯埏芟潸姗骟膻钐疝蟮舢跚鳝",shang:"墒伤商赏晌上尚裳垧绱殇熵觞",shao:"梢捎稍烧芍勺韶少哨邵绍劭苕潲蛸笤筲艄",she:"奢赊蛇舌舍赦摄射慑涉社设厍佘猞畲麝",shen:"砷申呻伸身深娠绅神沈审婶甚肾慎渗诜谂吲哂渖椹矧蜃",sheng:"声生甥牲升绳省盛剩胜圣丞渑媵眚笙",shi:"师失狮施湿诗尸虱十石拾时什食蚀实识史矢使屎驶始式示士世柿事拭誓逝势是嗜噬适仕侍释饰氏市恃室视试谥埘莳蓍弑唑饣轼耆贳炻礻铈铊螫舐筮豕鲥鲺",shou:"收手首守寿授售受瘦兽扌狩绶艏",shu:"蔬枢梳殊抒输叔舒淑疏书赎孰熟薯暑曙署蜀黍鼠属术述树束戍竖墅庶数漱恕倏塾菽忄沭涑澍姝纾毹腧殳镯秫鹬",shua:"刷耍唰涮",shuai:"摔衰甩帅蟀",shuan:"栓拴闩",shuang:"霜双爽孀",shui:"谁水睡税",shun:"吮瞬顺舜恂",shuo:"说硕朔烁蒴搠嗍濯妁槊铄",si:"斯撕嘶思私司丝死肆寺嗣四伺似饲巳厮俟兕菥咝汜泗澌姒驷缌祀祠锶鸶耜蛳笥",song:"松耸怂颂送宋讼诵凇菘崧嵩忪悚淞竦",sou:"搜艘擞嗽叟嗖嗾馊溲飕瞍锼螋",su:"苏酥俗素速粟僳塑溯宿诉肃夙谡蔌嗉愫簌觫稣",suan:"酸蒜算",sui:"虽隋随绥髓碎岁穗遂隧祟蓑冫谇濉邃燧眭睢",sun:"孙损笋荪狲飧榫跣隼",suo:"梭唆缩琐索锁所唢嗦娑桫睃羧",ta:"塌他它她塔獭挞蹋踏闼溻遢榻沓",tai:"胎苔抬台泰酞太态汰邰薹肽炱钛跆鲐",tan:"坍摊贪瘫滩坛檀痰潭谭谈坦毯袒碳探叹炭郯蕈昙钽锬覃",tang:"汤塘搪堂棠膛唐糖傥饧溏瑭铴镗耥螗螳羰醣",thang:"倘躺淌",theng:"趟烫",tao:"掏涛滔绦萄桃逃淘陶讨套挑鼗啕韬饕",te:"特",teng:"藤腾疼誊滕",ti:"梯剔踢锑提题蹄啼体替嚏惕涕剃屉荑悌逖绨缇鹈裼醍",tian:"天添填田甜恬舔腆掭忝阗殄畋钿蚺",tiao:"条迢眺跳佻祧铫窕龆鲦",tie:"贴铁帖萜餮",ting:"厅听烃汀廷停亭庭挺艇莛葶婷梃蜓霆",tong:"通桐酮瞳同铜彤童桶捅筒统痛佟僮仝茼嗵恸潼砼",tou:"偷投头透亠",tu:"凸秃突图徒途涂屠土吐兔堍荼菟钍酴",tuan:"湍团疃",tui:"推颓腿蜕褪退忒煺",tun:"吞屯臀饨暾豚窀",tuo:"拖托脱鸵陀驮驼椭妥拓唾乇佗坨庹沱柝砣箨舄跎鼍",wa:"挖哇蛙洼娃瓦袜佤娲腽",wai:"歪外",wan:"豌弯湾玩顽丸烷完碗挽晚皖惋宛婉万腕剜芄苋菀纨绾琬脘畹蜿箢",wang:"汪王亡枉网往旺望忘妄罔尢惘辋魍",wei:"威巍微危韦违桅围唯惟为潍维苇萎委伟伪尾纬未蔚味畏胃喂魏位渭谓尉慰卫倭偎诿隈葳薇帏帷崴嵬猥猬闱沩洧涠逶娓玮韪軎炜煨熨痿艉鲔",wen:"瘟温蚊文闻纹吻稳紊问刎愠阌汶璺韫殁雯",weng:"嗡翁瓮蓊蕹",wo:"挝蜗涡窝我斡卧握沃莴幄渥杌肟龌",wu:"巫呜钨乌污诬屋无芜梧吾吴毋武五捂午舞伍侮坞戊雾晤物勿务悟误兀仵阢邬圬芴庑怃忤浯寤迕妩骛牾焐鹉鹜蜈鋈鼯",xi:"昔熙析西硒矽晰嘻吸锡牺稀息希悉膝夕惜熄烯溪汐犀檄袭席习媳喜铣洗系隙戏细僖兮隰郗茜葸蓰奚唏徙饩阋浠淅屣嬉玺樨曦觋欷熹禊禧钸皙穸蜥蟋舾羲粞翕醯鼷",xia:"瞎虾匣霞辖暇峡侠狭下厦夏吓掀葭嗄狎遐瑕硖瘕罅黠",xian:"锨先仙鲜纤咸贤衔舷闲涎弦嫌显险现献县腺馅羡宪陷限线冼藓岘猃暹娴氙祆鹇痫蚬筅籼酰跹",xiang:"相厢镶香箱襄湘乡翔祥详想响享项巷橡像向象芗葙饷庠骧缃蟓鲞飨",xiao:"萧硝霄削哮嚣销消宵淆晓小孝校肖啸笑效哓咻崤潇逍骁绡枭枵筱箫魈",xie:"楔些歇蝎鞋协挟携邪斜胁谐写械卸蟹懈泄泻谢屑偕亵勰燮薤撷廨瀣邂绁缬榭榍歙躞",xin:"薪芯锌欣辛新忻心信衅囟馨莘歆铽鑫",xing:"星腥猩惺兴刑型形邢行醒幸杏性姓陉荇荥擤悻硎",xiong:"兄凶胸匈汹雄熊芎",xiu:"休修羞朽嗅锈秀袖绣莠岫馐庥鸺貅髹",xu:"墟戌需虚嘘须徐许蓄酗叙旭序畜恤絮婿绪续讴诩圩蓿怵洫溆顼栩煦砉盱胥糈醑",xuan:"轩喧宣悬旋玄选癣眩绚儇谖萱揎馔泫洵渲漩璇楦暄炫煊碹铉镟痃",xue:"靴薛学穴雪血噱泶鳕",xun:"勋熏循旬询寻驯巡殉汛训讯逊迅巽埙荀薰峋徇浔曛窨醺鲟",ya:"压押鸦鸭呀丫芽牙蚜崖衙涯雅哑亚讶伢揠吖岈迓娅琊桠氩砑睚痖",yan:"焉咽阉烟淹盐严研蜒岩延言颜阎炎沿奄掩眼衍演艳堰燕厌砚雁唁彦焰宴谚验厣靥赝俨偃兖讠谳郾鄢芫菸崦恹闫阏洇湮滟妍嫣琰晏胭腌焱罨筵酽魇餍鼹",yang:"殃央鸯秧杨扬佯疡羊洋阳氧仰痒养样漾徉怏泱炀烊恙蛘鞅",yao:"邀腰妖瑶摇尧遥窑谣姚咬舀药要耀夭爻吆崾徭瀹幺珧杳曜肴鹞窈繇鳐",ye:"椰噎耶爷野冶也页掖业叶曳腋夜液谒邺揶馀晔烨铘",yi:"一壹医揖铱依伊衣颐夷遗移仪胰疑沂宜姨彝椅蚁倚已乙矣以艺抑易邑屹亿役臆逸肄疫亦裔意毅忆义益溢诣议谊译异翼翌绎刈劓佾诒圪圯埸懿苡薏弈奕挹弋呓咦咿噫峄嶷猗饴怿怡悒漪迤驿缢殪贻旖熠钇镒镱痍瘗癔翊衤蜴舣羿翳酏黟",yin:"茵荫因殷音阴姻吟银淫寅饮尹引隐印胤鄞堙茚喑狺夤氤铟瘾蚓霪龈",ying:"英樱婴鹰应缨莹萤营荧蝇迎赢盈影颖硬映嬴郢茔莺萦撄嘤膺滢潆瀛瑛璎楹鹦瘿颍罂",yo:"哟唷",yong:"拥佣臃痈庸雍踊蛹咏泳涌永恿勇用俑壅墉慵邕镛甬鳙饔",you:"幽优悠忧尤由邮铀犹油游酉有友右佑釉诱又幼卣攸侑莸呦囿宥柚猷牖铕疣蝣鱿黝鼬",yu:"迂淤于盂榆虞愚舆余俞逾鱼愉渝渔隅予娱雨与屿禹宇语羽玉域芋郁吁遇喻峪御愈欲狱育誉浴寓裕预豫驭禺毓伛俣谀谕萸蓣揄喁圄圉嵛狳饫庾阈妪妤纡瑜昱觎腴欤於煜燠聿钰鹆瘐瘀窳蝓竽舁雩龉",yuan:"鸳渊冤元垣袁原援辕园员圆猿源缘远苑愿怨院塬沅媛瑗橼爰眢鸢螈鼋",yue:"曰约越跃钥岳粤月悦阅龠樾刖钺",yun:"耘云郧匀陨允运蕴酝晕韵孕郓芸狁恽纭殒昀氲",za:"匝砸杂拶咂",zai:"栽哉灾宰载再在咱崽甾",zan:"攒暂赞瓒昝簪糌趱錾",zang:"赃脏葬奘戕臧",zao:"遭糟凿藻枣早澡蚤躁噪造皂灶燥唣缫",ze:"责择则泽仄赜啧迮昃笮箦舴",zei:"贼",zen:"怎谮",zeng:"增憎曾赠缯甑罾锃",zha:"扎喳渣札轧铡闸眨栅榨咋乍炸诈揸吒咤哳怍砟痄蚱齄",zhai:"摘斋宅窄债寨砦",zhan:"瞻毡詹粘沾盏斩辗崭展蘸栈占战站湛绽谵搌旃",zhang:"樟章彰漳张掌涨杖丈帐账仗胀瘴障仉鄣幛嶂獐嫜璋蟑",zhao:"招昭找沼赵照罩兆肇召爪诏棹钊笊",zhe:"遮折哲蛰辙者锗蔗这浙谪陬柘辄磔鹧褚蜇赭",zhen:"珍斟真甄砧臻贞针侦枕疹诊震振镇阵缜桢榛轸赈胗朕祯畛鸩",zheng:"蒸挣睁征狰争怔整拯正政帧症郑证诤峥钲铮筝",zhi:"芝枝支吱蜘知肢脂汁之织职直植殖执值侄址指止趾只旨纸志挚掷至致置帜峙制智秩稚质炙痔滞治窒卮陟郅埴芷摭帙忮彘咫骘栉枳栀桎轵轾攴贽膣祉祗黹雉鸷痣蛭絷酯跖踬踯豸觯",zhong:"中盅忠钟衷终种肿重仲众冢锺螽舂舯踵",zhou:"舟周州洲诌粥轴肘帚咒皱宙昼骤啄着倜诹荮鬻纣胄碡籀舳酎鲷",zhu:"珠株蛛朱猪诸诛逐竹烛煮拄瞩嘱主著柱助蛀贮铸筑住注祝驻伫侏邾苎茱洙渚潴驺杼槠橥炷铢疰瘃蚰竺箸翥躅麈",zhua:"抓",zhuai:"拽",zhuan:"专砖转撰赚篆抟啭颛",zhuang:"桩庄装妆撞壮状丬",zhui:"椎锥追赘坠缀萑骓缒",zhun:"谆准",zhuo:"捉拙卓桌琢茁酌灼浊倬诼廴蕞擢啜浞涿杓焯禚斫",zi:"兹咨资姿滋淄孜紫仔籽滓子自渍字谘嵫姊孳缁梓辎赀恣眦锱秭耔笫粢觜訾鲻髭",zong:"鬃棕踪宗综总纵腙粽",zou:"邹走奏揍鄹鲰",zu:"租足卒族祖诅阻组俎菹啐徂驵蹴",zuan:"钻纂攥缵",zui:"嘴醉最罪",zun:"尊遵撙樽鳟",zuo:"昨左佐柞做作坐座阝阼胙祚酢",cou:"薮楱辏腠",nang:"攮哝囔馕曩",o:"喔",dia:"嗲",chuai:"嘬膪踹",cen:"岑涔",diu:"铥",nou:"耨",fou:"缶",bia:"髟"},this.polyphone={19969:"DZ",19975:"WM",19988:"QJ",20048:"YL",20056:"SC",
20060:"NM",20094:"QG",20127:"QJ",20167:"QC",20193:"YG",20250:"KH",20256:"ZC",20282:"SC",20285:"QJG",20291:"TD",20314:"YD",20340:"NE",20375:"TD",20389:"YJ",20391:"CZ",20415:"PB",20446:"YS",20447:"SQ",20504:"TC",20608:"KG",20854:"QJ",20857:"ZC",20911:"PF",20504:"TC",20608:"KG",20854:"QJ",20857:"ZC",20911:"PF",20985:"AW",21032:"PB",21048:"XQ",21049:"SC",21089:"YS",21119:"JC",21242:"SB",21273:"SC",21305:"YP",21306:"QO",21330:"ZC",21333:"SDC",21345:"QK",21378:"CA",21397:"SC",21414:"XS",21442:"SC",21477:"JG",21480:"TD",21484:"ZS",21494:"YX",21505:"YX",21512:"HG",21523:"XH",21537:"PB",21542:"PF",21549:"KH",21571:"E",21574:"DA",21588:"TD",21589:"O",21618:"ZC",21621:"KHA",21632:"ZJ",21654:"KG",21679:"LKG",21683:"KH",21710:"A",21719:"YH",21734:"WOE",21769:"A",21780:"WN",21804:"XH",21834:"A",21899:"ZD",21903:"RN",21908:"WO",21939:"ZC",21956:"SA",21964:"YA",21970:"TD",22003:"A",22031:"JG",22040:"XS",22060:"ZC",22066:"ZC",22079:"MH",22129:"XJ",22179:"XA",22237:"NJ",22244:"TD",22280:"JQ",22300:"YH",22313:"XW",22331:"YQ",22343:"YJ",22351:"PH",22395:"DC",22412:"TD",22484:"PB",22500:"PB",22534:"ZD",22549:"DH",22561:"PB",22612:"TD",22771:"KQ",22831:"HB",22841:"JG",22855:"QJ",22865:"XQ",23013:"ML",23081:"WM",23487:"SX",23558:"QJ",23561:"YW",23586:"YW",23614:"YW",23615:"SN",23631:"PB",23646:"ZS",23663:"ZT",23673:"YG",23762:"TD",23769:"ZS",23780:"QJ",23884:"QK",24055:"XH",24113:"DC",24162:"ZC",24191:"GA",24273:"QJ",24324:"NL",24377:"TD",24378:"QJ",24439:"PF",24554:"ZS",24683:"TD",24694:"WE",24733:"LK",24925:"TN",25094:"ZG",25100:"XQ",25103:"XH",25153:"PB",25170:"PB",25179:"KG",25203:"PB",25240:"ZS",25282:"FB",25303:"NA",25324:"KG",25341:"ZY",25373:"WZ",25375:"XJ",25384:"A",25457:"A",25528:"SD",25530:"SC",25552:"TD",25774:"ZC",25874:"ZC",26044:"YW",26080:"WM",26292:"PB",26333:"PB",26355:"ZY",26366:"CZ",26397:"ZC",26399:"QJ",26415:"ZS",26451:"SB",26526:"ZC",26552:"JG",26561:"TD",26588:"JG",26597:"CZ",26629:"ZS",26638:"YL",26646:"XQ",26653:"KG",26657:"XJ",26727:"HG",26894:"ZC",26937:"ZS",26946:"ZC",26999:"KJ",27099:"KJ",27449:"YQ",27481:"XS",27542:"ZS",27663:"ZS",27748:"TS",27784:"SC",27788:"ZD",27795:"TD",27812:"O",27850:"PB",27852:"MB",27895:"SL",27898:"PL",27973:"QJ",27981:"KH",27986:"HX",27994:"XJ",28044:"YC",28065:"WG",28177:"SM",28267:"QJ",28291:"KH",28337:"ZQ",28463:"TL",28548:"DC",28601:"TD",28689:"PB",28805:"JG",28820:"QG",28846:"PB",28952:"TD",28975:"ZC",29100:"A",29325:"QJ",29575:"SL",29602:"FB",30010:"TD",30044:"CX",30058:"PF",30091:"YSP",30111:"YN",30229:"XJ",30427:"SC",30465:"SX",30631:"YQ",30655:"QJ",30684:"QJG",30707:"SD",30729:"XH",30796:"LG",30917:"PB",31074:"NM",31085:"JZ",31109:"SC",31181:"ZC",31192:"MLB",31293:"JQ",31400:"YX",31584:"YJ",31896:"ZN",31909:"ZY",31995:"XJ",32321:"PF",32327:"ZY",32418:"HG",32420:"XQ",32421:"HG",32438:"LG",32473:"GJ",32488:"TD",32521:"QJ",32527:"PB",32562:"ZSQ",32564:"JZ",32735:"ZD",32793:"PB",33071:"PF",33098:"XL",33100:"YA",33152:"PB",33261:"CX",33324:"BP",33333:"TD",33406:"YA",33426:"WM",33432:"PB",33445:"JG",33486:"ZN",33493:"TS",33507:"QJ",33540:"QJ",33544:"ZC",33564:"XQ",33617:"YT",33632:"QJ",33636:"XH",33637:"YX",33694:"WG",33705:"PF",33728:"YW",33882:"SR",34067:"WM",34074:"YW",34121:"QJ",34255:"ZC",34259:"XL",34425:"JH",34430:"XH",34485:"KH",34503:"YS",34532:"HG",34552:"XS",34558:"YE",34593:"ZL",34660:"YQ",34892:"XH",34928:"SC",34999:"QJ",35048:"PB",35059:"SC",35098:"ZC",35203:"TQ",35265:"JX",35299:"JX",35782:"SZ",35828:"YS",35830:"E",35843:"TD",35895:"YG",35977:"MH",36158:"JG",36228:"QJ",36426:"XQ",36466:"DC",36710:"JC",36711:"ZYG",36767:"PB",36866:"SK",36951:"YW",37034:"YX",37063:"XH",37218:"ZC",37325:"ZC",38063:"PB",38079:"TD",38085:"QY",38107:"DC",38116:"TD",38123:"YD",38224:"HG",38241:"XTC",38271:"ZC",38415:"YE",38426:"KH",38461:"YD",38463:"AE",38466:"PB",38477:"XJ",38518:"YT",38551:"WK",38585:"ZC",38704:"XS",38739:"LJ",38761:"GJ",38808:"SQ",39048:"JG",39049:"XJ",39052:"HG",39076:"CZ",39271:"XT",39534:"TD",39552:"TD",39584:"PB",39647:"SB",39730:"LG",39748:"TPB",40109:"ZQ",40479:"ND",40516:"HG",40536:"HG",40583:"QJ",40765:"YQ",40784:"QJ",40840:"YK",40863:"QJG"}},getFullChars:function(a){for(var b,c="",d=(new RegExp("[a-zA-Z0-9- ]"),0),e=a.length;d<e;d++){var f=a.substr(d,1),g=f.charCodeAt(0);g>40869||g<19968?c+=f:(b=this._getFullChar(f),b!==!1&&(c+=b))}return c},getCamelChars:function(a){if("string"!=typeof a)throw new Error((-1),"函数getFisrt需要字符串类型参数!");for(var b=[],c=0,d=a.length;c<d;c++){var e=a.charAt(c);b.push(this._getChar(e))}return this._getResult(b)},_getFullChar:function(a){for(var b in this.full_dict)if(-1!==this.full_dict[b].indexOf(a))return this._capitalize(b);return!1},_capitalize:function(a){if(a.length>0){var b=a.substr(0,1).toUpperCase(),c=a.substr(1,a.length);return b+c}},_getChar:function(a){var b=a.charCodeAt(0);return b>40869||b<19968?a:this.options.checkPolyphone&&this.polyphone[b]?this.polyphone[b]:this.char_dict.charAt(b-19968)},_getResult:function(a){if(!this.options.checkPolyphone)return a.join("");for(var b=[""],c=0,d=a.length;c<d;c++){var e=a[c],f=e.length;if(1==f)for(var g=0;g<b.length;g++)b[j]+=e;else{var h=b.slice(0);b=[];for(var g=0;g<f;g++){for(var i=h.slice(0),j=0;j<i.length;j++)i[j]+=e.charAt(g);b=b.concat(i)}}}return b}};var c=function(a,b){for(var c in b)a[c]=b[c];return a};return new a(arguments)}(),BIMWINNER.lobibox=function(){function a(a,b){this.$input=null,this.$type="prompt",this.$promptType=a,b=$.extend({},f.prompt.DEFAULT_OPTIONS,b),this.$options=this._processInput(b),this._init(),this.debug(this)}function b(a){this.$type="confirm",this.$options=this._processInput(a),this._init(),this.debug(this)}function c(a,b){this.$type=a,this.$options=this._processInput(b),this._init(),this.debug(this)}function d(a){this.$type="progress",this.$progressBarElement=null,this.$options=this._processInput(a),this.$progress=0,this._init(),this.debug(this)}function e(a,b){this.$type=a,this.$options=this._processInput(b),this._init(),this.debug(this)}var f=this;Math.randomString=function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;d<a;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},f.viewport="body",f.counter=0,f.prompt=function(b,c){return new a(b,c)},f.confirm=function(a){return new b(a)},f.progress=function(a){return new d(a)},f.error={},f.success={},f.warning={},f.info={},f.alert=function(a,b){if(["success","error","warning","info"].indexOf(a)>-1)return new c(a,b)},f.window=function(a){return new e("window",a)};var g={$type:null,$el:null,$options:null,debug:function(){this.$options.debug&&window.console.debug.apply(window.console,arguments)},_processInput:function(a){if($.isArray(a.buttons)){for(var b={},c=0;c<a.buttons.length;c++)b[a.buttons[c]]=f.base.OPTIONS.buttons[a.buttons[c]];a.buttons=b}a.customBtnClass=a.customBtnClass?a.customBtnClass:f.base.DEFAULTS.customBtnClass;for(var c in a.buttons)if(a.buttons.hasOwnProperty(c)){var d=a.buttons[c];d=$.extend({},f.base.OPTIONS.buttons[c],d),d["class"]||(d["class"]=a.customBtnClass),a.buttons[c]=d}return a=$.extend({},f.base.DEFAULTS,a),void 0===a.showClass&&(a.showClass=f.base.OPTIONS.showClass),void 0===a.hideClass&&(a.hideClass=f.base.OPTIONS.hideClass),void 0===a.baseClass&&(a.baseClass=f.base.OPTIONS.baseClass),void 0===a.delayToRemove&&(a.delayToRemove=f.base.OPTIONS.delayToRemove),a.iconClass||(a.iconClass=f.base.OPTIONS.icons[a.iconSource][this.$type]),a},_init:function(){var a=this;a._createMarkup(),a.setTitle(a.$options.title),a.$options.draggable&&!a._isMobileScreen()&&(a.$el.addClass("draggable"),a._enableDrag()),a.$options.closeButton&&a._addCloseButton(),a.$options.closeOnEsc&&$(document).on("keyup.lobibox",function(b){27===b.which&&a.destroy()}),a.$options.baseClass&&a.$el.addClass(a.$options.baseClass),a.$options.showClass&&(a.$el.removeClass(a.$options.hideClass),a.$el.addClass(a.$options.showClass)),a.$el.data("lobibox",a)},_calculatePosition:function(a){var b,c=this;b="top"===a?30:"bottom"===a?$(window).outerHeight()-c.$el.outerHeight()-30:($(window).outerHeight()-c.$el.outerHeight())/2;var d=($(window).outerWidth()-c.$el.outerWidth())/2;return{left:d,top:b}},_createButton:function(a,b){var c=this,d=$("<button></button>").addClass(b["class"]).attr("data-type",a).html(b.text);return c.$options.callback&&"function"==typeof c.$options.callback&&d.on("click.lobibox",function(b){var d=$(this);c._onButtonClick(c.$options.buttons[a],a),c.$options.callback(c,d.data("type"),b)}),d.click(function(){c._onButtonClick(c.$options.buttons[a],a)}),d},_onButtonClick:function(a,b){var c=this;("ok"===b&&"prompt"===c.$type&&c.isValid()||"prompt"!==c.$type||"ok"!==b)&&a&&a.closeOnClick&&c.destroy()},_generateButtons:function(){var a=this,b=[];for(var c in a.$options.buttons)if(a.$options.buttons.hasOwnProperty(c)){var d=a.$options.buttons[c],e=a._createButton(c,d);b.push(e)}return b},_createMarkup:function(){var a=this,b=$('<div class="lobibox"></div>');b.attr("data-is-modal",a.$options.modal);var c=$('<div class="lobibox-header"></div>').append('<span class="lobibox-title"></span>'),d=$('<div class="lobibox-body"></div>');if(b.append(c),b.append(d),a.$options.buttons&&!$.isEmptyObject(a.$options.buttons)){var e=$('<div class="lobibox-footer"></div>');e.append(a._generateButtons()),b.append(e),f.base.OPTIONS.buttonsAlign.indexOf(a.$options.buttonsAlign)>-1&&e.addClass("text-"+a.$options.buttonsAlign)}a.$el=b.addClass(f.base.OPTIONS.modalClasses[a.$type])},_setSize:function(){var a=this;a.setWidth(a.$options.width),"auto"===a.$options.height?a.setHeight(a.$el.outerHeight()):a.setHeight(a.$options.height)},_calculateBodyHeight:function(a){var b=this,c=b.$el.find(".lobibox-header").outerHeight(),d=b.$el.find(".lobibox-footer").outerHeight();return a-(c?c:0)-(d?d:0)},_addBackdrop:function(){0===$(".lobibox-backdrop").length&&$(f.viewport).append('<div class="lobibox-backdrop"></div>')},_triggerEvent:function(a){var b=this;b.$options[a]&&"function"==typeof b.$options[a]&&b.$options[a](b)},_calculateWidth:function(a){var b=this;return a=Math.min(Math.max(a,b.$options.width),$(window).outerWidth()),a===$(window).outerWidth()&&(a-=2*b.$options.horizontalOffset),a},_calculateHeight:function(a){var b=this;return a=Math.min(Math.max(a,b.$options.height),$(window).outerHeight()),a===$(window).outerHeight()&&(a-=2*b.$options.verticalOffset),a},_addCloseButton:function(){var a=this,b=$('<span class="btn-close">&times;</span>');a.$el.find(".lobibox-header").append(b),b.on("mousedown",function(a){a.stopPropagation()}),b.on("click.lobibox",function(){a.destroy()})},_position:function(){var a=this;a._setSize();var b=a._calculatePosition();a.setPosition(b.left,b.top)},_isMobileScreen:function(){return $(window).outerWidth()<768},_enableDrag:function(){var a=this.$el,b=a.find(".lobibox-header");b.on("mousedown.lobibox",function(b){a.attr("offset-left",b.offsetX),a.attr("offset-top",b.offsetY),a.attr("allow-drag","true")}),b.on("touchstart.lobibox",function(b){var c=a.position().left,d=a.position().top,e=b.originalEvent.targetTouches[0].clientX,f=b.originalEvent.targetTouches[0].clientY;a.attr("offset-left",e-c),a.attr("offset-top",f-d),a.attr("allow-drag","true")}),$(document).on("mouseup.lobibox",function(){a.attr("allow-drag","false")}),$(document).on("mousemove.lobibox",function(b){if("true"===a.attr("allow-drag")){var c=b.clientX-parseInt(a.attr("offset-left"),10)-parseInt(a.css("border-left-width"),10),d=b.clientY-parseInt(a.attr("offset-top"),10)-parseInt(a.css("border-top-width"),10);d<0&&(d=5),d>$(window).height()&&(d=$(window).height()-10),c<0&&(c=5),c>$(window).width()&&(c=$(window).width()-10),a.css({left:c,top:d})}}),$(document).on("touchend.lobibox",function(){a.attr("allow-drag","false")}),$(document).on("touchmove.lobibox",function(b){if("true"===a.attr("allow-drag")){var c=b.originalEvent.targetTouches[0].clientX-parseInt(a.attr("offset-left"),10)-parseInt(a.css("border-left-width"),10),d=b.originalEvent.targetTouches[0].clientY-parseInt(a.attr("offset-top"),10)-parseInt(a.css("border-top-width"),10);d<0&&(d=5),d>$(window).height()&&(d=$(window).height()-10),c<0&&(c=5),c>$(window).width()&&(c=$(window).width()-10),a.css({left:c,top:d})}})},_setContent:function(a){var b=this;return b.$el.find(".lobibox-body").html(a),b},_beforeShow:function(){var a=this;a._triggerEvent("onShow")},_afterShow:function(){var a=this;f.counter++,a.$el.attr("data-nth",f.counter),a.$options.draggable||$(window).on("resize.lobibox-"+a.$el.attr("data-nth"),function(){a.refreshWidth(),a.refreshHeight(),a.$el.css("left","50%").css("margin-left","-"+a.$el.width()/2+"px"),a.$el.css("top","50%").css("margin-top","-"+a.$el.height()/2+"px")}),a._triggerEvent("shown")},_beforeClose:function(){var a=this;a._triggerEvent("beforeClose")},_afterClose:function(){var a=this;a.$options.draggable||$(window).off("resize.lobibox-"+a.$el.attr("data-nth")),a._triggerEvent("closed")},_beforeHide:function(){var a=this;a._triggerEvent("beforeHide")},_afterHide:function(){var a=this;a._triggerEvent("afterHide")},hide:function(){function a(){b.$el.addClass("lobibox-hidden"),0===$(".lobibox[data-is-modal=true]:not(.lobibox-hidden)").length&&($(".lobibox-backdrop").remove(),$(f.viewport).removeClass(f.base.OPTIONS.bodyClass)),b._afterHide()}var b=this;return b._beforeHide(),b.$options.hideClass?(b.$el.removeClass(b.$options.showClass),b.$el.addClass(b.$options.hideClass),setTimeout(function(){a()},b.$options.delayToRemove)):a(),this},destroy:function(){function a(){b.$el.remove(),0===$(".lobibox[data-is-modal=true]").length&&($(".lobibox-backdrop").remove(),$(f.viewport).removeClass(f.base.OPTIONS.bodyClass)),b._afterClose()}var b=this;return b._beforeClose(),b.$options.hideClass?(b.$el.removeClass(b.$options.showClass).addClass(b.$options.hideClass),setTimeout(function(){a()},b.$options.delayToRemove)):a(),this},setWidth:function(a){var b=this;return b.$el.css("width",b._calculateWidth(a)),b},refreshWidth:function(){this.setWidth(this.$el.width())},refreshHeight:function(){this.setHeight(this.$el.height())},setHeight:function(a){var b=this;return b.$el.css("height",b._calculateHeight(a)).find(".lobibox-body").css("height",b.$options.height-41),b},setSize:function(a,b){var c=this;return c.setWidth(a),c.setHeight(b),c},setPosition:function(a,b){var c;return"number"==typeof a&&"number"==typeof b?c={left:a,top:b}:"string"==typeof a?c=this._calculatePosition(a):"object"==typeof a&&(c=a),this.$el.css(c),this},setTitle:function(a){return this.$el.find(".lobibox-title").html(a)},getTitle:function(){return this.$el.find(".lobibox-title").html()},show:function(){var a=this,b=$(f.viewport);if(a._beforeShow(),a.$el.removeClass("lobibox-hidden"),b.append(a.$el),a.$options.buttons){var c=a.$el.find(".lobibox-footer").children();c[0].focus()}return a.$options.modal&&(b.addClass(f.base.OPTIONS.bodyClass),a._addBackdrop()),a.$options.delay!==!1&&setTimeout(function(){a.destroy()},a.$options.delay),a._afterShow(),a}};f.base={},f.base.OPTIONS={bodyClass:"lobibox-open",modalClasses:{error:"lobibox-error",success:"lobibox-success",info:"lobibox-info",warning:"lobibox-warning",confirm:"lobibox-confirm",progress:"lobibox-progress",prompt:"lobibox-prompt","default":"lobibox-default",window:"lobibox-window"},buttonsAlign:["left","center","right"],buttons:{ok:{"class":"lobibox-btn lobibox-btn-default",text:"OK",closeOnClick:!0},cancel:{"class":"lobibox-btn lobibox-btn-cancel",text:"Cancel",closeOnClick:!0},yes:{"class":"lobibox-btn lobibox-btn-yes",text:"Yes",closeOnClick:!0},no:{"class":"lobibox-btn lobibox-btn-no",text:"No",closeOnClick:!0}},icons:{bootstrap:{confirm:"glyphicon glyphicon-question-sign",success:"glyphicon glyphicon-ok-sign",error:"glyphicon glyphicon-remove-sign",warning:"glyphicon glyphicon-exclamation-sign",info:"glyphicon glyphicon-info-sign"},fontAwesome:{confirm:"fa fa-question-circle",success:"fa fa-check-circle",error:"fa fa-times-circle",warning:"fa fa-exclamation-circle",info:"fa fa-info-circle"}}},f.base.DEFAULTS={horizontalOffset:5,verticalOffset:5,width:600,height:"auto",closeButton:!0,draggable:!0,customBtnClass:"lobibox-btn lobibox-btn-default",modal:!1,debug:!1,buttonsAlign:"center",closeOnEsc:!0,delayToRemove:200,delay:!1,baseClass:"animated-super-fast",showClass:"zoomIn",hideClass:"zoomOut",iconSource:"bootstrap",onShow:null,shown:null,beforeClose:null,closed:null},a.prototype=$.extend({},g,{constructor:a,_processInput:function(b){var c=this,d=g._processInput.call(c,b);return d.buttons={ok:f.base.OPTIONS.buttons.ok,cancel:f.base.OPTIONS.buttons.cancel},b=$.extend({},d,a.DEFAULT_OPTIONS,b)},_init:function(){var a=this;g._init.call(a),a.show()},_afterShow:function(){var a=this;a._setContent(a._createInput())._position(),a.$input.focus(),g._afterShow.call(a)},_createInput:function(){var a,b=this;return b.$options.multiline?b.$input=$("<textarea></textarea>").attr("rows",b.$options.lines):b.$input=$('<input type="'+b.$promptType+'"/>'),b.$input.addClass("lobibox-input").attr(b.$options.attrs),b.$options.value&&b.setValue(b.$options.value),b.$options.label&&(a=$("<label>"+b.$options.label+"</label>")),$("<div></div>").append(a,b.$input)},setValue:function(a){return this.$input.val(a),this},getValue:function(){return this.$input.val()},isValid:function(){var a=this,b=a.$el.find(".lobibox-input-error-message");return a.$options.required&&!a.getValue()?(a.$input.addClass("invalid"),0===b.length&&(a.$el.find(".lobibox-body").append('<p class="lobibox-input-error-message">'+a.$options.errorMessage+"</p>"),a._position(),a.$input.focus()),!1):(a.$input.removeClass("invalid"),b.remove(),a._position(),a.$input.focus(),!0)}}),a.DEFAULT_OPTIONS={width:400,attrs:{},value:"",multiline:!1,lines:3,type:"text",label:"",required:!0,errorMessage:"The field is required"},b.prototype=$.extend({},g,{constructor:b,_processInput:function(a){var b=this,c=g._processInput.call(b,a);return c.buttons={yes:f.base.OPTIONS.buttons.yes,no:f.base.OPTIONS.buttons.no},a=$.extend({},c,f.confirm.DEFAULTS,a)},_init:function(){var a=this;g._init.call(a),a.show()},_afterShow:function(){var a=this,b=$("<div></div>");a.$options.iconClass&&b.append($('<div class="lobibox-icon-wrapper"></div>').append('<i class="lobibox-icon '+a.$options.iconClass+'"></i>')),b.append('<div class="lobibox-body-text-wrapper"><span class="lobibox-body-text">'+a.$options.msg+"</span></div>"),a._setContent(b.html()),a._position(),g._afterShow.call(a)}}),f.confirm.DEFAULTS={title:"Question",width:500},c.prototype=$.extend({},g,{constructor:c,_processInput:function(a){var b=this,c=g._processInput.call(b,a);return c.buttons={ok:f.base.OPTIONS.buttons.ok},a=$.extend({},c,f.alert.OPTIONS[b.$type],f.alert.DEFAULTS,a)},_init:function(){var a=this;g._init.call(a),a.show()},_afterShow:function(){var a=this,b=$("<div></div>");a.$options.iconClass&&b.append($('<div class="lobibox-icon-wrapper"></div>').append('<i class="lobibox-icon '+a.$options.iconClass+'"></i>')),b.append('<div class="lobibox-body-text-wrapper"><span class="lobibox-body-text">'+a.$options.msg+"</span></div>"),a._setContent(b.html()),a._position(),g._afterShow.call(a)}}),f.alert.OPTIONS={warning:{title:"Warning"},info:{title:"Information"},success:{title:"Success"},error:{title:"Error"}},f.alert.DEFAULTS={},d.prototype=$.extend({},g,{constructor:d,_processInput:function(a){var b=this,c=g._processInput.call(b,a);return a=$.extend({},c,f.progress.DEFAULTS,a)},_init:function(){var a=this;g._init.call(a),a.show()},_afterShow:function(){var a=this;a.$options.progressTpl?a.$progressBarElement=$(a.$options.progressTpl):a.$progressBarElement=a._createProgressbar();var b;a.$options.label&&(b=$("<label>"+a.$options.label+"</label>"));var c=$("<div></div>").append(b,a.$progressBarElement);a._setContent(c),a._position(),g._afterShow.call(a)},_createProgressbar:function(){var a=this,b=$('<div class="lobibox-progress-bar-wrapper lobibox-progress-outer"></div>').append('<div class="lobibox-progress-bar lobibox-progress-element"></div>');return a.$options.showProgressLabel&&b.append('<span class="lobibox-progress-text" data-role="progress-text"></span>'),b},setProgress:function(a){var b=this;if(100!==b.$progress)return a=Math.min(100,Math.max(0,a)),b.$progress=a,b._triggerEvent("progressUpdated"),100===b.$progress&&b._triggerEvent("progressCompleted"),b.$el.find(".lobibox-progress-element").css("width",a.toFixed(1)+"%"),b.$el.find('[data-role="progress-text"]').html(a.toFixed(1)+"%"),b},getProgress:function(){return this.$progress}}),f.progress.DEFAULTS={width:500,showProgressLabel:!0,label:"",progressTpl:!1,progressUpdated:null,progressCompleted:null},e.prototype=$.extend({},g,{constructor:e,_processInput:function(a){var b=this,c=g._processInput.call(b,a);return a.content&&"function"==typeof a.content&&(a.content=a.content()),a.content instanceof jQuery&&(a.content=a.content.clone()),a=$.extend({},c,f.window.DEFAULTS,a)},_init:function(){var a=this;g._init.call(a),a.setContent(a.$options.content),a.$options.url&&a.$options.autoload?(a.$options.showAfterLoad||a.show(),a.load(function(){a.$options.showAfterLoad&&a.show()})):a.show()},_afterShow:function(){var a=this;a._position(),g._afterShow.call(a)},_addCloseButton:function(){var a=this,b=$('<span class="btn-close">&times;</span>');a.$el.find(".lobibox-header").append(b),b.on("mousedown",function(a){a.stopPropagation()}),b.on("click.lobibox",function(){a.windowHide()})},_beforeWindowShow:function(){var a=this;a._triggerEvent("beforeWindowShow")},_beforeWindowHide:function(){var a=this;a._triggerEvent("beforeWindowHide")},_afterWindowShow:function(){var a=this;a._triggerEvent("afterWindowShow")},_afterWindowHide:function(){var a=this;a._triggerEvent("afterWindowHide")},windowHide:function(){var a=this;return a._beforeWindowHide(),a.$el.addClass("hide"),a._afterWindowHide(),this},windowShow:function(){var a=this;return a._beforeWindowShow(),a.$el.removeClass("hide"),a._afterWindowShow(),a.$el[0].style.zIndex=(new Date).getTime()-f.window.startTime,this},setParams:function(a){var b=this;return b.$options.params=a,b},getParams:function(){var a=this;return a.$options.params},setLoadMethod:function(a){var b=this;return b.$options.loadMethod=a,b},getLoadMethod:function(){var a=this;return a.$options.loadMethod},setContent:function(a){var b=this;return b.$options.content=a,b.$el.find(".lobibox-body").html("").append(a),b},getContent:function(){var a=this;return a.$options.content},setUrl:function(a){return this.$options.url=a,this},getUrl:function(){return this.$options.url},load:function(a){var b=this;return b.$options.url?($.ajax(b.$options.url,{method:b.$options.loadMethod,data:b.$options.params}).done(function(c){b.setContent(c),a&&"function"==typeof a&&a(c)}),b):b}}),f.window.DEFAULTS={width:480,height:600,content:"",url:"",draggable:!0,autoload:!0,loadMethod:"GET",showAfterLoad:!0,params:{}},f.window.startTime=(new Date).getTime();var h=function(a,b){this.$type=null,this.$options=null,this.$el=null;var c=this,d=function(a){return"mini"!==a.size&&"large"!==a.size||(a=$.extend({},f.notify.OPTIONS[a.size],a)),a=$.extend({},f.notify.OPTIONS[c.$type],f.notify.DEFAULTS,a),"mini"!==a.size&&a.title===!0?a.title=f.notify.OPTIONS[c.$type].title:"mini"===a.size&&a.title===!0&&(a.title=!1),a.icon===!0&&(a.icon=f.notify.OPTIONS.icons[a.iconSource][c.$type]),a.sound===!0&&(a.sound=f.notify.OPTIONS[c.$type].sound),a.sound&&(a.sound=a.soundPath+a.sound+a.soundExt),a},e=function(a,b){if("normal"===c.$options.size)b.hasClass("bottom")?b.prepend(a):b.append(a);else if("mini"===c.$options.size)b.hasClass("bottom")?b.prepend(a):b.append(a);else if("large"===c.$options.size){var d=i().append(a),e=h(d.attr("id"));b.find(".lb-notify-wrapper").append(d),b.find(".lb-notify-tabs").append(e),g(e),e.find(">a").click(function(){g(e)})}},g=function(a){a.closest(".lb-notify-tabs").find(">li").removeClass("active"),a.addClass("active");var b=$(a.find(">a").attr("href"));b.closest(".lb-notify-wrapper").find(">.lb-tab-pane").removeClass("active"),b.addClass("active")},h=function(a){var b=$("<li></li>",{"class":f.notify.OPTIONS[c.$type]["class"]});return $("<a></a>",{href:"#"+a}).append('<i class="tab-control-icon '+c.$options.icon+'"></i>').appendTo(b),b},i=function(){return $("<div></div>",{"class":"lb-tab-pane",id:Math.randomString(10)})},j=function(){var a,b=("large"===c.$options.size?".lobibox-notify-wrapper-large":".lobibox-notify-wrapper")+"."+c.$options.position.replace(/\s/gi,".");return a=$(b),0===a.length&&(a=$("<div></div>").addClass(b.replace(/\./g," ").trim()).appendTo($(f.viewport)),"large"===c.$options.size&&a.append($('<ul class="lb-notify-tabs"></ul>')).append($('<div class="lb-notify-wrapper"></div>'))),a},k=function(){var a,b,d,e,g,h=f.notify.OPTIONS,i=$("<div></div>",{"class":"lobibox-notify "+h[c.$type]["class"]+" "+h["class"]+" "+c.$options.showClass});return d=$('<div class="lobibox-notify-icon-wrapper"></div>').appendTo(i),a=$('<div class="lobibox-notify-icon"></div>').appendTo(d),b=$("<div></div>").appendTo(a),c.$options.img?b.append('<img src="'+c.$options.img+'"/>'):c.$options.icon?b.append('<div class="icon-el"><i class="'+c.$options.icon+'"></i></div>'):i.addClass("without-icon"),g=$('<div class="lobibox-notify-msg">'+c.$options.msg+"</div>"),c.$options.messageHeight!==!1&&g.css("max-height",c.$options.messageHeight),e=$("<div></div>",{"class":"lobibox-notify-body"}).append(g).appendTo(i),c.$options.title&&e.prepend('<div class="lobibox-notify-title">'+c.$options.title+"<div>"),l(i),"normal"!==c.$options.size&&"mini"!==c.$options.size||(m(i),n(i)),c.$options.width&&i.css("width",p(c.$options.width)),i},l=function(a){c.$options.closable&&$('<span class="lobibox-close">&times;</span>').click(function(){c.remove()}).appendTo(a)},m=function(a){c.$options.closeOnClick&&a.click(function(){c.remove()})},n=function(a){if(c.$options.delay){if(c.$options.delayIndicator){var b=$('<div class="lobibox-delay-indicator"><div></div></div>');a.append(b)}var d=0,e=1e3/30,f=(new Date).getTime(),g=setInterval(function(){c.$options.continueDelayOnInactiveTab?d=(new Date).getTime()-f:d+=e;var a=100*d/c.$options.delay;a>=100&&(a=100,c.remove(),g=clearInterval(g)),c.$options.delayIndicator&&b.find("div").css("width",a+"%")},e);c.$options.pauseDelayOnHover&&a.on("mouseenter.lobibox",function(){e=0}).on("mouseleave.lobibox",function(){e=1e3/30})}},o=function(a){var b=a.prev();return 0===b.length&&(b=a.next()),0===b.length?null:b},p=function(a){return a=Math.min($(window).outerWidth(),a)};this.remove=function(){c.$el.removeClass(c.$options.showClass).addClass(c.$options.hideClass);var a=c.$el.parent(),b=a.closest(".lobibox-notify-wrapper-large"),d="#"+a.attr("id"),e=b.find('>.lb-notify-tabs>li:has(a[href="'+d+'"])');return e.addClass(f.notify.OPTIONS["class"]).addClass(c.$options.hideClass),setTimeout(function(){if("normal"===c.$options.size||"mini"===c.$options.size)c.$el.remove();else if("large"===c.$options.size){var b=o(e);b&&g(b),e.remove(),a.remove()}var d=f.notify.list,h=d.indexOf(c);d.splice(h,1);var i=d[h];i&&i.$options.showAfterPrevious&&i._init()},500),c},c._init=function(){var a=k();if("mini"===c.$options.size&&a.addClass("notify-mini"),"string"==typeof c.$options.position){var b=j();e(a,b),b.hasClass("center")&&b.css("margin-left","-"+b.width()/2+"px")}else $(f.viewport).append(a),a.css({position:"fixed",left:c.$options.position.left,top:c.$options.position.top});if(c.$el=a,c.$options.sound){var d=new Audio(c.$options.sound);d.play()}c.$options.rounded&&c.$el.addClass("rounded"),c.$el.on("click.lobibox",function(a){c.$options.onClickUrl&&(window.location.href=c.$options.onClickUrl),c.$options.onClick&&"function"==typeof c.$options.onClick&&c.$options.onClick.call(c,a)}),c.$el.data("lobibox",c)},this.$type=a,this.$options=d(b),c.$options.showAfterPrevious&&0!==f.notify.list.length||this._init()};f.notify=function(a,b){if(["default","info","warning","error","success"].indexOf(a)>-1){var c=new h(a,b);return f.notify.list.push(c),c}},f.notify.list=[],f.notify.closeAll=function(){var a=f.notify.list;for(var b in a)a[b].remove()},f.notify.DEFAULTS={title:!0,size:"normal",soundPath:"sounds/",soundExt:".ogg",showClass:"fadeInDown",hideClass:"zoomOut",icon:!0,msg:"",img:null,closable:!0,hideCloseButton:!1,delay:5e3,delayIndicator:!0,closeOnClick:!0,width:400,sound:!0,position:"bottom right",iconSource:"bootstrap",rounded:!1,messageHeight:60,pauseDelayOnHover:!0,onClickUrl:null,showAfterPrevious:!1,continueDelayOnInactiveTab:!0,onClick:null},f.notify.OPTIONS={"class":"animated-fast",large:{width:500,messageHeight:96},mini:{"class":"notify-mini",messageHeight:32},"default":{"class":"lobibox-notify-default",title:"Default",sound:!1},success:{"class":"lobibox-notify-success",title:"Success",sound:"sound2"},error:{"class":"lobibox-notify-error",title:"Error",sound:"sound4"},warning:{"class":"lobibox-notify-warning",title:"Warning",sound:"sound5"},info:{"class":"lobibox-notify-info",title:"Information",sound:"sound6"},icons:{bootstrap:{success:"glyphicon glyphicon-ok-sign",error:"glyphicon glyphicon-remove-sign",warning:"glyphicon glyphicon-exclamation-sign",info:"glyphicon glyphicon-info-sign"},fontAwesome:{success:"fa fa-check-circle",error:"fa fa-times-circle",warning:"fa fa-exclamation-circle",info:"fa fa-info-circle"}}}},BIMWINNER.CODE_STATE="BETA",BIMWINNER.DEBUG=!1,BIMWINNER.Material={IfcRoof:{color:[.837255,.203922,.270588,1]},IfcSlab:{color:[.637255,.603922,.670588,1]},IfcWall:{color:[.537255,.337255,.237255,1]},IfcWallStandardCase:{color:[.537255,.337255,.237255,1]},IfcDoor:{color:[.637255,.603922,.670588,1]},IfcWindow:{color:[.137255,.403922,.870588,.4]},IfcOpeningElement:{color:[.137255,.403922,.870588,0]},IfcRailing:{color:[.137255,.403922,.870588,1]},IfcColumn:{color:[.137255,.403922,.870588,1]},IfcBeam:{color:[.137255,.403922,.870588,1]},IfcFurnishingElement:{color:[.137255,.403922,.870588,1]},IfcCurtainWall:{color:[.137255,.403922,.870588,1]},IfcStair:{color:[.637255,.603922,.670588,1]},IfcStairFlight:{color:[.637255,.603922,.670588,1]},IfcBuildingElementProxy:{color:[.5,.5,.5,1]},IfcFlowSegment:{color:[.137255,.403922,.870588,1]},IfcFlowitting:{color:[.137255,.403922,.870588,1]},IfcFlowTerminal:{color:[.137255,.403922,.870588,1]},IfcProxy:{color:[.137255,.403922,.870588,1]},IfcSite:{color:[.137255,.403922,.870588,1]},IfcLightFixture:{color:[.8470588235,.8470588235,.870588,1]},IfcDuctSegment:{color:[.8470588235,.427450980392,0,1]},IfcDistributionFlowElement:{color:[.8470588235,.427450980392,0,1]},IfcDuctFitting:{color:[.8470588235,.427450980392,0,1]},IfcPlate:{color:[.137255,.403922,.870588,.5]},IfcAirTerminal:{color:[.8470588235,.427450980392,0,1]},IfcMember:{color:[.8470588235,.427450980392,0,1]},IfcCovering:{color:[.8470588235,.427450980392,0,1]},IfcTransportElement:{color:[.8470588235,.427450980392,0,1]},IfcFlowController:{color:[.8470588235,.427450980392,0,1]},IfcFlowFitting:{color:[.8470588235,.427450980392,0,1]},IfcRamp:{color:[.8470588235,.427450980392,0,1]},IfcFurniture:{color:[.8470588235,.427450980392,0,1]},IfcFooting:{color:[.8470588235,.427450980392,0,1]},IfcSystemFurnitureElement:{color:[.8470588235,.427450980392,0,1]},IfcSpace:{color:[.137255,.303922,.570588,.5]},DEFAULT:{color:[.8470588235,.427450980392,0,1]}},BIMWINNER.DeviceTypeTest={},BIMWINNER.DeviceTypeTest.isTouchDevice=function(){return"undefined"!=typeof window&&"ontouchstart"in window},BIMWINNER.DeviceTypeTest.isBrowser="undefined"!=typeof navigator,BIMWINNER.DeviceTypeTest.isIE11=BIMWINNER.DeviceTypeTest.isBrowser&&!!navigator.userAgent.match(/Trident\/7\./),BIMWINNER.DeviceTypeTest.isIOSDevice=function(){return!!BIMWINNER.DeviceTypeTest.isBrowser&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())},BIMWINNER.DeviceTypeTest.isAndroidDevice=function(){return!!BIMWINNER.DeviceTypeTest.isBrowser&&navigator.userAgent.toLowerCase().indexOf("android")!==-1},BIMWINNER.DeviceTypeTest.isMobileDevice=function(){return!!BIMWINNER.DeviceTypeTest.isBrowser&&(this.isIOSDevice()||this.isAndroidDevice())},BIMWINNER.DeviceTypeTest.isSafari=function(){if(!BIMWINNER.DeviceTypeTest.isBrowser)return!1;
var a=navigator.userAgent.toLowerCase();return a.indexOf("safari")!==-1&&a.indexOf("chrome")===-1},BIMWINNER.DeviceTypeTest.isFirefox=function(){if(!BIMWINNER.DeviceTypeTest.isBrowser)return!1;var a=navigator.userAgent.toLowerCase();return a.indexOf("firefox")!==-1},BIMWINNER.DeviceTypeTest.isMac=function(){if(!BIMWINNER.DeviceTypeTest.isBrowser)return!1;var a=navigator.userAgent.toLowerCase();return a.indexOf("mac os")!==-1},BIMWINNER.DeviceTypeTest.isWindows=function(){if(!BIMWINNER.DeviceTypeTest.isBrowser)return!1;var a=navigator.userAgent.toLowerCase();return a.indexOf("win32")!==-1||a.indexOf("windows")!==-1},BIMWINNER.Listener=function(){this._handleMap=new function(a,b){this.items=a||[],b=b||0;var c=b+1;this.addItem=function(){var a;if(2===arguments.length){var b=arguments[0];if(a=arguments[1],this.items[b])throw"ID clash: '"+b+"'";return this.items[b]=a,b}for(;;){a=arguments[0];var d=c++;if(!this.items[d])return this.items[d]=a,d}},this.removeItem=function(a){var b=this.items[a];return delete this.items[a],b}},this._locSubs={},this._handleLocs={},this.props={},this.fire=function(a,b,c){c!==!0&&(this.props[a]=b);var d,e=this._locSubs[a];if(e)for(var f in e)e.hasOwnProperty(f)&&(d=e[f],d.callback.call(d.scope,b))},this.on=function(a,b,c){var d=this._locSubs[a];d||(d={},this._locSubs[a]=d);var e=this._handleMap.addItem();d[e]={scope:c||this,callback:b},this._handleLocs[e]=a;var f=this.props[a];return f&&b.call(c||this,f),e},this.off=function(a){var b=this._handleLocs[a];if(b){delete this._handleLocs[a];var c=this._locSubs[b];c&&delete c[a],this._handleMap.removeItem(a)}},this.once=function(a,b,c){var d=this,e=this.on(a,function(a){d.off(e),b(a)},c)}},BIMWINNER.Input=function(a){this.listener=new BIMWINNER.Listener;var b=this;this.altDown=!1,this.ctrlDown=!1,this.mouseDownLeft=!1,this.mouseDownMiddle=!1,this.mouseDownRight=!1,this.keyDown=[],this.enabled=!0,this.translationFlag=!1,this.theMeasuredDistance=!1,this.theMeasuredDistanceSize=.1,this.zoomFlag=!1,this.touchstart=!1,this.touchmove=!1,this.touchend=!1,this.theInitialStadia=1,a.addEventListener("contextmenu",function(a){a.preventDefault()},!1),a.addEventListener("touchstart",this._touchstartListener=function(a){if(b.enabled){b.touchstart=!0;var c=[a.touches[0].clientX,a.touches[0].clientY];b.listener.fire("touchstart",c,a,!0)}}),a.addEventListener("touchend",this._touchendListener=function(a){if(b.enabled){b.touchend=!0;var c=[a.changedTouches[0].clientX,a.changedTouches[0].clientY];b.listener.fire("touchend",c,a,!0)}}),a.addEventListener("touchmove",this._touchmoveListener=function(a){if(b.enabled){b.touchmove=!0,a.preventDefault();var c=[a.touches[0].clientX,a.touches[0].clientY];b.listener.fire("touchmove",c,a,!0)}}),a.addEventListener("mousedown",this._mouseDownListener=function(a){if(b.enabled){switch(a.which){case 1:b.mouseDownLeft=!0;break;case 2:b.mouseDownMiddle=!0;break;case 3:b.mouseDownRight=!0}var c=b._getClickCoordsWithinElement(a);b.listener.fire("mousedown",c,a,!0)}}),a.addEventListener("mouseup",this._mouseUpListener=function(a){if(b.enabled){switch(a.which){case 1:b.mouseDownLeft=!1;break;case 2:b.mouseDownMiddle=!1;break;case 3:b.mouseDownRight=!1}var c=b._getClickCoordsWithinElement(a);b.listener.fire("mouseup",c,a,!0)}}),a.addEventListener("dblclick",this._dblClickListener=function(a){if(b.enabled){switch(a.which){case 1:b.mouseDownLeft=!1,b.mouseDownRight=!1;break;case 2:b.mouseDownMiddle=!1;break;case 3:b.mouseDownLeft=!1,b.mouseDownRight=!1}var c=b._getClickCoordsWithinElement(a);b.listener.fire("dblclick",c,a,!0)}}),a.addEventListener("mousemove",this._mouseMoveListener=function(a){if(b.enabled){var c=b._getClickCoordsWithinElement(a);b.listener.fire("mousemove",c,a,!0)}}),a.addEventListener("mousewheel",this._mouseWheelListener=function(a,c){if(b.enabled){var a=window.event||a,d=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));a.preventDefault();var e=a.offsetX,f=a.offsetY;b.listener.fire("mousewheel",{delta:d,offsetx:e,offsety:f},a,!0)}}),a.addEventListener("DOMMouseScroll",this._mouseWheelListener=function(a,c){if(b.enabled){var a=window.event||a,d=Math.min(1,Math.max(-1,a.wheelDelta||-a.detail));a.preventDefault();var e=a.offsetX,f=a.offsetY;b.listener.fire("mousewheel",{delta:d,offsetx:e,offsety:f},a,!0)}}),function(){var a,c;b.listener.on("mousedown",function(b){a=b.x,c=b.y}),b.listener.on("touchstart",function(b){a=b.x,c=b.y}),b.listener.on("mouseup",function(d){a===d.x&&c===d.y&&b.listener.fire("mouseclicked",d,!0)}),b.listener.on("touchend",function(a){})}(),this._getClickCoordsWithinElement=function(a){var b=[0,0];if(a){for(var c=a.target,d=0,e=0;c.offsetParent;)d+=c.offsetLeft,e+=c.offsetTop,c=c.offsetParent;b[0]=a.pageX-d,b[1]=a.pageY-e}else a=window.event,b.x=a.x,b.y=a.y;return b};this.keyCode={KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_NUM_0:48,KEY_NUM_1:49,KEY_NUM_2:50,KEY_NUM_3:51,KEY_NUM_4:52,KEY_NUM_5:53,KEY_NUM_6:54,KEY_NUM_7:55,KEY_NUM_8:56,KEY_NUM_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_SPACE:32}},BIMWINNER.ObjectSet=function(a){this.className="BIMWINNER.ObjectSet",this.listener=new BIMWINNER.Listener;var b=this;this.alwaysVisible=!1,this.showBox=!0,this.objects={},this.boxHelper={},this.box=new THREE.Object3D,a.scene.add(b.box),this.numObjects=0,this.boundary={},this._boundaryDirty=!0,this.clear=function(){for(var a in this.objects)this.objects.hasOwnProperty(a)&&d(this.objects[a]);b.listener.fire("updated",{cleared:!0})},this.addObjects=function(a){for(var d=0,e=a.length;d<e;d++)c(a[d]);b.listener.fire("updated",{added:{objects:a}})};var c=function(a){var c=a.key||a.id;if($.isArray(a.material))for(var d=0;d<a.material.length;d++)a.material[d].color.setRGB(.25,.68,0),a.material[d].depthTest=!b.alwaysVisible,!a.material[d].transparent&&b.alwaysVisible&&(a.material[d].transparent=!0,a.userData.objectSetChange=!0);else a.material.color.setRGB(.25,.68,0),a.material.depthTest=!b.alwaysVisible,!a.material.transparent&&b.alwaysVisible&&(a.material.transparent=!0,a.userData.objectSetChange=!0);a.highlight=!0,a.visible=!0,b.objects[c]=a,b.boxHelper[c]=new THREE.BoxHelper(a),b.showBox&&b.box.add(b.boxHelper[c]),b.numObjects=Object.getOwnPropertyNames(b.objects).length},d=function(c){var d=c.key||c.id;if($.isArray(c.material))for(var e=0;e<c.material.length;e++)c.userData.color.clone?c.material[e].color=c.userData.color.clone():c.material[e].color.setRGB(c.userData.color[4*e],c.userData.color[4*e+1],c.userData.color[4*e+2]),c.material[e].depthTest=!0,c.userData.objectSetChange&&!c.userData.transparentChange&&(c.material[e].transparent=c.userData.originalMaterial[e].transparent);else c.material.color=c.userData.color.clone(),c.material.depthTest=!0,c.userData.objectSetChange&&!c.userData.transparentChange&&(c.material.transparent=c.userData.originalMaterial[0].transparent);c.userData.objectSetChange=!1,c.highlight=!1,c.userData&&"IfcSpace"==c.userData.type&&(c.visible=!1),delete b.objects[d],b.numObjects=Object.getOwnPropertyNames(b.objects).length,b.box.remove(b.boxHelper[d]),delete b.boxHelper[d],b.numObjects<=0&&(a.scene.remove(b.box),b.box=new THREE.Object3D,a.scene.add(b.box))};this.removeObjects=function(a){for(var c=0,e=a.length;c<e;c++)d(a[c]);b.listener.fire("updated",{removed:{objects:a}})},this.addObjectIds=function(d){for(var e,f,g=0,h=d.length;g<h;g++)e=d[g],f=a.components[e],f?c(f):console.warn("addObjectIds - object not found: '"+e+"'");b.listener.fire("updated",{added:{objectIds:d}})},this.removeObjectIds=function(c){for(var e,f,g=0,h=c.length;g<h;g++)e=c[g],f=a.components[e],f?d(f):console.warn("removeObjectIds - object not found: '"+e+"'");b.listener.fire("updated",{removed:{objectIds:c}})},this.addTypes=function(d){for(var e,f,g,h=0,i=d.length;h<i;h++)if(e=d[h],f=a.getComponentTypeArray(),f[e])for(g in f[e])f.hasOwnProperty(g)&&c(f[g]);else console.warn("addTypes - 类型没有找到: '"+e+"'");b.listener.fire("updated",{added:{types:d}})},this.removeTypes=function(c){for(var e,f,g,h=0,i=c.length;h<i;h++)if(e=c[h],f=a.getComponentTypeArray(),f[e])for(g in f[e])f.hasOwnProperty(g)&&d(this.objects[g]);else console.warn("removeTypes - 类型没有找到: '"+e+"'");b.listener.fire("updated",{removed:{types:c}})},this.withObjects=function(a){for(var b in this.objects)this.objects.hasOwnProperty(b)&&a(this.objects[b])},this.getBoundary=function(){b.boundary=null,b.boundary=new THREE.Box3(new THREE.Vector3,new THREE.Vector3);var a=!0;for(var c in b.objects)if(b.objects[c].visible){var d=(new THREE.Box3).expandByObject(b.objects[c]);a?(b.boundary=d.clone(),a=!1):b.boundary.union(d),d=null}return b.boundary},this.getCenter=function(){return b.getBoundary().getCenter()}},BIMWINNER.CameraFlyAnimation=function(a,b,c){var d=this;this.lister=new BIMWINNER.Listener,this._look1=new THREE.Vector3,this._eye1=new THREE.Vector3,this._up1=new THREE.Vector3,this._look2=new THREE.Vector3,this._eye2=new THREE.Vector3,this._up2=new THREE.Vector3,this._dist=0,this._flying=!1,this._ok=null,this._onTick=null,this._camera=b||a.camera,this._tempVec=new THREE.Vector3,this._eyeVec=new THREE.Vector3,this._lookVec=new THREE.Vector3,this._stopFOV=55,this._time1=null,this._time2=null,this.easing=a.easing!==!1,this._duration=a.duration||800,this.camera=b||a.camera,this.cameraControl=c||a.cameraControl,this.flyTo=function(b,c){!d.cameraControl instanceof BIMWINNER.OrbitControls&&console.warn("非轨道球控制模式不支持视角飞跃方法"),d.cameraControl.forbidRotate&&d.cameraControl.forbidRotate(),d._flying&&d.stop(),d._ok=c,this._arc=void 0===b.arc?0:b.arc;var f=d.camera;d._look1=d.cameraControl.target.clone(),d._eye1=f.position.clone(),d._up1=f.up.clone();var g=b.backOff||.5;if(g<0?g=0:g>1&&(g=1),g=1-g,b.boundary){var h=b.boundary;if(h.xmax<=h.xmin||h.ymax<=h.ymin||h.zmax<=h.zmin)return;var i=b.dist||2.5,j=Math.abs(BIMSURFER.math.lenVec3(d._vec)),k=BIMSURFER.math.getBoundaryDiag(h),l=Math.abs(k/(1+.8*g)/Math.tan(d._stopFOV/2)),m=l/j*i;d._look2=BIMSURFER.math.getBoundaryCenter(h),d._look2=[d._look2[0],d._look2[1],d._look2[2]],b.offset&&(d._look2[0]+=b.offset[0],d._look2[1]+=b.offset[1],d._look2[2]+=b.offset[2]),d._eye2=BIMSURFER.math.addVec3(d._look2,BIMSURFER.math.mulVec3Scalar(d._vec,m,[])),d._up2=BIMSURFER.math.vec3(),d._up2[1]=1}else{d._look1=d.cameraControl.target.clone(),d._eye1=f.position.clone(),d._up1=f.up.clone();var n=b;n.look&&n.look.isVector3?d._look2=n.look:$.isArray(n.look)?d._look2=new THREE.Vector3(n.look[0],n.look[1],n.look[2]):d._look2=d.cameraControl.target.clone(),n.eye&&n.eye.isVector3?d._eye2=n.eye:$.isArray(n.eye)?d._eye2=new THREE.Vector3(n.eye[0],n.eye[1],n.eye[2]):d._eye2=d.camera.position.clone(),n.up&&n.up.isVector3?d._up2=n.up:$.isArray(n.up)?d._up2=new THREE.Vector3(n.up[0],n.up[1],n.up[2]):d._up2=f.up.clone()}d.lister.fire("started",b,!0),d._time1=(new Date).getTime(),d._time2=d._time1+d._duration,d._tick=a.listener.on("tick",function(a){e(1e3*a.time)}),d._flying=!0};var e=function(b){if(d._flying){b=(new Date).getTime();var c=(b-d._time1)/(d._time2-d._time1);if(c>1)return d._camera.position.copy(d._eye2),d._camera.lookAt(d._look2),d.cameraControl.target.copy(d._look2),d._camera.up.copy(d._up2),d._camera.updateProjectionMatrix(),void d.stop();c=d.easing?f(c,0,1,1):c,d._camera.position.copy((new THREE.Vector3).lerpVectors(d._eye1,d._eye2,c));var e=(new THREE.Vector3).lerpVectors(d._look1,d._look2,c);d.cameraControl.target.copy(e),d._camera.lookAt(e),d._camera.up.copy((new THREE.Vector3).lerpVectors(d._up1,d._up2,c)),d._camera.updateProjectionMatrix(),a.cameraControl.update()}},f=function(a,b,c,d){return a/=d,-c*a*(a-2)+b};this.stop=function(){if(d._flying){a.listener.off(d._tick),d._flying=!1,d._time1=null,d._time2=null,d.lister.fire("stopped",!0,!0);var b=d._ok;b&&(d._ok=!1,b())}}},BIMWINNER.FirstPersonControls=function(a,b,c){function d(a){a.preventDefault()}function e(a,b){return function(){b.apply(a,arguments)}}var f=this;this.className="FirstPersonControls",this.camera=a,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==b?b:document,this.enabled=!0,this.collisionEnabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.mouseDown=!1,this.touchCameraMove=!1,this.touchLensMove=!1,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.jump=!1,this.targetChange=!1,this.keyDown=!1,this.mouseDragOn=!1,this.pointerLock=!1,this.havePointerLock,this.collision=new BIMWINNER.CollisionDetection({},c),this.collisionResult=null,this.deviceTest=BIMWINNER.DeviceTypeTest,this.viewX=0,this.viewY=0;var g=0,h=0,i=0,j=0,k={},l=$('<div class="roamReticle">');if(this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),f.havePointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,f.havePointerLock){var m=$('<div id="blocker"> <div id="instructions"> <span style="font-size:40px">点击进入沉浸式浏览</span> <br />(W, A, S, D键 = 移动, esc键 = 退出, 鼠标移动 = 镜头环绕) </div> </div>');m.appendTo($("body"));var n=document.getElementById("blocker"),o=document.getElementById("instructions"),p=function(a){document.pointerLockElement===f.domElement||document.mozPointerLockElement===f.domElement||document.webkitPointerLockElement===f.domElement?(f.pointerLock=!0,n.style.display="none",c.ClickSelectObjects.pointerLock=!0,c?(l.appendTo($("#"+c.viewport)),l.css({top:f.viewY/2-30,left:f.viewX/2-30})):(l.appendTo($("body")),l.css({top:f.viewY/2-30,left:f.viewX/2-30}))):(f.pointerLock=!1,c.ClickSelectObjects.pointerLock=!1,n.style.display="-webkit-box",n.style.display="-moz-box",n.style.display="box",o.style.display="",l.remove(),f.domElement.focus())},q=function(a){o.style.display="",f.pointerLock=!1};document.addEventListener("pointerlockchange",p,!1),document.addEventListener("mozpointerlockchange",p,!1),document.addEventListener("webkitpointerlockchange",p,!1),document.addEventListener("pointerlockerror",q,!1),document.addEventListener("mozpointerlockerror",q,!1),document.addEventListener("webkitpointerlockerror",q,!1),o.addEventListener("click",function(a){o.style.display="none",f.domElement.requestPointerLock=f.domElement.requestPointerLock||f.domElement.mozRequestPointerLock||f.domElement.webkitRequestPointerLock,f.domElement.requestPointerLock()},!1)}else{if(this.pointerLock=!1,f.deviceTest.isMobileDevice()){var r=$('<div id="blocker"> <div id="instructions"> <div style="font-size:40px">点击进入漫游模式</div> <br /><div style="font-size:40px;    width: 40%;top: 60%;left: 0%;position: absolute;">触摸屏幕左侧并滑动  控制相机移动</div> <div style="font-size:40px;width: 40%;top: 60%;right: 0%;position: absolute;">触摸屏幕右侧并滑动  控制镜头环绕</div></div> </div>');r.appendTo($("body"))}else{var s=$('<div id="blocker"> <div id="instructions"> <span style="font-size:40px">点击进入漫游模式</span> <br />(W, A, S, D键 = 移动,  鼠标左键按下并移动 = 镜头环绕) </div> </div>');s.appendTo($("body"))}var t=document.getElementById("blocker"),u=document.getElementById("instructions");u.addEventListener("click",function(a){t.style.display="none",t.remove()},!1)}this.roamingState=function(){},this.handleResize=function(){this.domElement===document?(this.viewX=window.innerWidth,this.viewY=window.innerHeight):(this.viewX=this.domElement.offsetWidth,this.viewY=this.domElement.offsetHeight)},this.onMouseDown=function(a){this.domElement!==document&&this.domElement.focus(),a.preventDefault(),a.stopPropagation(),0==a.button&&(this.mouseDown=!0,g=a.pageX-this.domElement.offsetLeft,h=a.pageY-this.domElement.offsetTop),this.mouseDragOn=!0},this.onMouseUp=function(a){a.preventDefault(),a.stopPropagation(),f.havePointerLock||0==a.button&&(this.mouseDown=!1),this.mouseDragOn=!1},this.onMouseMove=function(a){if(f.havePointerLock&&f.pointerLock)this.mouseX=-a.movementX||a.mozMovementX||a.webkitMovementX||0,this.mouseY=a.movementY||a.mozMovementY||a.webkitMovementY||0,!f.keyDown;else if(f.mouseDown){var b=a.pageX-this.domElement.offsetLeft,c=a.pageY-this.domElement.offsetTop;this.mouseX=g-b,this.mouseY=c-h,g=b,h=c,!f.keyDown}},this.onTouchStart=function(a){this.domElement!==document&&this.domElement.focus(),a.preventDefault(),a.stopPropagation(),i=a.changedTouches[0].clientX-this.domElement.offsetLeft,j=a.changedTouches[0].clientY-this.domElement.offsetTop,i>f.viewX/2?k.lensMove||(k.lensMove={x:i,y:j,id:a.changedTouches[0].identifier},f.touchLensMove=!0):k.cameraMove||(k.cameraMove={x:i,y:j,id:a.changedTouches[0].identifier},f.touchCameraMove=!0)},this.onTouchEnd=function(a){if(a.preventDefault(),a.stopPropagation(),!f.havePointerLock)for(var b=0;b<a.changedTouches.length;b++)k.cameraMove&&k.cameraMove.id==a.changedTouches[b].identifier?(f.touchCameraMove=!1,f.moveRight=!1,f.moveLeft=!1,f.moveBackward=!1,f.moveForward=!1,k.cameraMove=void 0):k.lensMove&&k.lensMove.id==a.changedTouches[b].identifier&&(f.touchLensMove=!1,k.lensMove=void 0)},this.onTouchMove=function(a){if(!f.havePointerLock&&!f.pointerLock){for(var b=0;b<a.changedTouches.length;b++)if(f.touchLensMove){if(k.lensMove&&k.lensMove.id==a.changedTouches[b].identifier){var c=a.changedTouches[b].clientX-this.domElement.offsetLeft,d=a.changedTouches[b].clientY-this.domElement.offsetTop;this.mouseX=k.lensMove.x-c,this.mouseY=d-k.lensMove.y,k.lensMove.x=c,k.lensMove.y=d}}else if(f.touchCameraMove&&k.cameraMove&&k.cameraMove.id==a.changedTouches[b].identifier){var e=a.changedTouches[b].clientX-this.domElement.offsetLeft,g=a.changedTouches[b].clientY-this.domElement.offsetTop,h=e-k.cameraMove.x,i=g-k.cameraMove.y;k.cameraMove.x=e,k.cameraMove.y=g,Math.abs(h)>=Math.abs(i)?h>0?f.moveRight=!0:f.moveLeft=!0:i>0?f.moveBackward=!0:f.moveForward=!0}!f.keyDown}},this.onKeyDown=function(a){switch(a.keyCode){case 38:this.mouseY=-2;break;case 87:this.moveForward=!0;break;case 37:this.mouseX=2;break;case 65:this.moveLeft=!0;break;case 40:this.mouseY=2;break;case 83:this.moveBackward=!0;break;case 39:this.mouseX=-2;break;case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 32:this.jump=!0}f.keyDown=!0},this.onKeyUp=function(a){switch(a.keyCode){case 38:this.mouseY=0;break;case 87:this.moveForward=!1;break;case 37:this.mouseX=0;break;case 65:this.moveLeft=!1;break;case 40:this.mouseY=0;break;case 83:this.moveBackward=!1;break;case 39:this.mouseX=0;break;case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1;break;case 32:this.jump=!1}f.keyDown=!1},this.update=function(a){if(this.enabled!==!1){if(a=1,this.heightSpeed){var b=THREE.Math.clamp(this.camera.position.dot(this.camera.up),this.heightMin,this.heightMax),c=b-this.heightMin;this.autoSpeedFactor=a*(c*this.heightCoef)}else this.autoSpeedFactor=0;var d=a*this.lookSpeed;this.activeLook||(d=0);var e=1;this.constrainVertical&&(e=Math.PI/(this.verticalMax-this.verticalMin)),0==this.mouseX&&0==this.mouseY||(f.targetChange=!0),this.lon+=this.mouseX*d,this.lookVertical&&(this.lat-=this.mouseY*d*e),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var g=this.target,h=this.camera.position;this.camera.up.x||(this.camera.up.y?(g.x=h.x+1*Math.sin(this.phi)*Math.cos(this.theta),g.y=h.y+1*Math.cos(this.phi),g.z=h.z+1*Math.sin(this.phi)*Math.sin(this.theta)):(g.x=h.x+1*Math.sin(this.phi)*Math.cos(this.theta),g.y=h.y+1*Math.sin(this.phi)*Math.sin(this.theta),g.z=h.z+1*Math.cos(this.phi))),this.camera.lookAt(g),this.target.copy(g);var i=a*this.movementSpeed;if(f.collisionEnabled){if(this.moveForward||this.moveBackward||this.moveLeft||this.moveRight||this.moveUp||this.moveDown){var j=g.clone().sub(this.camera.position).normalize();j.z=0,f.targetChange&&(f.collisionResult=f.determineTheMove(f.collision.run(this.camera.position,j)),f.targetChange=!1),f.collisionResult||(f.collisionResult=f.determineTheMove(f.collision.run(this.camera.position,j))),f.collisionResult.front>i&&(this.moveForward||this.autoForward&&!this.moveBackward)&&(this.camera.translateZ(-(i+this.autoSpeedFactor)),f.collisionResult.front-=i,f.collisionResult.back+=i),f.collisionResult.back>i&&this.moveBackward&&(this.camera.translateZ(i),f.collisionResult.back-=i,f.collisionResult.front+=i),f.collisionResult.left>i&&this.moveLeft&&(this.camera.translateX(-i),f.collisionResult.left-=i,f.collisionResult.right+=i),f.collisionResult.right>i&&this.moveRight&&(this.camera.translateX(i),f.collisionResult.right-=i,f.collisionResult.left+=i)}this.moveUp&&this.camera.translateY(i),this.moveDown&&this.camera.translateY(-i)}else(this.moveForward||this.autoForward&&!this.moveBackward)&&this.camera.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.camera.translateZ(i),this.moveLeft&&this.camera.translateX(-i),this.moveRight&&this.camera.translateX(i),this.moveUp&&this.camera.translateY(i),this.moveDown&&this.camera.translateY(-i);this.mouseX=0,this.mouseY=0}},this.determineTheMove=function(a){var b={},c=10;for(var d in a)if(a[d][0])switch(d){case"top":b[d]=a[d][0].distance-f.collision.height+f.collision.eyeHeight-c;break;case"front":b[d]=a[d][0].distance-c-f.collision.thickness/2;break;case"back":b[d]=a[d][0].distance-c-f.collision.thickness/2;break;case"left":b[d]=a[d][0].distance-c-f.collision.width/2;break;case"right":b[d]=a[d][0].distance-c-f.collision.width/2;break;default:b[d]=a[d][0].distance-c}else b[d]=1/0;return b},this.dispose=function(){this.domElement.removeEventListener("contextmenu",d,!1),this.domElement.removeEventListener("mousedown",w,!1),this.domElement.removeEventListener("mousemove",v,!1),this.domElement.removeEventListener("mouseup",x,!1),this.domElement.removeEventListener("touchstart",z,!1),this.domElement.removeEventListener("touchmove",y,!1),this.domElement.removeEventListener("touchend",A,!1),window.removeEventListener("keydown",B,!1),window.removeEventListener("keyup",C,!1),document.getElementById("blocker")&&document.getElementById("blocker").remove(),l.remove()};var v=e(this,this.onMouseMove),w=e(this,this.onMouseDown),x=e(this,this.onMouseUp),y=e(this,this.onTouchMove),z=e(this,this.onTouchStart),A=e(this,this.onTouchEnd),B=e(this,this.onKeyDown),C=e(this,this.onKeyUp);this.domElement.addEventListener("contextmenu",d,!1),this.domElement.addEventListener("mousemove",v,!1),this.domElement.addEventListener("mousedown",w,!1),this.domElement.addEventListener("mouseup",x,!1),this.domElement.addEventListener("touchmove",y,!1),this.domElement.addEventListener("touchstart",z,!1),this.domElement.addEventListener("touchend",A,!1),window.addEventListener("keydown",B,!1),window.addEventListener("keyup",C,!1),this.handleResize()},BIMWINNER.FirstPersonControls.prototype=Object.create(THREE.EventDispatcher.prototype),BIMWINNER.FirstPersonControls.prototype.constructor=BIMWINNER.FirstPersonControls,BIMWINNER.ClickSelectObjects=function(a,b){function c(a){if(m.enabled){var b=j(a);n.x=k=b[0],n.y=l=b[1]}}function d(b){if(m.enabled){var c=j(b);(c[0]>k?c[0]-k<5:k-c[0]<5)&&(c[1]>l?c[1]-l<5:l-c[1]<5)&&(n.x=k=c[0],n.y=l=c[1],m.pointerLock&&(n.x=a.viewerdiv.width()/2,n.y=a.viewerdiv.height()/2),i("pick"))}}function e(a){m.enabled&&(n.x=k=a.changedTouches[0].clientX,n.y=l=a.changedTouches[0].clientY)}function f(a){m.enabled&&(a.changedTouches[0].clientX>k?a.changedTouches[0].clientX-k<5:k-a.changedTouches[0].clientX<5)&&(a.changedTouches[0].clientY>l?a.changedTouches[0].clientY-l<5:l-a.changedTouches[0].clientY<5)&&(n.x=k=a.changedTouches[0].clientX,n.y=l=a.changedTouches[0].clientY,i("pick"))}function g(a){m.enabled&&a.ctrlKey&&(m.multi=!0)}function h(a){m.enabled&&(a.ctrlKey||(m.multi=!1))}function i(c){var d=new THREE.Vector3(n.x/a.renderer.domElement.clientWidth*2-1,2*-(n.y/a.renderer.domElement.clientHeight)+1,.5);m.raycaster.setFromCamera(d,a.camera);var e=m.raycaster.intersectObjects(b.children);m.listener.fire("pick",e),e.length>0?"move"==c?o!=e[0].object&&(o&&o.material.emissive.setHex(o.currentHex),o=e[0].object,o.currentHex=o.material.emissive.getHex(),o.material.emissive.setHex(16777215)):a.objectSet.objects[e[0].object.key]?a.objectSet.removeObjects([e[0].object]):(m.multi||a.objectSet.clear(),a.objectSet.addObjects([e[0].object])):"move"==c?(o&&o.material.emissive.setHex(o.currentHex),o=null):a.objectSet.clear(),d=null}function j(a){var b=[0,0];if(a){for(var c=a.target,d=0,e=0;c.offsetParent;)d+=c.offsetLeft,e+=c.offsetTop,c=c.offsetParent;b[0]=a.pageX-d,b[1]=a.pageY-e}else a=window.event,b.x=a.x,b.y=a.y;return b}var k,l,m=this,n=new THREE.Vector2;this.listener=new BIMWINNER.Listener,this.enabled=!0,this.raycaster=new THREE.Raycaster,this.domElement=a.renderer.domElement,this.activeEventListener=function(){this.mousedown=m.domElement.addEventListener("mousedown",c,!1),this.mouseup=m.domElement.addEventListener("mouseup",d,!1),this.keydown=document.addEventListener("keydown",g,!1),this.keyup=document.addEventListener("keyup",h,!1)},this.disposeEventListener=function(){this.mousedown=m.domElement.removeEventListener("mousedown",c,!1),this.mouseup=m.domElement.removeEventListener("mouseup",d,!1),this.keydown=document.removeEventListener("keydown",g,!1),this.keyup=document.removeEventListener("keyup",h,!1)},this.dispose=function(){this.disposeEventListener(),this.touchDisabled()},this.disabled=function(){this.disposeEventListener(),this.touchDisabled()},this.touchEnabled=function(){this.touchstart=m.domElement.addEventListener("touchstart",e,!1),this.touchend=m.domElement.addEventListener("touchend",f,!1)},this.touchDisabled=function(){this.touchstart=m.domElement.removeEventListener("touchstart",e,!1),this.touchend=m.domElement.removeEventListener("touchend",f,!1)};var o;this.multi=!1,m.pointerLock=!1,m.raycaster.setFromCamera(n,a.camera),m.activeEventListener(),m.touchEnabled()},BIMWINNER.OrbitControls=function(a,b,c){function d(){return 2*Math.PI/60/60*G.autoRotateSpeed}function e(){return Math.pow(.95,G.zoomSpeed)}function f(a){O.theta-=a}function g(a){O.phi-=a}function h(a){G.camera instanceof THREE.PerspectiveCamera?(P/=a,R=!0):G.camera instanceof THREE.OrthographicCamera?(G.camera.zoom=Math.max(G.minZoom,Math.min(G.maxZoom,G.camera.zoom*a)),G.camera.updateProjectionMatrix(),R=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),G.enableZoom=!1)}function i(a){G.camera instanceof THREE.PerspectiveCamera?P*=a:G.camera instanceof THREE.OrthographicCamera?(G.camera.zoom=Math.max(G.minZoom,Math.min(G.maxZoom,G.camera.zoom/a)),G.camera.updateProjectionMatrix(),R=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),G.enableZoom=!1)}function j(a){S.set(a.clientX,a.clientY)}function k(a){V.set(a.clientX,a.clientY)}function l(a){T.set(a.clientX,a.clientY),U.subVectors(T,S);var b=G.domElement===document?G.domElement.body:G.domElement;f(2*Math.PI*U.x/b.clientWidth*G.rotateSpeed),g(2*Math.PI*U.y/b.clientHeight*G.rotateSpeed),S.copy(T),G.update()}function m(a){Z.set(a.clientX,a.clientY),$.subVectors(Z,Y),$.y>0?h(e()):$.y<0&&i(e()),Y.copy(Z),G.update()}function n(a){W.set(a.clientX,a.clientY),X.subVectors(W,V),ba(X.x,X.y),V.copy(W),G.update()}function o(a){}function p(a){a.deltaY<0?i(e()):a.deltaY>0&&h(e()),G.update()}function q(a){switch(a.keyCode){case G.keys.PANUP:ba(0,-G.keyPanSpeed),G.update();break;case G.keys.PANBOTTOM:ba(0,G.keyPanSpeed),G.update();break;case G.keys.PANLEFT:ba(-G.keyPanSpeed,0),G.update();break;case G.keys.PANRIGHT:ba(G.keyPanSpeed,0),G.update();break;case G.keys.ROTATEUP:g(-G.rotateSpeed/8),G.update();break;case G.keys.ROTATEBOTTOM:g(G.rotateSpeed/8),G.update();break;case G.keys.ROTATELEFT:f(-G.rotateSpeed/8),G.update();break;case G.keys.ROTATERIGHT:f(G.rotateSpeed/8),G.update();break;case G.keys.ZOOMIN:h(e()),G.update();break;case G.keys.ZOOMOUT:i(e()),G.update()}}function r(a){S.set(a.touches[0].pageX,a.touches[0].pageY)}function s(a){var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);Y.set(0,d)}function t(a){V.set(a.touches[0].pageX,a.touches[0].pageY)}function u(a){T.set(a.touches[0].pageX,a.touches[0].pageY),U.subVectors(T,S);var b=G.domElement===document?G.domElement.body:G.domElement;f(2*Math.PI*U.x/b.clientWidth*G.rotateSpeed),g(2*Math.PI*U.y/b.clientHeight*G.rotateSpeed),S.copy(T),G.update()}function v(a){var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);Z.set(0,d),$.subVectors(Z,Y),$.y>0?i(e()):$.y<0&&h(e()),Y.copy(Z),G.update()}function w(a){W.set(a.touches[0].pageX,a.touches[0].pageY),X.subVectors(W,V),ba(X.x,X.y),V.copy(W),G.update()}function x(a){}function y(a){if(G.enabled!==!1){if(a.preventDefault(),a.button===G.mouseButtons.ORBIT){if(G.enableRotate===!1)return;j(a),L=K.ROTATE}else if(a.button===G.mouseButtons.PAN2){if(G.enablePan===!1)return;k(a),L=K.PAN}else if(a.button===G.mouseButtons.PAN){if(G.enablePan===!1)return;k(a),L=K.PAN}L!==K.NONE&&(G.domElement.addEventListener("mousemove",z,!1),G.domElement.addEventListener("mouseup",A,!1),G.domElement.addEventListener("mouseout",A,!1),G.dispatchEvent(I))}}function z(a){if(G.enabled!==!1)if(a.preventDefault(),L===K.ROTATE){if(G.enableRotate===!1)return;l(a)}else if(L===K.DOLLY){if(G.enableZoom===!1)return;m(a)}else if(L===K.PAN){if(G.enablePan===!1)return;n(a)}}function A(a){G.enabled!==!1&&(o(a),G.domElement.removeEventListener("mousemove",z,!1),G.domElement.removeEventListener("mouseup",A,!1),G.domElement.removeEventListener("mouseout",A,!1),G.dispatchEvent(J),L=K.NONE)}function B(a){G.enabled===!1||G.enableZoom===!1||L!==K.NONE&&L!==K.ROTATE||(a.preventDefault(),a.stopPropagation(),p(a),G.dispatchEvent(I),G.dispatchEvent(J))}function C(a){G.enabled!==!1&&G.enableKeys!==!1&&G.enablePan!==!1&&"INPUT"!==a.target.tagName&&"TEXTAREA"!==a.target.tagName&&q(a)}function D(a){if(G.enabled!==!1){switch(a.touches.length){case 1:if(G.enableRotate===!1)return;r(a),L=K.TOUCH_ROTATE;break;case 2:if(G.enableZoom===!1)return;s(a),L=K.TOUCH_DOLLY;break;case 3:if(G.enablePan===!1)return;t(a),L=K.TOUCH_PAN;break;default:L=K.NONE}L!==K.NONE&&G.dispatchEvent(I)}}function E(a){if(G.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(G.enableRotate===!1)return;if(L!==K.TOUCH_ROTATE)return;u(a);break;case 2:if(G.enableZoom===!1)return;if(L!==K.TOUCH_DOLLY)return;v(a);break;case 3:if(G.enablePan===!1)return;if(L!==K.TOUCH_PAN)return;w(a);break;default:L=K.NONE}}function F(a){G.enabled!==!1&&(x(a),G.dispatchEvent(J),L=K.NONE)}var G=this;this.camera=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.target=new THREE.Vector3(0,0,0),this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,
this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={PANLEFT:65,PANUP:87,PANRIGHT:68,PANBOTTOM:83,ROTATELEFT:37,ROTATEUP:38,ROTATERIGHT:39,ROTATEBOTTOM:40,ZOOMIN:109,ZOOMOUT:107},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT,PAN2:THREE.MOUSE.MIDDLE},this.target0=this.target.clone(),this.position0=this.camera.position.clone(),this.zoom0=this.camera.zoom,this.getPolarAngle=function(){return N.phi},this.getAzimuthalAngle=function(){return N.theta},this.reset=function(){G.target.copy(G.target0),G.camera.position.copy(G.position0),G.camera.zoom=G.zoom0,G.camera.updateProjectionMatrix(),G.dispatchEvent(H),G.update(),L=K.NONE},this.update=function(){var b=new THREE.Vector3,c=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),e=c.clone().inverse(),g=new THREE.Vector3,h=new THREE.Quaternion;return function(){var a=G.camera.position;return b.copy(a).sub(G.target),b.applyQuaternion(c),N.setFromVector3(b),G.autoRotate&&L===K.NONE&&f(d()),N.theta+=O.theta,N.phi+=O.phi,N.theta=Math.max(G.minAzimuthAngle,Math.min(G.maxAzimuthAngle,N.theta)),N.phi=Math.max(G.minPolarAngle,Math.min(G.maxPolarAngle,N.phi)),N.makeSafe(),N.radius*=P,N.radius=Math.max(G.minDistance,Math.min(G.maxDistance,N.radius)),G.target.add(Q),b.setFromSpherical(N),b.applyQuaternion(e),a.copy(G.target).add(b),G.camera.lookAt(G.target),G.enableDamping===!0?(O.theta*=1-G.dampingFactor,O.phi*=1-G.dampingFactor):O.set(0,0,0),P=1,Q.set(0,0,0),!!(R||g.distanceToSquared(G.camera.position)>M||8*(1-h.dot(G.camera.quaternion))>M)&&(G.dispatchEvent(H),g.copy(G.camera.position),h.copy(G.camera.quaternion),R=!1,!0)}}(),this.disabled=function(){G.disposeEventListener()},this.dispose=function(){G.disposeEventListener()},this.activeEventListener=function(){G.domElement.addEventListener("mousedown",y,!1),G.domElement.addEventListener("wheel",B,!1),G.domElement.addEventListener("touchstart",D,!1),G.domElement.addEventListener("touchend",F,!1),G.domElement.addEventListener("touchmove",E,!1),window.addEventListener("keydown",C,!1)},this.disposeEventListener=function(){G.domElement.removeEventListener("mousedown",y,!1),G.domElement.removeEventListener("wheel",B,!1),G.domElement.removeEventListener("touchstart",D,!1),G.domElement.removeEventListener("touchend",F,!1),G.domElement.removeEventListener("touchmove",E,!1),G.domElement.removeEventListener("mousemove",z,!1),G.domElement.removeEventListener("mouseup",A,!1),G.domElement.removeEventListener("mouseout",A,!1),window.removeEventListener("keydown",C,!1)},this.activeEventListener();var H={type:"change"},I={type:"start"},J={type:"end"},K={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},L=K.NONE,M=1e-6,N=new THREE.Spherical,O=new THREE.Spherical,P=1,Q=new THREE.Vector3,R=!1,S=new THREE.Vector2,T=new THREE.Vector2,U=new THREE.Vector2,V=new THREE.Vector2,W=new THREE.Vector2,X=new THREE.Vector2,Y=new THREE.Vector2,Z=new THREE.Vector2,$=new THREE.Vector2,_=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,0),a.multiplyScalar(-b),Q.add(a)}}(),aa=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,1),a.multiplyScalar(b),Q.add(a)}}(),ba=function(){var a=new THREE.Vector3;return function(b,c){var d=G.domElement===document?G.domElement.body:G.domElement;if(G.camera instanceof THREE.PerspectiveCamera){var e=G.camera.position;a.copy(e).sub(G.target);var f=a.length();f*=Math.tan(G.camera.fov/2*Math.PI/180),_(2*b*f/d.clientHeight,G.camera.matrix),aa(2*c*f/d.clientHeight,G.camera.matrix)}else G.camera instanceof THREE.OrthographicCamera?(_(b*(G.camera.right-G.camera.left)/G.camera.zoom/d.clientWidth,G.camera.matrix),aa(c*(G.camera.top-G.camera.bottom)/G.camera.zoom/d.clientHeight,G.camera.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),G.enablePan=!1)}}();this.update()},BIMWINNER.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),BIMWINNER.OrbitControls.prototype.constructor=BIMWINNER.OrbitControls,Object.defineProperties(BIMWINNER.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!a}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!a}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!a}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!a}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!a}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=a}}}),BIMWINNER.Debug=function(a){var b=this;this.debugMode={},this.modeState={lightDubug:!1,cameraDubug:!1,materialDubug:!1,geometryDubug:!1},this.lightDebug=function(){var a=new dat.GUI;this.updata=function(){},this.destroy=function(){a.destroy()}},this.render=function(){b.modeState.lightDubug?b.debugMode.lightDubug.updata():b.modeState.cameraDubug&&b.debugMode.cameraDubug.updata(),b.modeState.materialDubug&&b.debugMode.materialDubug.updata(),b.modeState.geometryDubug&&b.debugMode.geometryDubug.updata()};var c=function(){var c={lightDubug:!1,cameraDubug:!1,materialDubug:!1,geometryDubug:!1},d=new dat.GUI;d.add(c,"lightDubug").onChange(function(){b.modeState.lightDubug=!b.modeState.lightDubug,b.modeState.lightDubug?b.debugMode.lightDubug=new BIMWINNER.Debug.LightDebug(a):b.debugMode.lightDubug&&b.debugMode.lightDubug.destroy()}),d.add(c,"cameraDubug").onChange(function(){b.modeState.cameraDubug=!b.modeState.cameraDubug,b.modeState.cameraDubug?b.debugMode.cameraDubug=new BIMWINNER.Debug.CameraDebug(a):b.debugMode.cameraDubug&&b.debugMode.cameraDubug.destroy()}),d.add(c,"materialDubug").onChange(function(){b.modeState.materialDubug=!b.modeState.materialDubug,b.modeState.materialDubug?b.debugMode.materialDubug=new BIMWINNER.Debug.MaterialDebug(a):b.debugMode.materialDubug&&b.debugMode.materialDubug.destroy()}),d.add(c,"geometryDubug").onChange(function(){b.modeState.geometryDubug=!b.modeState.geometryDubug,b.modeState.geometryDubug?b.debugMode.geometryDubug=new BIMWINNER.Debug.GeometryDebug(a):b.debugMode.geometryDubug&&b.debugMode.geometryDubug.destroy()})};c()},BIMWINNER.Debug.GeometryDebug=function(a){var b=new dat.GUI,c=1,d=!1,e=!0,f=this,g=new function(){this.positionX=0,this.positionY=0,this.positionZ=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.rotationX=0,this.rotationY=0,this.rotationZ=0,this.visible=!0,this.width=0,this.height=0,this.depth=0,this.vertices=0,this.faces=0};b.remember(g),this.updata=function(){1!=c&&d&&(c.position.set(g.positionX,g.positionY,g.positionZ),c.scale.set(g.scaleX,g.scaleY,g.scaleZ),c.rotation.set(g.rotationX*Math.PI/180,g.rotationY*Math.PI/180,g.rotationZ*Math.PI/180),c.visible=g.visible,c.geometry instanceof THREE.BufferGeometry&&(c.geometry.width=g.width,c.geometry.height=g.height,c.geometry.depth=g.depth))},this.destroy=function(){b.destroy()};var h=function(a){g.positionX=a.position.x,g.positionY=a.position.y,g.positionZ=a.position.z,g.scaleX=a.scale.x,g.scaleY=a.scale.y,g.scaleZ=a.scale.z,g.rotationX=180*a.rotation.x/Math.PI,g.rotationY=180*a.rotation.y/Math.PI,g.rotationZ=180*a.rotation.z/Math.PI,g.visible=a.visible,a.geometry instanceof THREE.BufferGeometry?(g.width=a.width,g.height=a.height,g.depth=a.depth):a.geometry instanceof THREE.Geometry&&(g.vertices=a.geometry.vertices.length,g.faces=a.geometry.faces.length),d=!0};this.init=function(){var a=b.addFolder("selected model position");a.add(g,"positionX").min(c.position.x/10).max(10*c.position.x).step(10).listen(),a.add(g,"positionY").min(c.position.y/10).max(10*c.position.y).step(10).listen(),a.add(g,"positionZ").min(c.position.z/10).max(10*c.position.z).step(10).listen();var d=b.addFolder("selected model scale");d.add(g,"scaleX").min(c.scale.x/50).max(10*c.scale.x).step(.01).listen(),d.add(g,"scaleY").min(c.scale.y/50).max(10*c.scale.y).step(.01).listen(),d.add(g,"scaleZ").min(c.scale.z/50).max(10*c.scale.z).step(.01).listen();var e=b.addFolder("selected model rotation");e.add(g,"rotationX").min(0).max(360).step(5).listen(),e.add(g,"rotationY").min(0).max(360).step(5).listen(),e.add(g,"rotationZ").min(0).max(360).step(5).listen();var f=b.addFolder("selected model visible");if(f.add(g,"visible"),c.geometry instanceof THREE.BufferGeometry){var h=b.addFolder("selected model size");h.add(g,"width"),h.add(g,"height"),h.add(g,"depth")}else if(c.geometry instanceof THREE.Geometry){var h=b.addFolder("selected model v&f");h.add(g,"vertices").listen(),h.add(g,"faces").listen()}},a.listentoSelectObjs(function(a,b){c=b[a],h(c),e&&(f.init(),e=!1),console.log()})},BIMWINNER.Debug.MaterialDebug=function(a){function b(a){var b=2;return"Front"==a?b=0:"Back"==a&&(b=1),b}function c(a){return 0==a?"Front":1==a?"Back":"Double"}var d=new dat.GUI,e=1,f=!1,g=!0,h=!1,i=this,j=new function(){this.type=[],this.color=[0,128,255],this.roughness=1,this.side="Double",this.opacity=1,this.transparent=!1,this.alphaTest=0};d.remember(j),this.updata=function(){if(1!=e&&f&&e.material){var c=e.material;if("none"!==j.type,h){var d=j.color[0]/255,g=j.color[1]/255,i=j.color[2]/255,k=[d,g,i];console.log("update color"),a.setColorProcess(k),h=!1}if(void 0!==c.roughness&&Math.abs(c.roughness-j.roughness)>=.01&&(e.material.roughness=j.roughness,e.material.needsUpdate=!0),void 0!==c.side){var l=b(j.side);e.material.side!==l&&(e.material.side=l,e.material.needsUpdate=!0,a.renderer.render(a.scene,a.camera))}void 0!==c.opacity&&(e.material.opacity=j.opacity,e.material.needsUpdate=!0),void 0!==c.transparent&&(e.material.transparent=j.transparent,e.material.needsUpdate=!0),void 0!==c.alphaTest&&(e.material.alphaTest=j.alphaTest,e.material.needsUpdate=!0)}},this.destroy=function(){d.destroy()};var k=function(a){j.type=a.material.name||"MeshLambertMaterial",a.material.color&&(j.color[0]=255*a.material.color.r,j.color[1]=255*a.material.color.g,j.color[2]=255*a.material.color.b,console.log("init:"+j.color[0],j.color[1],j.color[2])),a.material.roughness?j.roughness=a.material.roughness:j.roughness="no support.",a.material.side&&(j.side=c(a.material.side)),a.material.opacity&&(j.opacity=a.material.opacity),a.material.transparent&&(j.transparent=a.material.transparent),a.material.alphaTest&&(j.alphaTest=a.material.alphaTest),f=!0};this.init=function(){var a=d.addFolder("material type");a.add(j,"type").listen(),d.addColor(j,"color").onChange(function(a){j.color=a,h=!0,console.log(j.color[0]+":"+j.color[1]+":"+j.color[2])}).listen(),d.add(j,"roughness").listen(),d.add(j,"side").listen(),d.add(j,"opacity",0,1).listen(),d.add(j,"transparent").listen(),d.add(j,"alphaTest",0,1).step(.01).listen()},a.listentoSelectObjs(function(a,b){e=b[a],k(e),g&&(i.init(),g=!1)})},BIMWINNER.Debug.CameraDebug=function(a){var b=this,c=new dat.GUI,d=a.camera,e=new function(){this.SwitchCamera=function(){a.switchCamera()},this.updateCameraState=function(){this.cameraType=d.name,this.positionX=d.position.x,this.positionY=d.position.y,this.positionZ=d.position.z,this.rotationX=d.rotation.x*THREE.Math.RAD2DEG,this.rotationY=d.rotation.y*THREE.Math.RAD2DEG,this.rotationZ=d.rotation.z*THREE.Math.RAD2DEG,this.scaleX=d.scale.x,this.scaleY=d.scale.y,this.scaleZ=d.scale.z,this.fov=d.fov||0,this.near=d.near||0,this.far=d.far||0,a.cameraControl.wheelingFlag=!1}};this.updata=function(){d!=a.camera&&(d=a.camera,e.updateCameraState()),a.cameraControl.controlState!=-1||a.cameraControl.wheelingFlag||a.fly._flying?e.updateCameraState():(d.position.copy(new THREE.Vector3(e.positionX,e.positionY,e.positionZ)),d.rotation.copy(new THREE.Euler(e.rotationX*THREE.Math.DEG2RAD,e.rotationY*THREE.Math.DEG2RAD,e.rotationZ*THREE.Math.DEG2RAD)),d.scale.copy(new THREE.Vector3(e.scaleX,e.scaleY,e.scaleZ)),d.fov=e.fov,d.near=e.near,d.far=e.far,d.updateProjectionMatrix())},this.build=function(){c.add(e,"cameraType").listen(),c.add(e,"SwitchCamera");var b=a.modelBounds.min,d=a.modelBounds.max,f=c.addFolder("Camera position");f.add(e,"positionX").min(20*b.x).max(20*d.x).step(1).listen(),f.add(e,"positionY").min(20*b.y).max(20*d.y).step(1).listen(),f.add(e,"positionZ").min(20*b.z).max(20*d.z).step(1).listen();var g=c.addFolder("Camera rotation");g.add(e,"rotationX").min(-360).max(360).step(.01).listen(),g.add(e,"rotationY").min(-360).max(360).step(.01).listen(),g.add(e,"rotationZ").min(-360).max(360).step(.01).listen();var h=c.addFolder("Camera scale");h.add(e,"scaleX").min(.01).max(10).step(.01).listen(),h.add(e,"scaleY").min(.01).max(10).step(.01).listen(),h.add(e,"scaleZ").min(.01).max(10).step(.01).listen();var i=c.addFolder("Other");i.add(e,"fov").min(-360).max(360).step(.01).listen(),i.add(e,"near").step(10).listen(),i.add(e,"far").step(100).listen()},this.destroy=function(){c.destroy(),a.controls.forEach(function(a){a.activeZoom()})},e.updateCameraState(),c.remember(e),a.controls.forEach(function(a){a.forbidZoom()}),b.build()},BIMWINNER.Debug.LightDebug=function(a){var b,c=new dat.GUI,d=!1,e=!0,f=a.ambientLight,g=a.light,h=this,i=new function(){this.light={},this.positionX=0,this.positionY=0,this.positionZ=0,this.intensity=1},j={ambientColor:[0,128,255,1],dirColor:[0,128,255,1],spotLight:function(){a.light=new THREE.SpotLight("#FF0000"),b=a.light,b.position.set(0,1e3,0);var c=new THREE.CubeGeometry(100,100,100),d=new THREE.MeshBasicMaterial({color:11299877}),e=new THREE.Mesh(c,d);e.position.copy(new THREE.Vector3(0,0,0)),a.scene.add(b),a.scene.add(e),console.log("haha")}},k=new function(){this.castShadow=!0};c.remember(i),this.updata=function(){f&&d&&f.color&&a.ambientLight.color.setRGB(j.ambientColor[0]/255,j.ambientColor[1]/255,j.ambientColor[2]/255),g&&g.color&&d&&a.light.color.setRGB(j.dirColor[0]/255,j.dirColor[1]/255,j.dirColor[2]/255),g&&g.position&&d&&a.light.position.set(i.positionX,i.positionY,i.positionZ),g&&g.intensity&&d&&(a.light.intensity=i.intensity),g&&d&&(a.light.castShadow=k.castShadow)},this.destroy=function(){c.destroy()};var l=function(){f&&f.color&&(j.ambientColor[0]=255*f.color.r,j.ambientColor[1]=255*f.color.g,j.ambientColor[2]=255*f.color.b),g&&g.color&&(j.dirColor[0]=255*g.color.r,j.dirColor[1]=255*g.color.g,j.dirColor[2]=255*g.color.b),g&&g.position&&(i.positionX=g.position.x,i.positionY=g.position.y,i.positionZ=g.position.z),g&&g.intensity&&(i.intensity=a.light.intensity),g&&g.castShadow&&(k.castShadow=a.light.castShadow),d=!0};this.init=function(){var a=c.addFolder("DirectionalLight");a.addColor(j,"dirColor").listen(),a.add(i,"intensity",0,5).listen(),a.add(k,"castShadow").listen();var b=a.addFolder("position");b.add(i,"positionX",-5,5).listen(),b.add(i,"positionY",-5,5).listen(),b.add(i,"positionZ",-5,5).listen();var d=c.addFolder("Ambient Light");d.addColor(j,"ambientColor").listen()},this.start=function(){l(),e&&(h.init(),e=!1)},this.start()},BIMWINNER.ViewController=function(a,b){function c(a){var b=l.userData.camera,c=new THREE.Vector3(a.x,a.y,a.z);c.setLength(b.position.length()),b.position.set(c.x,c.y,c.z),b.lookAt(l.position),l.userData.cameraLastRotation=b.rotation.clone()}function d(b){var c=a._getClickCoordsWithinElement(b),d=l.userData.element.getBoundingClientRect(),e=d.right-d.left,f=d.bottom-d.top;w.x=c[0]/e*2-1,w.y=2*-(c[1]/f)+1,x.setFromCamera(w,l.userData.camera);var g=x.intersectObjects(l.userData.objects);g.length>0?v!=g[0].object&&(v&&v.material.color.set(v.currentColor),v=g[0].object,v.currentColor=v.material.color.clone(),v.material.color.set(16761035)):(v&&v.material.color.set(v.currentColor),v=null),h.render()}function e(a){a.preventDefault();var b=l.userData.element.getBoundingClientRect(),c=b.right-b.left,d=b.bottom-b.top;w.x=a.clientX/c*2-1,w.y=2*-(a.clientY/d)+1,x.setFromCamera(w,l.userData.camera);var e=x.intersectObjects(l.userData.objects);e.length>0&&f(e[0].object)}function f(b){var c=b.position.clone();c.x=c.x||.5,c.y=c.y||.5,c.z=c.z||.5,j.forEach(function(b){var d=b.userData.camera,e=b.userData.cameraDistance||d.position.length(),f=new THREE.Vector3(c.x,c.y,c.z);f.setLength(e),b.userData.fly.flyTo({eye:new THREE.Vector3(f.x,f.y,f.z),look:a.originalCamera.look}),b.userData.cameraLastRotation=d.rotation.clone()})}function g(a){var b=new THREE.Mesh,c=new THREE.TextureLoader;c.load(i+"viewcontroller/front.png",function(c){var d=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:c,overdraw:!0,color:16777215,side:THREE.DoubleSide}));d.position.set(5,0,0),d.rotation.y=.5*Math.PI,d.rotation.x=.5*Math.PI,b.add(d),a.userData.objects.push(d)}),c.load(i+"viewcontroller/back.png",function(c){var d=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:c,overdraw:!0,color:16777215,side:THREE.DoubleSide}));d.position.set(-5,0,0),d.rotation.y=.5*Math.PI,d.rotation.x=.5*Math.PI,b.add(d),a.userData.objects.push(d)}),c.load(i+"viewcontroller/left.png",function(c){var d=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:c,overdraw:!0,color:16777215,side:THREE.DoubleSide}));d.position.set(0,-5,0),d.rotation.x=.5*Math.PI,b.add(d),a.userData.objects.push(d)}),c.load(i+"viewcontroller/right.png",function(c){var d=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:c,overdraw:!0,color:16777215,side:THREE.DoubleSide}));d.position.set(0,5,0),d.rotation.x=.5*Math.PI,b.add(d),a.userData.objects.push(d)}),c.load(i+"viewcontroller/top.png",function(c){var d=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:c,overdraw:!0,color:16777215,side:THREE.DoubleSide}));d.position.set(0,0,5),d.rotation.z=.5*Math.PI,b.add(d),a.userData.objects.push(d)}),c.load(i+"viewcontroller/bottom.png",function(c){var d=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,6),new THREE.MeshBasicMaterial({map:c,overdraw:!0,color:16777215,side:THREE.DoubleSide}));d.position.set(0,0,-5),d.rotation.z=.5*Math.PI,b.add(d),a.userData.objects.push(d)});var d=new THREE.BoxBufferGeometry(2,6,2),e=new THREE.Mesh(d,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));e.position.set(4,0,4),b.add(e),a.userData.objects.push(e);var f=new THREE.Mesh(d,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));f.position.set(4,0,-4),b.add(f),a.userData.objects.push(f);var g=new THREE.Mesh(d,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));g.position.set(-4,0,4),b.add(g),a.userData.objects.push(g);var h=new THREE.Mesh(d,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));h.position.set(-4,0,-4),b.add(h),a.userData.objects.push(h);var j=new THREE.BoxBufferGeometry(6,2,2),k=new THREE.Mesh(j,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));k.position.set(0,-4,4),b.add(k),a.userData.objects.push(k);var l=new THREE.Mesh(j,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));l.position.set(0,-4,-4),b.add(l),a.userData.objects.push(l);var m=new THREE.Mesh(j,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));m.position.set(0,4,4),b.add(m),a.userData.objects.push(m);var n=new THREE.Mesh(j,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));n.position.set(0,4,-4),b.add(n),a.userData.objects.push(n);var o=new THREE.BoxBufferGeometry(2,2,6),p=new THREE.Mesh(o,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));p.position.set(4,-4,0),b.add(p),a.userData.objects.push(p);var q=new THREE.Mesh(o,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));q.position.set(4,4,0),b.add(q),a.userData.objects.push(q);var r=new THREE.Mesh(o,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));r.position.set(-4,-4,0),b.add(r),a.userData.objects.push(r);var s=new THREE.Mesh(o,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));s.position.set(-4,4,0),b.add(s),a.userData.objects.push(s);var t=new THREE.BoxBufferGeometry(2,2,2),u=new THREE.Mesh(t,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));u.position.set(4,-4,4),b.add(u),a.userData.objects.push(u);var v=new THREE.Mesh(t,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));v.position.set(4,-4,-4),b.add(v),a.userData.objects.push(v);var w=new THREE.Mesh(t,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));w.position.set(4,4,4),b.add(w),a.userData.objects.push(w);var x=new THREE.Mesh(t,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));x.position.set(4,4,-4),b.add(x),a.userData.objects.push(x);var y=new THREE.Mesh(t,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));y.position.set(-4,-4,4),b.add(y),a.userData.objects.push(y);var z=new THREE.Mesh(t,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));z.position.set(-4,-4,-4),b.add(z),a.userData.objects.push(z);var A=new THREE.Mesh(t,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));A.position.set(-4,4,4),b.add(A),a.userData.objects.push(A);var B=new THREE.Mesh(t,new THREE.MeshBasicMaterial({overdraw:!0,color:16777215,transparent:!0}));return B.name="back_right_bottom",B.position.set(-4,4,-4),b.add(B),a.userData.objects.push(B),b}var h=this,i=a.imgURL||"";i.endsWith("/")||""==i||(i+="/"),this.render=function(){j.forEach(function(a){var b=a.userData.camera.rotation;b.x===a.userData.cameraLastRotation.x&&b.y===a.userData.cameraLastRotation.y&&b.z===a.userData.cameraLastRotation.z||(c(a.userData.camera.position),a.userData.cameraLastRotation=a.userData.camera.rotation.clone()),a.userData.renderer&&a.userData.renderer.render(a,a.userData.camera)})},this.updateMainCamera=function(){k.userData.camera=a.camera,k.userData.cameraLastRotation=a.camera.rotation.clone(),k.userData.controls=a.cameraControl,k.userData.fly=a.fly,c(k.userData.camera.position)};var j=[],k=a.scene;k.name="main",k.userData.element=document.getElementById(b),k.userData.objects=[],k.userData.camera=a.camera,k.userData.cameraLastRotation=a.camera.rotation.clone(),k.userData.controls=a.cameraControl,k.userData.fly=a.fly,j.push(k);var l=new THREE.Scene;l.name="viewcontroller";var m=document.createElement("div");m.className="list-item2",m.innerHTML="<div class='scene'></div>",l.userData.element=m.querySelector(".scene"),a.viewportDiv.appendChild(m);var n=l.userData.element.getBoundingClientRect(),o=n.right-n.left,p=n.bottom-n.top,q=new THREE.WebGLRenderer({alpha:!0,antialias:!0});q.setSize(o,p),q.sortObjects=!1,q.domElement.style.position="absolute",q.domElement.style.left="0px",q.domElement.style.top="0px",m.appendChild(q.domElement),l.userData.renderer=q;var r=new THREE.PerspectiveCamera(45,1,.1,1e3);r.up=new THREE.Vector3(0,0,1),r.position.set(16,16,16),r.lookAt(l.position),l.userData.camera=r,l.userData.cameraLastRotation=r.rotation.clone(),l.userData.cameraDistance=r.position.length();var s=new BIMWINNER.OrbitControls(l.userData.camera,l.userData.element);s.enablePan=!1,s.enableZoom=!1,s.enableRotate=!1,l.userData.controls=s,l.userData.fly=new BIMWINNER.CameraFlyAnimation(a,r,s),l.userData.objects=[];var t=g(l),u=new THREE.BoxHelper(t,0);l.add(t),l.add(u),j.push(l),document.getElementById(a.viewport).addEventListener("mousemove",d,!1),q.domElement.addEventListener("mousedown",e,!1),h.render();var v,w=new THREE.Vector2,x=new THREE.Raycaster},BIMWINNER.ObjectMessageLabel=function(a){function b(b){var c;for(var d in b)c=b[d];var e=a.get2DCoordFrom3DCoord(c.position.clone());f[0].style.top=e[1]+"px",f[0].style.left=e[0]+"px",f[0].style.opacity="0.5",h.setText("构件"+c.id)}function c(){f[0].style.opacity="0.0"}function d(){return"width:"+j+"px;height:"+k+"px;"}function e(){return"background-color:"+l+";"}var f,g,h=this,i=(new BIMWINNER.Listener,"msgdiv"),j=150,k=150,l="#555555",m="";this.init=function(){f=$("<div class="+i+' style="position: absolute;top:0px;left:0px;'+d()+e()+'opacity: 0;z-index: 5000;padding: 10px;border-radius: 5px;">'),g=$('<div style=" color: white;padding-bottom: 2px;overflow: hidden;text-overflow: ellipsis;word-break: keep-all;white-space: nowrap;">'),g.html(m),f.append(g);var h="#"+a.viewport;$(h).append(f),a.listener.on("tick",function(){c(),a.objectSet.numObjects&&b(a.objectSet.objects)})},this.setLabelSize=function(a,b){j=a,k=b,f[0].style.width=j+"px",f[0].style.height=k+"px"},this.setBackground=function(a){l=a,f[0].style.backgroundColor=l},this.setText=function(a){m=a,g.html(m)}},BIMWINNER.CollisionDetection=function(a,b){var c=this;this.height=a.height?a.height:1800,this.eyeHeight=a.eyeHeight?a.eyeHeight:this.height-120,this.width=a.width?a.width:450,this.thickness=a.thickness?a.thickness:220,this.up=a.up?a.up:new THREE.Vector3(0,0,1);var d,e,f,g,h=new THREE.Raycaster,i=new THREE.Raycaster,j=new THREE.Raycaster,k=new THREE.Raycaster,l=new THREE.Raycaster,m=new THREE.Raycaster,n=new THREE.Raycaster,o=new THREE.Raycaster,p=new THREE.Raycaster,q=new THREE.Raycaster;this.run=function(a,r){var s={};return h.set(a,new THREE.Vector3(0,0,1)),i.set(a,new THREE.Vector3(0,0,(-1))),l.set(a,r),m.set(a,new THREE.Vector3((-r.x),(-r.y),(-r.z))),j.set(a,new THREE.Vector3((-r.y),r.x,r.z)),k.set(a,new THREE.Vector3(r.y,(-r.x),r.z)),d=new THREE.Vector3(a.x+-c.width*r.y/2,a.y+c.width*r.x/2,a.z+r.z),e=new THREE.Vector3(a.x+c.width*r.y/2,a.y+-c.width*r.x/2,a.z+r.z),f=new THREE.Vector3(a.x+c.thickness*r.x/2,a.y+c.thickness*r.y/2,a.z+r.z),g=new THREE.Vector3(a.x+-c.thickness*r.x/2,a.y+-c.thickness*r.y/2,a.z+r.z),n.set(d,new THREE.Vector3(0,0,(-1))),o.set(e,new THREE.Vector3(0,0,(-1))),p.set(f,new THREE.Vector3(0,0,(-1))),q.set(g,new THREE.Vector3(0,0,(-1))),s.top=h.intersectObjects(b.root.children),s.down=i.intersectObjects(b.root.children),s.front=l.intersectObjects(b.root.children),s.back=m.intersectObjects(b.root.children),s.left=j.intersectObjects(b.root.children),s.right=k.intersectObjects(b.root.children),s.leftDown=n.intersectObjects(b.root.children),s.rightDown=o.intersectObjects(b.root.children),s.frontDown=p.intersectObjects(b.root.children),s.backDown=q.intersectObjects(b.root.children),s}},BIMWINNER.Viewer=function(a){function b(){var a=this.stats=new Stats;a.setMode(0),a.domElement.style.position="absolute",a.domElement.style.left="0px",a.domElement.style.bottom="0px",$("body")[0].appendChild(a.domElement)}function c(){g.listener.fire("tick",!0,!0),requestAnimationFrame(c)}function d(a,b,c){b++,b<3?$.ajax({type:"GET",url:a,data:{},success:function(a){a.success?c(a.result):(console.warn("error: "+a.error),g.promptingMessage("warning",a.error))},error:function(a,e,f){d(this.url,b,c)}}):(console.warn("load component: "+a+" fail !"),g.promptingMessage("warning","加载 "+a+" 失败"))}function e(a){for(var b,c=[],d={},e=0;null!=(b=a[e]);e++)d[b]||(c.push(b),d[b]=!0);return c}console.log("BIMWINNER VERSION_NUMBER : "+BIMWINNER.VERSION_NUMBER+" 状态："+BIMWINNER.VERSION_STATE),this.Lobibox=new BIMWINNER.lobibox;var f=this.Lobibox;f.viewport="#"+a.viewport;var g=this,h={};this.originalCamera=h,this.className="BIMWINNER.Viewer";var i=this.uuid=THREE.Math.generateUUID();this.baseaddress=a.baseaddress,this.DBversion=a.DBversion,this.webApiAddress=a.webApiAddress,this.cn=a.cn,this.imgURL=a.imgURL,g.imgURL.endsWith("/")||""==g.imgURL||(g.imgURL=g.imgURL+"/"),this.type=a.type,this.appKey=a.appKey,this.accessToken=a.accessToken,this.viewport=a.viewport,this.viewportDiv=document.getElementById(a.viewport);var j="my-innerview-"+i;this.viewerdiv=$('<div id="'+j+'" style="height: 100%; width:100%; margin:0 auto;position:relative" ></div>'),this.viewerdiv.appendTo(g.viewportDiv),this.renderer=new THREE.WebGLRenderer({antialias:!0,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!0}),g.renderer.setClearColor(new THREE.Color(15658734),1),g.renderer.setPixelRatio(window.devicePixelRatio),g.renderer.setSize($(g.viewportDiv).width(),$(g.viewportDiv).height()-3),g.viewerdiv[0].appendChild(g.renderer.domElement);var k=new THREE.PerspectiveCamera(45,1,1,1e3);k.position=new THREE.Vector3(1,1,1),k.up=new THREE.Vector3(0,0,1),k.name="Perspective Camera";var l=new THREE.OrthographicCamera((-$(g.viewportDiv).width()),$(g.viewportDiv).width(),$(g.viewportDiv).height(),(-$(g.viewportDiv).height()),1,1e3);l.position=new THREE.Vector3(1,1,1),l.up=new THREE.Vector3(0,0,1),l.name="Orthographic Camera",this.camera=k;var m=new BIMWINNER.OrbitControls(k,g.renderer.domElement,g),n=new BIMWINNER.OrbitControls(l,g.renderer.domElement,g);n.disposeEventListener(),this.transfromControl=new THREE.TransformControls(g.camera,g.renderer.domElement),this.cameraControl=m,this.controls=[m,n];var o=new BIMWINNER.CameraFlyAnimation(g,k,m),p=new BIMWINNER.CameraFlyAnimation(g,l,n);this.fly=o,this.scene=new THREE.Scene,g.scene.add(g.transfromControl),this.viewController=new BIMWINNER.ViewController(g,j),this.switchCamera=function(){g.camera===l?(g.camera=k,n.disposeEventListener(),m.activeEventListener(),g.cameraControl=m,g.fly=o,g.promptingMessage("success","当前相机为透视相机")):(g.camera=l,m.disposeEventListener(),n.activeEventListener(),g.cameraControl=n,g.fly=p,g.promptingMessage("success","当前相机为正交相机")),g.fly.flyTo({eye:h.eye,look:h.look,up:h.up}),g.camera.zoom=h.zoom,g.viewController.updateMainCamera()},this.clock=new THREE.Clock,this.input=new BIMWINNER.Input(g.renderer.domElement),this.root=new THREE.Object3D,g.scene.add(g.root),this.lights=new THREE.Object3D,g.scene.add(g.lights);var q=new THREE.SpotLight(16777215);q.position.set(5e3,5e3,5e3),q.angle=Math.PI,q.penumbra=.05,q.decay=1,q.distance=0,g.lights.add(q),q.target=g.root;var r=new THREE.AmbientLight(16777215);r.intensity=.5,g.lights.add(r),this.calculateBoundary=!1,this.skybox={},this.components={},this.componentGeometrys={},this.componentAttribute={},this.componentData_Info={},this.firstModel=!0,this.documentInfo={},this.componentInfo={},this.componentType={},this.componentData={},this.componentLod={},this.alloids=[],this.modelExplosionCoefficient=0,this.modelBounds=new THREE.Box3,this.documentList=[],this.autoResize=!0,this.multiSelect=!1,this.listener=new BIMWINNER.Listener,this.objectSet=new BIMWINNER.ObjectSet(g),g.objectSet.listener.on("updated",function(){if(g.selectedPartsVal="",!$.isEmptyObject(g.objectSet.objects)){var a=g.objectSet.objects,b="";for(var c in a)b=b+c+",";b=b.substring(0,b.length-1),g.selectedPartsVal=b}}),this.ClickSelectObjects=new BIMWINNER.ClickSelectObjects(g,g.root),this.Flag={clip:!1,selectBox:!1,measuredDistance:!1},this.Measurement={measuredNode:{},tempLine:new THREE.Object3D,tempPoint:new THREE.Object3D,point1:{},point2:{},pointCoord1:{},
pointCorrd2:{},line:{},mark1:{},mark2:{},markX:{},markY:{},markZ:{},lineX:{},lineY:{},lineZ:{},measureWindow:{}},this.Clip={Empty:Object.freeze([]),boundingBox:new THREE.Object3D,cuttingfirst:!0,clipFace:{front:{clipnum:0,x:1,y:0,z:0},back:{clipnum:1,x:-1,y:0,z:0},right:{clipnum:2,x:0,y:1,z:0},left:{clipnum:3,x:0,y:-1,z:0},top:{clipnum:4,x:0,y:0,z:1},bottom:{clipnum:5,x:0,y:0,z:-1}},clipFaceName:["global_front","global_back","global_right","global_left","global_top","global_bottom"],clipPlane:[new THREE.Plane(new THREE.Vector3(1,0,0),0),new THREE.Plane(new THREE.Vector3((-1),0,0),0),new THREE.Plane(new THREE.Vector3(0,1,0),0),new THREE.Plane(new THREE.Vector3(0,(-1),0),0),new THREE.Plane(new THREE.Vector3(0,0,1),0),new THREE.Plane(new THREE.Vector3(0,0,(-1)),0)],currentClipPlane:"",state:{}},this.SelectBox={boundingBox:new THREE.Object3D,selectFace:{front:{clipnum:0,x:1,y:0,z:0},back:{clipnum:1,x:-1,y:0,z:0},right:{clipnum:2,x:0,y:1,z:0},left:{clipnum:3,x:0,y:-1,z:0},top:{clipnum:4,x:0,y:0,z:1},bottom:{clipnum:5,x:0,y:0,z:-1}},selectFaceName:["global_front","global_back","global_right","global_left","global_top","global_bottom"],currentSelectPlane:"",selectBox:void 0,selected:[],unselected:[]},BIMWINNER.DEBUG&&(g.debug=new BIMWINNER.Debug(g),this.FPSstats=new b),this.cameraLod={currentLevel:5,oldcam:g.camera,newCam:g.camera,t:1},c(),this.render=function(){"RELEASE"!==BIMWINNER.CODE_STATE,"FirstPersonControls"==g.cameraControl.className&&g.cameraControl.update(g.clock.getDelta()),g.transfromFlag&&g.transfromControl.update(),BIMWINNER.DEBUG&&(g.debug.render(),g.FPSstats.stats.update()),q.position.copy(g.camera.position),setTimeout(g.render,20),g.viewController.render(),g.renderer.render(g.scene,g.camera),g.loadLodByCameraPoistionFlag&&g.loadLodByCameraPoistion()},g.render(),this.loadLodByCameraPoistion=function(){g.cameraLod.newCam=g.camrea,g.cameraLod.oldCam!=g.cameraLod.newCam&&(g.cameraLod.oldCam=g.cameraLod.newCam,g.cameraLod.t=1),0!=g.modelBounds.getCenter().x&&0==g.fly._flying&&(g.cameraLod.from=g.modelBounds.getCenter(),g.cameraLod.to=g.camera.position,1==g.cameraLod.t&&(g.cameraLod.orginalDis=Math.sqrt(Math.pow(g.cameraLod.from.x-g.cameraLod.to.x,2)+Math.pow(g.cameraLod.from.y-g.cameraLod.to.y,2)+Math.pow(g.cameraLod.from.z-g.cameraLod.to.z,2)),g.cameraLod.t=2),g.cameraLod.newDis=Math.sqrt(Math.pow(g.cameraLod.from.x-g.cameraLod.to.x,2)+Math.pow(g.cameraLod.from.y-g.cameraLod.to.y,2)+Math.pow(g.cameraLod.from.z-g.cameraLod.to.z,2)),Math.round(100*g.cameraLod.newDis)!=Math.round(100*g.cameraLod.oldDis)&&g.convertLevel())},this.convertLevel=function(){console.log("orginalDis:",g.cameraLod.orginalDis),console.log("oldDis:",g.cameraLod.oldDis),console.log("newDis:",g.cameraLod.newDis),console.log("currentLevel:",g.cameraLod.currentLevel),g.cameraLod.oldDis=g.cameraLod.newDis,g.cameraLod.oldDis>1.1*g.cameraLod.orginalDis?5!=g.cameraLod.currentLevel&&(g.destroyObjs(),g.showModelByDocumentId(g.documentList[0],function(){},void 0,"Level5"),g.currentLevel=5):g.cameraLod.oldDis<.85*g.cameraLod.orginalDis&&g.cameraLod.oldDis>.7*g.cameraLod.orginalDis?3!=g.cameraLod.currentLevel&&(g.destroyObjs(),g.showModelByDocumentId(g.documentList[0],function(){},void 0,"Level3"),g.currentLevel=3):g.cameraLod.oldDis<.55*g.cameraLod.orginalDis&&g.cameraLod.oldDis>.4*g.cameraLod.orginalDis?1!=g.cameraLod.currentLevel&&(g.destroyObjs(),g.showModelByDocumentId(g.documentList[0],function(){},void 0,"Level1"),g.currentLevel=1):g.cameraLod.oldDis<.3*g.cameraLod.orginalDis&&0!=g.cameraLod.currentLevel&&(g.destroyObjs(),g.showModelByDocumentId(g.documentList[0],function(){},void 0,"Level0"),g.currentLevel=0)},this.arrayConversion=function(){var a=g.selectedPartsVal,b=[];if(""!=a&&null!=a)return b=a.split(",")},this.createGeometry=function(a){for(var b=""+a.guid==void 0?a.guid:a._id,c=[],d=[],e=new THREE.Geometry,f=0;f<a.positions.length;f+=3)e.vertices.push(new THREE.Vector3(a.positions[f],a.positions[f+1],a.positions[f+2])),c.push(new THREE.Vector3(a.normals[f],a.normals[f+1],a.normals[f+2])),a.numberOfColors/4==a.positions.length/3&&d.push(new THREE.Color(a.colors[f],a.colors[f+1],a.colors[f+2]));for(var h=0;h<a.indices.length;h+=3){var i=new THREE.Vector3(a.normals[h],a.normals[h+1],a.normals[h+2]);a.numberOfColors/4==a.positions.length/3?e.faces.push(new THREE.Face3(a.indices[h],a.indices[h+1],a.indices[h+2],[c[a.indices[h]].clone(),c[a.indices[h+1]].clone(),c[a.indices[h+2]].clone()],[d[a.indices[h]].clone(),d[a.indices[h+1]].clone(),d[a.indices[h+2]].clone()])):e.faces.push(new THREE.Face3(a.indices[h],a.indices[h+1],a.indices[h+2],i))}if(0!=a.numberOfColors)for(var j=0;j<a.materialIndices.length;j++)e.faces[j].color.setRGB(a.colors[4*a.materialIndices[j]],a.colors[4*a.materialIndices[j]+1],a.colors[4*a.materialIndices[j]+2]);return e.computeBoundingBox(),e.computeFaceNormals(),g.componentGeometrys[b]=e,e},this.createGeometry2=function(a){var b,c=void 0!=a.guid?a.guid:void 0!=a._id?a._id:a.key,d=[],e=[],f=new THREE.BufferGeometry,h=new Float32Array(a.positions);if(f.addAttribute("position",new THREE.BufferAttribute(h,3)),0!=a.numberOfColors&&1!=a.numberOfColors){if(Array.fill)e=Array(a.positions.length).fill(1);else for(var i=0;i<a.positions.length;i++)e.push(1);var j=new Float32Array(e);f.addAttribute("color",new THREE.BufferAttribute(j,3,(!0)));for(var k,l=[],m=void 0,n=a.materialIndices,o=0;o<n.length;o++){var p=n[o];p!==m&&(m=p,void 0!==k&&(k.count=3*o-k.start,l.push(k)),k={start:3*o,materialIndex:m})}void 0!==k&&(k.count=3*o-k.start,l.push(k)),f.groups=l,j=null,k=null,l=null,m=null,n=null}return f.setIndex(a.indices),a.positions.length==a.normals.length?(d=a.normals,b=new Float32Array(d),f.addAttribute("normal",new THREE.BufferAttribute(b,3))):f.computeVertexNormals(),f.computeBoundingBox(),f.key=c,g.componentGeometrys[c]=f,c=null,d=null,e=null,h=null,b=null,f},this.createObject=function(a,b,c,d){if(g.components[a])return void console.warn("该ID的组件已经存在于视图中: "+a);if("IfcOpeningElement"!=b){var e,f=[],h={};if(1==c.length)h=g.componentGeometrys[c[0]];else{h=new THREE.Geometry;for(var i=0,j=c.length;i<j;i++)f.push(""+c[i]),h.merge(g.componentGeometrys[c[i]])}var k=new THREE.Matrix4;k.set(d[0],d[4],d[8],d[12],d[1],d[5],d[9],d[13],d[2],d[6],d[10],d[14],d[3],d[7],d[11],d[15]);var l,m=[],n=g.componentData[c[0]].colors,o=g.componentData[c[0]].numberOfColors;if(0!=o&&1!=o){for(var p=[],i=0;i<o;i++){var q=new THREE.MeshLambertMaterial({color:new THREE.Color(n[4*i],n[4*i+1],n[4*i+2])});n[4*i+3]<1&&(q.transparent=!0,q.opacity=n[4*i+3]),q.side=THREE.DoubleSide,q.vertexColors=THREE.VertexColors,p.push(q),m.push({color:q.color.clone(),opacity:q.opacity,transparent:q.transparent}),q=null}l=p,p=null}else{var r;if(1==o)r=n;else{var s=BIMWINNER.Material;r=s[b]?s[b].color:void 0,r||(console.log("Material not found for type: ",b),r=s.DEFAULT.color),r||console.log("Default material not found for type: ",b)}l=new THREE.MeshLambertMaterial({color:new THREE.Color(r[0],r[1],r[2])}),r[3]<1&&(l.transparent=!0,l.opacity=r[3]),l.side=THREE.DoubleSide,s=null,r=null}var t=new THREE.Mesh(h,l);if(t.key=""+a,t.applyMatrix(k),g.components[a]=t,t.userData.originalMaterial=[],$.isArray(l)?(t.userData.originalMaterial=m,t.userData.color=n):(t.userData.originalMaterial.push({color:l.color.clone(),opacity:l.opacity,transparent:l.transparent}),t.userData.color=l.color.clone()),t.highlight=!1,t.userData.useLevel=e,t.userData.type=b,"IfcSpace"==b&&(t.visible=!1),g.componentType[b]?g.componentType[b].push(""+a):(g.componentType[b]=[],g.componentType[b].push(""+a)),t.receiveShadow=!0,t.castShadow=!0,g.calculateBoundary){var u=(new THREE.Box3).setFromObject(t);g.modelBounds.isEmpty()?g.updataBound(u):g.modelBounds.containsBox(u)||g.updataBound(u),u=null}if(0!=g.modelExplosionCoefficient){var v=g.modelBounds.getCenter().x,w=g.modelBounds.getCenter().y,x=g.modelBounds.getCenter().z,y=t.position.x,z=t.position.y,A=t.position.z,B=new THREE.Vector3;B.setX(v+(1+2*g.modelExplosionCoefficient)*(y-v)),B.setY(w+(1+2*g.modelExplosionCoefficient)*(z-w)),B.setZ(x+(1+2*g.modelExplosionCoefficient)*(A-x)),t.position.set(B.x,B.y,B.z),v=null,w=null,x=null,y=null,z=null,A=null,B=null}g.alloids.push(t.key),g.root.add(t),f=null,h=null,e=null,k=null,l=null,m=null,n=null,o=null}},this.readStart=function(a,b){var c=new THREE.Box3(b,a);if(g.modelBounds.isEmpty()?g.modelBounds.copy(c):g.modelBounds.union(c),g.firstModel){g.firstModel=!1;var d=c.max.x+c.getSize().x/2,e=c.max.y+c.getSize().y/2,f=c.max.z+c.getSize().z/2,i=Math.sqrt(Math.pow(c.max.x-c.min.x,2)+Math.pow(c.max.y-c.min.y,2)+Math.pow(c.max.z-c.min.z,2));k.far=20*i,k.fov=37.8493,k.zoomSpeedFactor=2,k.position.set(d,e,f),k.updateProjectionMatrix(),l.near=-1e5,l.far=20*i,l.zoomSpeedFactor=2,l.left=c.max.y/-.35,l.right=c.max.y/.35,l.top=c.max.z/.35,l.bottom=c.max.z/-.35,l.position.set(10*d,10*e,10*f),l.updateProjectionMatrix(),h.look=(new THREE.Vector3).copy(g.modelBounds.getCenter()),h.eye=k.position.clone(),h.up=k.up.clone(),h.zoom=k.zoom,m.target.copy(g.modelBounds.getCenter()),n.target.copy(g.modelBounds.getCenter()),g.resize()}},this.updataBound=function(a){if(g.modelBounds.isEmpty()){g.modelBounds=a;var b=g.modelBounds.max.x+g.modelBounds.getSize().x/2,c=g.modelBounds.max.y+g.modelBounds.getSize().y/2,d=g.modelBounds.max.z+g.modelBounds.getSize().z/2;k.position.set(b,c,d)}else{g.modelBounds.union(a);var e=g.modelBounds.getCenter(),f=(new THREE.Vector3).copy(g.cameraControl.target).sub(e),i=new THREE.Vector3(g.modelBounds.max.x+g.modelBounds.getSize().x,g.modelBounds.max.y+g.modelBounds.getSize().y,g.modelBounds.max.z+g.modelBounds.getSize().z),j=i.sub(e),m=(new THREE.Vector3).copy(g.camera.position).sub(f),n=m.sub(e).setLength(j.length()).add(e);g.fly.flyTo({eye:n,look:e}),k.position.copy(n)}var o=Math.sqrt(Math.pow(g.modelBounds.max.x-g.modelBounds.min.x,2)+Math.pow(g.modelBounds.max.y-g.modelBounds.min.y,2)+Math.pow(g.modelBounds.max.z-g.modelBounds.min.z,2)),p=20*o;k.far=p,k.fovy=37.8493,k.zoomSpeedFactor=2,k.lookAt(g.modelBounds.getCenter()),k.updateProjectionMatrix(),l.near=-1e5,l.far=p,l.zoomSpeedFactor=2,l.left=g.modelBounds.max.y/-.35,l.right=g.modelBounds.max.y/.35,l.top=g.modelBounds.max.z/.35,l.bottom=g.modelBounds.max.z/-.35,l.position.copy(k.position),l.lookAt(g.modelBounds.getCenter()),l.updateProjectionMatrix(),h.look=g.modelBounds.getCenter().clone(),h.eye=k.position.clone(),h.up=k.up.clone(),h.zoom=k.zoom,b=null,c=null,d=null},this.automaticPathFinding=function(a,b,c,d,e){function f(){v==h.length-1?g.fly.flyTo({eye:[h[v][0],h[v][1],h[v][2]+i],look:[h[v][0],h[v][1],h[v][2]+i],up:[0,0,1]}):g.fly.flyTo({eye:[h[v][0],h[v][1],h[v][2]+i],look:[h[v+1][0],h[v+1][1],h[v+1][2]+i],up:[0,0,1]}),v++,v<h.length?setTimeout(f,k):b()}var h=[],i=1600,j=500,k=100;if(void 0==a)return void g.promptingMessage("warning","路径点未指定！");void 0==c||"number"!=typeof c?console.warn("漫游高度未指定，将采用默认值 ：1600 mm"):i=c,void 0==d||"number"!=typeof d?console.warn("漫游步长未指定，将采用默认值 ：500 mm"):j=d,void 0==e||"number"!=typeof e?console.warn("漫游频率未指定，将采用默认值 ：100 ms"):k=e;for(var l=0;l<a.length;l++){var m=0;if(l!=a.length-1){var n=a[l+1][0]-a[l][0],o=a[l+1][1]-a[l][1],p=a[l+1][2]-a[l][2];m=Math.abs(n),Math.abs(o)>=m&&Math.abs(o)>=Math.abs(p)&&(m=Math.abs(o)),Math.abs(p)>=m&&Math.abs(p)>=Math.abs(o)&&(m=Math.abs(p));var q=Math.ceil(m/j),r=0,s=0,t=0;0!=q&&(r=n/q,s=o/q,t=p/q);for(var u=0;u<=q;u++)h.push([a[l][0]+r*u,a[l][1]+s*u,a[l][2]+t*u])}}var v=0;f()},this.setEyesToRoaming=function(a){function b(){g.flyto(a[c]),c++,c<a.length&&setTimeout(b,1e3)}var c=0;b()},this.getEyesToRoaming=function(a){var b={eye:g.camera.eye,look:g.camera.look,up:g.camera.up};a(b)},this.getDocument=function(a,b,c){if(0!==a.indexOf("document/")&&(a="document/"+a),g.documentInfo[a])b(g.documentInfo[a]);else{var d=encodeURIComponent(a);$.ajax({type:"GET",url:g.baseaddress+"document/"+d,data:{},success:function(c){if(c.success){if(3!=c.result.Status&&g.cn){var d=a.split("/")[1];$.ajax({type:"GET",url:g.webApiAddress+"?cn="+g.cn+"&fileid="+d,data:{},success:function(a){},error:function(a,b,c){}})}if(.5==c.result.Status){var e=$("<div class='progressdiv' style=\"position: absolute;top: 20px; left:50%; margin-left: -150px; opacity: 0.6;height: 47px;z-index: 5000;padding: 10px; width: 300px;background-color: #555555;border-radius: 5px;\">"),f=$('<div style=" color: white;padding-bottom: 2px;overflow: hidden;text-overflow: ellipsis;word-break: keep-all;white-space: nowrap;">');f.html("几何信息解析中，将在一分钟之后重试··");var h=$('<div class="progress active progress-striped">'),i=$('<div class="progress-bar">');e.append(f),h.append(i),e.append(h);var j="#"+g.viewport;$(j).append(e);var k=0,l=setInterval(function(){k>59&&(l=clearInterval(l),location.reload(!0)),k++,f.html("几何信息解析中，将在"+(61-k)+"秒之后重试··"),i.css("width",k/6*10+"%")},1e3);return}1==c.result.Status?(g.promptingMessage("warning","属性未解析完成，将只显示几何··",!1),g.documentInfo[a]=c.result,b(c.result)):3==c.result.Status?(g.documentInfo[a]=c.result,b(c.result)):void 0==c.result.Status?b(c.result):g.promptingMessage("warning","文件解析中，请稍后再试··",!1)}else if(console.warn("error: "+c.error),"document not found"==c.error&&""!=g.cn){var m=a.split("/")[1];$.ajax({type:"GET",url:g.webApiAddress+"?cn="+g.cn+"&fileid="+m,data:{},success:function(a){},error:function(a,b,c){}});var n=$("<div class='progressdiv' style=\"position: absolute;top: 20px; left:50%; margin-left: -150px; opacity: 0.6;height: 47px;z-index: 5000;padding: 10px; width: 300px;background-color: #555555;border-radius: 5px;\">"),o=$('<div style=" color: white;padding-bottom: 2px;overflow: hidden;text-overflow: ellipsis;word-break: keep-all;white-space: nowrap;">');o.html("文件尚未解析，将在一分钟之后重试··");var p=$('<div class="progress active progress-striped">'),q=$('<div class="progress-bar">');n.append(o),p.append(q),n.append(p);var r="#"+g.viewport;$(r).append(n);var s=0,t=setInterval(function(){s>59&&(t=clearInterval(t),location.reload(!0)),s++,o.html("文件尚未解析，将在"+(61-s)+"秒之后重试··"),q.css("width",s/6*10+"%")},1e3)}else g.promptingMessage("warning",c.error,!1)},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})}},this.getDocument_BOS=function(a,b,c){0==a.indexOf("files/")&&(a=a.slice(6)),g.documentInfo[a]?b(g.documentInfo[a]):$.ajax({type:"GET",url:g.baseaddress+g.appKey+"/prototype/files/"+a+"?noRelation=true",headers:{authorization:"AccessToken "+g.accessToken,"content-type":"application/json"},data:{},success:function(c){if(3!=c.Status&&g.cn){var d=a.split("/")[1];$.ajax({type:"GET",url:g.webApiAddress+"?cn="+g.cn+"&fileid="+d,data:{},success:function(a){},error:function(a,b,c){}})}.5==c.Status&&(g.promptingMessage("warning","几何信息解析中··",!1),f.progress({title:"提示",label:"几何信息解析中，将在一分钟之后重试··",progressTpl:'<div class="progress lobibox-progress-outer"><div class="progress-bar progress-bar-danger progress-bar-striped lobibox-progress-element" data-role="progress-text" role="progressbar"></div></div>',onShow:function(a){var b=100,c=setInterval(function(){b<0&&(c=clearInterval(c),location.reload(!0)),b-=.1,a.setProgress(b)},60)}})),1==c.Status?(g.promptingMessage("warning","属性未解析完成，将只显示几何··",!1),g.documentInfo[a]=c,b(c)):3==c.Status?(g.documentInfo[a]=c,b(c)):void 0==c.Status?b(c):g.promptingMessage("warning","文件解析中，请稍后再试··",!1)},error:function(b,d,e){if(console.warn("error: "+b.responseJSON.message),b.responseJSON.data=="key为"+a+"的files不存在")if("404"==b.responseJSON.code&&""!=g.cn){var h=a.split("/")[1];$.ajax({type:"GET",url:g.webApiAddress+"?cn="+g.cn+"&fileid="+h,data:{},success:function(a){},error:function(a,b,c){}}),f.progress({title:"提示",label:"文件尚未解析，将在一分钟之后重试··",progressTpl:'<div class="progress lobibox-progress-outer"><div class="progress-bar progress-bar-danger progress-bar-striped lobibox-progress-element" data-role="progress-text" role="progressbar"></div></div>',onShow:function(a){var b=100,c=setInterval(function(){b<0&&(c=clearInterval(c),location.reload(!0)),b-=.1,a.setProgress(b)},60)}})}else g.promptingMessage("warning",b.responseJSON.message,!1);"function"==typeof c?c(b):b.responseJSON?g.promptingMessage("error","“错误码："+b.responseJSON.code+" 错误信息："+b.responseJSON.message+","+b.responseJSON.data+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})},this.getEntity=function(a,b,c,d){"app"==g.type?$.ajax({type:"GET",url:g.baseaddress+"common/"+a+"/"+b,data:{appKey:g.appKey,access_token:g.accessToken},success:function(a){0==a.code?c(a.data):(console.warn("error: "+a.message),g.promptingMessage("warning",a.message))},error:function(a,b,c){"function"==typeof d?d(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}}):(b=encodeURIComponent(b),$.ajax({type:"GET",url:g.baseaddress+a+"/"+b,data:{},success:function(a){a.success?c(a.result):(console.warn("error: "+a.error),g.promptingMessage("warning",a.error))},error:function(a,b,c){"function"==typeof d?d(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}}))},this.getComponent=function(a,b){for(var c=0;c<a.length;c++){var e=encodeURIComponent(a[c]);$.ajax({type:"GET",url:g.baseaddress+"component/"+e,data:{},success:function(a){a.success?b(a.result):(console.warn("error: "+a.error),g.promptingMessage("warning",a.error))},error:function(a,c,e){var f=0;d(this.url,f,b)}})}},this.getComponentAttribute=function(a,b){0==a.indexOf("component/")&&(a=a.slice(10)),void 0!=g.componentAttribute[a]?b(g.componentAttribute[a]):g.getAttributeByComponentId([a],function(c){for(var d in c)c[d].length<1?g.componentAttribute[a]=null:g.componentAttribute[a]=c[d][0].attribute||c[d][0].Attribute;b(g.componentAttribute[a])},function(){g.componentAttribute[a]=void 0,b(g.componentAttribute[a])})},this.getComponentBatch=function(a,b,c){for(var d=0;d<a.length;d++)"app"==g.type?0!==a[d].indexOf("component/")||(a[d]=a.slice(10)):0!==a[d].indexOf("component/")&&(a[d]="component/"+a[d]);var e,f,h=a.concat();"3.0"==g.DBversion?(e=h,f="application/json"):(e={array:h},f=void 0),"app"==g.type?$.ajax({type:"POST",url:g.baseaddress+g.appKey+"/batchget/components",data:JSON.stringify(h),headers:{authorization:"AccessToken "+g.accessToken,"content-type":"application/json"},success:function(a){b(a)},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.message+","+a.responseJSON.data+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}}):$.ajax({type:"POST",url:g.baseaddress+"component/batchget",data:JSON.stringify(e),contentType:f,success:function(a){a.success?b(a.result):(console.warn("error: "+a.error),g.promptingMessage("warning",a.error))},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})},this.getComponentDataBatch=function(){var a=function(a,b){var c,d={};"3.0"==g.DBversion?(d=a,c="application/json"):(d={array:a},c=void 0),"app"==g.type?$.ajax({type:"POST",url:g.baseaddress+g.appKey+"/batchget/componentGeoes",data:JSON.stringify(a),headers:{authorization:"AccessToken "+g.accessToken,"content-type":"application/json"},success:function(a){for(var c=0;c<a.length;c++)b(a[c])},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON?g.promptingMessage("error","信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.message+","+a.responseJSON.data+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}}):$.ajax({type:"POST",url:g.baseaddress+"componentGeo/batchget",data:JSON.stringify(d),contentType:c,success:function(a){if(a.success)for(var c=0;c<a.result.length;c++)b(a.result[c]);else console.warn("error: "+a.error),g.promptingMessage("warning",a.error)},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})};return function(b,c,d){var e=50;void 0!==d&&"number"==typeof d&&(e=d);for(var f=0,h=[],i=[],j=0;j<b.length;j++)g.componentInfo[g.componentData_Info[b[j]][0]].numberOfPrimitives?g.componentInfo[g.componentData_Info[b[j]][0]].numberOfPrimitives>5e4?a([b[j]],c):(f+=g.componentInfo[g.componentData_Info[b[j]][0]].numberOfPrimitives,"app"==g.type?0==b[j].indexOf("componentGeoes/")&&(b[j]=b[j].slice(15)):0!==b[j].indexOf("componentGeo/")&&(b[j]="componentGeo/"+b[j]),h.push(b[j]),f>5e4&&(f=0,a(h,c),h=null,h=[])):("app"==g.type?0==b[j].indexOf("componentGeoes/")&&(b[j]=b[j].slice(15)):0!==b[j].indexOf("componentGeo/")&&(b[j]="componentGeo/"+b[j]),i.push(b[j]));if(h.length>0&&(f=0,a(h,c),h=null,h=[]),i.length>0)for(;i.length>=1;){var k=i.splice(0,e);a(k,c)}}}(),this.getComponentFromDocument=function(a,b,c){a=encodeURIComponent(a),$.ajax({type:"GET",url:g.baseaddress+"component/document/"+a,data:{},contentType:"application/json",success:function(a){a.success?b(a.result):(console.warn("error: "+a.error),g.promptingMessage("warning",a.error))},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})},this.getComponentIdByDocumentId_BOS=function(a,b,c){$.ajax({type:"POST",url:g.baseaddress+g.appKey+"/prototype/query/irIFCComponent",headers:{authorization:"AccessToken "+g.accessToken,"content-type":"application/json"},data:JSON.stringify({condition:[{field:"_from",operator:"==",value:"files/"+a,logic:""}],select:["_to"]}),success:function(c){if(c.length>0){for(var d=[],e=0;e<c.length;e++)d.push(c[e][0]);b(d)}else console.warn("error: 没有找到id为："+a+" 关联的构件"),g.promptingMessage("warning","没有找到id为："+a+" 关联的构件")},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})},this.getComponentIdByDocumentId=function(a,b,c){if("app"==g.type?0!==a.indexOf("document/")||(a=a.slice(9)):0!==a.indexOf("document/")&&(a="document/"+a),"app"==g.type)$.ajax({type:"GET",url:g.baseaddress+g.appKey+"/files/"+a+"/components?bosclass=components",headers:{authorization:"AccessToken "+g.accessToken,"content-type":"application/json"},data:{},success:function(c){if(c.length>0){for(var d=[],e=0;e<c.length;e++)g.componentInfo[c[e].key]=c[e],d.push(c[e].key);b(d)}else console.warn("error: 没有找到id为："+a+" 关联的构件"),g.promptingMessage("warning","没有找到id为："+a+" 关联的构件")},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.message+","+a.responseJSON.data+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}});else{var d={_from:a};$.ajax({type:"POST",url:g.baseaddress+"document_component/query",data:JSON.stringify(d),success:function(a){if(a.success){for(var c=[],d=0;d<a.result.length;d++)c.push(a.result[d]._to);b(c)}else console.warn("error: "+a.error),g.promptingMessage("warning",a.error)},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})}},this.getDocumentFromComponent=function(a,b,c){"app"==g.type?0!==a.indexOf("component/")||(a=a.slice(9)):0!==a.indexOf("component/")&&(a="component/"+a),"app"==g.type?$.ajax({type:"POST",url:g.baseaddress+g.appKey+"/prototype/query/irIFCComponent",headers:{authorization:"AccessToken "+g.accessToken,"content-type":"application/json"},data:JSON.stringify({condition:[{field:"_to",operator:"==",value:"components/"+a,logic:""}],select:["_from"]}),contentType:"application/json",success:function(c){c.length>0?g.getDocument_BOS(c[0][0],b):(console.warn("error: 没有找到id为："+a+" 关联的文件"),g.promptingMessage("warning","没有找到id为："+a+" 关联的文件"))},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.message+","+a.responseJSON.data+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}}):(a=encodeURIComponent(a),$.ajax({type:"GET",url:g.baseaddress+"component/"+a+"/document",data:{},success:function(a){a.success?b(a.result[0]):(console.warn("error: "+a.error),g.promptingMessage("warning",a.error))},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}}))},this.stopFlashing=function(){void 0!=flashing&&clearTimeout(flashing),g.closetransParentObjs(),document.getElementById(g.viewer.canvasParent).style.background="white",g.setAllObjtColor(allcolor)},this.componentLocationAndFlashing=function(a){function b(){for(var a=0;a<c.length;a++)c[a].highlight=!c[a].highlight,c[a].color=c[a].highlight?allcolor[c[a].id]:[1,0,0,1];flashing=setTimeout(b,1e3)}var c=[];if(void 0==a||null==a)return void g.promptingMessage("warning","没有发现选中的构件",!1);if(g.stopFlashing(),g.objectSet.clear(),g.objectSet.addObjectIds(a),g.objectSet.numObjects<=0)return this;var d=1.5*g.objectSet.boundary.xmax,e=1.5*g.objectSet.boundary.ymax,f=1.5*g.objectSet.boundary.zmax,h=[(g.objectSet.boundary.xmax+g.objectSet.boundary.xmin)/2,(g.objectSet.boundary.ymax+g.objectSet.boundary.ymin)/2,(g.objectSet.boundary.zmax+g.objectSet.boundary.zmin)/2];if(g.fly.flyTo({eye:[d,e,f],look:h,up:[0,0,1],velocity:20}),!(g.alloids.length<=0)){for(var i=null,j=g.alloids.concat(),k=0;k<a.length;k++)for(var l=0;l<j.length;l++)if(a[k]==j[l]){if(i=g.viewer.components[""+j[l]],void 0==i)break;c.push(i),j.splice(l,1);break}for(var m=null,n=0;n<j.length;n++)m=g.viewer.components[""+j[n]],void 0!=m&&null!=i&&(m.color=[.5,.5,.5],m.transparent=!0);c.length>0&&(document.getElementById(g.viewer.canvasParent).style.background="grey",b())}},this.getLodByComponentGeoId=function(a,b,c){for(var d=0;d<a.length;d++)"app"==g.type?0!==a[d].indexOf("componentGeo/")||(a[d]=a[d].slice(13)):0!==a[d].indexOf("componentGeo/")&&(a[d]="componentGeo/"+a[d]);var e={from:a};"app"==g.type?$.ajax({type:"POST",url:g.baseaddress+"model/relation/component/children/lod/id/batch?access_token="+g.accessToken+"&appKey="+g.appKey,data:JSON.stringify(e),success:function(a){0==a.code?b(a.data):console.warn("error: "+a.message)},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}}):$.ajax({type:"POST",url:g.baseaddress+"componentGeo_lod/batch/rel/lod",data:JSON.stringify(e),success:function(a){a.success?b(a.result):console.warn("error: "+a.error)},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})},this.getAttributeByComponentId=function(a,b,c){for(var d=0;d<a.length;d++)"app"==g.type?0!==a[d].indexOf("component/")||(a[d]=a[d].slice(10)):0!==a[d].indexOf("component/")&&(a[d]="component/"+a[d]);var e={from:a},f={};if("app"==g.type)for(var h=0;h<a.length;h++)$.ajax({type:"GET",url:g.baseaddress+g.appKey+"/relation/components/"+a[h]+"/to/ifcAttributes",headers:{authorization:"AccessToken "+g.accessToken,"content-type":"application/json"},async:!1,data:{},success:function(b){b.length>0?f[a[h]]=b:(console.warn("error: 没有找到id为："+a[h]+" 关联的构件"),g.promptingMessage("warning","没有找到id为："+a[h]+" 关联的构件"))},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.message+","+a.responseJSON.data+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}}),b(f);else $.ajax({type:"POST",url:g.baseaddress+"component_ifcAttribute/batch/rel/ifcAttribute",data:JSON.stringify(e),success:function(a){a.success?b(a.result):console.warn("error: "+a.error)},error:function(a,b,d){"function"==typeof c?c(a):a.responseJSON?g.promptingMessage("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):g.promptingMessage("error","网络请求发生错误，请稍后再试。")}})},this.showModelByDocumentId=function(){var a,b,c,d,e=function(e){g.documentList.push(a),$(".loading").addClass("hide"),"app"==g.type?e.attribute&&e.attribute.maxBoundary&&e.attribute.minBoundary?g.readStart(e.attribute.maxBoundary,e.attribute.minBoundary):g.calculateBoundary=!0:e.Attribute&&e.Attribute.maxBoundary&&e.Attribute.minBoundary?g.readStart(e.Attribute.maxBoundary,e.Attribute.minBoundary):g.calculateBoundary=!0,g.getComponentIdByDocumentId(a,function(e){g.showModelByComponentId(e,function(){g.listener.fire("finish",a,!0),"function"==typeof b&&b(a)},c,d)})};return function(f,h,i,j){a=f,b=h,c=i,d=j,"app"==g.type?g.getDocument_BOS(f,e):g.getDocument(f,e)}}(),this.showModelByComponentId=function(){var a,b,c=0,d=0,f=[],h=[],i=[],j=[],k=[],l=function(a,b,c){for(var d=0;d<f.length;d++)void 0!=g.componentData_Info[g.componentInfo[f[d]].gid]&&null!=g.componentData_Info[g.componentInfo[f[d]].gid]?g.componentData_Info[g.componentInfo[f[d]].gid].push(f[d]):(g.componentData_Info[g.componentInfo[f[d]].gid]=[],g.componentData_Info[g.componentInfo[f[d]].gid].push(f[d])),g.componentGeometrys[g.componentInfo[f[d]].gid]?h.push(g.componentInfo[f[d]].gid):k.push(g.componentInfo[f[d]].gid);if(b)if(0==a.length){for(var i=[],j=0;j<k.length;j++)g.componentLod[k[j]]&&g.componentLod[k[j]][b]?(i.push(g.componentLod[k[j]][b]),g.componentData_Info[g.componentLod[k[j]][b]]=g.componentData_Info[k[j]]):i.push(k[j]);c(e(i))}else g.getLodByComponentGeoId(e(a),function(a){var d=[];for(var f in a)g.componentLod[f]=a[f][0];a=null;for(var h=0;h<k.length;h++)g.componentLod[k[h]]&&g.componentLod[k[h]][b]?(d.push(g.componentLod[k[h]][b]),g.componentData_Info[g.componentLod[k[h]][b]]=g.componentData_Info[k[h]]):d.push(k[h]);c(e(d))});else c(e(k),e(h))},m=function(a,b){for(var c=0;c<b.length;c++)n(b[c]);g.getComponentDataBatch(a,function(a){a._id||(a._id="componentGeoes/"+a.key),g.createGeometry2(a),g.componentData[a._id]={},g.componentData[a._id].colors=a.colors,g.componentData[a._id].numberOfColors=a.numberOfColors,n(a._id)},30)},n=function(h){if(void 0!=g.componentData_Info[h]&&null!=g.componentData_Info[h]){g.componentData_Info[h]=e(g.componentData_Info[h]),g.cameraControl.update();for(var l=0;l<g.componentData_Info[h].length;l++){var m=g.componentInfo[g.componentData_Info[h][l]];m&&(g.createObject(m.key,m.type,[h],m.matrix),m=null,d++,a.updata(d,c),d==c&&"function"==typeof b&&(c=null,d=null,a=null,f=null,i=null,j=null,k=null,b()))}}};return function(e,n,o,p){if(c=e.length,d=0,a=new g.downloadprogress(""),f=[],h=[],i=[],j=[],k=[],b=n,!$.isArray(e)||0==e.length)return g.promptingMessage("error","参数需要为长度不为0的数组"),void(a&&a.updata(1,1));g.modelBounds.isEmpty()&&g.getDocumentFromComponent(e[0],function(a){$(".loading").addClass("hide"),a&&("app"==g.type?a.attribute&&a.attribute.maxBoundary&&a.attribute.minBoundary?g.readStart(a.attribute.maxBoundary,a.attribute.minBoundary):g.calculateBoundary=!0:a.Attribute&&a.Attribute.maxBoundary&&a.Attribute.minBoundary?g.readStart(a.Attribute.maxBoundary,a.Attribute.minBoundary):g.calculateBoundary=!0)});for(var q=0;q<e.length;q++)g.componentInfo[e[q]]?(f.push(e[q]),g.componentLod[g.componentInfo[e[q]].gid]||i.push(g.componentInfo[e[q]].gid)):j.push(e[q]);j.length>0?("app"!=g.type&&g.getAttributeByComponentId(j,function(a){for(var b in a)a[b].length<1?(0==b.indexOf("component/")&&(b=b.slice(10)),g.componentAttribute[b]=null):0==b.indexOf("component/")?(b=b.slice(10),
g.componentAttribute[b]=a["component/"+b][0].attribute||a["component/"+b][0].Attribute):g.componentAttribute[b]=a[b][0].attribute||a["component/"+b][0].Attribute},o),g.getComponentBatch(j,function(a){c=a.length;for(var b=0;b<a.length;b++){var d="";a[b]._id?(d=a[b]._id,a[b].key=a[b]._key):a[b].key&&(d=a[b].key),g.componentInfo[d]=a[b],g.componentLod[a[b].gid]||i.push(a[b].gid),f.push(d)}l(i,p,m)})):l(i,p,m)}}(),this.showComponentAttribute=function(a){console.warn("showComponentAttribute 方法已经从Viewer类中移动到Tool类中。")},this.deletePath=function(a){if(void 0==a||"string"!=typeof a&&"number"!=typeof a)return void g.promptingMessage("warning","路径名称未指定或不合法！");var b=g.viewer.scene.getNode(a);void 0==b?g.promptingMessage("warning","路径不存在！"):(void 0!=g.pathFlashing[a]&&clearInterval(g.pathFlashing[a]),b.destroy())},this.drawPath=function(a,b,c){if(void 0==a)return void g.promptingMessage("warning","路径点未指定！");if(void 0==b)return void g.promptingMessage("warning","路径高度未指定！");if(void 0==c)return void g.promptingMessage("warning","路径名称未指定！");for(var d=[],e=[],f=0;f<a.length;f++)d.push(f);for(var f=0;f<a.length;f++)e.push(a[f][0]),e.push(a[f][1]),e.push(a[f][2]+b);g.viewer.scene.getNode("contentRoot").addNode({type:"name",name:c,id:c,nodes:[{type:"material",color:{r:1,g:0,b:0},nodes:[{type:"flags",flags:{picking:!1},nodes:[{type:"translate",x:0,y:0,z:0,nodes:[{type:"scale",x:1,y:1,z:1,nodes:[{type:"style",lineWidth:50,nodes:[{type:"geometry",primitive:"line-strip",positions:e,indices:d}]}]}]}]}]}]});for(var f=0;f<a.length;f++)if(f!=a.length-1){var h=g.viewer.scene.getNode(c).nodes[0],i=0,j=0,k=a[f+1][0]-a[f][0],l=a[f+1][1]-a[f][1],m=a[f+1][2]-a[f][2],n=(a[f+1][0]+a[f][0])/2,o=(a[f+1][1]+a[f][1])/2,p=(a[f+1][2]+a[f][2])/2+b;0==l?0!=m&&0!=k?(j=180*Math.atan(m/k)/Math.PI,i=90,k<0&&(j=180+180*Math.atan(m/k)/Math.PI)):(k<0?i=-90:k>0&&(i=90),m<0?j=-90:m>0&&(j=90)):l<0?(i=180+180*Math.atan(k/l)/Math.PI,j=180*Math.atan(m/l)/Math.PI):l>0&&(i=180*Math.atan(k/l)/Math.PI,j=180*Math.atan(m/l)/Math.PI),h.addNode({type:"translate",x:n,y:o,z:p,nodes:[{type:"rotate",id:c+"-myRotatez-"+f,x:0,y:0,z:-1,angle:i,nodes:[{type:"rotate",id:c+"-myRotatex-"+f,x:1,y:0,z:0,angle:j,nodes:[{type:"scale",x:20,y:20,z:20,nodes:[{type:"translate",x:0,y:0,z:0,nodes:[buildCylinder({type:"geometry/cylinder",radiusTop:1,radiusBottom:20,height:30,radialSegments:24,heightSegments:1,openEnded:!1})]},{type:"translate",x:0,y:-45,z:0,nodes:[buildCylinder({type:"geometry/cylinder",radiusTop:10,radiusBottom:10,height:60,radialSegments:24,heightSegments:1,openEnded:!1})]}]}]}]}]})}var q=setInterval(function(){h.setColor(1==h.getColor().g?{r:1,g:0,b:0}:{r:1,g:1,b:0})},1e3);g.pathFlashing[c]=q},this.promptingMessage=function(){var a,b="Success",c="",d="",e=!1,g=0;return function(h,i,j){return 5==h?$(".loading").addClass("hide"):b=h,"error"==h&&(e=!1),void 0!=i&&(c=i,void 0!=j&&(e=j)),(new Date).getTime()-g<5e3?c!=d&&(a=f.notify(b,{size:"mini",rounded:!0,position:"center top",sound:!1,delay:e,msg:c}),g=(new Date).getTime(),a.$el[0].childNodes[1].childNodes[0].title=c):(a=f.notify(b,{size:"mini",rounded:!0,position:"center top",sound:!1,delay:e,msg:c}),g=(new Date).getTime(),a.$el[0].childNodes[1].childNodes[0].title=c),d=c,a}}(),this.downloadprogress=function(a){var b=$("<div class='progressdiv' style=\"position: absolute;top: 20px; left:50%; margin-left: -150px; opacity: 0.6;height: 47px;z-index: 5000;padding: 10px; width: 300px;background-color: #555555;border-radius: 5px;\">"),c=$('<div style=" color: white;padding-bottom: 2px;overflow: hidden;text-overflow: ellipsis;word-break: keep-all;white-space: nowrap;">');c.html("加载中··");var d=$('<div class="progress active progress-striped">'),e=$('<div class="progress-bar">');b.append(c),d.append(e),b.append(d);var f="#"+g.viewport;$(f).append(b),this.updata=function(a,d){c.html("正在加载构件("+a+"/"+d+")"),c.title="正在加载构件("+a+"/"+d+")",a<=1&&$(".loading").addClass("hide");var f=a/d;e.css("width",100*f+"%"),1==f&&(b.fadeOut(800),$(".progressdiv").remove())}},this.resetScene=function(a,b,c,d,e,f,i){g.objectSet.clear(),(void 0==a||a)&&(g.fly.flyTo({eye:h.eye,look:h.look,up:h.up}),g.camera.zoom=h.zoom),(void 0==b||b)&&g.showObjs(),(void 0==c||c)&&g.closeHighlightObjs(),(void 0==d||d)&&g.closeTransparentObjs(),(void 0==e||e)&&g.restoreObjtColor(),(void 0==f||f)&&g.closeWireframeObjs(),g.viewportDiv.focus()},this.transparentObjs=function(a,b,c){if(!(g.alloids.length<=0)){var d=null,e=.5;if(void 0!=b&&(0<=Number(b)&&Number(b)<=1?e=b:g.promptingMessage("warning","透明度参数不合法",!1)),void 0==a||null==a)for(var f=0;f<g.alloids.length;f++){var h=g.components[""+g.alloids[f]];if(h.isMesh)if(h.userData.transparentChange=!0,$.isArray(h.material))for(var i=0;i<h.material.length;i++)void 0!==c&&1==c&&h.material[i].color.setRGB(.5,.5,.5),h.material[i].opacity=e,h.material[i].transparent=e<1||g.objectSet.objects[g.alloids[f]];else void 0!==c&&1==c&&h.material.color.setRGB(.5,.5,.5),h.material.opacity=e,h.material.transparent=e<1||g.objectSet.objects[g.alloids[f]]}else for(var f=0;f<a.length;f++)if(d=g.components[""+a[f]])if(d.userData.transparentChange=!0,$.isArray(d.material))for(var i=0;i<d.material.length;i++)void 0!==c&&1==c&&d.material[i].color.setRGB(.5,.5,.5),d.material[i].opacity=e,d.material[i].transparent=e<1||g.objectSet.objects[a[f]];else void 0!==c&&1==c&&d.material.color.setRGB(.5,.5,.5),d.material.opacity=e,d.material.transparent=e<1||g.objectSet.objects[a[f]]}},this.reverseTransparentObjs=function(a,b,c){var d=g.alloids.concat(),e=null,f=.5;if(b&&(f=b),a){for(var h=0;h<a.length;h++)for(var i=0;i<d.length;i++)if(a[h]==d[i]){d.splice(i,1);break}for(var h=0;h<d.length;h++)if(e=g.components[""+d[h]])if(e.userData.transparentChange=!0,$.isArray(e.material))for(var i=0;i<e.material.length;i++)void 0!==c&&1==c&&e.material[i].color.setRGB(.5,.5,.5),e.material[i].opacity=f,e.material[i].transparent=f<1;else void 0!==c&&1==c&&e.material.color.setRGB(.5,.5,.5),e.material.opacity=f,e.material.transparent=f<1}else for(var h=0;h<g.alloids.length;h++){var j=g.components[""+g.alloids[h]];if(j.isMesh)if(j.userData.transparentChange=!0,$.isArray(j.material))for(var i=0;i<j.material.length;i++)void 0!==c&&1==c&&j.material[i].color.setRGB(.5,.5,.5),j.material[i].opacity=f,j.material[i].transparent=f<1;else void 0!==c&&1==c&&j.material.color.setRGB(.5,.5,.5),j.material.opacity=f,j.material.transparent=f<1}},this.closeTransparentObjs=function(a){if(!(g.alloids.length<=0)){var b=null;if(a){for(var c=0;c<a.length;c++)if(b=g.components[""+a[c]])if(b.userData.transparentChange=!1,$.isArray(b.material))for(var d=0;d<b.material.length;d++)b.material[d].opacity=b.userData.originalMaterial[d].opacity,b.material[d].transparent=b.userData.originalMaterial[d].transparent;else b.material.opacity=b.userData.originalMaterial[0].opacity,b.material.transparent=b.userData.originalMaterial[0].transparent}else for(var c=0;c<g.alloids.length;c++)if(b=g.components[""+g.alloids[c]])if(b.userData.transparentChange=!1,$.isArray(b.material))for(var d=0;d<b.material.length;d++)b.material[d].opacity=b.userData.originalMaterial[d].opacity,b.material[d].transparent=b.userData.originalMaterial[d].transparent;else b.material.opacity=b.userData.originalMaterial[0].opacity,b.material.transparent=b.userData.originalMaterial[0].transparent}},this.hideObjs=function(a){if(void 0==a||null==a)return void g.promptingMessage("warning","没有发现选中的构件",!1);for(var b=null,c=0;c<a.length;c++)b=g.components[""+a[c]],b&&(b.visible=!1)},this.showObjs=function(a){var b=g.alloids.concat(),c=null;if(a)for(var d=0;d<a.length;d++)c=g.components[""+a[d]],c&&(c.visible=!0);else for(var e=0;e<g.alloids.length;e++)c=g.components[""+b[e]],c&&(c.visible=!0)},this.isolationObjs=function(a){if(void 0==a||null==a)return void g.promptingMessage("warning","没有发现选中的构件",!1);if(g.showObjs(),!(g.alloids.length<=0)){for(var b=g.alloids.concat(),c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(a[c]==b[d]){b.splice(d,1);break}for(var e=null,d=0;d<b.length;d++)e=g.components[""+b[d]],e&&(e.visible=!1)}},this.showLable=function(){},this.highlightObjs=function(a){return void 0==a||null==a?void g.promptingMessage("warning","没有发现选中的构件",!1):void(g.alloids.length<=0||(g.closeTransparentObjs(),g.closeHighlightObjs(),g.objectSet.addObjectIds(a)))},this.closeHighlightObjs=function(a){if(!(g.alloids.length<=0)){g.alloids.concat();a?g.objectSet.removeObjectIds(a):g.objectSet.removeObjectIds(g.alloids)}},this.wireframeObjs=function(a){if(void 0==a||null==a)return void g.promptingMessage("warning","没有发现选中的构件",!1);if(!(g.alloids.length<=0)){var b=null;if(void 0==a||null==a);else for(var c=0;c<a.length;c++)if(b=g.components[""+a[c]])if($.isArray(b.material))for(var d=0;d<b.material.length;d++)b.material[d].wireframe=!0;else b.material.wireframe=!0}},this.closeWireframeObjs=function(a){if(!(g.alloids.length<=0)){var b=null;if(void 0==a||null==a)for(var c=0;c<g.alloids.length;c++){var d=g.components[""+g.alloids[c]];if(d.isMesh)if($.isArray(d.material))for(var e=0;e<d.material.length;e++)d.material[e].wireframe=!1;else d.material.wireframe=!1}else for(var c=0;c<a.length;c++)if(b=g.components[""+a[c]])if($.isArray(b.material))for(var e=0;e<b.material.length;e++)b.material[e].wireframe=!1;else b.material.wireframe=!1}},this.restoreObjtColor=function(a){if(!(g.alloids.length<=0))if(void 0==a||null==a)for(var b=0;b<g.alloids.length;b++){var c=g.components[""+g.alloids[b]];if(c)if($.isArray(c.material)){c.userData.color=[];for(var d=0;d<c.material.length;d++)c.material[d].color=c.userData.originalMaterial[d].color.clone(),c.userData.color.push(c.material[d].color.r,c.material[d].color.g,c.material[d].color.b,1)}else c.material.color=c.userData.originalMaterial[0].color.clone(),c.userData.color=c.material.color.clone()}else for(var b=0;b<a.length;b++)if(c=g.components[""+a[b]])if($.isArray(c.material)){c.userData.color=[];for(var d=0;d<c.material.length;d++)c.material[d].color=c.userData.originalMaterial[d].color.clone(),c.userData.color.push(c.material[d].color.r,c.material[d].color.g,c.material[d].color.b,1)}else c.material.color=c.userData.originalMaterial[0].color.clone(),c.userData.color=c.material.color.clone()},this.setObjtColor=function(a,b){if(void 0==a||null==a)return void g.promptingMessage("warning","没有发现选中的构件",!1);if(void 0==b||null==b)return void g.promptingMessage("warning","未选中颜色",!1);if(!(g.alloids.length<=0))for(var c=null,d=0;d<a.length;d++)if(c=g.components[""+a[d]]){if($.isArray(c.material))for(var e=0;e<c.material.length;e++)c.material[e].color.setRGB(b[0],b[1],b[2]);else c.material.color.setRGB(b[0],b[1],b[2]);c.userData.color=new THREE.Color(b[0],b[1],b[2])}},this.setColorProcess=function(a){var b=g.arrayConversion();g.setObjtColor(b,a)},this.destroyObjs=function(a){if(!(g.alloids.length<=0)){var b=null,c=g.alloids.concat();if(a)for(var d=0;d<a.length;d++)b=g.components[""+a[d]],b&&(b.geometry.dispose(),delete g.componentGeometrys[b.geometry.key],delete g.componentData_Info[b.geometry.key],g.root.remove(b),g.components[""+a[d]]=null,delete g.components[""+a[d]]);else{for(var e=0;e<g.alloids.length;e++)b=g.components[""+c[e]],b&&(b.geometry.dispose(),delete g.componentGeometrys[b.geometry.key],delete g.componentData_Info[b.geometry.key],g.root.remove(b));g.alloids=null,g.components=null,g.alloids=[],g.components=[],g.componentGeometrys={},g.componentData_Info={}}}},this.findSceneNodes=function(a){if(void 0==a||null==a)return void g.promptingMessage("warning","没有发现选中的构件",!1);if(g.multiSelect||g.objectSet.clear(),g.objectSet.addObjectIds(a),g.objectSet.numObjects<=0)return this;var b=g.objectSet.getBoundary();if(b.isBox3){var c=b.getCenter(),d=(new THREE.Vector3).copy(g.cameraControl.target).sub(c),e=new THREE.Vector3(b.max.x+b.getSize().x,b.max.y+b.getSize().y,b.max.z+b.getSize().z),f=e.sub(c),h=(new THREE.Vector3).copy(g.camera.position).sub(d),i=h.sub(c).setLength(f.length()).add(c);g.fly.flyTo({eye:i,look:c})}},this.listentoSelectObjs=function(a){g.objectSet.listener.on("updated",function(b){if($.isEmptyObject(g.objectSet.objects))a(null,null);else{var c=g.objectSet.objects,d="";for(var e in c)d=d+e+",";if(d=d.substring(0,d.length-1),""==d);else if(g.explorer){var f=d.split(",");g.listentree(f)}a(d,g.objectSet.objects)}})},this.getModelSnapshoot=function(){for(var a={},b=[],c={eye:g.camera.position.clone(),look:g.cameraControl.target.clone(),up:g.camera.up.clone(),zoom:g.camera.zoom},d=g.alloids.concat(),e=null,f=0;f<d.length;f++)if(e=g.components[""+d[f]]){var h=[];if($.isArray(e.material))for(var i=0;i<e.material.length;i++){var j={};j.color=e.material[i].color.clone(),j.opacity=e.material[i].opacity,j.transparent=e.material[i].transparent,h.push(j)}else{var k={};k.color=e.material.color.clone(),k.opacity=e.material.opacity,k.transparent=e.material.transparent,h.push(k)}b.push({oid:d[f],highlight:e.highlight,active:e.visible,material:h})}else b.push({});return g.Flag.clip&&(a=g.Clip.state),{componentState:b,camaraState:c,cuttingState:a}},this.setModelSnapshoot=function(a,b,c){if(g.objectSet.clear(),b&&(g.camera.zoom=b.zoom,b.eye&&b.look&&b.up&&g.fly.flyTo({eye:(new THREE.Vector3).copy(b.eye),look:(new THREE.Vector3).copy(b.look),up:(new THREE.Vector3).copy(b.up)})),!(g.alloids.length<=0)&&a&&c){for(var d=null,e=0;e<a.length;e++)if(a[e].oid&&(d=g.components[""+a[e].oid]))if(d.highlight=a[e].highlight,d.highlight&&g.objectSet.addObjectIds([a[e].oid]),d.visible=a[e].active,a[e].material.length>1)for(var f=0;f<a[e].material.length;f++)"object"==typeof a[e].material[f].color?d.material.materials[f].color.copy(a[e].material[f].color):"string"!=typeof a[e].material[f].color&&"number"!=typeof a[e].material[f].color||d.material.materials[f].color.setHex(a[e].material[f].color),d.material.materials[f].opacity=a[e].material[f].opacity,d.material.materials[f].transparent=a[e].material[f].transparent;else 1==a[e].material.length&&("object"==typeof a[e].material[0].color?d.material.color.copy(a[e].material[0].color):"string"!=typeof a[e].material[0].color&&"number"!=typeof a[e].material[0].color||d.material.color.setHex(a[e].material[0].color),d.material.opacity=a[e].material[0].opacity,d.material.transparent=a[e].material[0].transparent);if($.isEmptyObject(c))g.Flag.clip=!0,g.modelCutting();else{g.Flag.clip=!1,g.modelCutting();var h=c.x,i=c.y,j=c.z,k=c.x1,l=c.y1,m=c.z1;g.cutting(h,i,j,k,l,m,c.sensitivity)}}},this.flyToView=function(a){switch(a){case"Front":g.camera.rotation.x=0,g.camera.rotation.y=0,g.camera.rotation.z=0;break;case"Back":g.camera.rotation.x=0,g.camera.rotation.y=Math.PI,g.camera.rotation.z=0;break;case"Left":g.camera.rotation.x=0,g.camera.rotation.y=-Math.PI/2,g.camera.rotation.z=0;break;case"Right":g.camera.rotation.x=0,g.camera.rotation.y=Math.PI/2,g.camera.rotation.z=0;break;case"Top":g.camera.rotation.x=-Math.PI/2,g.camera.rotation.y=0,g.camera.rotation.z=0;break;case"Bottom":g.camera.rotation.x=Math.PI/2,g.camera.rotation.y=0,g.camera.rotation.z=0}},this.modelExplosion=function(a){for(var b=g.modelBounds.getCenter().x,c=g.modelBounds.getCenter().y,d=g.modelBounds.getCenter().z,e=0;e<g.alloids.length;e++){var f=g.components[""+g.alloids[e]];if(f.isMesh){var h=f.position.x,i=f.position.y,j=f.position.z,k=new THREE.Vector3;k.setX(b+(1+2*a)*(h-b)/(1+2*g.modelExplosionCoefficient)),k.setY(c+(1+2*a)*(i-c)/(1+2*g.modelExplosionCoefficient)),k.setZ(d+(1+2*a)*(j-d)/(1+2*g.modelExplosionCoefficient)),f.position.set(k.x,k.y,k.z),k=null}}g.modelExplosionCoefficient=a},this.modelCutting=function(){var a=g.input,b={},c="",d=(g.modelBounds.getCenter().x,g.modelBounds.getCenter().y),e=g.modelBounds.getCenter().z,f=g.modelBounds.getSize().x/2+.1,h=g.modelBounds.getSize().y/2+.1,i=g.modelBounds.getSize().z/2+.1,j=g.modelBounds.getCenter().x,k=g.modelBounds.getCenter().y,l=g.modelBounds.getCenter().z,m=j,n=k,o=l,p=f,q=h,r=i;g.x=p,g.y=q,g.z=r;var s=m+p,t=m-p,u=o+r,v=o-r,w=n+q,x=n-q;if(g.Clip.cuttingfirst&&(g.cutting(f,h,i,j,k,l),g.Clip.cuttingfirst=!1),g.Flag.clip?(g.closeOrResetClips(!0),g.cameraControl.enabled=!0):g.Flag.clip=!0,g.Flag.clip){var y,z,A,B=0,C=0,D=!1;g.modelCutting._onMouseDown=function(b){if(!D){var c=g._getClickCoordsWithinElement(b);if(a.mouseDownLeft){y=c[0],z=c[1],g.Clip.currentClipPlane="";var d=g.pick(c[0],c[1],g.Clip.boundingBox.children);d.length>0&&(g.Clip.currentClipPlane=d[0].object.name),void 0!=g.Clip.clipFace[g.Clip.currentClipPlane]?(A=!0,g.cameraControl.enabled=!1):g.Clip.currentClipPlane=""}else A=!1,g.cameraControl.enabled=!0}},g.modelCutting._onMouseUp=function(a){A=!1,g.cameraControl.enabled=!0},g.modelCutting._onMouseOut=function(){A=!1,g.cameraControl.enabled=!0},g.modelCutting._onMouseMove=function(D){var E=g._getClickCoordsWithinElement(D);if(g.Flag.clip&&!A&&!a.mouseDownLeft){y=E[0],z=E[1],g.Clip.currentClipPlane="";var F=g.pick(E[0],E[1],g.Clip.boundingBox.children);F.length>0&&(g.Clip.currentClipPlane=F[0].object.name),void 0!=g.Clip.clipFace[g.Clip.currentClipPlane]?(""==c?(c=g.Clip.currentClipPlane,b=F[0].object,b.material.opacity=.3):F[0].object!=b&&(b.material.opacity=.15,c=g.Clip.currentClipPlane,b=F[0].object,b.material.opacity=.3),g.viewportDiv.style.cursor="pointer"):(b.isMesh&&(b.material.opacity=.3,b={}),c="",g.viewportDiv.style.cursor="auto")}if(A){a.cuttingFlag=!0,g.Clip.cuttingfirst=!1;var G=g.camera.position.clone(),H=g.cameraControl.target.clone(),I=G.distanceTo(H),J=I/5e3;"front"==g.Clip.currentClipPlane&&(Math.abs(G.x)>Math.abs(s)&&(B=G.y<d?(E[0]-y)*J:(y-E[0])*J,C=G.z>e?(E[1]-z)*J:(z-E[1])*J),y=E[0],z=E[1]),"back"==g.Clip.currentClipPlane&&(Math.abs(G.x)>Math.abs(t)&&(B=G.y>d?(E[0]-y)*J:(y-E[0])*J,C=G.z>e?(E[1]-z)*J:(z-E[1])*J),y=E[0],z=E[1]),"top"==g.Clip.currentClipPlane&&(Math.abs(G.z)<Math.abs(u)?(B=(E[0]-y)*J,C=(E[1]-z)*J):(B=(y-E[0])*J,C=(z-E[1])*J),y=E[0],z=E[1]),"bottom"==g.Clip.currentClipPlane&&(Math.abs(G.z)>Math.abs(v)?(B=(E[0]-y)*J,C=(E[1]-z)*J):(B=(y-E[0])*J,C=(z-E[1])*J),y=E[0],z=E[1]),"right"==g.Clip.currentClipPlane&&(Math.abs(G.y)>Math.abs(w)&&(B=G.x>0?(E[0]-y)*J:(y-E[0])*J,C=G.z>0?(E[1]-z)*J:(z-E[1])*J),y=E[0],z=E[1]),"left"==g.Clip.currentClipPlane&&(Math.abs(G.y)>Math.abs(x)&&(B=G.x<0?(E[0]-y)*J:(y-E[0])*J,C=G.z>0?(E[1]-z)*J:(z-E[1])*J),y=E[0],z=E[1]);var K=0;if(K=Math.abs(B)>=Math.abs(C)?B:C,p+=K*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].x),q+=K*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].y),r+=K*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].z),p<0)return void(p-=K*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].x));if(q<0)return void(q-=K*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].y));if(r<0)return void(r-=K*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].z));if(m-=K*-g.Clip.clipFace[g.Clip.currentClipPlane].x,n-=K*-g.Clip.clipFace[g.Clip.currentClipPlane].y,o-=K*-g.Clip.clipFace[g.Clip.currentClipPlane].z,parseFloat((p+m).toFixed(10))>parseFloat((j+f).toFixed(10))||parseFloat((m-p).toFixed(10))<parseFloat((j-f).toFixed(10)))return p-=K,void(m-=K*g.Clip.clipFace[g.Clip.currentClipPlane].x);if(parseFloat((q+n).toFixed(10))>parseFloat((k+h).toFixed(10))||parseFloat((n-q).toFixed(10))<parseFloat((k-h).toFixed(10)))return q-=K,void(n-=K*g.Clip.clipFace[g.Clip.currentClipPlane].y);if(parseFloat((r+o).toFixed(10))>parseFloat((l+i).toFixed(10))||parseFloat((o-r).toFixed(10))<parseFloat((l-i).toFixed(10)))return r-=K,void(o-=K*g.Clip.clipFace[g.Clip.currentClipPlane].z);if(p<0||q<0||r<0)return;s=m+p,t=m-p,u=o+r,v=o-r,w=n+q,x=n-q,g.cutting(p,q,r,m,n,o,J)}else a.cuttingFlag=!1},g.renderer.domElement.addEventListener("mouseout",g.modelCutting._onMouseOut,!1),g.renderer.domElement.addEventListener("mousedown",g.modelCutting._onMouseDown,!1),g.renderer.domElement.addEventListener("mouseup",g.modelCutting._onMouseUp,!1),g.renderer.domElement.addEventListener("mousemove",g.modelCutting._onMouseMove,!1),g.modelCutting._onTouchStart=function(a){D=!0;var d=[a.changedTouches[0].clientX,a.changedTouches[0].clientY];y=d[0],z=d[1],g.Clip.currentClipPlane="";var e=g.pick(d[0],d[1],g.Clip.boundingBox.children);e.length>0&&(g.Clip.currentClipPlane=e[0].object.name,A=!0,g.cameraControl.enabled=!1),void 0!=g.Clip.clipFace[g.Clip.currentClipPlane]?(""==c?(c=g.Clip.currentClipPlane,b=e[0].object,b.material.opacity=.3,console.log(e[0])):e[0].object!=b&&(b.material.opacity=.15,c=g.Clip.currentClipPlane,b=e[0].object,b.material.opacity=.3),g.viewportDiv.style.cursor="pointer"):(b.isMesh&&(b.material.opacity=.3,b={}),c="",g.viewportDiv.style.cursor="auto")},g.modelCutting._onTouchEnd=function(a){D=!1,A=!1,g.cameraControl.enabled=!0},g.modelCutting._onTouchMove=function(b){var c=[b.changedTouches[0].clientX,b.changedTouches[0].clientY];if(A){a.cuttingFlag=!0,g.Clip.cuttingfirst=!1;var D=g.camera.position.clone(),E=g.cameraControl.target.clone(),F=D.distanceTo(E),G=F/5e3;"front"==g.Clip.currentClipPlane&&(Math.abs(D.x)>Math.abs(s)&&(B=D.y<d?(c[0]-y)*G:(y-c[0])*G,C=D.z>e?(c[1]-z)*G:(z-c[1])*G),y=c[0],z=c[1]),"back"==g.Clip.currentClipPlane&&(Math.abs(D.x)>Math.abs(t)&&(B=D.y>d?(c[0]-y)*G:(y-c[0])*G,C=D.z>e?(c[1]-z)*G:(z-c[1])*G),y=c[0],z=c[1]),"top"==g.Clip.currentClipPlane&&(Math.abs(D.z)<Math.abs(u)?(B=(c[0]-y)*G,C=(c[1]-z)*G):(B=(y-c[0])*G,C=(z-c[1])*G),y=c[0],z=c[1]),"bottom"==g.Clip.currentClipPlane&&(Math.abs(D.z)>Math.abs(v)?(B=(c[0]-y)*G,C=(c[1]-z)*G):(B=(y-c[0])*G,C=(z-c[1])*G),y=c[0],z=c[1]),"right"==g.Clip.currentClipPlane&&(Math.abs(D.y)>Math.abs(w)&&(B=D.x>0?(c[0]-y)*G:(y-c[0])*G,C=D.z>0?(c[1]-z)*G:(z-c[1])*G),y=c[0],z=c[1]),"left"==g.Clip.currentClipPlane&&(Math.abs(D.y)>Math.abs(x)&&(B=D.x<0?(c[0]-y)*G:(y-c[0])*G,C=D.z>0?(c[1]-z)*G:(z-c[1])*G),y=c[0],z=c[1]);var H=0;if(H=Math.abs(B)>=Math.abs(C)?B:C,p+=H*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].x),q+=H*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].y),r+=H*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].z),p<0)return void(p-=H*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].x));if(q<0)return void(q-=H*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].y));if(r<0)return void(r-=H*Math.abs(g.Clip.clipFace[g.Clip.currentClipPlane].z));if(m-=H*-g.Clip.clipFace[g.Clip.currentClipPlane].x,n-=H*-g.Clip.clipFace[g.Clip.currentClipPlane].y,o-=H*-g.Clip.clipFace[g.Clip.currentClipPlane].z,parseFloat((p+m).toFixed(10))>parseFloat((j+f).toFixed(10))||parseFloat((m-p).toFixed(10))<parseFloat((j-f).toFixed(10)))return p-=H,m-=H*g.Clip.clipFace[g.Clip.currentClipPlane].x,void console.log("x:error");if(parseFloat((q+n).toFixed(10))>parseFloat((k+h).toFixed(10))||parseFloat((n-q).toFixed(10))<parseFloat((k-h).toFixed(10)))return q-=H,n-=H*g.Clip.clipFace[g.Clip.currentClipPlane].y,void console.log("y:error");if(parseFloat((r+o).toFixed(10))>parseFloat((l+i).toFixed(10))||parseFloat((o-r).toFixed(10))<parseFloat((l-i).toFixed(10)))return r-=H,o-=H*g.Clip.clipFace[g.Clip.currentClipPlane].z,void console.log("z:error");if(p<0||q<0||r<0)return void console.log("xyz:小于0");s=m+p,t=m-p,u=o+r,v=o-r,w=n+q,x=n-q,g.cutting(p,q,r,m,n,o,G)}else a.cuttingFlag=!1},g.renderer.domElement.addEventListener("touchstart",g.modelCutting._onTouchStart,!1),g.renderer.domElement.addEventListener("touchend",g.modelCutting._onTouchEnd,!1),g.renderer.domElement.addEventListener("touchmove",g.modelCutting._onTouchMove,!1)}else g.renderer.domElement.removeEventListener("mouseout",g.modelCutting._onMouseOut,!1),g.renderer.domElement.removeEventListener("mousedown",g.modelCutting._onMouseDown,!1),g.renderer.domElement.removeEventListener("mouseup",g.modelCutting._onMouseUp,!1),g.renderer.domElement.removeEventListener("mousemove",g.modelCutting._onMouseMove,!1),g.renderer.domElement.removeEventListener("touchstart",g.modelCutting._onTouchStart,!1),g.renderer.domElement.removeEventListener("touchend",g.modelCutting._onTouchEnd,!1),g.renderer.domElement.removeEventListener("touchmove",g.modelCutting._onTouchMove,!1)},this.cutting=function(a,b,c,d,e,f,h){g.scene.remove(g.Clip.boundingBox),g.Clip.boundingBox=new THREE.Object3D,void 0==h&&(h=.1),g.Clip.state.x=a,g.Clip.state.y=b,g.Clip.state.z=c,g.Clip.state.x1=d,g.Clip.state.y1=e,g.Clip.state.z1=f,g.Clip.state.sensitivity=h,g.Clip.cuttingfirst?(g.Clip.clipPlane[0].constant=h-(d-a),g.Clip.clipPlane[1].constant=h+(d+a),g.Clip.clipPlane[2].constant=h-(e-b),g.Clip.clipPlane[3].constant=h+(e+b),g.Clip.clipPlane[4].constant=h-(f-c),g.Clip.clipPlane[5].constant=h+(f+c),g.renderer.clippingPlanes=g.Clip.clipPlane):(g.Clip.clipPlane[0].constant=h-(d-a),g.Clip.clipPlane[1].constant=h+(d+a),g.Clip.clipPlane[2].constant=h-(e-b),g.Clip.clipPlane[3].constant=h+(e+b),g.Clip.clipPlane[4].constant=h-(f-c),g.Clip.clipPlane[5].constant=h+(f+c));var i=new THREE.BufferGeometry;i.setIndex([0,1,2,0,2,3]);var j=new Float32Array([a,b,c,a,-b,c,a,-b,-c,a,b,-c]);i.addAttribute("position",new THREE.BufferAttribute(j,3));var k=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));k.translateX(d).translateY(e).translateZ(f).name="front",g.Clip.boundingBox.add(k);var l=new THREE.BufferGeometry;l.setIndex([0,1,2,0,2,3]),j=new Float32Array([-a,b,c,-a,b,-c,-a,-b,-c,-a,-b,c]),l.addAttribute("position",new THREE.BufferAttribute(j,3));var m=new THREE.Mesh(l,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));m.translateX(d).translateY(e).translateZ(f).name="back",g.Clip.boundingBox.add(m);var n=new THREE.BufferGeometry;n.setIndex([0,1,2,0,2,3]),j=new Float32Array([a,b,c,a,b,-c,-a,b,-c,-a,b,c]),n.addAttribute("position",new THREE.BufferAttribute(j,3));var o=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));o.translateX(d).translateY(e).translateZ(f).name="right",g.Clip.boundingBox.add(o);var p=new THREE.BufferGeometry;p.setIndex([0,1,2,0,2,3]),j=new Float32Array([-a,-b,-c,a,-b,-c,a,-b,c,-a,-b,c]),p.addAttribute("position",new THREE.BufferAttribute(j,3));var q=new THREE.Mesh(p,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));q.translateX(d).translateY(e).translateZ(f).name="left",g.Clip.boundingBox.add(q);var r=new THREE.BufferGeometry;r.setIndex([0,1,2,0,2,3]),j=new Float32Array([a,b,c,-a,b,c,-a,-b,c,a,-b,c]),r.addAttribute("position",new THREE.BufferAttribute(j,3));var s=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));s.translateX(d).translateY(e).translateZ(f).name="top",g.Clip.boundingBox.add(s);var t=new THREE.BufferGeometry;t.setIndex([0,1,2,0,2,3]),j=new Float32Array([a,-b,-c,-a,-b,-c,-a,b,-c,a,b,-c]),t.addAttribute("position",new THREE.BufferAttribute(j,3));var u=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:"blue",opacity:.15,transparent:!0,side:THREE.DoubleSide}));u.translateX(d).translateY(e).translateZ(f).name="bottom",g.Clip.boundingBox.add(u),g.scene.add(g.Clip.boundingBox)},this.closeOrResetClips=function(a){if(g.Flag.clip)if(g.Clip.state={},void 0!=a&&a)void 0!=g.Clip.boundingBox&&(g.scene.remove(g.Clip.boundingBox),g.Flag.clip=!1,g.renderer.clippingPlanes=g.Clip.Empty,g.Clip.cuttingfirst=!0);else{var b=g.modelBounds.max.x/2+Math.abs(g.modelBounds.min.x/2)+.1,c=g.modelBounds.max.y/2+Math.abs(g.modelBounds.min.y/2)+.1,d=g.modelBounds.max.z/2+Math.abs(g.modelBounds.min.z/2)+.1,e=g.modelBounds.max.x/2-Math.abs(g.modelBounds.min.x/2),f=g.modelBounds.max.y/2-Math.abs(g.modelBounds.min.y/2),h=g.modelBounds.max.z/2-Math.abs(g.modelBounds.min.z/2);g.cutting(b,c,d,e,f,h)}},this.selecting=function(a,b,c,d,e,f,h){g.scene.remove(g.SelectBox.boundingBox),g.SelectBox.boundingBox=new THREE.Object3D;var i=new THREE.BufferGeometry;i.setIndex([0,1,2,0,2,3]);var j=new Float32Array([a,b,c,a,-b,c,a,-b,-c,a,b,-c]);i.addAttribute("position",new THREE.BufferAttribute(j,3));var k=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));k.translateX(d).translateY(e).translateZ(f).name="front",g.SelectBox.boundingBox.add(k);var l=new THREE.BufferGeometry;l.setIndex([0,1,2,0,2,3]),j=new Float32Array([-a,b,c,-a,b,-c,-a,-b,-c,-a,-b,c]),l.addAttribute("position",new THREE.BufferAttribute(j,3));var m=new THREE.Mesh(l,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));m.translateX(d).translateY(e).translateZ(f).name="back",g.SelectBox.boundingBox.add(m);var n=new THREE.BufferGeometry;n.setIndex([0,1,2,0,2,3]),j=new Float32Array([a,b,c,a,b,-c,-a,b,-c,-a,b,c]),n.addAttribute("position",new THREE.BufferAttribute(j,3));var o=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));o.translateX(d).translateY(e).translateZ(f).name="right",g.SelectBox.boundingBox.add(o);var p=new THREE.BufferGeometry;p.setIndex([0,1,2,0,2,3]),j=new Float32Array([-a,-b,-c,a,-b,-c,a,-b,c,-a,-b,c]),p.addAttribute("position",new THREE.BufferAttribute(j,3));var q=new THREE.Mesh(p,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));q.translateX(d).translateY(e).translateZ(f).name="left",g.SelectBox.boundingBox.add(q);var r=new THREE.BufferGeometry;r.setIndex([0,1,2,0,2,3]),j=new Float32Array([a,b,c,-a,b,c,-a,-b,c,a,-b,c]),r.addAttribute("position",new THREE.BufferAttribute(j,3));var s=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));s.translateX(d).translateY(e).translateZ(f).name="top",g.SelectBox.boundingBox.add(s);var t=new THREE.BufferGeometry;t.setIndex([0,1,2,0,2,3]),j=new Float32Array([a,-b,-c,-a,-b,-c,-a,b,-c,a,b,-c]),t.addAttribute("position",new THREE.BufferAttribute(j,3));var u=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:"red",opacity:.15,transparent:!0,side:THREE.DoubleSide}));u.translateX(d).translateY(e).translateZ(f).name="bottom",g.SelectBox.boundingBox.add(u),g.scene.add(g.SelectBox.boundingBox);var v=new THREE.Box3(new THREE.Vector3(-a+d,-b+e,-c+f),new THREE.Vector3(a+d,b+e,c+f));g.SelectBox.selectBox||(g.SelectBox.selectBox=v,g.SelectBox.selected=g.alloids,g.objectSet.addObjectIds(g.alloids));var w=null;g.objectSet.listener.on("updated",function(){g.SelectBox.selected.length!=g.objectSet.numObjects&&0==g.objectSet.numObjects&&g.Flag.selectBox&&(w=g.selectComponentByBox(g.SelectBox.selectBox,g.alloids),g.SelectBox.selected=w.selected,g.SelectBox.unselected=w.unselected,g.objectSet.addObjectIds(w.selected),g.transparentObjs(w.unselected,.4))}),g.SelectBox.selectBox.containsBox(v)?(w=g.selectComponentByBox(v,g.SelectBox.selected),g.SelectBox.unselected=g.SelectBox.unselected.concat(w.unselected),g.SelectBox.selected=w.selected,g.objectSet.removeObjectIds(w.unselected),g.transparentObjs(w.unselected,.4),w=null):(w=g.selectComponentByBox(v,g.SelectBox.unselected),g.SelectBox.selected=g.SelectBox.selected.concat(w.selected),g.SelectBox.unselected=w.unselected,g.closeTransparentObjs(w.selected),g.objectSet.addObjectIds(w.selected),g.transparentObjs(w.unselected,.4),w=null),g.SelectBox.selectBox=v,v=null},this.selectBoundingBox=function(){var a,b,c,d,e,f,h=g.input,i={},j="",k=g.modelBounds.getCenter().x,l=g.modelBounds.getCenter().y,m=g.modelBounds.getCenter().z,n=g.modelBounds.getSize().x/2+.1,o=g.modelBounds.getSize().y/2+.1,p=g.modelBounds.getSize().z/2+.1,q=g.modelBounds.getCenter().x,r=g.modelBounds.getCenter().y,s=g.modelBounds.getCenter().z;if(g.objectSet.numObjects>0){var t=g.objectSet.getBoundary();d=t.getSize().x/2+.1,e=t.getSize().y/2+.1,f=t.getSize().z/2+.1,a=t.getCenter().x,b=t.getCenter().y,c=t.getCenter().z,k=t.getCenter().x,l=t.getCenter().y,m=t.getCenter().z}else a=q,b=r,c=s,d=n,e=o,f=p;var u=a+d,v=a-d,w=c+f,x=c-f,y=b+e,z=b-e;if(g.Flag.selectBox?(g.Flag.selectBox=!1,g.objectSet.clear(),g.scene.remove(g.SelectBox.boundingBox),g.SelectBox.selectBox=void 0,g.closeTransparentObjs(g.SelectBox.unselected),g.SelectBox.selected=[],g.SelectBox.unselected=[],g.cameraControl.enabled=!0):(g.Flag.selectBox=!0,g.selecting(d,e,f,a,b,c)),g.Flag.selectBox){var A,B,C,D=0,E=0,F=!1;g.selectBoundingBox._onMouseDown=function(a){if(!F){var b=g._getClickCoordsWithinElement(a);if(h.mouseDownLeft){A=b[0],B=b[1],g.SelectBox.currentSelectPlane="";
var c=g.pick(b[0],b[1],g.SelectBox.boundingBox.children);c.length>0&&(g.SelectBox.currentSelectPlane=c[0].object.name),void 0!=g.SelectBox.selectFace[g.SelectBox.currentSelectPlane]?(C=!0,g.cameraControl.enabled=!1):g.SelectBox.currentSelectPlane=""}else C=!1,g.cameraControl.enabled=!0}},g.selectBoundingBox._onMouseUp=function(a){C=!1,g.cameraControl.enabled=!0},g.selectBoundingBox._onMouseOut=function(a){C=!1,g.cameraControl.enabled=!0},g.selectBoundingBox._onMouseMove=function(k){var t=g._getClickCoordsWithinElement(k);if(g.Flag.selectBox&&!C&&!h.mouseDownLeft){A=t[0],B=t[1],g.SelectBox.currentSelectPlane="";var F=g.pick(t[0],t[1],g.SelectBox.boundingBox.children);F.length>0&&(g.SelectBox.currentSelectPlane=F[0].object.name),void 0!=g.SelectBox.selectFace[g.SelectBox.currentSelectPlane]?(""==j?(j=g.SelectBox.currentSelectPlane,i=F[0].object,i.material.opacity=.3):F[0].object!=i&&(i.material.opacity=.15,j=g.SelectBox.currentSelectPlane,i=F[0].object,i.material.opacity=.3),g.viewportDiv.style.cursor="pointer"):(i.isMesh&&(i.material.opacity=.15,i={}),j="",g.viewportDiv.style.cursor="auto")}if(C){h.selectingFlag=!0,g.Clip.cuttingfirst=!1;var G=g.camera.position.clone(),H=g.cameraControl.target.clone(),I=G.distanceTo(H),J=I/5e3;"front"==g.SelectBox.currentSelectPlane&&(Math.abs(G.x)>Math.abs(u)&&(D=G.y<l?(t[0]-A)*J:(A-t[0])*J,E=G.z>m?(t[1]-B)*J:(B-t[1])*J),A=t[0],B=t[1]),"back"==g.SelectBox.currentSelectPlane&&(Math.abs(G.x)>Math.abs(v)&&(D=G.y>l?(t[0]-A)*J:(A-t[0])*J,E=G.z>m?(t[1]-B)*J:(B-t[1])*J),A=t[0],B=t[1]),"top"==g.SelectBox.currentSelectPlane&&(Math.abs(G.z)<Math.abs(w)?(D=(t[0]-A)*J,E=(t[1]-B)*J):(D=(A-t[0])*J,E=(B-t[1])*J),A=t[0],B=t[1]),"bottom"==g.SelectBox.currentSelectPlane&&(Math.abs(G.z)>Math.abs(x)?(D=(t[0]-A)*J,E=(t[1]-B)*J):(D=(A-t[0])*J,E=(B-t[1])*J),A=t[0],B=t[1]),"right"==g.SelectBox.currentSelectPlane&&(Math.abs(G.y)>Math.abs(y)&&(D=G.x>0?(t[0]-A)*J:(A-t[0])*J,E=G.z>0?(t[1]-B)*J:(B-t[1])*J),A=t[0],B=t[1]),"left"==g.SelectBox.currentSelectPlane&&(Math.abs(G.y)>Math.abs(z)&&(D=G.x<0?(t[0]-A)*J:(A-t[0])*J,E=G.z>0?(t[1]-B)*J:(B-t[1])*J),A=t[0],B=t[1]);var K=0;if(K=Math.abs(D)>=Math.abs(E)?D:E,d+=K*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].x),e+=K*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].y),f+=K*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].z),d<0)return void(d-=K*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].x));if(e<0)return void(e-=K*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].y));if(f<0)return void(f-=K*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].z));if(a-=K*-g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].x,b-=K*-g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].y,c-=K*-g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].z,parseFloat((d+a).toFixed(10))>parseFloat((q+n).toFixed(10))||parseFloat((a-d).toFixed(10))<parseFloat((q-n).toFixed(10)))return d-=K,void(a-=K*g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].x);if(parseFloat((e+b).toFixed(10))>parseFloat((r+o).toFixed(10))||parseFloat((b-e).toFixed(10))<parseFloat((r-o).toFixed(10)))return e-=K,void(b-=K*g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].y);if(parseFloat((f+c).toFixed(10))>parseFloat((s+p).toFixed(10))||parseFloat((c-f).toFixed(10))<parseFloat((s-p).toFixed(10)))return f-=K,void(c-=K*g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].z);if(d<0||e<0||f<0)return;u=a+d,v=a-d,w=c+f,x=c-f,y=b+e,z=b-e,g.selecting(d,e,f,a,b,c,J)}else h.selectingFlag=!1},g.renderer.domElement.addEventListener("mouseout",g.selectBoundingBox._onMouseOut,!1),g.renderer.domElement.addEventListener("mousedown",g.selectBoundingBox._onMouseDown,!1),g.renderer.domElement.addEventListener("mouseup",g.selectBoundingBox._onMouseUp,!1),g.renderer.domElement.addEventListener("mousemove",g.selectBoundingBox._onMouseMove,!1),g.selectBoundingBox._onTouchStart=function(a){F=!0;var b=[a.changedTouches[0].clientX,a.changedTouches[0].clientY];A=b[0],B=b[1],g.SelectBox.currentSelectPlane="";var c=g.pick(b[0],b[1],g.SelectBox.boundingBox.children);c.length>0&&(g.SelectBox.currentSelectPlane=c[0].object.name,C=!0,g.cameraControl.enabled=!1),void 0!=g.SelectBox.selectFace[g.SelectBox.currentSelectPlane]?(""==j?(j=g.SelectBox.currentSelectPlane,i=c[0].object,i.material.opacity=.3,console.log(c[0])):c[0].object!=i&&(i.material.opacity=.15,j=g.SelectBox.currentSelectPlane,i=c[0].object,i.material.opacity=.3),g.viewportDiv.style.cursor="pointer"):(i.isMesh&&(i.material.opacity=.15,i={}),j="",g.viewportDiv.style.cursor="auto")},g.selectBoundingBox._onTouchEnd=function(a){F=!1,C=!1,g.cameraControl.enabled=!0},g.selectBoundingBox._onTouchMove=function(i){var j=[i.changedTouches[0].clientX,i.changedTouches[0].clientY];if(C){h.selectingFlag=!0;var k=g.camera.position.clone(),t=g.cameraControl.target.clone(),F=k.distanceTo(t),G=F/5e3;"front"==g.SelectBox.currentSelectPlane&&(Math.abs(k.x)>Math.abs(u)&&(D=k.y<l?(j[0]-A)*G:(A-j[0])*G,E=k.z>m?(j[1]-B)*G:(B-j[1])*G),A=j[0],B=j[1]),"back"==g.SelectBox.currentSelectPlane&&(Math.abs(k.x)>Math.abs(v)&&(D=k.y>l?(j[0]-A)*G:(A-j[0])*G,E=k.z>m?(j[1]-B)*G:(B-j[1])*G),A=j[0],B=j[1]),"top"==g.SelectBox.currentSelectPlane&&(Math.abs(k.z)<Math.abs(w)?(D=(j[0]-A)*G,E=(j[1]-B)*G):(D=(A-j[0])*G,E=(B-j[1])*G),A=j[0],B=j[1]),"bottom"==g.SelectBox.currentSelectPlane&&(Math.abs(k.z)>Math.abs(x)?(D=(j[0]-A)*G,E=(j[1]-B)*G):(D=(A-j[0])*G,E=(B-j[1])*G),A=j[0],B=j[1]),"right"==g.SelectBox.currentSelectPlane&&(Math.abs(k.y)>Math.abs(y)&&(D=k.x>0?(j[0]-A)*G:(A-j[0])*G,E=k.z>0?(j[1]-B)*G:(B-j[1])*G),A=j[0],B=j[1]),"left"==g.SelectBox.currentSelectPlane&&(Math.abs(k.y)>Math.abs(z)&&(D=k.x<0?(j[0]-A)*G:(A-j[0])*G,E=k.z>0?(j[1]-B)*G:(B-j[1])*G),A=j[0],B=j[1]);var H=0;if(H=Math.abs(D)>=Math.abs(E)?D:E,d+=H*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].x),e+=H*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].y),f+=H*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].z),d<0)return void(d-=H*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].x));if(e<0)return void(e-=H*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].y));if(f<0)return void(f-=H*Math.abs(g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].z));if(a-=H*-g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].x,b-=H*-g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].y,c-=H*-g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].z,parseFloat((d+a).toFixed(10))>parseFloat((q+n).toFixed(10))||parseFloat((a-d).toFixed(10))<parseFloat((q-n).toFixed(10)))return d-=H,a-=H*g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].x,void console.log("x:error");if(parseFloat((e+b).toFixed(10))>parseFloat((r+o).toFixed(10))||parseFloat((b-e).toFixed(10))<parseFloat((r-o).toFixed(10)))return e-=H,b-=H*g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].y,void console.log("y:error");if(parseFloat((f+c).toFixed(10))>parseFloat((s+p).toFixed(10))||parseFloat((c-f).toFixed(10))<parseFloat((s-p).toFixed(10)))return f-=H,c-=H*g.SelectBox.selectFace[g.SelectBox.currentSelectPlane].z,void console.log("z:error");if(d<0||e<0||f<0)return void console.log("xyz:小于0");u=a+d,v=a-d,w=c+f,x=c-f,y=b+e,z=b-e,g.selecting(d,e,f,a,b,c,G)}else h.selectingFlag=!1},g.renderer.domElement.addEventListener("touchstart",g.selectBoundingBox._onTouchStart,!1),g.renderer.domElement.addEventListener("touchend",g.selectBoundingBox._onTouchEnd,!1),g.renderer.domElement.addEventListener("touchmove",g.selectBoundingBox._onTouchMove,!1)}else g.renderer.domElement.removeEventListener("mouseout",g.selectBoundingBox._onMouseDown,!1),g.renderer.domElement.removeEventListener("mousedown",g.selectBoundingBox._onMouseDown,!1),g.renderer.domElement.removeEventListener("mouseup",g.selectBoundingBox._onMouseUp,!1),g.renderer.domElement.removeEventListener("mousemove",g.selectBoundingBox._onMouseMove,!1),g.renderer.domElement.removeEventListener("touchstart",g.selectBoundingBox._onTouchStart,!1),g.renderer.domElement.removeEventListener("touchend",g.selectBoundingBox._onTouchEnd,!1),g.renderer.domElement.removeEventListener("touchmove",g.selectBoundingBox._onTouchMove,!1)},this.selectComponentByBox=function(a,b){var c=[],d=[],e=.1;if(!a instanceof THREE.Box3)return void g.promptingMessage("warning","参数需要为 THREE.Box3 对象",!1);b||(b=g.alloids);for(var f=0;f<b.length;f++)if(g.components[b[f]]&&g.components[b[f]].visible){var h=(new THREE.Box3).expandByObject(g.components[b[f]]);a.min.x-e<=h.min.x&&h.max.x<=a.max.x+e&&a.min.y-e<=h.min.y&&h.max.y<=a.max.y+e&&a.min.z-e<=h.min.z&&h.max.z<=a.max.z+e?c.push(b[f]):d.push(b[f]),h=null}return{selected:c,unselected:d}},this.getObjectByProperty=function(a,b,c,d){for(var e=0,f=c.children.length;e<f;e++){var h=c.children[e];if(h[a]===b)return h;if(d){var i=g.getObjectByProperty(a,b,h,!0);if(void 0!==i)return i}}},this.queryObjectIdByType=function(a){for(var b=[],c=0;c<g.root.children.length;c++)g.root.children[c].userData.type==a&&b.push(g.root.children[c].key);return b},this.queryResultByString=function(a,b,c){var d=Object.getOwnPropertyNames(g.components).length,e=0,f=!1,h=new RegExp(a,"ig");if("string"==typeof a)if("app"==g.type)for(var i in g.components){var j={};g.componentInfo[i].name.search(h)>=0||g.componentInfo[i].type.search(h)>=0||g.componentInfo[i].guid.search(h)>=0?g.getComponentAttribute(i,function(a){e++,a&&(j=$.extend({},a)),j.name=g.componentInfo["component/"+i].name,j.ifcType=g.componentInfo["component/"+i].type,j.guid=g.componentInfo["component/"+i].guid,j.id=i,j["其他"]&&j["其他"]["类型"]&&(j["类型"]=j["其他"]["类型"]),f=!0,b(j),e>=d&&c()}):g.getComponentAttribute(i,function(a){e++,a&&JSON.stringify(a).search(h)>=0&&(j=jQuery.extend({},a),j.name=g.componentInfo["component/"+i].name,j.ifcType=g.componentInfo["component/"+i].type,j.guid=g.componentInfo["component/"+i].guid,j.id=i,j["其他"]&&(j["其他"]["构件名称"]&&(j["构件名称"]=j["其他"]["构件名称"]),j["其他"]["类型"]&&(j["类型"]=j["其他"]["类型"])),f=!0,b(j)),e>=d&&c()})}else for(var i in g.components){var j={};g.componentInfo["component/"+i].name.search(h)>=0||g.componentInfo["component/"+i].type.search(h)>=0||g.componentInfo["component/"+i].guid.search(h)>=0?g.getComponentAttribute(i,function(a){e++,a&&(j=jQuery.extend({},a)),j.name=g.componentInfo["component/"+i].name,j.ifcType=g.componentInfo["component/"+i].type,j.guid=g.componentInfo["component/"+i].guid,j.id=i,j["其他"]&&j["其他"]["类型"]&&(j["类型"]=j["其他"]["类型"]),f=!0,b(j),e>=d&&c()}):g.getComponentAttribute(i,function(a){e++,a&&JSON.stringify(a).search(h)>=0&&(j=jQuery.extend({},a),j.name=g.componentInfo["component/"+i].name,j.ifcType=g.componentInfo["component/"+i].type,j.guid=g.componentInfo["component/"+i].guid,j.id=i,j["其他"]&&(j["其他"]["构件名称"]&&(j["构件名称"]=j["其他"]["构件名称"]),j["其他"]["类型"]&&(j["类型"]=j["其他"]["类型"])),f=!0,b(j)),e>=d&&c()})}},this.getComponentTypeArray=function(){for(var a in g.componentType)g.componentType[a]=e(g.componentType[a]);return g.componentType},this.resize=function(a,b){var c=800,d=800,e="#"+g.viewport;a&&b?($(e).height(a).width(b),g.camera.aspect=b/a,g.camera.updateProjectionMatrix(),g.renderer.setSize(b,a)):g.autoResize&&(d=$(window).height(),c=$(window).width(),$(e).height(d).width(c),g.camera.aspect=c/d,g.camera.updateProjectionMatrix(),g.renderer.setSize(c,d-3))};var s,t;this.measuredDistance=function(a){var b=g.input;if(g.Flag.measuredDistance?(g.Flag.measuredDistance=!1,g.ClickSelectObjects.enabled=!0,g.scene.remove(g.Measurement.measuredNode),g.scene.remove(g.Measurement.mark),g.Measurement={measuredNode:{},tempLine:new THREE.Object3D,tempPoint:new THREE.Object3D,point1:{},point2:{},pointCoord1:{},pointCorrd2:{},line:{},mark1:{},mark2:{},markX:{},markY:{},markZ:{},lineX:{},lineY:{},lineZ:{}},s&&(s.remove(),s=null),t&&(t.remove(),t=null)):(g.ClickSelectObjects.enabled=!1,g.Flag.measuredDistance=!0),b.theMeasuredDistance=g.Flag.measuredDistance,g.Flag.measuredDistance){s=g.promptingMessage("info","请选择第一个点",!1);var c,d,e=.1,f=!1,h=!0,i=!1,j=!1,k=new THREE.SphereBufferGeometry(1);g.Measurement.measuredNode=new THREE.Object3D,g.scene.add(g.Measurement.measuredNode);var l=new THREE.TextureLoader,m=l.load(g.imgURL+"measuredDistance/1.png"),n=l.load(g.imgURL+"measuredDistance/2.png"),o=l.load(g.imgURL+"measuredDistance/X.png"),p=l.load(g.imgURL+"measuredDistance/Y.png"),q=l.load(g.imgURL+"measuredDistance/Z.png"),r=new THREE.SpriteMaterial({map:m,color:16777215,depthTest:!1}),u=new THREE.SpriteMaterial({map:n,color:16777215,depthTest:!1}),v=new THREE.SpriteMaterial({map:o,color:16777215,depthTest:!1}),w=new THREE.SpriteMaterial({map:p,color:16777215,depthTest:!1}),x=new THREE.SpriteMaterial({map:q,color:16777215,depthTest:!1});g.measuredDistance._onTick=g.listener.on("tick",function(){if(g.camera&&g.Flag.measuredDistance){var a=g.camera.position.clone(),b=g.cameraControl.target.clone(),c=a.distanceTo(b);e=c/350,$.isEmptyObject(g.Measurement.point1)||g.Measurement.point1.scale.set(c/200,c/200,c/200),$.isEmptyObject(g.Measurement.point2)||g.Measurement.point2.scale.set(c/200,c/200,c/200),$.isEmptyObject(g.Measurement.mark1)||g.Measurement.mark1.scale.set(c/30,c/30,1),$.isEmptyObject(g.Measurement.mark2)||g.Measurement.mark2.scale.set(c/30,c/30,1),$.isEmptyObject(g.Measurement.markX)||g.Measurement.markX.scale.set(c/30,c/30,1),$.isEmptyObject(g.Measurement.markY)||g.Measurement.markY.scale.set(c/30,c/30,1),$.isEmptyObject(g.Measurement.markZ)||g.Measurement.markZ.scale.set(c/30,c/30,1),a=null,b=null,c=null}}),g.measuredDistance._onMouseDown=function(a){var b=g._getClickCoordsWithinElement(a);c=b[0],d=b[1];var e=g.pick(b[0],b[1],g.root.children);e.length>0&&(f=!0)},g.measuredDistance._onMouseMove=function(a){var b=g._getClickCoordsWithinElement(a);if((d!=b[1]||c!=b[0])&&!f){c=b[0],d=b[1];var e,j=g.pick(b[0],b[1],g.root.children);if(j.length>0)if(e=j[0].point,h){g.Measurement.measuredNode.remove(g.Measurement.point1);var l=new THREE.MeshBasicMaterial({color:415753,depthTest:!1});g.Measurement.point1=new THREE.Mesh(k,l),g.Measurement.point1.position.copy(e),g.Measurement.measuredNode.add(g.Measurement.point1)}else if(!i){g.Measurement.measuredNode.remove(g.Measurement.point2),g.Measurement.measuredNode.remove(g.Measurement.line);var m=new THREE.MeshBasicMaterial({color:new THREE.Color(.24,.52,.77),depthTest:!1});g.Measurement.point2=new THREE.Mesh(k,m),g.Measurement.point2.position.copy(e),g.Measurement.measuredNode.add(g.Measurement.point2);var n=new THREE.LineBasicMaterial({color:16776960,linewidth:1e3,depthTest:!1}),o=new THREE.Geometry;o.vertices.push(g.Measurement.pointCoord1,e),g.Measurement.line=new THREE.Line(o,n),g.Measurement.measuredNode.add(g.Measurement.line)}}},g.measuredDistance._onMouseUp=function(b){var e=g._getClickCoordsWithinElement(b);if(f&&(f=!1,(e[0]>c?e[0]-c<5:c-e[0]<5)&&(e[1]>d?e[1]-d<5:d-e[1]<5)))if(h)g.Measurement.point1.material.color.setRGB(.24,.52,.77),g.Measurement.pointCoord1=g.Measurement.point1.position.clone(),h=!1,g.Measurement.mark1=new THREE.Sprite(r),g.Measurement.mark1.position.copy(g.Measurement.pointCoord1),g.Measurement.measuredNode.add(g.Measurement.mark1),s&&(s.remove(),s=null),t=g.promptingMessage("info","请选择第二个点",!1),a({state:"first",result:g.Measurement.pointCoord1.clone()});else{i=!0,g.Measurement.mark2=new THREE.Sprite(u),g.Measurement.mark2.position.copy(g.Measurement.point2.position),g.Measurement.measuredNode.add(g.Measurement.mark2);var j=new THREE.Vector3(g.Measurement.point2.position.x,g.Measurement.point1.position.y,g.Measurement.point1.position.z),k=new THREE.Vector3(g.Measurement.point2.position.x,g.Measurement.point1.position.y,g.Measurement.point2.position.z),l=new THREE.LineBasicMaterial({color:16711680,linewidth:1e3,depthTest:!1}),m=new THREE.LineBasicMaterial({color:65280,linewidth:1e3,depthTest:!1}),n=new THREE.LineBasicMaterial({color:255,linewidth:1e3,depthTest:!1}),o=new THREE.Geometry,p=new THREE.Geometry,q=new THREE.Geometry;o.vertices.push(g.Measurement.point1.position,j),q.vertices.push(j,k),p.vertices.push(k,g.Measurement.point2.position),g.Measurement.lineX=new THREE.Line(o,l),g.Measurement.lineY=new THREE.Line(p,m),g.Measurement.lineZ=new THREE.Line(q,n),g.Measurement.measuredNode.add(g.Measurement.lineX),g.Measurement.measuredNode.add(g.Measurement.lineY),g.Measurement.measuredNode.add(g.Measurement.lineZ),g.Measurement.markX=new THREE.Sprite(v),g.Measurement.markX.position.set((g.Measurement.point1.position.x+g.Measurement.point2.position.x)/2,g.Measurement.point1.position.y,g.Measurement.point1.position.z),g.Measurement.measuredNode.add(g.Measurement.markX),g.Measurement.markY=new THREE.Sprite(w),g.Measurement.markY.position.set(g.Measurement.point2.position.x,(g.Measurement.point1.position.y+g.Measurement.point2.position.y)/2,g.Measurement.point2.position.z),g.Measurement.measuredNode.add(g.Measurement.markY),g.Measurement.markZ=new THREE.Sprite(x),g.Measurement.markZ.position.set(g.Measurement.point2.position.x,g.Measurement.point1.position.y,(g.Measurement.point1.position.z+g.Measurement.point2.position.z)/2),g.Measurement.measuredNode.add(g.Measurement.markZ),t&&(t.remove(),t=null),a({state:"second",result:g.Measurement.point2.position.clone()})}},g.measuredDistance._onTouchStart=function(a){var b=[a.changedTouches[0].clientX,a.changedTouches[0].clientY];c=b[0],d=b[1];var e=g.pick(b[0],b[1],g.root.children);e.length>0&&(j=!0)},g.measuredDistance._onTouchEnd=function(b){j=!1;var e=[b.changedTouches[0].clientX,b.changedTouches[0].clientY];if((e[0]>c?e[0]-c<5:c-e[0]<5)&&(e[1]>d?e[1]-d<5:d-e[1]<5)){c=e[0],d=e[1];var f,l=g.pick(e[0],e[1],g.root.children);if(l.length>0)if(f=l[0].point,h){g.Measurement.measuredNode.remove(g.Measurement.point1);var m=new THREE.MeshBasicMaterial({color:new THREE.Color(.24,.52,.77),depthTest:!1});g.Measurement.point1=new THREE.Mesh(k,m),g.Measurement.point1.position.copy(f),g.Measurement.pointCoord1=g.Measurement.point1.position.clone(),h=!1,g.Measurement.mark1=new THREE.Sprite(r),g.Measurement.mark1.position.copy(g.Measurement.pointCoord1),g.Measurement.measuredNode.add(g.Measurement.mark1),g.Measurement.measuredNode.add(g.Measurement.point1),s&&s.remove(),t=g.promptingMessage("info","请选择第二个点",!1),a({state:"first",result:g.Measurement.pointCoord1.clone()})}else if(!i){i=!0,g.Measurement.measuredNode.remove(g.Measurement.point2),g.Measurement.measuredNode.remove(g.Measurement.line);var n=new THREE.MeshBasicMaterial({color:new THREE.Color(.24,.52,.77),depthTest:!1});g.Measurement.point2=new THREE.Mesh(k,n),g.Measurement.point2.position.copy(f),g.Measurement.measuredNode.add(g.Measurement.point2);var o=new THREE.LineBasicMaterial({color:16776960,linewidth:1e3,depthTest:!1}),p=new THREE.Geometry;p.vertices.push(g.Measurement.pointCoord1,f),g.Measurement.line=new THREE.Line(p,o),g.Measurement.measuredNode.add(g.Measurement.line),i=!0,g.Measurement.mark2=new THREE.Sprite(u),g.Measurement.mark2.position.copy(g.Measurement.point2.position),g.Measurement.measuredNode.add(g.Measurement.mark2);var q=new THREE.Vector3(g.Measurement.point2.position.x,g.Measurement.point1.position.y,g.Measurement.point1.position.z),y=new THREE.Vector3(g.Measurement.point2.position.x,g.Measurement.point1.position.y,g.Measurement.point2.position.z),z=new THREE.LineBasicMaterial({color:16711680,linewidth:1e3,depthTest:!1}),A=new THREE.LineBasicMaterial({color:65280,linewidth:1e3,depthTest:!1}),B=new THREE.LineBasicMaterial({color:255,linewidth:1e3,depthTest:!1}),C=new THREE.Geometry,D=new THREE.Geometry,E=new THREE.Geometry;C.vertices.push(g.Measurement.point1.position,q),E.vertices.push(q,y),D.vertices.push(y,g.Measurement.point2.position),g.Measurement.lineX=new THREE.Line(C,z),g.Measurement.lineY=new THREE.Line(D,A),g.Measurement.lineZ=new THREE.Line(E,B),g.Measurement.measuredNode.add(g.Measurement.lineX),g.Measurement.measuredNode.add(g.Measurement.lineY),g.Measurement.measuredNode.add(g.Measurement.lineZ),g.Measurement.markX=new THREE.Sprite(v),g.Measurement.markX.position.set((g.Measurement.point1.position.x+g.Measurement.point2.position.x)/2,g.Measurement.point1.position.y,g.Measurement.point1.position.z),g.Measurement.measuredNode.add(g.Measurement.markX),g.Measurement.markY=new THREE.Sprite(w),g.Measurement.markY.position.set(g.Measurement.point2.position.x,(g.Measurement.point1.position.y+g.Measurement.point2.position.y)/2,g.Measurement.point2.position.z),g.Measurement.measuredNode.add(g.Measurement.markY),g.Measurement.markZ=new THREE.Sprite(x),g.Measurement.markZ.position.set(g.Measurement.point2.position.x,g.Measurement.point1.position.y,(g.Measurement.point1.position.z+g.Measurement.point2.position.z)/2),g.Measurement.measuredNode.add(g.Measurement.markZ),t&&t.remove(),a({state:"second",result:g.Measurement.point2.position.clone()})}}},g.renderer.domElement.addEventListener("mousedown",g.measuredDistance._onMouseDown,!1),g.renderer.domElement.addEventListener("mouseup",g.measuredDistance._onMouseUp,!1),g.renderer.domElement.addEventListener("mousemove",g.measuredDistance._onMouseMove,!1),g.renderer.domElement.addEventListener("touchstart",g.measuredDistance._onTouchStart,!1),g.renderer.domElement.addEventListener("touchend",g.measuredDistance._onTouchEnd,!1)}else g.listener.off(g.measuredDistance._onTick),g.renderer.domElement.removeEventListener("mousedown",g.measuredDistance._onMouseDown,!1),g.renderer.domElement.removeEventListener("mouseup",g.measuredDistance._onMouseUp,!1),g.renderer.domElement.removeEventListener("mousemove",g.measuredDistance._onMouseMove,!1),g.renderer.domElement.removeEventListener("touchstart",g.measuredDistance._onTouchStart,!1),g.renderer.domElement.removeEventListener("touchend",g.measuredDistance._onTouchEnd,!1)},$(window).on("resize",g.resize),$(document).ready(function(){$(document).trigger("click")}),this.theFirstPerspective=function(){function a(a,c){if(g.camera&&a&&a.isVector3){g.cameraControl.dispose();var d=new BIMWINNER.FirstPersonControls(g.camera,g.renderer.domElement,g);d.target.copy(g.cameraControl.target),g.cameraControl=d,g.camera.position.copy(a),g.camera.zoom=.5,a=null,g.cameraControl.movementSpeed=50,g.cameraControl.lookSpeed=.125,g.cameraControl.lookVertical=!0,g.cameraControl.constrainVertical=!0,c&&c.remove(),g.ClickSelectObjects.enabled=!0,g.listener.off(g.theFirstPerspective._onTick),b.listener.off(g.theFirstPerspective._onMouseDown),b.listener.off(g.theFirstPerspective._onMouseUp),b.listener.off(g.theFirstPerspective._onTouchStart),b.listener.off(g.theFirstPerspective._onTouchEnd)}}var b=g.input,c=!1;return function(d){if(c){c=!1,g.cameraControl.dispose();var e=m;e.target.copy(g.cameraControl.target),g.cameraControl=e,g.cameraControl.activeEventListener()}else c=!0;if(c)if(d){if(d.isVector3)a(d);else if($.isArray(d)){var h=new THREE.Vector3(d[0],d[1],d[2]);a(h)}}else{var i=0,j=0,k=f.notify("info",{size:"mini",rounded:!0,position:"center top",sound:!1,delay:!1,msg:"请用鼠标点击选择漫游起点"});g.ClickSelectObjects.enabled=!1,g.theFirstPerspective._onMouseDown=b.listener.on("mousedown",function(a){i=a[0],j=a[1]}),g.theFirstPerspective._onMouseUp=b.listener.on("mouseup",function(b){if((b[0]>i?b[0]-i<5:i-b[0]<5)&&(b[1]>j?b[1]-j<5:j-b[1]<5)){i=b[0],j=b[1];var c=g.pick(b[0],b[1],g.root.children);c.length>0&&a(c[0].point,k)}}),g.theFirstPerspective._onTouchStart=b.listener.on("touchstart",function(a){i=a[0],j=a[1]}),g.theFirstPerspective._onTouchEnd=b.listener.on("touchend",function(b){if((b[0]>i?b[0]-i<5:i-b[0]<5)&&(b[1]>j?b[1]-j<5:j-b[1]<5)){i=b[0],j=b[1];var c=g.pick(b[0],b[1],g.root.children);c.length>0&&a(c[0].point,k)}})}}}(),this.pick=function(a,b,c){var d=new THREE.Raycaster,e=new THREE.Vector3(a/g.renderer.domElement.clientWidth*2-1,2*-(b/g.renderer.domElement.clientHeight)+1,.5);d.setFromCamera(e,g.camera);var f=d.intersectObjects(c);return d=null,e=null,f},this._getClickCoordsWithinElement=function(a){var b=[0,0];if(a){for(var c=a.target,d=0,e=0;c.offsetParent;)d+=c.offsetLeft,e+=c.offsetTop,c=c.offsetParent;b[0]=a.pageX-d,b[1]=a.pageY-e}else a=window.event,b.x=a.x,b.y=a.y;return b},this.get2DCoordFrom3DCoord=function(a){var b,c=[];if(a.isVector3)return b=a.distanceTo(g.camera.position),a.project(g.camera),c[0]=(a.x+1)*g.renderer.domElement.clientWidth/2,c[1]=(1-a.y)*g.renderer.domElement.clientHeight/2,c[2]=b,c;if($.isArray(a)){var d=new THREE.Vector3(a[0],a[1],a[2]);return b=d.distanceTo(g.camera.position),d.project(g.camera),c[0]=(d.x+1)*g.renderer.domElement.clientWidth/2,c[1]=(1-d.y)*g.renderer.domElement.clientHeight/2,c[2]=b,d=null,c}},this.setSceneBackGroundColor=function(a){g.scene.background=new THREE.Color(a[0],a[1],a[2])},this.getModelPhoto=function(){return{imgURL:g.renderer.domElement.toDataURL("image/png"),height:$(g.renderer.domElement).height(),width:$(g.renderer.domElement).width()}},this.setSceneBackGroundImage=function(a){var b=new THREE.TextureLoader;b.load(a,function(a){g.scene.background=a})},this.adaptiveSize=function(a){var b=void 0;if(a){for(var c=!0,d=0;d<a.length;d++)if(g.components[a[d]].visible){var e=(new THREE.Box3).expandByObject(g.components[a[d]]);c?(b=e.clone(),c=!1):b.union(e),e=null}}else b=$.isEmptyObject(g.objectSet.objects)?g.modelBounds:g.objectSet.getBoundary();if(b.isBox3){var f=b.getCenter(),h=(new THREE.Vector3).copy(g.cameraControl.target).sub(f),i=new THREE.Vector3(b.max.x+b.getSize().x,b.max.y+b.getSize().y,b.max.z+b.getSize().z),j=i.sub(f),k=(new THREE.Vector3).copy(g.camera.position).sub(h),l=k.sub(f).setLength(j.length()).add(f);g.fly.flyTo({eye:l,look:f})}},$(g.viewportDiv).attr("tabindex",1).keyup(function(a){var b;"INPUT"!==a.target.tagName&&"TEXTAREA"!==a.target.tagName&&("h"==a.key&&(b=g.arrayConversion(),g.hideObjs(b)),"i"==a.key&&(b=g.arrayConversion(),g.isolationObjs(b)),"t"==a.key&&(b=g.arrayConversion(),g.transparentObjs(b)),"l"==a.key&&(b=g.arrayConversion(),g.wireframeObjs(b)),"g"==a.key&&(b=g.arrayConversion(),g.highlightObjs(b)),a.ctrlKey||(g.multiSelect=!1),"Escape"==a.key&&g.listener.fire("esc",!0,!0),"Delete"==a.key&&g.listener.fire("delete",!0,!0))}),$(g.viewportDiv).attr("tabindex",1).keydown(function(a){"INPUT"!==a.target.tagName&&"TEXTAREA"!==a.target.tagName&&a.ctrlKey&&(g.multiSelect=!0)}),this.jishu=function(){for(var a=0,b=0,c=0,d=0,e=g.root.children.length;d<e;d++){var f=g.root.children[d];f.traverseVisible(function(d){if(a++,d instanceof THREE.Mesh){var e=d.geometry;e instanceof THREE.Geometry?(b+=e.vertices.length,c+=e.faces.length):e instanceof THREE.BufferGeometry&&(null!==e.index?(b+=3*e.index.count,c+=e.index.count):(b+=e.attributes.position.count,c+=e.attributes.position.count/3))}})}console.log("objects: "+a+"  vertices: "+b+"  triangles:"+c)}},BIMWINNER.Mark=function(a){function b(a){var b=g(a);k.x=i=b[0],k.y=j=b[1]}function c(a){var b=g(a);(b[0]>i?b[0]-i<5:i-b[0]<5)&&(b[1]>j?b[1]-j<5:j-b[1]<5)&&(k.x=i=b[0],k.y=j=b[1],f("pick"))}function d(a){k.x=i=a.changedTouches[0].clientX,k.y=j=a.changedTouches[0].clientY}function e(a){(a.changedTouches[0].clientX>i?a.changedTouches[0].clientX-i<5:i-a.changedTouches[0].clientX<5)&&(a.changedTouches[0].clientY>j?a.changedTouches[0].clientY-j<5:j-a.changedTouches[0].clientY<5)&&(k.x=i=a.changedTouches[0].clientX,k.y=j=a.changedTouches[0].clientY,f("pick"))}function f(b){var c=new THREE.Vector3(k.x/a.renderer.domElement.clientWidth*2-1,2*-(k.y/a.renderer.domElement.clientHeight)+1,.5);h.raycaster.setFromCamera(c,a.camera);var d=h.raycaster.intersectObjects(h.Marks.children);d.length>0&&h.SelectedMark!=d[0].object?(h.SelectedMark=d[0].object,h.markListener.fire("updated",{added:{objects:h.SelectedMark}})):(h.SelectedMark={},h.markListener.fire("updated",{removed:{objects:h.SelectedMark}}))}function g(a){var b=[0,0];if(a){for(var c=a.target,d=0,e=0;c.offsetParent;)d+=c.offsetLeft,e+=c.offsetTop,c=c.offsetParent;b[0]=a.pageX-d,b[1]=a.pageY-e}else a=window.event,b.x=a.x,b.y=a.y;return b}var h=this;this.Marks=new THREE.Object3D,a.scene.add(h.Marks),this.SelectedMark={};var i,j,k=new THREE.Vector2;this.raycaster=new THREE.Raycaster,this.active=!0,h.raycaster.setFromCamera(k,a.camera),h.domElement=a.renderer.domElement,this.enabled=function(){this.mousedown=a.renderer.domElement.addEventListener("mousedown",b,!1),this.mouseup=a.renderer.domElement.addEventListener("mouseup",c,!1)},this.disabled=function(){this.mousedown=a.renderer.domElement.removeEventListener("mousedown",b,!1),this.mouseup=a.renderer.domElement.removeEventListener("mouseup",c,!1)},this.touchEnabled=function(){this.touchstart=a.renderer.domElement.addEventListener("touchstart",d,!1),this.touchend=a.renderer.domElement.addEventListener("touchend",e,!1)},this.touchDisabled=function(){this.touchstart=a.renderer.domElement.removeEventListener("touchstart",d,!1),this.touchend=a.renderer.domElement.removeEventListener("touchend",e,!1)},this.enabled(),this.components={},this.markListener=new BIMWINNER.Listener,this.add=function(b){var c=1,d=1,e=1;b.scale&&(e=b.scale);var f=new THREE.TextureLoader;f.load(b.url,function(a){var f=new THREE.SpriteMaterial({map:a,color:16777215,depthTest:!1});"number"==typeof b.width?c=b.width:f.map&&f.map.image&&f.map.image.width&&(c=f.map.image.width),"number"==typeof b.height?d=b.height:f.map&&f.map.image&&f.map.image.width&&(d=f.map.image.height);var g=new THREE.Sprite(f);return g.scale.set(e*c,e*d,1),b.location.isVector3?g.position.copy(location):g.position.set(b.location[0],b.location[1],b.location[2]),h.Marks.add(g),b.id?(g.key=b.id,void(h.components[b.id]=g)):(h.components[g.uuid]=g,g.uuid)},function(){},function(b){a.promptingMessage.show("warning","加载材质出错")})},this.remove=function(b){if(void 0==b||null==b)return void a.promptingMessage.show("warning","未选中mark");for(var c=null,d=0;d<b.length;d++)c=h.components[""+b[d]],h.Marks.remove(c)},this.hide=function(b){if(void 0==b||null==b)return void a.promptingMessage.show("warning","未选中mark");for(var c=null,d=0;d<b.length;d++)c=h.components[""+b[d]],c&&(c.visible=!1)},this.show=function(a){var b=h.components.concat(),c=null;if(a)for(var d=0;d<a.length;d++)c=h.components[""+a[d]],c&&(c.visible=!0);else for(var e=0;e<h.components.length;e++)c=h.components[""+b[e]],c&&(c.visible=!0)},this.isolation=function(b){if(void 0==b||null==b)return void a.promptingMessage.show("warning","未选中mark");if(h.show(),!(h.components.length<=0)){for(var c=h.components.concat(),d=0;d<b.length;d++)for(var e=b[d],f=0;f<c.length;f++)if(e==c[f]){c.splice(f,1);break}for(var g=null,f=0;f<c.length;f++)g=h.components[""+c[f]],g&&(g.visible=!1)}},this.resize=function(b,c,d){if(void 0==b||null==b)return void a.promptingMessage.show("warning","未选中mark");if(!c||!d)return void a.promptingMessage.show("warning","未指定尺寸");for(var e=null,f=0;f<b.length;f++)e=h.components[""+b[f]],e&&e.scale.set(c,d,1)},this.listentoSelectMarks=function(a){h.markListener.on("updated",function(){$.isEmptyObject(h.SelectedMark)?a(null,null):h.SelectedMark.key?a(h.SelectedMark.key,h.SelectedMark):a(h.SelectedMark.uuid,h.SelectedMark)})}},BIMWINNER.Tool=function(a,b){function c(a){for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);d>=1&&d<=126||65376<=d&&d<=65439?b++:b+=2}return b}var d,e=this,f=a.Lobibox,g=a.uuid,h={roam:!1,sectioning:!1,multiple:!1,fullScreen:!1,attribute:!1,search:!1,measurement:!1,modelTree:!1,treeDataLoad:!1},i={home:!0,fit:!0,restore:!0,roam:!0,multiple:!0,transparent:!0,hide:!0,isolation:!0,sectioning:!0,modelPartition:!0,wireframe:!0,color:!0,setting:!0,modelTree:!0,attribute:!0,search:!0,measurement:!0},j="",k=0;this.className="BIMWINNER.Tool";this.snapshotsPlateFlag=!1,this.snapshots={models:{},lookAts:{},cutting:{}};var l=0;this.projectTreeFlag=!1;var m;try{m=new Intl.Collator("zh",{sensitivity:"case",numeric:!0})}catch(n){m={},console.log("当前浏览器不支持'Intl.Collator',无法有效排序"),m.compare=function(a,b){return-1}}var o=function(a,b){return m.compare(a.text,b.text)};this.createTool=function(b){function c(){f.find('[id="restoreModal'+g+'"]').hide(),f.find('[id="transparentModal'+g+'"]').hide(),f.find('[id="modelPartitionModal'+g+'"]').hide(),f.find('[id="colorModal'+g+'"]').hide(),f.find('[id="setModal'+g+'"]').hide()}function d(a){
a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}e.options=$.extend({},i,b);var f=$('<div class="yj-tool" id="my-tool'+g+'" ></div>');f.appendTo($("#"+a.viewport));var j=$('<div class="yj-group"></div>');j.appendTo(f);var k=$('<button type="button" class="yj-but" title="初始化" id="home'+g+'"><div class="yj-icon home-icon"   ></div></button>');e.options.home&&k.appendTo(j);var l=$('<button type="button" class="yj-but" title="自适应" id="fit'+g+'"><div class="yj-icon fit-icon"  ></div></button>');e.options.fit&&l.appendTo(j);var m=$('<button type="button" class="yj-but" title="复位" id="restore'+g+'"></button>'),n=$('<div class="yj-icon restore-icon"  ></div>');n.appendTo(m);var o=$('<ul class="restoreModal" id="restoreModal'+g+'" ><li class="input-group-addon"><input type="checkbox" id="showSet'+g+'" class="check" /><label for="showSet'+g+'"> 复位构件可见设置</label></li><li class="input-group-addon"><input type="checkbox" id="highlightSet'+g+'" class="check" /><label for="highlightSet'+g+'"> 复位构件高亮设置</label></li><li class="input-group-addon"><input type="checkbox" id="viewSet'+g+'" class="check" /><label for="viewSet'+g+'"> 复位模型视角设置</label></li><li class="input-group-addon"><input type="checkbox" id="transparentSet'+g+'" class="check" /><label for="transparentSet'+g+'">  复位构件透明设置</label></li><li class="input-group-addon"><input type="checkbox" id="wireframeSet'+g+'" class="check" /><label for="wireframeSet'+g+'">  复位构件线框设置</label></li><li class="input-group-addon"><input type="checkbox" id="colorSet'+g+'" class="check"/><label for="colorSet'+g+'">  复位构件颜色设置</label></li><li class="input-group-addon"><input type="checkbox" id="checkAll'+g+'" class="checkAll" /><label for="checkAll'+g+'">  全选</label><input type="button" id="reset'+g+'" class="reset" value="复位选中项"></li></ul>');e.options.restore&&(m.appendTo(j),o.appendTo(j),o.css({"margin-left":m.position().left-o.width()/2}));var p=$('<button type="button" class="yj-but" title="漫游" id="roam'+g+'"><div class="yj-icon roam-icon"   ></div></button>');e.options.roam&&p.appendTo(j);var q=$('<div class="yj-group"></div>');q.appendTo(f);var r=$('<button type="button" class="yj-but" title="框选" id="multiple'+g+'"><div class="yj-icon multiple-icon"   ></div></button>');e.options.multiple&&r.appendTo(q);var s=$('<button type="button" class="yj-but" title="构件透明化" id="transparent'+g+'"></button>'),t=$('<div class="yj-icon transparent-icon"  ></div>');t.appendTo(s);var u=$('<div class="transparentModal clearfix" id="transparentModal'+g+'"><div><span class="transparent-info">提示信息</span></div><div class="subtract">-</div><div class="transparentRangeParent"><input type="range" class="transparentRange"  step="0.01" min="0" max="1" /></div><div class="add">+</div></div>');e.options.transparent&&(s.appendTo(q),u.appendTo(q),u.css({"margin-left":s.position().left-u.width()/2}));var v=$('<button type="button" class="yj-but" title="构件隐藏" id="hide'+g+'"><div class="yj-icon hide-icon"   ></div></button>');v.appendTo(q);var w=$('<button type="button" class="yj-but" title="构件隔离" id="insulate'+g+'"><div class="yj-icon insulate-icon"   ></div></button>');w.appendTo(q);var x=$('<button type="button" class="yj-but" title="模型剖切" id="sectioning'+g+'"><div class="yj-icon sectioning-icon"   ></div></button>');x.appendTo(q);var y=$('<button type="button" class="yj-but" title="模型分解" id="modelPartition'+g+'"></button>'),z=$('<div class="yj-icon modelPartition-icon"  ></div>');z.appendTo(y);var A=$('<div class="modelPartitionModal" id="modelPartitionModal'+g+'"><div><span  class="modelPartition-info">提示信息</span></div><div class="subtract">-</div><div class="modelPartitionRangeParent"><input type="range" class="modelPartitionRange" value="0" name="points" step="0.01" min="0" max="2" /></div><div class="add">+</div></div>');e.options.modelPartition&&(y.appendTo(q),A.appendTo(q),A.css({"margin-left":y.position().left-A.width()/2}));var B=$('<button type="button" class="yj-but" title="构件线框化" id="wireframeModel'+g+'"><div class="yj-icon wireframeModel-icon"></div></button>');e.options.wireframe&&B.appendTo(q);var C=$('<div class="colorModal" id="colorModal'+g+'"><div class="colorModalDiv" title="选择构件颜色"><input id="objColorSet'+g+'"/></div></div>'),D=$('<button type="button" class="yj-but" title="构件变色" id="color'+g+'"></button>'),E=$('<div class="yj-icon color-icon"></div>');E.appendTo(D),e.options.color&&(C.appendTo(q),D.appendTo(q),C.css({"margin-left":D.position().left}));var F=$('<div class="yj-group"></div>');F.appendTo(f);var G=$('<button type="button" class="yj-but" title="设置" id="set'+g+'" style="border-radius: 6px;"></button>'),H=$('<div class="yj-icon set-icon" ></div>');H.appendTo(G);var I=$('<div class="setModal" id="setModal'+g+'"><div class="sceneColorDiv" title="选择背景颜色"><input id="sceneColorSet'+g+'"/></div><div class="fullScreenDiv"><button class="fullScreen" id="Fullscreen'+g+'" style="cursor: pointer" title="全屏显示"></button></div></div>');e.options.setting&&(G.appendTo(F),I.appendTo(F)),$(document).bind("click",function(a){c()}),f.find('[id="home'+g+'"]').on("click",function(){a.resetScene()}),f.find('[id="fit'+g+'"]').on("click",function(){a.adaptiveSize()}),f.find('[id="restore'+g+'"]').on("click",function(a){f.find('[id="restoreModal'+g+'"]').is(":hidden")&&c(),f.find('[id="restoreModal'+g+'"]').on("click",function(a){d(a)}),f.find('[id="restoreModal'+g+'"]').toggle(),d(a)}),f.find('[id="reset'+g+'"]').on("click",function(b){var c=$("#viewSet"+g).prop("checked"),d=$("#showSet"+g).prop("checked"),e=$("#highlightSet"+g).prop("checked"),f=$("#transparentSet"+g).prop("checked"),h=$("#colorSet"+g).prop("checked"),i=$("#wireframeSet"+g).prop("checked");a.resetScene(c,d,e,f,h,i)});var J=$("#restoreModal"+g+" .check");$("#restoreModal"+g+" .checkAll").on("click",function(){for(var a=0;a<J.length;a++)J[a].checked=this.checked}),J.on("click",function(){$("#restoreModal"+g+" .checkAll")[0].checked=J.length==$("#restoreModal"+g+" .check:checked").length}),$("#objColorSet"+g).spectrum({showButtons:!1,cancelText:"取消",chooseText:"选择",togglePaletteMoreText:"更多",togglePaletteLessText:"简洁",clearText:"清除颜色缓存",noColorSelectedText:"没有选择颜色",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",color:"#ECC",showInput:!0,className:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"hex",localStorageKey:"spectrum.demo",appendTo:"parent",clickoutFiresChange:!1,move:function(b){var c=b._r/255,d=b._g/255,e=b._b/255,f=[c,d,e];a.setColorProcess(f)},show:function(){},beforeShow:function(){},hide:function(){},change:function(a){},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]}),$("#sceneColorSet"+g).spectrum({showButtons:!1,cancelText:"取消",chooseText:"选择",togglePaletteMoreText:"更多",togglePaletteLessText:"简洁",clearText:"清除颜色缓存",noColorSelectedText:"没有选择颜色",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",color:"#ECC",showInput:!0,className:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"hex",localStorageKey:"spectrum.demo",appendTo:"parent",clickoutFiresChange:!1,move:function(b){var c=b._r/255,d=b._g/255,e=b._b/255,f=[c,d,e];a.setSceneBackGroundColor(f)},show:function(){},beforeShow:function(){},hide:function(){},change:function(a){},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]}),a.listener.on("esc",function(){h.roam&&$("#roam"+g).click(),h.measurement&&$("#measurement"+g).click(),h.multiple&&$("#multiple"+g).click(),h.sectioning&&$("#sectioning"+g).click()}),f.find('[id="roam'+g+'"]').on("click",function(){a.modelExplosion(0),h.measurement&&($("#measurement"+g)[0]&&($("#measurement"+g)[0].style.backgroundColor=""),e.message("info","漫游模式下将关闭测量功能",!1),h.measurement=!1,a.measuredDistance()),h.sectioning&&($("#sectioning"+g)[0]&&($("#sectioning"+g)[0].style.backgroundColor=""),e.message("info","漫游模式下将关闭剖切功能",!1),h.sectioning=!1,a.modelCutting()),h.multiple&&($("#multiple"+g)[0]&&($("#multiple"+g)[0].style.backgroundColor=""),this.style.backgroundColor="",e.message("info","漫游模式下将关闭框选功能",!1),h.multiple=!1,a.selectBoundingBox()),h.roam?this.style.backgroundColor="":this.style.backgroundColor="#1f89de",h.roam=!h.roam,a.theFirstPerspective()}),f.find('[id="multiple'+g+'"]').on("click",function(){a.modelExplosion(0),h.roam&&($("#roam"+g)[0]&&($("#roam"+g)[0].style.backgroundColor=""),e.message("info","框选模式下将关闭漫游功能",!1),h.roam=!1,a.theFirstPerspective()),h.measurement&&($("#measurement"+g)[0]&&($("#measurement"+g)[0].style.backgroundColor=""),e.message("info","框选模式下将关闭测量功能",!1),h.measurement=!1,a.measuredDistance()),h.sectioning&&($("#sectioning"+g)[0]&&($("#sectioning"+g)[0].style.backgroundColor=""),e.message("info","框选模式下将关闭剖切功能",!1),h.sectioning=!1,a.modelCutting()),h.multiple?this.style.backgroundColor="":this.style.backgroundColor="#1f89de",h.multiple=!h.multiple,a.selectBoundingBox()});var K=$("#transparentModal"+g+" .subtract"),L=$("#transparentModal"+g+" .add"),M=$("#transparentModal"+g+" .transparentRange");f.find('[id="transparent'+g+'"]').on("click",function(b){f.find('[id="transparentModal'+g+'"]').is(":hidden")&&c(),f.find('[id="transparentModal'+g+'"]').on("click",function(a){d(a)}),f.find('[id="transparentModal'+g+'"]').toggle(),M.val(1);var e=[];e=a.arrayConversion(),e?$(".transparent-info").text("透明度： "+(100*Number(M.val())).toFixed(0)+"%"):$(".transparent-info").text("未选择构件"),d(b)});var N=BIMWINNER.DeviceTypeTest.isIE11,O=null;O=N?"change":"input",M.bind(O,function(b){var c=[];c=a.arrayConversion(),c?($(".transparent-info").text("透明度： "+(100*Number(M.val())).toFixed(0)+"%"),a.transparentObjs(c,Number(M.val()))):$(".transparent-info").text("未选择构件")}),K.on("click",function(){var b=Number(M.val()),c=Number(M.attr("step"));M.val(b-c);var d=[];d=a.arrayConversion(),d?($(".transparent-info").text("透明度： "+(100*b).toFixed(0)+"%"),a.transparentObjs(d,b)):$(".transparent-info").text("未选择构件")}),L.on("click",function(){var b=Number(M.val()),c=Number(M.attr("step"));M.val(b+c);var d=[];d=a.arrayConversion(),d?($(".transparent-info").text("透明度： "+(100*b).toFixed(0)+"%"),a.transparentObjs(d,b)):$(".transparent-info").text("未选择构件")}),f.find('[id="hide'+g+'"]').on("click",function(){a.hideObjs(a.arrayConversion())}),f.find('[id="insulate'+g+'"]').on("click",function(){a.isolationObjs(a.arrayConversion())}),f.find('[id="sectioning'+g+'"]').on("click",function(){a.modelExplosion(0),h.roam&&($("#roam"+g)[0]&&($("#roam"+g)[0].style.backgroundColor=""),e.message("info","剖切模式下将关闭漫游功能",!1),h.roam=!1,a.theFirstPerspective()),h.measurement&&($("#measurement"+g)[0]&&($("#measurement"+g)[0].style.backgroundColor=""),e.message("info","剖切模式下将关闭测量功能",!1),h.measurement=!1,a.measuredDistance()),h.multiple&&($("#multiple"+g)[0]&&($("#multiple"+g)[0].style.backgroundColor=""),this.style.backgroundColor="",e.message("info","剖切模式下将关闭框选功能",!1),h.multiple=!1,a.selectBoundingBox()),h.sectioning?this.style.backgroundColor="":this.style.backgroundColor="#1f89de",h.sectioning=!h.sectioning,a.modelCutting()});var P=$("#modelPartitionModal"+g+" .subtract"),Q=$("#modelPartitionModal"+g+" .add"),R=$("#modelPartitionModal"+g+" .modelPartitionRange");f.find('[id="modelPartition'+g+'"]').on("click",function(b){h.roam&&($("#roam"+g)[0]&&($("#roam"+g)[0].style.backgroundColor=""),e.message("info","模型分解模式下将关闭漫游功能",!1),h.roam=!1,a.theFirstPerspective()),h.measurement&&($("#measurement"+g)[0]&&($("#measurement"+g)[0].style.backgroundColor=""),e.message("info","模型分解模式下将关闭测量功能",!1),h.measurement=!1,a.measuredDistance()),h.sectioning&&($("#sectioning"+g)[0]&&($("#sectioning"+g)[0].style.backgroundColor=""),e.message("info","模型分解模式下将关闭剖切功能",!1),h.sectioning=!1,a.modelCutting()),h.multiple&&($("#multiple"+g)[0]&&($("#multiple"+g)[0].style.backgroundColor=""),this.style.backgroundColor="",e.message("info","模型分解模式下将关闭框选功能",!1),h.multiple=!1,a.selectBoundingBox()),f.find('[id="modelPartitionModal'+g+'"]').is(":hidden")&&c(),f.find('[id="modelPartitionModal'+g+'"]').on("click",function(a){d(a)}),f.find('[id="modelPartitionModal'+g+'"]').toggle(),$(".modelPartition-info").text("离散系数： "+R.val()),d(b)}),R.bind(O,function(b){$(".modelPartition-info").text("离散系数： "+R.val()),a.modelExplosion(Number(R.val()))}),P.on("click",function(){var b=R.val(),c=Number(R.attr("step"));R.val(b-c),$(".modelPartition-info").text("离散系数： "+R.val()),a.modelExplosion(Number(R.val()))}),Q.on("click",function(){var b=R.val(),c=Number(R.attr("step"));R.val(Number(b)+c),$(".modelPartition-info").text("离散系数： "+R.val()),a.modelExplosion(Number(R.val()))}),f.find('[id="wireframeModel'+g+'"]').on("click",function(){a.wireframeObjs(a.arrayConversion())}),f.find('[id="color'+g+'"]').on("click",function(a){f.find('[id="colorModal'+g+'"]').is(":hidden")&&c(),f.find('[id="colorModal'+g+'"]').on("click",function(a){d(a)}),f.find('[id="colorModal'+g+'"]').toggle(),d(a)}),f.find('[id="set'+g+'"]').on("click",function(a){f.find('[id="setModal'+g+'"]').is(":hidden")&&c(),f.find('[id="setModal'+g+'"]').on("click",function(a){d(a)}),f.find('[id="setModal'+g+'"]').toggle(),d(a)}),f.find('[id="set'+g+'"]').on("mouseover",function(b){var c=document.getElementById("Fullscreen"+g),d=a.viewportDiv;"number"==typeof window.screenLeft?window.screenLeft:window.screenX,"number"==typeof window.screenTop?window.screenTop:window.screenY;d.offsetWidth!=window.screen.width||d.offsetHeight!=window.screen.height&&d.offsetHeight!=window.screen.height-1?(c.className="fullScreen",c.title="全屏显示",h.fullScreen=!1):(c.className="cancelFullScreen",c.title="取消全屏",h.fullScreen=!0)}),f.find('[id="Fullscreen'+g+'"]').on("click",function(b){c();var d=document.getElementById("Fullscreen"+g);if(h.fullScreen)h.fullScreen=!1,document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen(),d.className="fullScreen",d.title="全屏显示";else{h.fullScreen=!0;var e=a.viewportDiv;e.fullScreenElement?e.fullScreenElement():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),d.className="cancelFullScreen",d.title="取消全屏"}}),a.viewportDiv.focus(),f.css({"margin-left":-f.width()/2}),e.createTool2(),f.find("button").mouseover(function(a){this.style.backgroundColor="#1f89de"}),f.find("button").mouseout(function(a){h[this.id.split(g)[0]]||(this.style.backgroundColor="")})},this.createTool2=function(){function b(){}function c(b,c){var d=$('<div class="search-result" key="'+b.id+'"></div>');d.on("click",function(b){"more-icon-close"!=b.target.className&&"more-icon-open"!=b.target.className&&a.findSceneNodes([$(this).attr("key")])}),d.appendTo($("#search-result-body"+g));var e=$('<div class="search-result-info"></div>');e.appendTo(d);var f=$('<div class="search-type-icon"></div>');f.appendTo(e);var h="";switch(b.ifcType){case"IfcDoor":h="door";break;case"IfcBeam":h="beam";break;case"IfcWindow":h="window";break;case"IfcWall":h="wall";break;case"IfcWallStandardCase":h="wall";break;case"IfcStair":h="stair";break;case"IfcStairFlight":h="stair";break;case"IfcFlowSegment":h="pipeline";break;case"IfcFlowFitting":h="pipeline";break;case"IfcFlowTerminal":h="equipment";break;default:h="other"}f.addClass(h);var i=$('<table class="ss-table"></table>');i.appendTo(e);var j=$("<tr></tr>");j.appendTo(i);var k=$("<td>类型</td>");k.appendTo(j);var l="未知";b["类型"]&&(l=b["类型"]);var m=$("<td>"+l+"</td>");m.appendTo(j);var n=$("<tr></tr>");n.appendTo(i);var o=$("<td>名称</td>");o.appendTo(n);var p="未知";""!=b.name&&(p=b.name);var q=$("<td>"+p+"</td>");q.appendTo(n);var r=$("<tr></tr>");r.appendTo(i);var s=$("<td>GUID</td>");s.appendTo(r);var t="未知";b.guid&&(t=b.guid);var u=$("<td>"+t+"</td>");u.appendTo(r);var v=$('<button type="button" class="more-but" title="更多"> <div class="more-icon-close" style="">更多</div> </button>');v.appendTo(d);var w=$('<div class="search-result-more hide"></div>');w.appendTo(d),v.on("click",function(a){a.preventDefault(),"more-icon-close"==a.target.className?(a.target.className="more-icon-open",a.target.innerText="收起",w.removeClass("hide")):(a.target.className="more-icon-close",a.target.innerText="更多",w.addClass("hide"))}),x(c,b,w)}function d(b,c){var d=[];d=l(c),d=i(d),a.resetScene(!1,!1,!1,!0,!0,!1),a.reverseTransparentObjs(d,.4,!0)}function i(a){for(var b,c=[],d={},e=0;null!=(b=a[e]);e++)d[b]||(c.push(b),d[b]=!0);return c}function l(a){var b=[];if("component"!=a.type&&a.nodes)for(var c=0;c<a.nodes.length;c++){var d=l(a.nodes[c]);b=d.reduce(function(a,b){return a.push(b),a},b)}else b.push(a.id);return b}function m(b){var c=[],d={};return d.text=(a.documentInfo[b]?a.documentInfo[b].name:b)||b,d.id=b,d.type="document",d.expandIcon="other_small treeNodeIcon",d.collapseIcon="other_small treeNodeIcon",d.icon="other_small treeNodeIcon",c.push(d),c}var n=0,p=$('<div class="yj-tool2" id="my-tool2'+g+'" ></div>');p.appendTo($("#"+a.viewport));var q=$('<div class="yj-group"></div>');q.appendTo(p);var r=$('<button type="button" class="yj-but" title="模型树" id="modelTree'+g+'"><div class="yj-icon modelTree-icon" ></div></button>');e.options.modelTree&&(r.appendTo(q),n++);var s=$('<button type="button" class="yj-but" title="构件属性" id="attribute'+g+'"><div class="yj-icon attribute-icon" ></div></button>');e.options.attribute&&(s.appendTo(q),n++);var t=$('<button type="button" class="yj-but" title="查询" id="search'+g+'"><div class="yj-icon search-tool-icon" ></div></button>');e.options.search&&(t.appendTo(q),n++);var u=$('<button type="button" class="yj-but" title="模型测量" id="measurement'+g+'"><div class="yj-icon measurement-icon"></div></button>');e.options.measurement&&(u.appendTo(q),n++),p.find("button").mouseover(function(a){this.style.backgroundColor="#1f89de"}),p.find("button").mouseout(function(a){h[this.id.split(g)[0]]||(this.style.backgroundColor="")}),$(document).bind("click",function(a){b()});var v={title:"属性",width:334,height:688,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(a){var b=document.getElementById("attribute"+g);h.attribute=!1,b&&(b.style.backgroundColor="")},content:'<div class="tab-body" id="tab-properties'+g+'"> <table class="sx-table table-no-top"><thead></thead><tbody style="background-color: rgba(247, 247, 247, 0.8)"><tr class="noprop"><td>尚未选择构件</td></tr></tbody></table></div>'};this.attributeWindow=f.window(v),e.attributeWindow.setPosition({left:"",right:5,top:60}),e.attributeWindow.windowHide();var w={title:"搜索",width:334,height:688,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(a){var b=document.getElementById("search"+g);h.search=!1,b&&(b.style.backgroundColor="")},content:'<div class="search-body"><div class="search-input-div"><input class="search-input" id="search-input'+g+'" placeholder="请输入关键词"> <button type="button" class="search-but" title="搜索" id="search-but'+g+'"><div class="search-icon"></div></button></div><span class="searching hide">正在查找</span><div class="search-info hide">        <span >关键词： “</span> <span class="search-key"></span> <span>”，共搜索到</span> <span class="search-num"></span> <span>个构件</span></div><div class="search-result-body" id="search-result-body'+g+'"></div></div>'};this.searchWindow=f.window(w),e.searchWindow.setPosition({left:"",right:5,top:60}),e.searchWindow.windowHide();var x=function(){var a,b=function(a,b,c,d){var e=$("<tr></tr>");c.after(e);var f=$("<td></td>");e.append(f);var g=$("<td>");e.append(g);var h=null==b?"":b,i=/[\u4e00-\u9fa5]/;if(i.test(d)){var j=a.split(d);f.append("<span>"+j[0]+"</span>");for(var k=1;k<j.length;k++)f.append("<span class='search-key-highlight'>"+d+"</span>"),f.append("<span>"+j[k]+"</span>");var l=h.split(d);g.append("<span>"+l[0]+"</span>");for(var m=1;m<l.length;m++)g.append("<span class='search-key-highlight'>"+d+"</span>"),g.append("<span>"+l[m]+"</span>")}else{var n=new RegExp(d,"ig"),o=a.match(n),p=h.match(n);if(o)for(var q=a.toLocaleLowerCase(),r=d.toLocaleLowerCase(),s=d.length,t=q.split(r),u=0,m=0;m<t.length;m++){var v=a.substr(u,u+t[m].length);u+=t[m].length,u+=s,f.append("<span>"+v+"</span>");var w=o[m]?o[m]:"";f.append("<span class='search-key-highlight'>"+w+"</span>")}else f.append("<span>"+a+"</span>");if(p)for(var x=h.toLocaleLowerCase(),y=d.toLocaleLowerCase(),z=d.length,A=x.split(y),B=0,C=0;C<A.length;C++){var D=h.substr(B,B+A[C].length);B+=A[C].length,B+=z,g.append("<span>"+D+"</span>");var E=p[C]?p[C]:"";g.append("<span class='search-key-highlight'>"+E+"</span>")}else g.append("<span>"+h+"</span>")}},c=function(c,d,e){var f=$('<tr class="sx-active"></tr>');a.find("table tbody").append(f);var g=$("<td colspan=\"2\" style='font-size: 14px'></td>");f.append(g);var h=$("<b></b>");g.append(h);var i=/[\u4e00-\u9fa5]/;if(i.test(e)){var j=c.split(e);h.append("<span>"+j[0]+"</span>");for(var k=1;k<j.length;k++)h.append("<span class='search-key-highlight'>"+e+"</span>"),h.append("<span>"+j[k]+"</span>")}else{var l=new RegExp(e,"ig"),m=c.match(l);if(m)for(var n=c.toLocaleLowerCase(),o=e.toLocaleLowerCase(),p=e.length,q=n.split(o),r=0,s=0;s<q.length;s++){var t=c.substr(r,r+q[s].length);r+=q[s].length,r+=p,h.append("<span>"+t+"</span>");var u=m[s]?m[s]:"";h.append("<span class='search-key-highlight'>"+u+"</span>")}else h.append("<span>"+c+"</span>")}for(var v in d)b(v,d[v],f,e)};return function(d,e,f){a=f,f.append($('<table class="sx-table table-no-top"><thead></thead><tbody style="background-color: rgba(247, 247, 247, 0.8)"></tbody></table>')),a.find("table tbody").append('<tr class="noprop"><td><span class="value nonEditable">名称</span></td><td><span class="value nonEditable">值</span></td></tr>');var g=e,h=$('<tr class="sx-active"></tr>');a.find("table tbody").append(h);var i=$("<td colspan=\"2\" style='font-size: 14px'></td>");h.append(i),i.append("<b>信息</b>");for(var j in g)"string"==typeof g[j]&&b(j,g[j],h,d);for(var k in g)"object"==typeof g[k]?c(k,g[k],d):"string"==typeof g[k]}}(),y={title:"测量",width:334,height:405,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(b){var c=document.getElementById("measurement"+g);h.measurement&&a.measuredDistance(),h.measurement=!1,c&&(c.style.backgroundColor="")},content:'<div class="measurement-body"><table class="cl-table"><tr style="color: #696969;height: 90px;"><td><span>起点:</span></td><td><span class="cl-start-x"></span><br><span class="cl-start-y"></span><br><span class="cl-start-z"></span></td></tr><tr style="color: #696969;height: 90px;"><td><span>终点:</span></td><td><span class="cl-end-x"></span><br><span class="cl-end-y"></span><br><span class="cl-end-z"></span></td></tr><tr style="height: 30px;"><td style="font-size:14px"><span>测量结果</span></td><td></td></tr><tr style="color:red;height: 30px;"><td><span>∆X:</span></td><td><span class="cl-result-x"></span></td></tr><tr style="color:green;height: 30px;"><td><span>∆Y:</span></td><td><span class="cl-result-y"></span></td></tr><tr style="color:blue;height: 30px;"><td><span>∆Z:</span></td><td><span class="cl-result-z"></span></td></tr><tr style="color: #696969;height: 30px;"><td><span>直线距离:</span></td><td><span class="cl-result"></span></td></tr></table></div>'};this.measurementWindow=f.window(y),e.measurementWindow.setPosition({left:"",right:5,top:60}),e.measurementWindow.windowHide();var z={title:"模型浏览器",width:334,height:688,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(a){var b=document.getElementById("modelTree"+g);h.modelTree=!1,b&&(b.style.backgroundColor="")},content:'<div class="modelTree"><div class="modelTree-head"><button class="but-tree" id="butLocationTree'+g+'"><span>空间</span></button> <button class="but-tree" id="butSystemTree'+g+'"><span>系统</span></button> <button class="but-tree" id="butTypeTree'+g+'"><span>类型</span></button> <button class="but-tree" id="butFileTree'+g+'"><span>文件</span></button></div><div class="modelTree-body"><div class="location-tree" id="locationTree'+g+'">正在等待模型加载···</div><div class="system-tree" id="systemTree'+g+'"></div><div class="type-tree" id="typeTree'+g+'"></div><div class="file-tree" id="fileTree'+g+'"></div></div></div>'};this.modelTreeWindow=f.window(z),e.modelTreeWindow.setPosition({left:"",right:5,top:60}),e.modelTreeWindow.windowHide();var A,B,C,D,E=function(b,c){"app"==a.type?$.ajax({type:"GET",url:a.baseaddress+a.appKey+"/query/tree/files/"+b+"/components?bosclass=component_system",headers:{authorization:"AccessToken "+a.accessToken,"content-type":"application/json"},data:{},contentType:"application/json",success:function(a){var b=[];0==a.length&&(b.push({text:"该模型无系统划分"}),c(b));for(var d=0;d<a.length;d++)if("IfcSystem"==a[d].type){var e={};if(e.text=""==a[d].name?"系统(未命名)":a[d].name,e.id=a[d].key,e.type="system",e.nodes=[],a[d].children&&a[d].children.length>0)for(var f=0;f<a[d].children.length;f++){if("components"==a[d].children[f].bosclass){var g={};g.type="component",g.id=a[d].children[f].key,g.text=a[d].children[f].name||"构件(未命名)",e.nodes.push(g)}e.nodes.sort(o)}b.push(e)}b.sort(o),c(b)},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON}}):b?$.when($.ajax({type:"POST",url:a.baseaddress+"document_system/query",data:JSON.stringify({_from:b}),contentType:"application/json",success:function(a){},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON}})).done(function(b){function d(){f===b.result.length&&(e.sort(o),c(e))}if(b.success){var e=[];0==b.result.length&&(e.push({text:"该模型无系统划分"}),c(e));for(var f=0,g=0;g<b.result.length;g++)$.when($.ajax({type:"GET",url:a.baseaddress+"system/"+encodeURIComponent(b.result[g]._to),data:{},contentType:"application/json",success:function(a){a.success||console.warn("error: "+data2.error)},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON}}),$.ajax({type:"POST",url:a.baseaddress+"system_component/query",data:JSON.stringify({_from:b.result[g]._to}),contentType:"application/json",success:function(a){},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON}})).done(function(b,c){var g={};if(g.text=""==b[0].result.Name?"未命名":b[0].result.Name,g.id=b[0].result._id,g.type="system",g.nodes=[],c[0].success){for(var h=0;h<c[0].result.length;h++)if(c[0].result[h]._from==b[0].result._id){var i={};i.type="component",i.id=c[0].result[h]._to.slice(10),i.text=a.componentInfo[c[0].result[h]._to]&&""!=a.componentInfo[c[0].result[h]._to].name?a.componentInfo[c[0].result[h]._to].name:"未命名",g.nodes.push(i)}g.nodes.sort(o)}e.push(g),f++,d()})}else console.warn("error: "+b.error)}):c([{text:"该模型无系统划分"}])},F=function(b,c){var d=function(a){for(var b=[],c=0;c<a.length;c++){var e={};e.id=a[c].key;var f="";switch(a[c].type){case"IfcProject":f="项目(未命名)";break;case"IfcSite":f="场地(未命名)";break;case"IfcBuilding":f="建筑(未命名)";break;case"IfcBuildingStorey":f="楼层(未命名)";break;case"IfcSpace":f="空间(未命名)";break;default:f="构件(未命名)"}e.text=a[c].name||f,"component_location"==a[c].bosclass?(e.type="location",e.nodes=[]):"components"==a[c].bosclass&&(e.type="component"),a[c].children&&a[c].children.length>0&&(e.nodes=d(a[c].children)),b.push(e)}return b.sort(o),b},e=function(a){for(var b=[],c=0;c<a.length;c++){var d={};d.id=a[c]._key;var f="";switch(a[c].Type){case"IfcProject":f="项目(未命名)";break;case"IfcSite":f="场地(未命名)";break;case"IfcBuilding":f="建筑(未命名)";break;case"IfcBuildingStorey":f="楼层(未命名)";break;case"IfcSpace":f="空间(未命名)";break;default:f="构件(未命名)"}if(d.text=a[c].Name||f,d.type="location",d.nodes=[],a[c].coms.length>0)for(var g=0;g<a[c].coms.length;g++){var h={};h.id=a[c].coms[g]._key,h.text=a[c].coms[g].name||"构件(未命名)",h.type="component",d.nodes.push(h)}if(a[c].children&&a[c].children.length>0)for(var i=e(a[c].children),j=0;j<i.length;j++)d.nodes.push(i[j]);d.nodes.sort(o),b.push(d)}return b.sort(o),b};"app"==a.type?$.ajax({type:"GET",url:a.baseaddress+a.appKey+"/query/tree/files/"+b+"/components?bosclass=component_location",headers:{authorization:"AccessToken "+a.accessToken,"content-type":"application/json"},data:{},contentType:"application/json",success:function(a){var b=[];0==a.length&&(b.push({text:"该模型无空间划分"}),c(b)),b=d(a),c(b)},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON}}):(b=encodeURIComponent(b),$.ajax({type:"GET",url:a.baseaddress+"docloc/"+b+"/loctree",data:{},contentType:"application/json",success:function(a){if(a.success){var b=[];0==a.result.length&&(b.push({text:"该模型无空间划分"}),c(b)),b=e(a.result),c(b)}},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON}}))};$("#butLocationTree"+g).click(function(){$("#locationTree"+g).show(),this.style.backgroundColor="rgba(0, 104, 183, 0.8)",$("#systemTree"+g).hide(),$("#butSystemTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#typeTree"+g).hide(),$("#butTypeTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#fileTree"+g).hide(),$("#butFileTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"})}),$("#butSystemTree"+g).click(function(){$("#locationTree"+g).hide(),$("#butLocationTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#systemTree"+g).show(),this.style.backgroundColor="rgba(0, 104, 183, 0.8)",$("#typeTree"+g).hide(),$("#butTypeTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#fileTree"+g).hide(),$("#butFileTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"})}),$("#butTypeTree"+g).click(function(){$("#locationTree"+g).hide(),$("#butLocationTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"
}),$("#systemTree"+g).hide(),$("#butSystemTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#typeTree"+g).show(),this.style.backgroundColor="rgba(0, 104, 183, 0.8)",$("#fileTree"+g).hide(),$("#butFileTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"})}),$("#butFileTree"+g).click(function(){$("#locationTree"+g).hide(),$("#butLocationTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#systemTree"+g).hide(),$("#butSystemTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#typeTree"+g).hide(),$("#butTypeTree"+g).css({backgroundColor:"rgba(105,105,105,0.8)"}),$("#fileTree"+g).show(),this.style.backgroundColor="rgba(0, 104, 183, 0.8)"}),$("#search-input"+g).keyup(function(a){"Enter"==a.key&&$("#search-but"+g).click()}),$("#search-but"+g).on("click",function(){var b=$("#search-input"+g).val();""==b?e.message("warning","请输入关键字"):j!=b&&(j=b,$("#search-result-body"+g).empty(),$(".searching").removeClass("hide"),$(".search-info").addClass("hide"),k=0,a.queryResultByString(b,function(a){k++,c(a,b)},function(){$(".searching").addClass("hide"),0!=k?($(".search-info").removeClass("hide"),$(".search-key").text(b),$(".search-num").text(k)):$("#search-result-body"+g).append("<span>未找到相符的结果</span>")}))}),p.find('[id="modelTree'+g+'"]').on("click",function(){h.modelTree?(this.style.backgroundColor="",e.modelTreeWindow.windowHide()):(h.modelTree=!h.modelTree,this.style.backgroundColor="#1f89de",e.modelTreeWindow.windowShow(),e.treeDataLoad||(e.treeDataLoad=!0,e.loadTree(a.documentList[0])))}),p.find('[id="attribute'+g+'"]').on("click",function(){h.attribute?(this.style.backgroundColor="",e.attributeWindow.windowHide()):(h.attribute=!h.attribute,this.style.backgroundColor="#1f89de",e.attributeWindow.windowShow(),a.selectedPartsVal&&e.showComponentAttribute(a.selectedPartsVal.split(",")[0]))}),a.objectSet.listener.on("updated",function(b){if(h.attribute)if($.isEmptyObject(a.objectSet.objects))e.showComponentAttribute();else{var c="";for(var d in a.objectSet.objects)c=c+d+",";c=c.substring(0,c.length-1),e.showComponentAttribute(c.split(",")[0]||void 0)}}),p.find('[id="search'+g+'"]').on("click",function(a){h.search?(this.style.backgroundColor="",e.searchWindow.windowHide()):(h.search=!h.search,this.style.backgroundColor="#1f89de",e.searchWindow.windowShow())}),a.listener.on("delete",function(){h.measurement&&($(".cl-start-x").text(""),$(".cl-start-y").text(""),$(".cl-start-z").text(""),$(".cl-end-x").text(""),$(".cl-end-y").text(""),$(".cl-end-z").text(""),$(".cl-result-x").text(""),$(".cl-result-y").text(""),$(".cl-result-z").text(""),$(".cl-result").text(""),a.measuredDistance(),a.measuredDistance(function(a){"first"==a.state?(start=a.result.clone(),$(".cl-start-x").text("x: "+a.result.x.toFixed(2)),$(".cl-start-y").text("y: "+a.result.y.toFixed(2)),$(".cl-start-z").text("z: "+a.result.z.toFixed(2))):(end=a.result.clone(),$(".cl-end-x").text("x: "+a.result.x.toFixed(2)),$(".cl-end-y").text("y: "+a.result.y.toFixed(2)),$(".cl-end-z").text("z: "+a.result.z.toFixed(2)),$(".cl-result-x").text(Math.abs(end.x-start.x).toFixed(2)),$(".cl-result-y").text(Math.abs(end.y-start.y).toFixed(2)),$(".cl-result-z").text(Math.abs(end.z-start.z).toFixed(2)),$(".cl-result").text(end.distanceTo(start).toFixed(2)))}))}),p.find('[id="measurement'+g+'"]').on("click",function(b){if(a.modelExplosion(0),h.roam&&($("#roam"+g)[0]&&($("#roam"+g)[0].style.backgroundColor=""),e.message("info","测量模式下将关闭漫游功能",!1),h.roam=!1,a.theFirstPerspective()),h.sectioning&&($("#sectioning"+g)[0]&&($("#sectioning"+g)[0].style.backgroundColor=""),e.message("info","测量模式下将关闭剖切功能",!1),h.sectioning=!1,a.modelCutting()),h.multiple&&($("#multiple"+g)[0]&&($("#multiple"+g)[0].style.backgroundColor=""),this.style.backgroundColor="",e.message("info","测量模式下将关闭框选功能",!1),h.multiple=!1,a.selectBoundingBox()),h.measurement)this.style.backgroundColor="",e.measurementWindow.windowHide();else{h.measurement=!h.measurement,this.style.backgroundColor="#1f89de",e.measurementWindow.windowShow();var c,d;$(".cl-start-x").text(""),$(".cl-start-y").text(""),$(".cl-start-z").text(""),$(".cl-end-x").text(""),$(".cl-end-y").text(""),$(".cl-end-z").text(""),$(".cl-result-x").text(""),$(".cl-result-y").text(""),$(".cl-result-z").text(""),$(".cl-result").text(""),a.measuredDistance(function(a){"first"==a.state?(c=a.result.clone(),$(".cl-start-x").text("x: "+a.result.x.toFixed(2)),$(".cl-start-y").text("y: "+a.result.y.toFixed(2)),$(".cl-start-z").text("z: "+a.result.z.toFixed(2))):(d=a.result.clone(),$(".cl-end-x").text("x: "+a.result.x.toFixed(2)),$(".cl-end-y").text("y: "+a.result.y.toFixed(2)),$(".cl-end-z").text("z: "+a.result.z.toFixed(2)),$(".cl-result-x").text(Math.abs(d.x-c.x).toFixed(2)),$(".cl-result-y").text(Math.abs(d.y-c.y).toFixed(2)),$(".cl-result-z").text(Math.abs(d.z-c.z).toFixed(2)),$(".cl-result").text(d.distanceTo(c).toFixed(2)))})}}),e.loadTree=function(b){A=$.Deferred(),F(b,function(a){A.resolve(a)}),B=$.Deferred(),E(b,function(a){B.resolve(a)}),C=e.getSimpleTypeTree(),D=m(b),$.when(A).done(function(a){e.locationTree=$("#locationTree"+g).treeview({data:a,levels:1,onNodeSelected:function(a,b){d(a,b)}}).hide()}),$.when(B).done(function(a){e.systemTree=$("#systemTree"+g).treeview({data:a,levels:1,onNodeSelected:function(a,b){d(a,b)}}).hide()}),e.typeTree=$("#typeTree"+g).treeview({data:C,levels:1,onNodeSelected:function(a,b){d(a,b)}}).hide(),e.fileTree=$("#fileTree"+g).treeview({data:D,levels:1,onNodeSelected:function(b,c){a.resetScene(!1,!1,!1,!0,!0,!1),a.reverseTransparentObjs(a.alloids,.4,!0)}}).hide()},a.viewportDiv.focus()},this.getSimpleTypeTree=function(){var b=a.getComponentTypeArray(),c=[],d=a.componentInfo;for(var e in b){var f={};f.text=e,f.type="type",f.nodes=[];for(var g=0;g<b[e].length;g++){var h={};"app"==a.type?h.text=d[b[e][g]].name||"构件(未命名)":h.text=d["component/"+b[e][g]].name||"构件(未命名)",h.id=b[e][g],h.type="component",f.nodes.push(h)}f.nodes.sort(o),c.push(f)}return c.sort(o),c},this.getTypeTree=function(){var b=[],c={},d=a.componentAttribute,e=a.componentInfo;for(var f in d){var g=d[f];if(g){var h="其他",i="未命名",j="未命名",k="未命名",l="";g["其他"]&&g["其他"]["类别"]&&(h=g["其他"]["类别"]),g["其他"]&&g["其他"]["类型"]&&(i=g["其他"]["类型"].split(":")[0]);for(var m in g)g[m].Reference&&(j=g[m].Reference);e["component/"+f]&&e["component/"+f].name&&""!=e["component/"+f].name&&(k=e["component/"+f].name,l=e["component/"+f].type),c[h]?(c[h][i]?c[h][i][j]||(c[h][i][j]=[]):(c[h][i]={},c[h][i][j]=[]),c[h][i][j].push({id:f,name:k,type:l})):(c[h]={},c[h][i]={},c[h][i][j]=[],c[h][i][j].push({id:f,name:k,type:l}))}}for(var n in c){var o={};o.text=n,o.type="type",o.nodes=[];for(var p in c[n]){var q={};q.text=p,q.type="type",q.nodes=[];for(var r in c[n][p]){var s={};s.text=r,s.type="type",s.nodes=[];for(var t=0;t<c[n][p][r].length;t++){var u={};u.text=c[n][p][r][t].name,u.id=c[n][p][r][t].id,u.type="component";var v="";switch(c[n][p][r][t].type){case"IfcDoor":v="door_small treeNodeIcon";break;case"IfcBeam":v="beam_small treeNodeIcon";break;case"IfcWindow":v="window_small treeNodeIcon";break;case"IfcWall":v="wall_small treeNodeIcon";break;case"IfcWallStandardCase":v="wall_small treeNodeIcon";break;case"IfcStair":v="stair_small treeNodeIcon";break;case"IfcStairFlight":v="stair_small treeNodeIcon";break;case"IfcFlowSegment":v="pipeline_small treeNodeIcon";break;case"IfcFlowFitting":v="pipeline_small treeNodeIcon";break;case"IfcFlowTerminal":v="equipment_small treeNodeIcon";break;default:v="other_small treeNodeIcon"}u.icon=v,s.nodes.push(u)}q.nodes.push(s)}o.nodes.push(q)}b.push(o)}return b},this.showComponentAttribute=function(b){var c="",d=$("#tab-properties"+g),e=function(a,b,c){var d=$("<tr></tr>");c.after(d),d.append("<td>"+a+"</td>");var e=$("<td>"),f=null==b?"":b,g=$('<span class="value nonEditable">'+f+"</span>");e.append(g),d.append(e)},f=function(a,b){var c=$('<tr class="sx-active"></tr>');d.find("table tbody").append(c);var f=$("<td colspan=\"2\" style='font-size: 14px'></td>");c.append(f),f.append("<b>"+a+"</b>");for(var g in b)e(g,b[g],c)};return function(b){if(d=$("#tab-properties"+g),b!=c){if(void 0==b)return d.find("table tbody tr").remove(),d.find("table tbody").append('<tr class="noprop"><td>未选中构件</td></tr>'),void(c=b);c=b,d.find("table tbody tr").remove(),a.getComponentAttribute(b,function(a){if(null==a)return void d.find("table tbody").append('<tr class="noprop"><td>没有属性</td></tr>');if(void 0==a)return void d.find("table tbody").append('<tr class="noprop"><td>属性加载失败</td></tr>');d.find("table tbody").append('<tr class="noprop"><th><span class="value nonEditable">名称</span></th><th><span class="value nonEditable">值</span></th></tr>');var b=a;for(var c in b)"object"==typeof b[c]?f(c,b[c]):"string"==typeof b[c]})}}}(),this.snapshotsPush=function(){var b,c=null,d=null,f=null,h=THREE.Math.generateUUID(),i=document.getElementsByTagName("canvas")[0];b=i.toDataURL("image/png");var j=$(i).width(),k=$(i).height();a.getSnapshootModel(function(a,i,l){c=$.extend(!0,{},i),d=$.extend(!0,[],a),f=$.extend(!0,{},l);var m=new Date,n={look:c,model:d,cutting:f,imgURL:b,w:j,h:k,imgid:h,from:"local",order:m.getTime()};$("#snapshotsSaveToCloud_yj"+g).removeAttr("disabled"),e.addSnapshots(n,function(){},function(){})})},this.snapshotsClose=function(){$("#edit-body"+g)[0].contentWindow.Lobibox.alert("info",{msg:"即将退出编辑模式，是否保存当前状态已便下次继续编辑？",title:"保存提醒",buttons:{yes:{"class":"btn btn-success",closeOnClick:!1,text:"是"},no:{"class":"btn btn-warning",closeOnClick:!1,text:"否"}},callback:function(a,b){"no"===b?e.snapshotsSave(!1):"yes"===b&&e.snapshotsSave(!0),a.destroy()}})},this.snapshotsSave=function(b){if(b){e.editsnapshot.canvas.currentCanvasContainer.getCanvas().save(),e.editsnapshot.canvas.negativeCanvasContainer.getCanvas().save();var c=e.editsnapshot.canvas.currentCanvasContainer.getCanvas(),d=e.editsnapshot.canvas.negativeCanvasContainer.getCanvas(),f=document.createElement("canvas");f.width=c.width,f.height=c.height;var h=f.getContext("2d");h.drawImage(d.getCanvas(),0,0),h.drawImage(c.getCanvas(),0,0);var i=$("div[imgid='"+e.editsnapshot.canvas.currentCanvasContainer.getCanvas().getPictureName()+"']").get(0).children[1].children[0];i.src=f.toDataURL(),i.width=f.width/5,i.height=f.height/5,$($(i).closest(".snapshot")).attr("change",!0)}e.editsnapshot.canvas.currentCanvasContainer.getCanvas().clear(),e.editsnapshot.canvas.negativeCanvasContainer.getCanvas().clear(),e.editsnapshot.canvas.currentCanvasContainer.getCanvas().setDocumentName(""),e.editsnapshot.canvas.currentCanvasContainer.getCanvas().setPictureName(""),e.editsnapshot.canvas.negativeCanvasContainer.getCanvas().setDocumentName(""),e.editsnapshot.canvas.negativeCanvasContainer.getCanvas().setPictureName(""),$("#edit-snapshot"+g).hide();for(var j=0;j<a.viewportDiv.childNodes.length;j++)a.viewportDiv.childNodes[j].id=="edit-snapshot"+g||a.viewportDiv.childNodes[j].style&&(a.viewportDiv.childNodes[j].style.display="");document.getElementById("edit-body"+g).blur()},this.snapshotsEdit=function(b){var c="",d="",f=this;h.fullScreen&&(e.message("info","如需在全屏状态下使用编辑功能，请手动进入"),$("#Fullscreen"+g).trigger("click"));var i=$(this.parentNode.parentNode);d=i.attr("imgid");for(var j=0;j<a.documentList.length;j++)c+=a.documentList[j];var k=$("#edit-body"+g);if($("#edit-snapshot"+g).removeClass("hide").show().find(".edit-snapshot-name").text(f.parentNode.parentNode.children[0].children[0].innerText),k[0].contentWindow.$("#editmodelsnapshot").width("").height(""),k[0].contentWindow.$("#editmodelsnapshot").find(".sp-replacer,sp-light,spectrum-color").css({left:270,top:-50,position:"relative"}),e.editstorage=new e.editsnapshot.model.StorageModel,e.editstorage.init(),e.editsnapshot.canvas.currentCanvasContainer.getCanvas().setDocumentName(c),e.editsnapshot.canvas.currentCanvasContainer.getCanvas().setPictureName(d),e.editsnapshot.canvas.negativeCanvasContainer.getCanvas().setDocumentName(c),e.editsnapshot.canvas.negativeCanvasContainer.getCanvas().setPictureName(d),e.editstorage.getStorage()!==!1&&e.editstorage.load(c))e.editsnapshot.canvas.currentCanvasContainer.getCanvas().load(),e.editsnapshot.canvas.negativeCanvasContainer.getCanvas().load();else{var l=e.editsnapshot.canvas.negativeCanvasContainer.getCanvas(),m=new e.editsnapshot.model.shapeModel.ImageShape;m.init({x:0,y:0,width:f.parentNode.parentNode.children[1].children[0].naturalWidth,height:f.parentNode.parentNode.children[1].children[0].naturalHeight,src:f.parentNode.parentNode.children[1].children[0].src}),l.paint(m)}for(var j=0;j<a.viewportDiv.childNodes.length;j++)a.viewportDiv.childNodes[j].id=="edit-snapshot"+g||a.viewportDiv.childNodes[j].style&&(a.viewportDiv.childNodes[j].style.display="none")},this.getEntity=function(b,c,d,f,g){"app"==a.type?0!==c.indexOf(b+"/")||(c=c.slice(b.length+1)):0!==c.indexOf(b+"/")&&(c=b+"/"+c),"app"==a.type?$.ajax({type:"GET",url:a.baseaddress+"common/"+b+"/"+c,data:{appKey:a.appKey,access_token:a.accessToken},success:function(a){0==a.code?void 0!=g?d(a.data,g):d(a.data):(console.warn("error: "+a.message),"function"==typeof f?f(a.message):e.message("warning","服务器错误。错误信息："+a.message))},error:function(a,b,c){"function"==typeof f?f(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}}):(c=encodeURIComponent(c),$.ajax({type:"GET",url:a.baseaddress+b+"/"+c,data:{},success:function(a){a.success?void 0!=g?d(a.result,g):d(a.result):(console.warn("error: "+a.error),"function"==typeof f?f(a.error):e.message("warning","数据库错误。错误信息："+a.error))},error:function(a,b,c){"function"==typeof f?f(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}}))},this.updataEntity=function(b,c,d,f,g){if("app"==a.type?0!==c.indexOf(b+"/")||(c=c.slice(b.length+1)):0!==c.indexOf(b+"/")&&(c=b+"/"+c),"app"==a.type)$.ajax({type:"PUT",url:a.baseaddress+"common/"+b+"/"+c+"?appKey="+a.appKey+"&access_token="+a.accessToken,data:JSON.stringify(d),contentType:"application/json",success:function(a){0==a.code?f():(console.warn("error: "+a.message),"function"==typeof g?g(a.message):e.message("warning","错误信息："+a.message))},error:function(a,b,c){"function"==typeof g?g(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}});else{var c=encodeURIComponent(c);$.ajax({type:"PUT",url:a.baseaddress+b+"/"+c,data:JSON.stringify(d),contentType:"application/json",success:function(a){a.success?f():(console.warn("error: "+a.error),"function"==typeof g?g(a.error):e.message("warning","数据库错误。错误信息："+a.error))},error:function(a,b,c){"function"==typeof g?g(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}})}},this.deleteEntity=function(b,c,d,f){"app"==a.type?0!==c.indexOf(b+"/")||(c=c.slice(b.length+1)):0!==c.indexOf(b+"/")&&(c=b+"/"+c),"app"==a.type?$.ajax({type:"DELETE",url:a.baseaddress+"common/"+b+"/"+c+"?appKey="+a.appKey+"&access_token="+a.accessToken,data:{},contentType:"application/json",async:!1,success:function(a){0==a.code?d():(console.warn("error: "+a.message),"function"==typeof f?f(a.message):e.message("warning","错误信息："+a.message))},error:function(a,b,c){"function"==typeof f?f(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}}):(c=encodeURIComponent(c),$.ajax({type:"DELETE",url:a.baseaddress+b+"/"+c,data:{},contentType:"application/json",async:!1,success:function(a){a.success?d():(console.warn("error: "+a.error),"function"==typeof f?f(a.error):e.message("warning","数据库错误。错误信息："+a.error))},error:function(a,b,c){"function"==typeof f?f(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}}))},this.deleteEdge=function(b,c,d,f,g){"app"==a.type&&$.ajax({type:"DELETE",url:a.baseaddress+"common/edge/"+b+"/"+c+"/"+d+"?appKey="+a.appKey+"&access_token="+a.accessToken,data:{},contentType:"application/json",async:!1,success:function(a){0==a.code?f():(console.warn("error: "+a.message),"function"==typeof g?g(a.message):e.message("warning","错误信息："+a.message))},error:function(a,b,c){"function"==typeof g?g(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}})},this.snapshotsDelete=function(b){for(var c="",d=0;d<a.documentList.length;d++)c+=a.documentList[d];if(void 0!=e.editstorage&&e.editstorage.getStorage()!==!1){var g="",h=$(this.parentNode.parentNode);g=h.attr("imgid"),e.editstorage.getStorage().removeItem("negativeCanvas-"+c+"-"+g),e.editstorage.getStorage().removeItem("currentCanvas-"+c+"-"+g)}var i=$(this.parentNode.parentNode).attr("imgid"),j=$(this.parentNode.parentNode).attr("comefrom"),k=$(this.parentNode.parentNode).attr("save"),l=$(this).closest(".snapshot");return"cloud"==j||k?void f.alert("info",{msg:"该模型快照在云端有备份，是否将云端的快照一并删除？",title:"删除确认",buttons:{yes:{closeOnClick:!1,text:"一并删除"},no:{closeOnClick:!1,text:"只删除本地"}},callback:function(b,d){if("no"===d);else if("yes"===d){var f=l.attr("d_p"),g=l.attr("postilid");"null"!=f?e.deleteEntity("document_postil",f,function(){e.deleteEntity("postil",g,function(){e.message("success","删除成功！")})}):"app"==a.type&&e.deleteEdge("document_postil",c,g,function(){e.deleteEntity("postil",g,function(){e.message("success","删除成功！")})})}delete e.snapshots.models[i],delete e.snapshots.lookAts[i],delete e.snapshots.cutting[i],l.remove(),b.destroy()}}):(delete e.snapshots.models[i],delete e.snapshots.lookAts[i],delete e.snapshots.cutting[i],l.remove())},this.message=function(){var a,b="Success",c="",d="",e=!1,g=0;return function(h,i,j){return 5==h?$(".loading").addClass("hide"):b=h,"error"==h&&(e=!1),void 0!=i&&(c=i,void 0!=j&&(e=j)),(new Date).getTime()-g<5e3?c!=d&&(a=f.notify(b,{size:"mini",rounded:!0,position:"center top",sound:!1,delay:e,msg:c}),g=(new Date).getTime(),a.$el[0].childNodes[1].childNodes[0].title=c):(a=f.notify(b,{size:"mini",rounded:!0,position:"center top",sound:!1,delay:e,msg:c}),g=(new Date).getTime(),a.$el[0].childNodes[1].childNodes[0].title=c),d=c,a}}(),this.snapshotsRename=function(a){var b=this;f.prompt("text",{title:"重命名",modal:!0,value:b.innerHTML,attrs:{placeholder:""},buttons:{ok:{"class":"btn btn-info",closeOnClick:!1,text:"确定"},cancel:{"class":"btn btn-danger",closeOnClick:!1,text:"取消"}},callback:function(a,c){"ok"===c?($($(b).closest(".snapshot")).attr("change",!0),""!=a.getValue()?""==$.trim(a.getValue())?alert("您不能只输入空格"):b.innerHTML=a.getValue():b.innerHTML="未命名",a.destroy()):"cancel"===c&&a.destroy()}})},this.snapshotsAnnotation=function(){var a=this;f.prompt("text",{title:"添加/修改-注释/说明",value:a.innerHTML,multiline:!0,modal:!0,lines:6,attrs:{placeholder:""},buttons:{ok:{"class":"btn btn-info",closeOnClick:!1,text:"确定"},cancel:{"class":"btn btn-danger",closeOnClick:!1,text:"取消"}},callback:function(b,c){"ok"===c?($($(a).closest(".snapshot")).attr("change",!0),""!=b.getValue()?""==$.trim(b.getValue())?alert("您不能只输入空格"):a.innerHTML=b.getValue():a.innerHTML="无注释",b.destroy()):"cancel"===c&&b.destroy()}})},this.snapshotsPlay=function(){function b(a){return function(){c(a)}}function c(h){var i=$(f.get(h)).attr("imgid");void 0==e.snapshots.models[i]||void 0==e.snapshots.lookAts[i]?h<f.length&&c(h+1):(f.css({border:"2px"}),$(f.get(h)).css({border:"2px solid #002553"}),$("#snapshots"+g).scrollTop(300*h),void 0!=e.snapshots.models[i]&&void 0!=e.snapshots.lookAts[i]&&a.setSnapshootModel(e.snapshots.models[i],e.snapshots.lookAts[i],e.snapshots.cutting[i]),h<f.length&&(d=setTimeout(b(h+1),1e3))),h>=f.length&&$("#snapshotsPlate_yj"+g).text("播放模型快照")}var f=$(".snapshot");$("#snapshots"+g).scrollTop(0);var h=0;c(h)},this.snapshotsStop=function(){d&&clearTimeout(d)},this.snapshotsflyto=function(){$(".snapshot").css({border:"2px"});var b=$(this.parentNode.parentNode);b.css({border:"2px solid #002553"});var c=b.attr("imgid");null!=c&&void 0!=c&&a.setSnapshootModel(e.snapshots.models[c],e.snapshots.lookAts[c],e.snapshots.cutting[c])},this.postPostilToCloud=function(b,c,d,f){"app"==a.type?$.ajax({type:"POST",url:a.baseaddress+"common/postil?appKey="+a.appKey+"&access_token="+a.accessToken,data:JSON.stringify(b),contentType:"application/json",success:function(a){0==a.code?e.postDocument_PostilToCloud("postil/"+a.data.id,c,function(a,b){d(a,b)},function(b){"string"==typeof b?(e.message("warning","保存失败，将回滚当前快照。错误原因："+b),e.deleteEntity("postil",a.data.id,function(){e.message("success","回滚成功"),f("回滚成功")},function(a){"string"==typeof a?(e.message("warning","数据库错误，回滚失败。错误原因："+a),f("回滚失败")):f(a)})):f(b)}):(console.warn("error: "+a.error||a.message),"function"==typeof f&&f(a.error||a.message))},error:function(a,b,c){"function"==typeof f?f(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}}):$.ajax({type:"POST",url:a.baseaddress+"postil?appKey="+a.appKey+"&access_token="+a.accessToken,data:JSON.stringify(b),contentType:"application/json",success:function(a){a.success?e.postDocument_PostilToCloud(a.result._id,c,function(a,b){d(a,b)},function(b){"string"==typeof b?(e.message("warning","保存失败，将回滚当前快照。错误原因："+b),e.deleteEntity("postil",a.resul._id,function(){e.message("success","回滚成功"),f("回滚成功")},function(a){"string"==typeof a?(e.message("warning","数据库错误，回滚失败。错误原因："+a),f("回滚失败")):f(a)})):f(b)}):(console.warn("error: "+a.error||a.message),"function"==typeof f&&f(a.error||a.message))},error:function(a,b,c){"function"==typeof f?f(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}})},this.postDocument_PostilToCloud=function(b,c,d,f){for(var g="document/",h=0;h<a.documentList.length;h++)g+=a.documentList[h];var i={_from:g,_to:b,Class:"IR_documentPostil"},j="";"app"==a.type&&(j="edge/"),$.ajax({type:"POST",url:a.baseaddress+j+"document_postil?appKey="+a.appKey+"&access_token="+a.accessToken,data:JSON.stringify(i),contentType:"application/json",success:function(a){a.success||0==a.code?d(b,a.result?a.result._id:a.data.id):(console.warn("error: "+a.error||a.message),"function"==typeof f?f(a.error||a.message):e.message("warning","错误信息："+a.error||a.message))},error:function(a,b,c){"function"==typeof f?f(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}})},this.snapshotsSaveToCloud=function(){function a(){var a=h.getProgress();h.setProgress(1/d.length*100+a),i++,i==d.length?b("完成"):c()}function b(a){a&&e.message("success","本次保存已完成"),h.destroy(),$("#snapshotsSaveToCloud_yj"+g).removeAttr("disabled")}function c(){var c=d[i],g=$(c).attr("change"),j=$(c).attr("imgid"),k=$(c).attr("comefrom"),l=$(c).attr("save");c||(h.destroy(),e.message("warning","当前没有模型快照")),$(c).attr("order",(new Date).getTime());var m={Class:"postil",Description:c.children[1].children[1].innerHTML,Height:c.children[1].children[0].naturalHeight,Width:c.children[1].children[0].naturalWidth,Name:c.children[0].children[0].innerText,Order:$(c).attr("order"),Picture:c.children[1].children[0].src,Imgid:j,Snapshot:{look:e.snapshots.lookAts[j],model:e.snapshots.models[j],cutting:e.snapshots.cutting[j]}};if("cloud"==k||l){var n={Order:$(c).attr("order")};e.updataEntity("postil",$(c).attr("postilid"),n,function(){},function(a){}),"true"==g?f.alert("info",{msg:'名称为" '+c.children[0].children[0].innerText+' "的快照与云端不一致，是否同步到云端？',title:"已修改快照同步确认",closeButton:!1,closeOnEsc:!1,buttons:{yes:{closeOnClick:!1,text:"同步到云端"},ok:{closeOnClick:!1,text:"新建快照"},no:{closeOnClick:!1,text:"放弃修改"}},beforeClose:function(){},callback:function(d,f){if("no"===f)d.destroy(),a();else if("yes"===f){d.destroy();var g={Description:c.children[1].children[1].innerHTML,Height:c.children[1].children[0].naturalHeight,Width:c.children[1].children[0].naturalWidth,Name:c.children[0].children[0].innerText,Picture:c.children[1].children[0].src};e.updataEntity("postil",$(c).attr("postilid"),g,function(){$(c).attr("change",!1),a()},function(c){"string"==typeof c?(e.message("warning","数据库错误，更新失败。原因："+c),a()):c&&c.responseJSON?(e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+c.responseJSON.code+" 错误信息："+c.responseJSON.errorMessage+"”"),b()):(e.message("error","连接错误，更新失败。"),b())})}else if("ok"===f){d.destroy();var i=THREE.Math.generateUUID();$(c).attr("imgid",i),m.Imgid=i,e.postPostilToCloud(m,h,function(b,d){$(c).attr("change",!1),$(c).attr("save",!0),$(c).attr("postilid",b),$(c).attr("d_p",d),a()},function(c){"string"==typeof c?"回滚成功"==c||"回滚失败"==c?a():(e.message("warning","数据库错误，新建失败。原因："+c),a()):c&&c.responseJSON?(e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+c.responseJSON.code+" 错误信息："+c.responseJSON.errorMessage+"”"),b()):(e.message("error","连接错误，新建失败。"),b())})}}}):a()}else e.postPostilToCloud(m,h,function(b,d){$(c).attr("change",!1),$(c).attr("save",!0),$(c).attr("postilid",b),$(c).attr("d_p",d),a()},function(c){"string"==typeof c?"回滚成功"==c||"回滚失败"==c?a():(e.message("warning","数据库错误，保存失败。原因："+c),a()):c&&c.responseJSON?(e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+c.responseJSON.code+" 错误信息："+c.responseJSON.errorMessage+"”"),b()):(e.message("error","连接错误，保存失败。"),b())})}var d=$(".snapshot"),h=f.progress({title:"请等待··",label:"正在保存快照到云端···",onShow:function(a){}}),i=0;c()},this.loadSnapshotFromCloud=function(){function b(){f!=-1&&(g++,g>=f&&e.snapshotsSorting())}for(var c="",d=0;d<a.documentList.length;d++)c+=a.documentList[d];var f=-1,g=0;if("app"==a.type)$.ajax({type:"GET",url:a.baseaddress+"model/relation/document/"+c+"/children/postil?access_token="+a.accessToken+"&appKey="+a.appKey,data:{},contentType:"application/json",success:function(a){if(0==a.code)for(var c=0;c<a.data.length;c++){var d={look:a.data[c].Snapshot.look,model:a.data[c].Snapshot.model,cutting:a.data[c].Snapshot.cutting,imgURL:a.data[c].Picture,w:a.data[c].Width,h:a.data[c].Height,imgid:a.data[c].Imgid,from:"cloud",order:a.data[c].Order,name:a.data[c].Name,description:a.data[c].Description,d_p:null,postilid:a.data[c]._id};e.addSnapshots(d,function(){b()},function(){})}else console.warn("error: "+a.message)},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}});else{var h={_from:c};$.ajax({type:"POST",url:a.baseaddress+"document_postil/query",data:JSON.stringify(h),contentType:"application/json",success:function(a){if(a.success){f=a.result.length;for(var c=a.result.length-1;c>=0;c--)e.getEntity("postil",a.result[c]._to,function(a,c){var d={look:a.Snapshot.look,model:a.Snapshot.model,cutting:a.Snapshot.cutting,imgURL:a.Picture,w:a.Width,h:a.Height,imgid:a.Imgid,from:"cloud",order:a.Order,name:a.Name,description:a.Description,d_p:c,postilid:a._id};e.addSnapshots(d,function(){b()},function(){})},function(a){"string"==typeof a?e.message("warning","数据库错误，错误信息："+a):a&&a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","加载模型快照失败。")},a.result[c]._id)}else console.warn("error: "+a.error)},error:function(a,b,c){"function"==typeof error?error(a):a.responseJSON?e.message("error","网络请求发生错误，请稍后再试。详细信息“错误码："+a.responseJSON.code+" 错误信息："+a.responseJSON.errorMessage+"”"):e.message("error","网络请求发生错误，请稍后再试。")}})}},this.snapshotsSaveToPDF=function(){f.notify("info",{size:"mini",rounded:!0,position:"center top",sound:!1,delay:6e3,msg:"正在生成PDf，请稍候··"});var a=new jsPDF,b="审查报告",c=0,d=1;a.setFontSize(20),a.text(200,290,""+d);var g=e.textToimg("审查报告",40);c+=15,a.addImage(g.src,"png",84.2,c,.26*g.w,.26*g.h),c+=15,a.line(10,c,200,c);for(var h=$(".snapshot"),i=0;i<h.length;i++){c>287&&(a.addPage(),d++,a.text(200,290,""+d),c=15),c+=8,g=e.textToimg(h[i].children[0].children[0].innerText+" ：",30),a.addImage(g.src,"png",10,c,.26*g.w,.26*g.h),c+=.26*g.h+2;var j=h[i].children[1].children[0].naturalHeight,k=h[i].children[1].children[0].naturalWidth;j*=190/k,k=190,c+j>287&&(a.addPage(),d++,a.text(200,290,""+d),c=15),a.addImage(h[i].children[1].children[0].currentSrc,"png",10,c,k,j),c+=j+5,g=e.textToimg("注释：  "+h[i].children[1].children[1].innerHTML,20),c+.26*g.h>287&&(a.addPage(),d++,a.text(200,290,""+d),c=15),a.addImage(g.src,"png",10,c,.26*g.w,.26*g.h),c+=.26*g.h+5}a.save(b+".pdf")},this.textToimg=function(a,b){var d=[],e={};"string"==typeof a&&(a=a.match(/[\n\r]/)?a.split(/\r\n|\r|\n/g):[a]);for(var f=730,g=0;g<a.length;g++)if(c(a[g])*b/2>730)for(var h=Math.ceil(c(a[g])*b/2/730),i=Math.floor(730/b),j=1;j<=h;j++)d.push(a[g].substring((j-1)*i,j*i));else d.push(a[g]);var k=document.createElement("canvas");k.width=f,k.height=d.length*b+10;var l=k.getContext("2d");l.shadowOffsetX=0,l.shadowOffsetY=0,l.shadowBlur=0,l.shadowColor="#000000",l.strokeStyle="rgba(0,0,0,1)",l.fillStyle="rgba(0,0,0,1)",l.globalAlpha=1,l.font=b+"px serif",l.lineWidth=1,l.textAlign="left";for(var g=0;g<d.length;g++)l.fillText(d[g],0,b+b*g),l.strokeText(d[g],0,b+b*g);return l.restore(),e.src=k.toDataURL(),e.w=k.width,e.h=k.height,e},this.addSnapshots=function(a,c,d){var f=a.look,h=a.model,i=a.cutting,j=a.imgURL,k=a.w,m=a.h,n=a.imgid,o=a.from,p=a.order,q=a.name,r=a.description,s=a.d_p,t=a.postilid;if(!(f&&h&&j&&n&&k&&m&&o))return void d();var u="glyphicon-hdd",v="快照来自本地",w="快照"+l,x="";void 0!=q&&(w=q),void 0!=r&&(x=r),"cloud"==o&&(u="glyphicon-cloud",v="快照来自云端"),e.snapshots.models[n]=h,e.snapshots.lookAts[n]=f,e.snapshots.cutting[n]=i,$(".snapshot").css({border:"2px"});var y="";b&&(y='<button class="snapshot-button"data-type="ok" title="对快照进行编辑、批注">编辑图片</button>');var z=$('<div class="snapshot" order="'+p+'" imgid="'+n+'" comefrom="'+o+'" d_p="'+s+'" postilid="'+t+'" style="border: 2px solid #002553" num="'+l+'"><div class="snapshot-header"><span class="snapshot-name" title="点击以重命名">'+w+'</span><span class="snapshot-delete" title="删除快照">×</span></div><div class="snapshot-body" title="点击以浏览模型快照"><img class="snapshot-img" width='+k/5+'"px" height='+m/5+'"px" src="'+j+'"><textarea class="snapshot-annotation"  rows="1" type="text" placeholder="点击以添加注释" cols="51" title="点击以修改注释" data-attr="text" readonly="readonly">'+x+'</textarea></div><div class="snapshot-footer"><span class="glyphicon '+u+'" aria-hidden="true" title="'+v+'"></span>'+y+"</div></div>");if(z.find(".snapshot-delete").on("click",e.snapshotsDelete),z.find(".snapshot-img").on("click",e.snapshotsflyto),z.find(".snapshot-name").on("click",e.snapshotsRename),z.find(".snapshot-annotation").on("click",e.snapshotsAnnotation),z.find(".snapshot-button").on("click",e.snapshotsEdit),$("#snapshots"+g).append(z),"cloud"!=o){var A=$("#modelsnapshot"+g);A.removeClass("hide")}e.snapshotsPlateFlag=!0,$("#snapshots"+g).scrollTop(300*l),l+=1,c()},this.showsnapshot=function(){var a={title:"模型快照(Beta)",width:420,height:900,closeOnEsc:!1,closeButton:!0,afterWindowHide:function(a){var b=document.getElementById("SnapshotsPlate_yj"+g);e.snapshotsPlateFlag=!1,b.style.backgroundColor=""},content:'<div class="span12"> <button class="btn btn-info btn-block" id="snapshotsPlate_yj'+g+'" type="button">播放模型快照</button><button class="btn btn-danger btn-block" id="snapshotsSaveToCloud_yj'+g+'" type="button">快照和批注保存到云端</button> </div><div id="snapshots-area'+g+'"> <div id="snapshots-animframe'+g+'"> </div> <div style=" overflow-y:auto; overflow-x:auto;width: 399px;height: 750px" id="snapshots'+g+'"> </div> </div>'};this.snapshotsPlate=f.window(a),e.snapshotsPlate.setPosition({right:1,left:"",top:1}),e.snapshotsPlate.$el.attr("id","modelsnapshot"+g),e.snapshotsPlate.$el[0].style.zIndex=3999,e.snapshotsPlate.windowHide(),
$("#snapshotsPlate_yj"+g).on("click",function(a){"播放模型快照"==$("#snapshotsPlate_yj"+g).text()?($("#snapshotsPlate_yj"+g).text("退出模型快照播放"),e.snapshotsPlay()):"退出模型快照播放"==$("#snapshotsPlate_yj"+g).text()&&($("#snapshotsPlate_yj"+g).text("播放模型快照"),e.snapshotsStop())}),$("#SnapshotstoPDF_yj"+g).on("click",function(a){e.snapshotsSaveToPDF()}),$("#snapshotsSaveToCloud_yj"+g).on("click",function(a){$("#snapshotsSaveToCloud_yj"+g).attr({disabled:"disabled"}),e.snapshotsSaveToCloud()}),$("#snapshots"+g).sortable({delay:300}),$("#snapshots"+g).on("sortupdate",function(a,b){})},this.snapshotsSorting=function(){function a(a,b){return $(a).attr("order")>$(b).attr("order")?1:-1}var b=$("#snapshots"+g+">.snapshot").sort(a);$("#snapshots"+g).empty().append(b).each(function(a,b){$(b).find(".snapshot-delete").on("click",e.snapshotsDelete),$(b).find(".snapshot-img").on("click",e.snapshotsflyto),$(b).find(".snapshot-name").on("click",e.snapshotsRename),$(b).find(".snapshot-annotation").on("click",e.snapshotsAnnotation),$(b).find(".snapshot-button").on("click",e.snapshotsEdit)})}},function(){"use strict";var a=function(a){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype),a.prototype.constructor=a;var b=function(a){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype),b.prototype.constructor=b;var c=new a({visible:!1,transparent:!1});THREE.TransformGizmo=function(){this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),c={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=c.XYZE,c.YZ.rotation.set(0,Math.PI/2,0),c.XZ.rotation.set(-Math.PI/2,0,0);for(var d in c)c[d].name=d,this.planes.add(c[d]),this.planes[d]=c[d];var e=function(a,b){for(var c in a)for(d=a[c].length;d--;){var e=a[c][d][0],f=a[c][d][1],g=a[c][d][2];e.name=c,f&&e.position.set(f[0],f[1],f[2]),g&&e.rotation.set(g[0],g[1],g[2]),b.add(e)}};e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=a.geometry.clone();b.applyMatrix(a.matrix),a.geometry=b,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1)}})},this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name===a?b.material.highlight(!0):b.material.highlight(!1))})}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo,THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),e=new THREE.Matrix4;this.traverse(function(f){f.name.search("E")!==-1?f.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)):f.name.search("X")===-1&&f.name.search("Y")===-1&&f.name.search("Z")===-1||f.quaternion.setFromEuler(a)})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var d=new THREE.Geometry,e=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,(!1)));e.position.y=.5,e.updateMatrix(),d.merge(e.geometry,e.matrix);var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var g=new THREE.BufferGeometry;g.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,1,0],3));var h=new THREE.BufferGeometry;h.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new THREE.Mesh(d,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(d,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(d,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),c)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===a&&(this.activePlane=this.planes.XYZE),"XY"===a&&(this.activePlane=this.planes.XY),"YZ"===a&&(this.activePlane=this.planes.YZ),"XZ"===a&&(this.activePlane=this.planes.XZ)},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate,THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var a=function(a,b,c){var d=new THREE.BufferGeometry,e=[];c=c?c:1;for(var f=0;f<=64*c;++f)"x"===b&&e.push(0,Math.cos(f/32*Math.PI)*a,Math.sin(f/32*Math.PI)*a),"y"===b&&e.push(Math.cos(f/32*Math.PI)*a,0,Math.sin(f/32*Math.PI)*a),"z"===b&&e.push(Math.sin(f/32*Math.PI)*a,Math.cos(f/32*Math.PI)*a,0);return d.addAttribute("position",new THREE.Float32BufferAttribute(e,3)),d};this.handleGizmos={X:[[new THREE.Line(new a(1,"x",.5),new b({color:16711680}))]],Y:[[new THREE.Line(new a(1,"y",.5),new b({color:65280}))]],Z:[[new THREE.Line(new a(1,"z",.5),new b({color:255}))]],E:[[new THREE.Line(new a(1.25,"z",1),new b({color:13421568}))]],XYZE:[[new THREE.Line(new a(1,"z",1),new b({color:7895160}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.12,2,24),c)]],XYZE:[[new THREE.Mesh]]},this.setActivePlane=function(a){"E"===a&&(this.activePlane=this.planes.XYZE),"X"===a&&(this.activePlane=this.planes.YZ),"Y"===a&&(this.activePlane=this.planes.XZ),"Z"===a&&(this.activePlane=this.planes.XY)},this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=({handles:this.handles,pickers:this.pickers},new THREE.Matrix4),d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"X"===a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"Y"===a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"Z"===a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate,THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var d=new THREE.Geometry,e=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));e.position.y=.5,e.updateMatrix(),d.merge(e.geometry,e.matrix);var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var g=new THREE.BufferGeometry;g.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,1,0],3));var h=new THREE.BufferGeometry;h.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new THREE.Mesh(d,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(d,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(d,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.4,.4,.4),c)]]},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===a&&(this.activePlane=this.planes.XYZE)},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale,THREE.TransformControls=function(a,b){function c(a){if(void 0!==h.object&&j!==!0&&(void 0===a.button||0===a.button)){var b=a.changedTouches?a.changedTouches[0]:a,c=g(b,k[i].pickers.children),d=null;c&&(d=c.object.name,a.preventDefault()),h.axis!==d&&(h.axis=d,h.update(),h.dispatchEvent(n))}}function d(a){if(void 0!==h.object&&j!==!0&&(void 0===a.button||0===a.button)){var b=a.changedTouches?a.changedTouches[0]:a;if(0===b.button||void 0===b.button){var c=g(b,k[i].pickers.children);if(c){a.preventDefault(),a.stopPropagation(),h.dispatchEvent(o),h.axis=c.object.name,h.update(),z.copy(T).sub(Q).normalize(),k[i].setActivePlane(h.axis,z);var d=g(b,[k[i].activePlane]);d&&(L.copy(h.object.position),M.copy(h.object.scale),N.extractRotation(h.object.matrix),S.extractRotation(h.object.matrixWorld),O.extractRotation(h.object.parent.matrixWorld),P.setFromMatrixScale(A.getInverse(h.object.parent.matrixWorld)),u.copy(d.point))}}j=!0}}function e(a){if(void 0!==h.object&&null!==h.axis&&j!==!1&&(void 0===a.button||0===a.button)){var b=a.changedTouches?a.changedTouches[0]:a,c=g(b,[k[i].activePlane]);c!==!1&&(a.preventDefault(),a.stopPropagation(),t.copy(c.point),"translate"===i?(t.sub(u),t.multiply(P),"local"===h.space&&(t.applyMatrix4(A.getInverse(S)),h.axis.search("X")===-1&&(t.x=0),h.axis.search("Y")===-1&&(t.y=0),h.axis.search("Z")===-1&&(t.z=0),t.applyMatrix4(N),h.object.position.copy(L),h.object.position.add(t)),"world"!==h.space&&h.axis.search("XYZ")===-1||(h.axis.search("X")===-1&&(t.x=0),h.axis.search("Y")===-1&&(t.y=0),h.axis.search("Z")===-1&&(t.z=0),t.applyMatrix4(A.getInverse(O)),h.object.position.copy(L),h.object.position.add(t)),null!==h.translationSnap&&("local"===h.space&&h.object.position.applyMatrix4(A.getInverse(S)),h.axis.search("X")!==-1&&(h.object.position.x=Math.round(h.object.position.x/h.translationSnap)*h.translationSnap),h.axis.search("Y")!==-1&&(h.object.position.y=Math.round(h.object.position.y/h.translationSnap)*h.translationSnap),h.axis.search("Z")!==-1&&(h.object.position.z=Math.round(h.object.position.z/h.translationSnap)*h.translationSnap),"local"===h.space&&h.object.position.applyMatrix4(S))):"scale"===i?(t.sub(u),t.multiply(P),"local"===h.space&&("XYZ"===h.axis?(x=1+t.y/10/Math.max(M.x,M.y,M.z),h.object.scale.x=M.x*x,h.object.scale.y=M.y*x,h.object.scale.z=M.z*x):(t.applyMatrix4(A.getInverse(S)),"X"===h.axis&&(h.object.scale.x=M.x*(1+t.x/M.x)),"Y"===h.axis&&(h.object.scale.y=M.y*(1+t.y/M.y)),"Z"===h.axis&&(h.object.scale.z=M.z*(1+t.z/M.z))))):"rotate"===i&&(t.sub(Q),t.multiply(P),B.copy(u).sub(Q),B.multiply(P),"E"===h.axis?(t.applyMatrix4(A.getInverse(y)),B.applyMatrix4(A.getInverse(y)),v.set(Math.atan2(t.z,t.y),Math.atan2(t.x,t.z),Math.atan2(t.y,t.x)),w.set(Math.atan2(B.z,B.y),Math.atan2(B.x,B.z),Math.atan2(B.y,B.x)),C.setFromRotationMatrix(A.getInverse(O)),K.setFromAxisAngle(z,v.z-w.z),G.setFromRotationMatrix(S),C.multiplyQuaternions(C,K),C.multiplyQuaternions(C,G),h.object.quaternion.copy(C)):"XYZE"===h.axis?(K.setFromEuler(t.clone().cross(B).normalize()),C.setFromRotationMatrix(A.getInverse(O)),H.setFromAxisAngle(K,-t.clone().angleTo(B)),G.setFromRotationMatrix(S),C.multiplyQuaternions(C,H),C.multiplyQuaternions(C,G),h.object.quaternion.copy(C)):"local"===h.space?(t.applyMatrix4(A.getInverse(S)),B.applyMatrix4(A.getInverse(S)),v.set(Math.atan2(t.z,t.y),Math.atan2(t.x,t.z),Math.atan2(t.y,t.x)),w.set(Math.atan2(B.z,B.y),Math.atan2(B.x,B.z),Math.atan2(B.y,B.x)),G.setFromRotationMatrix(N),null!==h.rotationSnap?(H.setFromAxisAngle(D,Math.round((v.x-w.x)/h.rotationSnap)*h.rotationSnap),I.setFromAxisAngle(E,Math.round((v.y-w.y)/h.rotationSnap)*h.rotationSnap),J.setFromAxisAngle(F,Math.round((v.z-w.z)/h.rotationSnap)*h.rotationSnap)):(H.setFromAxisAngle(D,v.x-w.x),I.setFromAxisAngle(E,v.y-w.y),J.setFromAxisAngle(F,v.z-w.z)),"X"===h.axis&&G.multiplyQuaternions(G,H),"Y"===h.axis&&G.multiplyQuaternions(G,I),"Z"===h.axis&&G.multiplyQuaternions(G,J),h.object.quaternion.copy(G)):"world"===h.space&&(v.set(Math.atan2(t.z,t.y),Math.atan2(t.x,t.z),Math.atan2(t.y,t.x)),w.set(Math.atan2(B.z,B.y),Math.atan2(B.x,B.z),Math.atan2(B.y,B.x)),C.setFromRotationMatrix(A.getInverse(O)),null!==h.rotationSnap?(H.setFromAxisAngle(D,Math.round((v.x-w.x)/h.rotationSnap)*h.rotationSnap),I.setFromAxisAngle(E,Math.round((v.y-w.y)/h.rotationSnap)*h.rotationSnap),J.setFromAxisAngle(F,Math.round((v.z-w.z)/h.rotationSnap)*h.rotationSnap)):(H.setFromAxisAngle(D,v.x-w.x),I.setFromAxisAngle(E,v.y-w.y),J.setFromAxisAngle(F,v.z-w.z)),G.setFromRotationMatrix(S),"X"===h.axis&&C.multiplyQuaternions(C,H),"Y"===h.axis&&C.multiplyQuaternions(C,I),"Z"===h.axis&&C.multiplyQuaternions(C,J),C.multiplyQuaternions(C,G),h.object.quaternion.copy(C))),h.update(),h.dispatchEvent(n),h.dispatchEvent(q))}}function f(a){a.preventDefault(),void 0!==a.button&&0!==a.button||(j&&null!==h.axis&&(p.mode=i,h.dispatchEvent(p)),j=!1,"TouchEvent"in window&&a instanceof TouchEvent?(h.axis=null,h.update(),h.dispatchEvent(n)):c(a))}function g(c,d){var e=b.getBoundingClientRect(),f=(c.clientX-e.left)/e.width,g=(c.clientY-e.top)/e.height;s.set(2*f-1,-(2*g)+1),r.setFromCamera(s,a);var h=r.intersectObjects(d,!0);return!!h[0]&&h[0]}THREE.Object3D.call(this),b=void 0!==b?b:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var h=this,i="translate",j=!1,k={translate:new THREE.TransformGizmoTranslate,rotate:new THREE.TransformGizmoRotate,scale:new THREE.TransformGizmoScale};for(var l in k){var m=k[l];m.visible=l===i,this.add(m)}var n={type:"change"},o={type:"mouseDown"},p={type:"mouseUp",mode:i},q={type:"objectChange"},r=new THREE.Raycaster,s=new THREE.Vector2,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3,x=1,y=new THREE.Matrix4,z=new THREE.Vector3,A=new THREE.Matrix4,B=new THREE.Vector3,C=new THREE.Quaternion,D=new THREE.Vector3(1,0,0),E=new THREE.Vector3(0,1,0),F=new THREE.Vector3(0,0,1),G=new THREE.Quaternion,H=new THREE.Quaternion,I=new THREE.Quaternion,J=new THREE.Quaternion,K=new THREE.Quaternion,L=new THREE.Vector3,M=new THREE.Vector3,N=new THREE.Matrix4,O=new THREE.Matrix4,P=new THREE.Vector3,Q=new THREE.Vector3,R=new THREE.Euler,S=new THREE.Matrix4,T=new THREE.Vector3,U=new THREE.Euler;b.addEventListener("mousedown",d,!1),b.addEventListener("touchstart",d,!1),b.addEventListener("mousemove",c,!1),b.addEventListener("touchmove",c,!1),b.addEventListener("mousemove",e,!1),b.addEventListener("touchmove",e,!1),b.addEventListener("mouseup",f,!1),b.addEventListener("mouseout",f,!1),b.addEventListener("touchend",f,!1),b.addEventListener("touchcancel",f,!1),b.addEventListener("touchleave",f,!1),this.dispose=function(){b.removeEventListener("mousedown",d),b.removeEventListener("touchstart",d),b.removeEventListener("mousemove",c),b.removeEventListener("touchmove",c),b.removeEventListener("mousemove",e),b.removeEventListener("touchmove",e),b.removeEventListener("mouseup",f),b.removeEventListener("mouseout",f),b.removeEventListener("touchend",f),b.removeEventListener("touchcancel",f),b.removeEventListener("touchleave",f)},this.attach=function(a){this.object=a,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return i},this.setMode=function(a){i=a?a:i,"scale"===i&&(h.space="local");for(var b in k)k[b].visible=b===i;this.update(),h.dispatchEvent(n)},this.setTranslationSnap=function(a){h.translationSnap=a},this.setRotationSnap=function(a){h.rotationSnap=a},this.setSize=function(a){h.size=a,this.update(),h.dispatchEvent(n)},this.setSpace=function(a){h.space=a,this.update(),h.dispatchEvent(n)},this.update=function(){void 0!==h.object&&(h.object.updateMatrixWorld(),Q.setFromMatrixPosition(h.object.matrixWorld),R.setFromRotationMatrix(A.extractRotation(h.object.matrixWorld)),a.updateMatrixWorld(),T.setFromMatrixPosition(a.matrixWorld),U.setFromRotationMatrix(A.extractRotation(a.matrixWorld)),x=Q.distanceTo(T)/6*h.size,this.position.copy(Q),this.scale.set(x,x,x),a instanceof THREE.PerspectiveCamera?z.copy(T).sub(Q).normalize():a instanceof THREE.OrthographicCamera&&z.copy(T).normalize(),"local"===h.space?k[i].update(R,z):"world"===h.space&&k[i].update(new THREE.Euler,z),k[i].highlight(h.axis))}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformControls.prototype.constructor=THREE.TransformControls}(),"object"==typeof module&&(module.exports=BIMWINNER);