/*
 * BIMEditPicture V1.0.0
 *
 * Edit model snapshot generated images
 * http://www.bimwinner.com
 *
 * Built on 2016-12-08
 *
 * todo
 * Copyright 2016, wgb
 * 
 *
 */

!function(a,b){"use strict";var c=function(){this.storage=null};c.prototype={init:function(){function a(){var a=!1;return"object"==typeof b.localStorage?a=localStorage:"object"==typeof b.globalStorage&&(a=b.globalStorage),a}this.storage=a()},getStorage:function(){return this.storage},save:function(a,b){var c=this.storage,d=!1;return c!==!1&&(d=c.setItem(a,b)),d},load:function(a){var b=this.storage,c=!1;return b!==!1&&(c=b.getItem(a)),c}},b.painter=b.painter||{},b.painter.model=b.painter.model||{},b.painter.model.StorageModel=c}(jQuery,window),function(a,b){"use strict";var c,d,e,f,g,h,i;c=function(){this.name="Mouse",this.option={},this.mouseShape=null,this.init=function(a,c){var d="CircleStroke";this.setOption({lineWidth:1,strokeStyle:a.strokeStyle,radius:Math.ceil(a.lineWidth/2),opacity:100}),this.setPoints(c),this.setMouseShape(new b.painter.model.shapeModel[d]),this.initMouseShape(),this.setImage()},this.paint=function(a){this.getMouseShape().paint(a)}},c.prototype={getName:function(){return this.name},setOption:function(b){return"object"==typeof b?(a.extend(!0,this.option,b),this.getOption()):null},getOption:function(){return a.extend(!0,{},this.option)},getMouseShape:function(){return this.mouseShape},setMouseShape:function(a){return this.mouseShape=a,a},setPoints:function(a){this.setOption(a)},initMouseShape:function(){this.getMouseShape().init(this.getOption())},setImage:function(){var b=a("#canvas-mouse"),c=this.getName();return b.attr("data-mouse",c),!0}},d=function(){this.name="Cross",this.init=function(a,c){var d=this.getName();this.setOption({length:10,lineHeight:1,opacity:100,strokeStyle:a.strokeStyle,lineJoin:a.lineJoin,lineCap:a.lineCap,shadowOffsetX:a.shadowOffsetX,shadowOffsetY:a.shadowOffsetY,shadowBlur:a.shadowBlur,shadowColor:a.shadowColor}),this.setPoints(c),this.setMouseShape(new b.painter.model.shapeModel[d]),this.initMouseShape(),this.setImage()},this.paint=function(a){this.getMouseShape().paint(a)}},d.prototype=new c,e=function(){this.name="Pen"},e.prototype=new c,f=function(){this.name="Eraser",this.init=function(a,c){var d="CircleStroke";this.setOption({strokeStyle:"#000",opacity:a.opacity,radius:Math.ceil(a.lineWidth/2,10),lineJoin:a.lineJoin,lineCap:a.lineCap,shadowOffsetX:a.shadowOffsetX,shadowOffsetY:a.shadowOffsetY,shadowBlur:a.shadowBlur,shadowColor:a.shadowColor}),this.setPoints(c),this.setMouseShape(new b.painter.model.shapeModel[d]),this.initMouseShape(),this.setImage()},this.paint=function(a){this.getMouseShape().paint(a)}},f.prototype=new c,g=function(){this.name="Text",this.init=function(a,b){this.setImage()},this.paint=function(a){}},g.prototype=new c,h=function(){this.name="FloodFill",this.init=function(a,c){var d="CircleStroke";this.setOption({strokeStyle:"#000",opacity:90,radius:Math.ceil(a.lineWidth/2,10)}),this.setPoints(c),this.setMouseShape(new b.painter.model.shapeModel[d]),this.initMouseShape(),this.setImage()},this.paint=function(a){this.getMouseShape().paint(a)}},h.prototype=new c,i=function(){this.name="EyeDropper",this.init=function(a,c){var d="CircleStroke";this.setOption({strokeStyle:"#000",opacity:90,radius:Math.ceil(a.lineWidth/2,10)}),this.setPoints(c),this.setMouseShape(new b.painter.model.shapeModel[d]),this.initMouseShape(),this.setImage()},this.paint=function(a){this.getMouseShape().paint(a)}},i.prototype=new c,b.painter=b.painter||{},b.painter.model=b.painter.model||{},b.painter.model.mouseModel=b.painter.model.mouseModel||{},b.painter.model.mouseModel.Mouse=c,b.painter.model.mouseModel.Cross=d,b.painter.model.mouseModel.Pen=e,b.painter.model.mouseModel.Eraser=f,b.painter.model.mouseModel.Text=g,b.painter.model.mouseModel.FloodFill=h,b.painter.model.mouseModel.EyeDropper=i}(jQuery,window),function(a,b){"use strict";var c={list:[],add:function(a){return this.list.push(a),this.list},getStart:function(){return this.list[0]},getEnd:function(){return this.list[this.list.length-1]},getList:function(){return this.list},init:function(){return this.list=[],this.list}};b.painter=b.painter||{},b.painter.model=b.painter.model||{},b.painter.model.PointList=c}(jQuery,window),function(a,b){"use strict";function c(a,b,c,d,e){var f=d/.75/2,g=e/2;return a.beginPath(),a.moveTo(b,c-g),a.bezierCurveTo(b+f,c-g,b+f,c+g,b,c+g),a.bezierCurveTo(b-f,c+g,b-f,c-g,b,c-g),a.closePath(),a}var d,e,f,g,h,i,j,k,l,m,n,o,p,q=null,r=null,s=null,t=null,u=null,v=null,w=null;q=function(){this.name="Shape",this.option={}},q.prototype={init:function(a){this.initOption(a)},getName:function(){return this.name},initOption:function(a){this.option={},this.setOption(a)},setOption:function(b){return a.extend(!0,this.option,b),this.option},getOption:function(){return this.option},repaint:function(a){this.paint(a)},setAttributes:function(a){}},d=function(){this.name="FillStroke",this.setAttributes=function(a){var b=this.getOption();a.strokeStyle=b.strokeStyle,a.fillStyle=b.fillStyle,a.lineWidth=b.lineWidth,a.globalAlpha=b.opacity/100,a.lineJoin=b.lineJoin,a.lineCap=b.lineCap,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.shadowBlur=b.shadowBlur,a.shadowColor=b.shadowColor}},d.prototype=new q,r=function(){this.name="Line",this.paint=function(a){var b=this.getOption();a.save(),this.setAttributes(a),a.beginPath(),a.moveTo(b.startX,b.startY),a.lineTo(b.endX,b.endY),a.closePath(),a.stroke(),a.restore()}},r.prototype=new d,e=function(){this.name="CurveClosed",this.paint=function(a){var b=this.getOption(),c=b.list,d=c[0],e=c.length,f=0;for(a.save(),this.setAttributes(a),a.beginPath(),a.moveTo(d.x,d.y),f;e>f;f+=1)a.lineTo(c[f].x,c[f].y);a.closePath(),a.fill(),a.stroke(),a.restore()}},e.prototype=new d,s=function(){this.name="Rect",this.paint=function(a){var b=this.getOption();a.save(),this.setAttributes(a),a.fillRect(b.left,b.top,b.width,b.height),a.strokeRect(b.left,b.top,b.width,b.height),a.restore()}},s.prototype=new d,t=function(){this.name="Circle",this.paint=function(a){var b=this.getOption();a.save(),this.setAttributes(a),a.beginPath(),a.arc(b.x,b.y,b.radius,0,2*Math.PI,!0),a.closePath(),a.fill(),a.stroke(),a.restore()}},t.prototype=new d,f=function(){this.name="Ellipes",this.paint=function(a){var b=this.getOption(),d=b.x,e=b.y,f=b.width,g=b.height;a.save(),this.setAttributes(a),c(a,d,e,f,g),a.fill(),a.stroke(),a.restore()}},f.prototype=new d,g=function(){this.name="Stroke",this.setAttributes=function(a){var b=this.getOption();a.strokeStyle=b.strokeStyle,a.lineWidth=b.lineWidth,a.globalAlpha=b.opacity/100,a.lineJoin=b.lineJoin,a.lineCap=b.lineCap,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.shadowBlur=b.shadowBlur,a.shadowColor=b.shadowColor}},g.prototype=new q,u=function(){this.name="Pen",this.paint=function(a){var b=this.getOption(),c=b.list,d=c[0],e=c.length,f=0;for(a.save(),this.setAttributes(a),a.beginPath(),a.moveTo(d.x,d.y),f;e>f;f+=1)a.lineTo(c[f].x,c[f].y);a.stroke(),a.restore()}},u.prototype=new g,h=function(){this.name="CurveClosedStroke",this.paint=function(a){var b=this.getOption(),c=b.list,d=c[0],e=c.length,f=0;for(a.save(),this.setAttributes(a),a.beginPath(),a.moveTo(d.x,d.y),f;e>f;f+=1)a.lineTo(c[f].x,c[f].y);a.closePath(),a.stroke(),a.restore()}},h.prototype=new g,v=function(){this.name="RectStroke",this.paint=function(a){var b=this.getOption();a.save(),this.setAttributes(a),a.strokeRect(b.left,b.top,b.width,b.height),a.restore()}},v.prototype=new g,w=function(){this.name="CircleStroke",this.paint=function(a){var b=this.getOption();a.save(),this.setAttributes(a),a.beginPath(),a.arc(b.x,b.y,b.radius,0,2*Math.PI,!0),a.closePath(),a.stroke(),a.restore()}},w.prototype=new g,m=function(){this.name="EllipesStroke",this.paint=function(a){var b=this.getOption(),d=b.x,e=b.y,f=b.width,g=b.height;a.save(),this.setAttributes(a),c(a,d,e,f,g),a.stroke(),a.restore()}},m.prototype=new g,i=function(){this.name="Eraser",this.paint=function(a){var b=this.getOption(),c=b.list,d=c[0],e=c.length,f=0;for(a.save(),a.strokeStyle=b.color,a.lineWidth=b.lineWidth,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.shadowBlur=b.shadowBlur,a.shadowColor=b.shadowColor,a.lineJoin=b.lineJoin,a.lineCap=b.lineCap,a.globalAlpha=b.opacity/100,a.beginPath(),a.moveTo(d.x,d.y),f;e>f;f+=1)a.lineTo(c[f].x,c[f].y);a.stroke(),a.restore()}},i.prototype=new q,j=function(){this.name="FloodFill",this.paint=function(a){function c(a,b,c,d,e,f,g,h,i){function j(a){return 0!==a.length}for(var m=4*(c*l+k),n=e[m],o=e[m+1],p=e[m+2],q=e[m+3]/255,r="rgba(".concat(n,",",o,",",p,",",q,")"),s=null;j(a);)s=a.pop(),m=4*(c*s.y+s.x),n=e[m],o=e[m+1],p=e[m+2],q=e[m+3]/255,r="rgba(".concat(n,",",o,",",p,",",q,")"),r!==h&&Math.abs(n-g.r)<b&&Math.abs(o-g.g)<b&&Math.abs(p-g.b)<b&&Math.abs(q-g.a)<b/256&&(e[m]=i.r,e[m+1]=i.g,e[m+2]=i.b,e[m+3]=i.a,k>0&&a.push({x:s.x-1,y:s.y}),c>k&&a.push({x:s.x+1,y:s.y}),l>0&&a.push({x:s.x,y:s.y-1}),d>l&&a.push({x:s.x,y:s.y+1}));return 0}var d=this.getOption(),e=d.allowance,f=d.fillStyle,g=f.indexOf("(")+1,h=f.slice(g,-1),i=h.split(","),j={r:parseInt(i[0],10),g:parseInt(i[1],10),b:parseInt(i[2],10),a:Math.ceil(255*(i[3]||1))},k=d.x,l=d.y,m=d.width,n=d.height,o=a.getImageData(0,0,m,n),p=o.data,q=4*(m*l+k),r=p[q],s=p[q+1],t=p[q+2],u=p[q+3]/255,v="rgba(".concat(r,",",s,",",t,",",u,")"),w={r:r,g:s,b:t,a:u},x=[{x:k,y:l}];try{c(x,e,m,n,p,v,w,f,j)}catch(y){b.console.log(y.message)}a.save(),a.putImageData(o,0,0),a.restore()}},j.prototype=new q,k=function(){this.name="EyeDropper",this.paint=function(b){var c=this.getOption(),d=a("#tool-wrap .tool .color").eq(0),e=b.getImageData(c.x,c.y,1,1).data,f=e[0],g=e[1],h=e[2],i=e[3]/255,j="rgba(".concat(f,",",g,",",h,",",i,")");d.spectrum("set",j)},this.repaint=function(){}},k.prototype=new q,l=function(){this.name="Cross",this.paint=function(a){var b=this.getOption(),c=b.x,d=b.y,e=b.length,f=c-e,g=d,h=c+e,i=d,j=c,k=d-e,l=c,m=d+e;a.save(),a.strokeStyle=b.strokeStyle,a.lineWidth=b.lineWidth,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.shadowBlur=b.shadowBlur,a.shadowColor=b.shadowColor,a.lineJoin=b.lineJoin,a.lineCap=b.lineCap,a.globalAlpha=b.opacity/100,a.beginPath(),a.moveTo(f,g),a.lineTo(h,i),a.moveTo(j,k),a.lineTo(l,m),a.closePath(),a.stroke(),a.restore()}},l.prototype=new q,n=function(){this.name="Text",this.setAttributes=function(a){var b=this.getOption();a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.shadowBlur=b.shadowBlur,a.shadowColor=b.shadowColor,a.strokeStyle=b.strokeStyle,a.fillStyle=b.fillStyle,a.globalAlpha=b.opacity/100,a.font=b.italic+" "+b.bold+" "+b.size+"px "+b.family,a.lineWidth=b.border,a.textAlign=b.textAlign},this.paint=function(a){var b=this.getOption(),c=b.x,d=b.y,e=b.text;a.save(),this.setAttributes(a),a.fillText(e,c,d),a.strokeText(e,c,d),a.restore()}},n.prototype=new q,o=function(){this.name="TextStroke",this.paint=function(a){var b=this.getOption(),c=b.x,d=b.y,e=b.text;a.save(),this.setAttributes(a),a.strokeText(e,c,d),a.restore()}},o.prototype=new n,p=function(){this.name="ImageShape",this.paint=function(a){var b=this.getOption(),c=b.x,d=b.y,e=b.src,f=b.width,g=b.height,h=new Image,i=this;h.src=e,h.onload=function(){a.save(),i.setAttributes(a),a.drawImage(h,c,d,f,g),a.restore()}}},p.prototype=new q,b.painter=b.painter||{},b.painter.model=b.painter.model||{},b.painter.model.shapeModel=b.painter.model.shapeModel||{},b.painter.model.shapeModel.Line=r,b.painter.model.shapeModel.CurveClosed=e,b.painter.model.shapeModel.Rect=s,b.painter.model.shapeModel.Circle=t,b.painter.model.shapeModel.Pen=u,b.painter.model.shapeModel.CurveClosedStroke=h,b.painter.model.shapeModel.RectStroke=v,b.painter.model.shapeModel.CircleStroke=w,b.painter.model.shapeModel.Eraser=i,b.painter.model.shapeModel.FloodFill=j,b.painter.model.shapeModel.EyeDropper=k,b.painter.model.shapeModel.Cross=l,b.painter.model.shapeModel.Ellipes=f,b.painter.model.shapeModel.EllipesStroke=m,b.painter.model.shapeModel.Text=n,b.painter.model.shapeModel.TextStroke=o,b.painter.model.shapeModel.ImageShape=p}(jQuery,window),function(a,b){"use strict";var c={init:function(){this.bindEvent()},bindEvent:function(){var c=a(document);c.delegate("#nav-file-export","click",function(c){var d=b.painter.canvas.currentCanvasContainer.getCanvas(),e=b.painter.canvas.negativeCanvasContainer.getCanvas(),f=new Image,g=new Image,h=document.createElement("canvas");h.width=d.width,h.height=d.height;var i=h.getContext("2d");f.src=e.getCanvas().toDataURL("image/png"),g.src=d.getCanvas().toDataURL("image/png"),i.drawImage(f,0,0),i.drawImage(g,0,0);var j=a("#save-image").get(0);j.src=h.toDataURL()}),c.delegate("#nav-file-save","click",function(c){var d=b.painter.canvas.currentCanvasContainer.getCanvas(),e=b.painter.canvas.negativeCanvasContainer.getCanvas();d.save(),e.save(),a.fn.TorangeNotice({type:"success",content:"保存成功"}),window.console.log("触发保存事件")}),c.delegate("#nav-edit-undo","click",function(a){var c=b.painter.canvas.currentCanvasContainer.getCanvas();c.undo()}),c.delegate("#nav-edit-clear","click",function(a){var c=b.painter.canvas.currentCanvasContainer.getCanvas();c.clear()}),c.delegate("#nav-edit-clear-negative","click",function(a){var c=b.painter.canvas.negativeCanvasContainer.getCanvas();c.clear()}),c.delegate("#nav-edit-convert","click",function(a){var c=b.painter.canvas.currentCanvasContainer.getCanvas();c.convert()}),c.delegate("#nav-edit-flipx","click",function(a){var c=b.painter.canvas.currentCanvasContainer.getCanvas();c.flipX()}),c.delegate("#nav-edit-flipy","click",function(a){var c=b.painter.canvas.currentCanvasContainer.getCanvas();c.flipY()})}};a(document).ready(function(){c.init()})}(jQuery,window),function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;c=function(b){this.name="Tool",this.className="shape",this.mouse="Mouse",this.option={strokeStyle:"#000",fillStyle:"#000",lineWidth:1},void 0!==b?a.extend(this.option,b):0},c.prototype={getClassName:function(){return this.className},getName:function(){return this.name},setOption:function(b){return"object"==typeof b?(a.extend(!0,this.option,b),this.getOption()):null},getOption:function(){return a.extend(!0,{},this.option)},getMouse:function(){return this.mouse}},d=function(){this.name="Shape",this.mouse="Cross",this.initAttributes=function(){var b=a("#tool-shape-attribute-panel"),c=a(".width",b).eq(0).val(),d=a(".opacity",b).eq(0).val(),e=a("#tool-wrap .tool .color").eq(0).val(),f=a(':radio[name="line-join"]',b).val(),g=a(".shadow-offsetx",b).eq(0).val(),h=a(".shadow-offsety",b).eq(0).val(),i=a(".shadow-blur",b).eq(0).val(),j=a(".shadow-color",b).eq(0).val(),k=a(':radio[name="line-cap"]',b).val();return this.setOption({lineWidth:c,opacity:d,strokeStyle:e,fillStyle:e,lineJoin:f,lineCap:k,shadowOffsetX:g,shadowOffsetY:h,shadowBlur:i,shadowColor:j})}},d.prototype=new c,e=function(){this.name="Line",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getStart(),c=a.getEnd(),d=b.x,e=b.y,f=c.x,g=c.y;return this.setOption({startX:d,startY:e,endX:f,endY:g})}},e.prototype=new d,f=function(){this.name="CurveClosed",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getList();return this.option.list=[],this.setOption({list:b})}},f.prototype=new d,g=function(){this.name="Rect",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getStart(),c=a.getEnd(),d=b.x,e=b.y,f=c.x-d,g=c.y-e;return this.setOption({left:d,top:e,width:f,height:g})}},g.prototype=new d,h=function(){this.name="Circle",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getStart(),c=a.getEnd(),d=(b.x+c.x)/2,e=(b.y+c.y)/2,f=Math.abs(Math.sqrt(Math.pow(b.x,2)+Math.pow(b.y,2))-Math.sqrt(Math.pow(c.x,2)+Math.pow(c.y,2)))/2;return this.setOption({x:d,y:e,radius:f})}},h.prototype=new d,i=function(){this.name="Ellipes",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getStart(),c=a.getEnd(),d=(b.x+c.x)/2,e=(b.y+c.y)/2,f=Math.abs(b.x-c.x),g=Math.abs(b.y-c.y);return this.setOption({x:d,y:e,width:f,height:g})}},i.prototype=new d,j=function(){this.name="Stroke",this.mouse="Cross",this.initAttributes=function(){var b=a("#tool-stroke-attribute-panel"),c=a(".width",b).eq(0).val(),d=a(".opacity",b).eq(0).val(),e=a("#tool-wrap .tool .color").eq(0).val(),f=a(".shadow-offsetx",b).eq(0).val(),g=a(".shadow-offsety",b).eq(0).val(),h=a(".shadow-blur",b).eq(0).val(),i=a(".shadow-color",b).eq(0).val(),j=a(':radio[name="line-join"]',b).val(),k=a(':radio[name="line-cap"]',b).val();return this.setOption({lineWidth:c,opacity:d,strokeStyle:e,lineJoin:j,lineCap:k,shadowOffsetX:f,shadowOffsetY:g,shadowBlur:h,shadowColor:i})}},j.prototype=new c,k=function(){this.name="Pen",this.mouse="Pen",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getList();return this.option.list=[],this.setOption({list:b})}},k.prototype=new j,l=function(){this.name="CurveClosedStroke",this.mouse="Cross"},l.prototype=new k,m=function(){this.name="RectStroke",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getStart(),c=a.getEnd(),d=b.x,e=b.y,f=c.x-d,g=c.y-e;return this.setOption({left:d,top:e,width:f,height:g})}},m.prototype=new j,n=function(){this.name="CircleStroke",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getStart(),c=a.getEnd(),d=(b.x+c.x)/2,e=(b.y+c.y)/2,f=Math.abs(Math.sqrt(Math.pow(b.x,2)+Math.pow(b.y,2))-Math.sqrt(Math.pow(c.x,2)+Math.pow(c.y,2)))/2;return this.setOption({x:d,y:e,radius:f})}},n.prototype=new j,s=function(){this.name="EllipesStroke",this.init=function(){this.initAttributes()},this.setPoint=function(a){var b=a.getStart(),c=a.getEnd(),d=(b.x+c.x)/2,e=(b.y+c.y)/2,f=Math.abs(b.x-c.x),g=Math.abs(b.y-c.y);return this.setOption({x:d,y:e,width:f,height:g})}},s.prototype=new j,o=function(){this.name="Eraser",this.mouse="Eraser",this.init=function(){var b=a("#tool-eraser-attribute-panel"),c=a(".width",b).eq(0).val(),d=a(".opacity",b).eq(0).val(),e=a(".shadow-offsetx",b).eq(0).val(),f=a(".shadow-offsety",b).eq(0).val(),g=a(".shadow-blur",b).eq(0).val(),h=a(".shadow-color",b).eq(0).val(),i=a(':radio[name="line-join"]',b).val(),j=a(':radio[name="line-cap"]',b).val();return this.setOption({opacity:d,lineWidth:c,color:"#fff",shadowOffsetX:e,shadowOffsetY:f,shadowBlur:g,shadowColor:h,lineJoin:i,lineCap:j})},this.setPoint=function(a){var b=a.getList();return this.option.list=[],this.setOption({list:b})}},o.prototype=new c,p=function(){this.name="FloodFill",this.mouse="FloodFill",this.init=function(){var c=a("#tool-flood-fill-attribute-panel"),d=a("#tool-wrap .tool .color").eq(0).val(),e=parseInt(a(".allowance",c).eq(0).val(),10),f=b.painter.canvas.currentCanvasContainer.getCanvas(),g=f.getWidth(),h=f.getHeight();return this.setOption({fillStyle:d,width:g,height:h,allowance:e})},this.setPoint=function(a){var b=a.getEnd(),c=b.x,d=b.y;return this.setOption({x:c,y:d})}},p.prototype=new c,q=function(){this.name="EyeDropper",this.mouse="EyeDropper",this.init=function(){return this.setOption({})},this.setPoint=function(a){var b=a.getEnd(),c=b.x,d=b.y;return this.setOption({x:c,y:d})}},q.prototype=new c,r=function(){this.name="Cross",this.init=function(){return this.setOption({lineWidth:1,strokeStyle:"#000000",length:10})},this.setPoint=function(a){var b=a.getEnd(),c=b.x,d=b.y;return this.setOption({x:c,y:d})}},r.prototype=new c,t=function(){this.name="Text",this.mouse="Text",this.init=function(){this.initAttributes()},this.initAttributes=function(){var b=a("#tool-text-attribute-panel"),c=a(".opacity",b).eq(0).val(),d=a(".text",b).eq(0).val(),e=a(".size",b).eq(0).val(),f=a(".border",b).eq(0).val(),g=a(".font",b).eq(0).val(),h="checked"===a(".bold",b).eq(0).attr("checked")?"bold":"",i="checked"===a(".italic",b).eq(0).attr("checked")?"italic":"",j=a(".shadow-offsetx",b).eq(0).val(),k=a(".shadow-offsety",b).eq(0).val(),l=a(".shadow-blur",b).eq(0).val(),m=a(".shadow-color",b).eq(0).val(),n=a("#tool-wrap .tool .color").eq(0).val();return this.setOption({strokeStyle:n,opacity:c,fillStyle:n,text:d,size:e,border:f,family:g,bold:h,italic:i,shadowOffsetX:j,shadowOffsetY:k,shadowBlur:l,shadowColor:m})},this.setPoint=function(a){var b=a.getStart(),c=a.getEnd(),d=b.x,e=b.y,f=d<=c.x?"left":"right";return this.setOption({x:d,y:e,textAlign:f})}},t.prototype=new c,u=function(){this.name="TextStroke"},u.prototype=new t,b.painter=b.painter||{},b.painter.model=b.painter.model||{},b.painter.model.toolModel=b.painter.model.toolModel||{},b.painter.model.toolModel.Line=e,b.painter.model.toolModel.CurveClosed=f,b.painter.model.toolModel.Rect=g,b.painter.model.toolModel.Circle=h,b.painter.model.toolModel.Pen=k,b.painter.model.toolModel.CurveClosedStroke=l,b.painter.model.toolModel.RectStroke=m,b.painter.model.toolModel.CircleStroke=n,b.painter.model.toolModel.Eraser=o,b.painter.model.toolModel.FloodFill=p,b.painter.model.toolModel.EyeDropper=q,b.painter.model.toolModel.Cross=r,b.painter.model.toolModel.Ellipes=i,b.painter.model.toolModel.EllipesStroke=s,b.painter.model.toolModel.Text=t,b.painter.model.toolModel.TextStroke=u}(jQuery,window),function(a,b){"use strict";var c={tool:null,init:function(a){a.init(),this.setTool(a)},setTool:function(a){return this.tool=a,!0},getTool:function(){return this.tool}};b.painter=b.painter||{},b.painter.model=b.painter.model||{},b.painter.model.ToolContainerModel=c}(jQuery,window),function(a,b){"use strict";var c;c=function(){this.currentOpenAttributePanel=null},c.prototype={init:function(){this.bindEvent(),this.initAttributePanel(),this.initColor(),b.painter.tool=b.painter.tool||{},b.painter.tool.currentToolContainer=Object.create(b.painter.model.ToolContainerModel),b.painter.tool.currentToolContainer.init(new b.painter.model.toolModel.Line)},initAttributePanel:function(){var b=a("#tool-wrap"),c=a("footer"),d=a(".tool-attribute-panel",b),e=d.filter("#tool-shape-attribute-panel");d.dialog({position:{my:"right bottom",at:"right bottom",of:c},autoOpen:!1}),this.setCurrentAttributePanel(e),this.openAttributePanel(e)},initColor:function(){var b=a("#tool-wrap .tool .color").eq(0);b.spectrum({color:"#000",flat:!1,showInput:!0,showInitial:!0,showAlpha:!0,localStorageKey:"spectrum",showSelectionPalette:!0,clickoutFiresChange:!0,className:"spectrum-color",preferredFormat:"rgb",showPalette:!0,palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]})},openAttributePanel:function(b){var c=a(".tool-attribute-panel");b=b||this.getCurrentAttributePanel(),c.dialog("close"),b.dialog("open")},getCurrentAttributePanel:function(){return this.currentOpenAttributePanel},setCurrentAttributePanel:function(a){return void 0!==a?(this.currentOpenAttributePanel=a,!0):!1},bindEvent:function(){var c=a(document),d=a("#tool-wrap"),e=this;c.delegate("#tool-wrap .tool button","click",function(){var c=a(this),f=c.attr("data-tool-panel"),g=a(".tool-panel ."+f,d),h=a(".tool-panel .wrap:visible",d),i=a("#tool-"+f+"-attribute-panel"),j=c.attr("data-current-tool");a(".tool button.active",d).removeClass("active"),c.addClass("active"),h.hide(),g.show(),e.setCurrentAttributePanel(i),e.openAttributePanel(i),b.painter.tool.currentToolContainer.init(new b.painter.model.toolModel[j])}),c.delegate("#tool-wrap .tool-panel .wrap > button","click",function(b){var c=a(this),d=c.attr("data-tool"),e=c.attr("data-tool-class"),f=a("#tool-wrap .tool button[data-tool-panel='"+d+"']");f.attr("data-current-tool",e),f.trigger("click")}),c.delegate("#tool-wrap .color","change",function(c){var d=a(this).val(),e=b.painter.tool.currentToolContainer.getTool();e.setOption({fillStyle:d,strokeStyle:d})}),c.delegate('.tool-attribute-panel input[type!="checkbox"][type!="radio"],.tool-attribute-panel select',"change",function(c){var d=a(this),e=d.attr("data-attr"),f=d.val(),g=b.painter.tool.currentToolContainer.getTool(),h={},i=d.next("span");h[e]=f,g.setOption(h),i.html(f)}),c.delegate(".tool-attribute-panel :checkbox","change",function(c){var d=a(this),e=d.attr("data-attr"),f=d.val(),g=d.prop("checked"),h=b.painter.tool.currentToolContainer.getTool(),i={};i[e]=g===!0?f:"",h.setOption(i),window.console.log(g),document.getA}),c.delegate(".tool-attribute-panel :radio","change",function(c){var d=a(this),e=d.attr("data-attr"),f=d.val(),g=b.painter.tool.currentToolContainer.getTool(),h={};h[e]=f,g.setOption(h)})}},a(document).ready(function(){var a=new c;a.init()})}(jQuery,window),function(a,b){"use strict";var c=function(){this.canvas=null,this.name="Canvas",this.shapeList=[],this.convertStatus="source-over",this.flipXStatus=!1,this.flipYStatus=!1,this.width=1e3,this.height=400,this.context2D=null,this.top=0,this.left=0};c.prototype={init:function(a,b){this.initCanvas(a),this.initHeight(),this.initWidth(),this.initLeft(),this.initTop(),this.initContext2D(),this.initName(b),this.load()},initName:function(a){this.setName(a)},setName:function(a){this.name=a},getName:function(){return this.name},initCanvas:function(a){this.setCanvas(a)},setCanvas:function(a){return void 0!==a&&null!==a?(this.canvas=a,!0):!1},getCanvas:function(){return this.canvas},initContext2D:function(){this.setContext2D()},getContext2D:function(){return this.context2D},setContext2D:function(a){a=a||this.getCanvas().getContext("2d"),this.context2D=a},clearContext:function(){var a=this.getHeight(),b=this.getWidth(),c=this.getContext2D();return c.clearRect(0,0,b,a),c},initLeft:function(){this.updateLeft()},updateLeft:function(){function a(a){for(var b=a.offsetLeft,c=a.offsetParent;null!==c;)b+=c.offsetLeft,c=c.offsetParent;return b}var b=this.getCanvas(),c=0;return c=a(b),this.left=c,c},getLeft:function(){return this.left},initTop:function(){this.updateTop()},updateTop:function(){function a(a){for(var b=a.offsetTop,c=a.offsetParent;null!==c;)b+=c.offsetTop,c=c.offsetParent;return b}var b=this.getCanvas(),c=0;return c=a(b),this.top=c,c},getTop:function(){return this.top},updateSize:function(){this.updateHeight(),this.updateWidth(),this.repaint()},initHeight:function(){this.updateHeight()},updateHeight:function(){var b=this.getCanvas(),c=a(b),d=c.parent(),e=d.height();return c.attr("height",e),this.setHeight(e)},setHeight:function(a){return a=a||600,this.height=a,a},getHeight:function(){return this.height},initWidth:function(){this.updateWidth()},updateWidth:function(){var b=this.getCanvas(),c=a(b),d=c.parent(),e=d.width();return c.attr("width",e),this.setWidth(e)},setWidth:function(a){return a=a||600,this.width=a,this.width},getWidth:function(){return this.width},initShapeList:function(){this.clearShapeList()},getShapeList:function(){return a.extend(!0,[],this.shapeList)},setShapeList:function(b){return this.clearShapeList(),a.extend(!0,this.shapeList,b),b},addShape:function(a){this.shapeList.push(a)},deleteShape:function(){this.shapeList.pop()},clearShapeList:function(){this.shapeList=[]},paint:function(a){this.addShape(a),a.paint(this.getContext2D())},repaint:function(){var a=null,b=this.shapeList,c=b.length,d=0;for(a=this.clearContext(),d;c>d;d+=1)b[d].paint(a)},undo:function(){this.deleteShape(),this.repaint()},clear:function(){this.clearContext(),this.clearShapeList()},convert:function(){var a=this.getContext2D(),b=a.globalCompositeOperation,c="source-over"===this.convertStatus?"destination-over":"source-over";this.convertStatus=c,a.globalCompositeOperation=c,this.repaint(),a.globalCompositeOperation=b},save:function(a){var c=new b.painter.model.StorageModel,d=[],e=this.shapeList,f=e.length,g=0,h=this.getName(),i="";if(void 0!=a&&(h=a),c.init(),c.getStorage()!==!1){for(g;f>g;g+=1)d[g]={name:e[g].getName(),option:e[g].getOption()};i=b.JSON.stringify(d),c.save(h,i)}},load:function(a){var c,d,e=new b.painter.model.StorageModel,f=[],g=0,h=this.getName(),i=this.shapeList;if(void 0!=a&&(h=a),e.init(),e.getStorage()!==!1){for(d=e.load(h)||"[]",f=b.JSON.parse(d),c=f.length,g;c>g;g+=1)i[g]=new b.painter.model.shapeModel[f[g].name],i[g].init(f[g].option);this.repaint()}},autoSave:function(c){var d=this;b.setInterval(function(){d.save(),a.fn.TorangeNotice({type:"info",content:"自动为您保存图片"})},c)},flipX:function(){var a=this.getContext2D(),b=this.getWidth();a.save(),this.flipXStatus?this.flipXStatus=!1:(this.flipXStatus=!0,a.translate(b,0),a.scale(-1,1)),this.repaint(),a.restore()},flipY:function(){var a=this.getContext2D(),b=this.getHeight();a.save(),this.flipYStatus?this.flipYStatus=!1:(this.flipYStatus=!0,a.translate(0,b),a.scale(1,-1)),this.repaint(),a.restore()}},b.painter=b.painter||{},b.painter.model=b.painter.model||{},b.painter.model.CanvasModel=c}(jQuery,window),function(a,b){"use strict";var c={canvas:null,init:function(a){this.setCanvas(a)},setCanvas:function(a){return this.canvas=a,!0},getCanvas:function(){return this.canvas}};b.painter=b.painter||{},b.painter.model=b.painter.model||{},b.painter.model.CanvasContainerModel=c}(jQuery,window),function(a,b){"use strict";var c={clickStatus:!1,pointList:Object.create(b.painter.model.PointList),getPointList:function(){return this.pointList},getClickStatus:function(){return this.clickStatus},setClickStatus:function(a){return a=a||!1,this.clickStatus=a,a},init:function(){var c=a(".canvas-negative").get(0),d=new b.painter.model.CanvasModel,e=Object.create(b.painter.model.CanvasContainerModel),f=a(".canvas-layer").get(0),g=new b.painter.model.CanvasModel,h=Object.create(b.painter.model.CanvasContainerModel),i=a(".canvas-buffer").get(0),j=new b.painter.model.CanvasModel,k=Object.create(b.painter.model.CanvasContainerModel),l=a(".canvas-mouse").get(0),m=new b.painter.model.CanvasModel,n=Object.create(b.painter.model.CanvasContainerModel);d.init(c,"negativeCanvas"),e.init(d),b.painter=b.painter||{},b.painter.canvas=b.painter.canvas||{},b.painter.canvas.negativeCanvasContainer=e,g.init(f,"currentCanvas"),g.autoSave(6e4),h.init(g),b.painter=b.painter||{},b.painter.canvas=b.painter.canvas||{},b.painter.canvas.currentCanvasContainer=h,j.init(i,"bufferCanvas"),k.init(j),b.painter=b.painter||{},b.painter.canvas=b.painter.canvas||{},b.painter.canvas.bufferCanvasContainer=k,m.init(l,"mouseCanvas"),n.init(m),b.painter=b.painter||{},b.painter.canvas=b.painter.canvas||{},b.painter.canvas.mouseCanvasContainer=n,this.bindEvent()},bindEvent:function(){var c=a(document),d=b.painter.canvas.mouseCanvasContainer.getCanvas(),e=b.painter.canvas.bufferCanvasContainer.getCanvas(),f=b.painter.canvas.currentCanvasContainer.getCanvas(),g=d.getLeft(),h=d.getTop(),i=this,j=b.painter.tool.currentToolContainer.getTool();c.delegate("#canvas-mouse","mousemove",function(a){var c=null,f=null,k="",l=null,m=null,n=i.getClickStatus(),o="",p=null,q=null,r=j.getClassName();"shape"===r&&(c={x:a.pageX-g,y:a.pageY-h},o=j.getMouse(),p=j.getOption(),q=new b.painter.model.mouseModel[o],q.init(p,c),d.clear(),d.paint(q),n&&(k=j.getName(),f=i.getPointList(),f.add(c),m=j.setPoint(f),l=new b.painter.model.shapeModel[k],l.init(m),e.clear(),e.paint(l)))}),c.delegate("#canvas-mouse","mousedown",function(a){
var b={x:a.pageX-g,y:a.pageY-h};i.getPointList();i.getPointList().init(),i.getPointList().add(b),i.setClickStatus(!0)}),c.delegate("#canvas-mouse","mouseup",function(a){var c={x:a.pageX-g,y:a.pageY-h},d=i.getPointList(),k=j.getName(),l=null,m=null,n=j.getClassName();"shape"===n&&(i.getPointList().add(c),i.setClickStatus(!1),l=new b.painter.model.shapeModel[k],m=j.setPoint(d),l.init(m),f.paint(l),e.clear())}),c.delegate("#canvas-mouse","mouseleave",function(a){d.clear()}),c.delegate("#canvas-mouse","mouseenter",function(a){d.clear(),j=b.painter.tool.currentToolContainer.getTool()}),document.getElementById("canvas-mouse").addEventListener("touchmove",function(a){var c=null,f=null,k="",l=null,m=null,n=i.getClickStatus(),o="",p=null,q=null,r=j.getClassName(),s=a.changedTouches[0];a.preventDefault(),"shape"===r&&(c={x:s.pageX-g,y:s.pageY-h},o=j.getMouse(),p=j.getOption(),q=new b.painter.model.mouseModel[o],q.init(p,c),d.clear(),d.paint(q),n&&(k=j.getName(),f=i.getPointList(),f.add(c),m=j.setPoint(f),l=new b.painter.model.shapeModel[k],l.init(m),e.clear(),e.paint(l)))},!1),document.getElementById("canvas-mouse").addEventListener("touchstart",function(a){var b=a.touches[0],c={x:b.pageX-g,y:b.pageY-h};i.getPointList();a.preventDefault(),i.getPointList().init(),i.getPointList().add(c),i.setClickStatus(!0)},!1),document.getElementById("canvas-mouse").addEventListener("touchend",function(a){var c=a.changedTouches[0],d={x:c.pageX-g,y:c.pageY-h},k=i.getPointList(),l=j.getName(),m=null,n=null,o=j.getClassName();a.preventDefault(),"shape"===o&&(i.getPointList().add(d),i.setClickStatus(!1),m=new b.painter.model.shapeModel[l],n=j.setPoint(k),m.init(n),f.paint(m),e.clear())},!1)}};a(document).ready(function(){c.init()})}(jQuery,window),function(a,b){"use strict";var c={init:function(){this.bindEvent()},bindEvent:function(){var c=a(document),d=null,e=null;a(window).bind("beforeunload",function(b){return a("#nav-file-save").trigger("click"),"图片尚未导出，您确定离开吗？"}),c.bind("keydown",function(b){b.ctrlKey&&90===b.keyCode&&(a("#nav-edit-undo").trigger("click"),b.preventDefault())}),c.bind("keydown",function(b){b.ctrlKey&&83===b.keyCode&&(a("#nav-file-save").trigger("click"),b.preventDefault())}),c.bind("keydown",function(b){b.ctrlKey&&68===b.keyCode&&(a("#nav-edit-clear").trigger("click"),b.preventDefault())}),c.bind("keydown",function(b){b.ctrlKey&&69===b.keyCode&&(a("#nav-file-export").trigger("click"),b.preventDefault())}),c.bind("keydown",function(b){b.ctrlKey&&82===b.keyCode&&(a("#nav-edit-convert").trigger("click"),b.preventDefault())}),c.bind("keydown",function(b){b.ctrlKey&&72===b.keyCode&&(a("#nav-edit-flipx").trigger("click"),b.preventDefault())}),c.bind("keydown",function(b){b.ctrlKey&&86===b.keyCode&&(a("#nav-edit-flipy").trigger("click"),b.preventDefault())}),a(b).bind("resize",function(a){var c=b.painter.canvas,d=c.currentCanvasContainer.getCanvas(),e=c.bufferCanvasContainer.getCanvas(),f=c.mouseCanvasContainer.getCanvas(),g=b.painter.canvas.negativeCanvasContainer.getCanvas();d.updateSize(),e.updateSize(),f.updateSize(),g.updateSize()}),c.delegate("#negative-modal-file","change",function(b){var c=b.target.files,e=new FileReader;e.readAsDataURL(c[0]),e.onload=function(){var b=a("#negative-modal"),c=a("#negative-modal-view",b);d=e.result,c.attr("src",e.result),c.bind("load",function(){var b=a("#negative-modal"),c=a("#negative-modal-width",b),d=a("#negative-modal-height",b);c.val(a(this).width()),d.val(a(this).height())})}}),c.delegate("#negative-modal-ok","click",function(c){var e=b.painter.canvas.negativeCanvasContainer.getCanvas(),f=new b.painter.model.shapeModel.ImageShape,g=a("#negative-modal"),h=a("#negative-modal-x",g).val(),i=a("#negative-modal-y",g).val(),j=a("#negative-modal-width",g).val(),k=a("#negative-modal-height",g).val();f.init({x:h,y:i,width:j,height:k,src:d}),e.paint(f)}),c.delegate("#image-modal-file","change",function(b){var c=b.target.files,d=new FileReader;d.readAsDataURL(c[0]),d.onload=function(){var b=a("#image-modal"),c=a("#image-modal-view",b);e=d.result,c.attr("src",d.result),c.bind("load",function(){var b=a("#image-modal"),c=a("#image-modal-width",b),d=a("#image-modal-height",b);c.val(a(this).width()),d.val(a(this).height())})}}),c.delegate("#image-modal-ok","click",function(c){var d=b.painter.canvas.currentCanvasContainer.getCanvas(),f=new b.painter.model.shapeModel.ImageShape,g=a("#image-modal"),h=a("#image-modal-x",g).val(),i=a("#image-modal-y",g).val(),j=a("#image-modal-width",g).val(),k=a("#image-modal-height",g).val();f.init({x:h,y:i,width:j,height:k,src:e}),d.paint(f)})}};a(document).ready(function(){c.init()})}(jQuery,window),$.fn.extend({TorangeNotice:function(a){var b=a._speed||3e3,c=document.documentElement.clientHeight,d=document.documentElement.clientWidth,e=a.type||"info",f={error:"错误:",warning:"警告:",info:"提示:",success:"成功:"},g=a.content||"...",h={error:"rgba(197, 61, 54, 0.8)",warning:"rgba(249, 163, 42, 0.8)",info:"rgba(0, 68, 204, 0.8)",success:"rgba(81, 163, 81, 0.8)"},i=$("<div></div>");i.html(f[e]+g);var j={position:"absolute",top:0,left:0,"z-index":1e3,"font-size":"22px","max-width":"500px","background-color":h[e],color:"#ffffff","border-radius":"5px","-webkit-border-radius":"5px",padding:"20px 25px","box-shadow":"12px 12px 20px #bbb","text-align":"center",opacity:"1"};i.css(j),i.appendTo($("body")),i.css("top",(c-i.height())/2),i.css("left",(d-i.width())/2),i.animate({opacity:"0.2",top:"-=50"},b,function(){i.remove()})}}),!function(a){function b(b,c){this.el=a(b),this.confirmBtn=void 0,this.cancelBtn=void 0,this.options={title:"提示",onSuccess:null,para1:"",para2:"",para3:null},this.setOptions(c),this.initialize()}a.fn.torangeConfirm=function(a){return new b(this.get(0),a)},b.prototype={setOptions:function(b){var c=this.options;a.extend(c,b)},initialize:function(){var b='<div class="modal hidden" id="confirm_modal">';b+='	<form class="form-horizontal" onsubmit="return false;">',b+='<input type="hidden" id="confirm_hidden1"/>',b+='		<div class="modal-header">',b+='			<button type="button" class="close" data-dismiss="modal">×</button>',b+="			<h3>提示</h3>",b+="		</div>",b+='		<div class="modal-body">',b+="			<p>"+this.options.title+"</p>",b+=" </div>",b+='<div class="modal-footer"> ',b+='	<button class="btn btn-primary" id="confirmbox_btn">&nbsp;确定&nbsp;</button>',b+='	<button class="btn" id="cancelbox_btn">&nbsp;取消&nbsp;</button>',b+=" </div>",b+="</form>	",b+="</div>",a(b).appendTo(this.el),void 0==this.confirmBtn&&(this.confirmBtn=a("#confirmbox_btn")),void 0==this.cancelBtn&&(this.cancelBtn=a("#cancelbox_btn"));var c=this;this.confirmBtn.bind("click",function(){c.confirmDo()}),this.cancelBtn.bind("click",function(){c.cancelDo()}),a("#confirm_modal").modal({backdrop:"static",show:!0})},confirmDo:function(){a("#confirm_modal").modal("hide"),this.options.onSuccess(this.options.para1,this.options.para2,this.options.para3),this.confirmBtn.unbind("click"),this.cancelBtn.unbind("click"),a("#confirm_modal").remove()},cancelDo:function(){a("#confirm_modal").modal("hide"),this.confirmBtn.unbind("click"),this.cancelBtn.unbind("click"),a("#confirm_modal").remove()}}}(window.jQuery||window.ender),window.Modernizr=function(a,b,c){function d(a){s.cssText=a}function e(a,b){return typeof a===b}function f(a,b){return!!~(""+a).indexOf(b)}function g(a,b){for(var d in a){var e=a[d];if(!f(e,"-")&&s[e]!==c)return"pfx"==b?e:!0}return!1}function h(a,b,d){for(var f in a){var g=b[a[f]];if(g!==c)return d===!1?a[f]:e(g,"function")?g.bind(d||b):g}return!1}function i(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),f=(a+" "+w.join(d+" ")+d).split(" ");return e(b,"string")||e(b,"undefined")?g(f,b):(f=(a+" "+x.join(d+" ")+d).split(" "),h(f,b,c))}function j(){n.input=function(c){for(var d=0,e=c.length;e>d;d++)A[c[d]]=c[d]in t;return A.list&&(A.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),A}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),n.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;h>g;g++)t.setAttribute("type",e=a[g]),d="text"!==t.type,d&&(t.value=u,t.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&t.style.WebkitAppearance!==c?(p.appendChild(t),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(t,null).WebkitAppearance&&0!==t.offsetHeight,p.removeChild(t)):/^(search|tel)$/.test(e)||(d=/^(url|email)$/.test(e)?t.checkValidity&&t.checkValidity()===!1:t.value!=u)),z[a[g]]=!!d;return z}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var k,l,m="2.6.2",n={},o=!0,p=b.documentElement,q="modernizr",r=b.createElement(q),s=r.style,t=b.createElement("input"),u=":)",v=({}.toString,"Webkit Moz O ms"),w=v.split(" "),x=v.toLowerCase().split(" "),y={},z={},A={},B=[],C=B.slice,D={}.hasOwnProperty;l=e(D,"undefined")||e(D.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return D.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=C.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(C.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(C.call(arguments)))};return d}),y.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},y.canvastext=function(){return!!n.canvas&&!!e(b.createElement("canvas").getContext("2d").fillText,"function")},y.localstorage=function(){try{return localStorage.setItem(q,q),localStorage.removeItem(q),!0}catch(a){return!1}};for(var E in y)l(y,E)&&(k=E.toLowerCase(),n[k]=y[E](),B.push((n[k]?"":"no-")+k));return n.input||j(),n.addTest=function(a,b){if("object"==typeof a)for(var d in a)l(a,d)&&n.addTest(d,a[d]);else{if(a=a.toLowerCase(),n[a]!==c)return n;b="function"==typeof b?b():b,"undefined"!=typeof o&&o&&(p.className+=" "+(b?"":"no-")+a),n[a]=b}return n},d(""),r=t=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=r.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=q[a[o]];return b||(b={},p++,a[o]=p,q[p]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():n.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),f.canHaveChildren&&!m.test(a)?d.frag.appendChild(f):f}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function i(a){a||(a=b);var d=e(a);return r.shivCSS&&!j&&!d.hasCSS&&(d.hasCSS=!!c(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),k||h(a,d),a}var j,k,l=a.html5||{},m=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,n=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,o="_html5shiv",p=0,q={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){j=!0,k=!0}}();var r={elements:l.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:l.shivCSS!==!1,supportsUnknownElements:k,shivMethods:l.shivMethods!==!1,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=r,i(b)}(this,b),n._version=m,n._domPrefixes=x,n._cssomPrefixes=w,n.testProp=function(a){return g([a])},n.testAllProps=i,p.className=p.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(o?" js "+B.join(" "):""),n}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==q.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=r.shift();s=1,a?a.t?o(function(){("c"==a.t?m.injectCss:m.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):s=0}function i(a,c,d,e,f,i,j){function k(b){if(!n&&g(l.readyState)&&(t.r=n=1,!s&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&o(function(){v.removeChild(l)},50);for(var d in A[c])A[c].hasOwnProperty(d)&&A[c][d].onload()}}var j=j||m.errorTimeout,l=b.createElement(a),n=0,q=0,t={t:d,s:c,e:f,a:i,x:j};1===A[c]&&(q=1,A[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,q)},r.splice(e,0,t),"img"!=a&&(q||2===A[c]?(v.insertBefore(l,u?null:p),o(k,j)):A[c].push(l))}function j(a,b,c,d,f){return s=0,b=b||"j",e(a)?i("c"==b?x:w,a,b,this.i++,c,d,f):(r.splice(this.i++,0,a),1==r.length&&h()),this}function k(){var a=m;return a.loader={load:j,i:0},a}var l,m,n=b.documentElement,o=a.setTimeout,p=b.getElementsByTagName("script")[0],q={}.toString,r=[],s=0,t="MozAppearance"in n.style,u=t&&!!b.createRange().compareNode,v=u?n:p.parentNode,n=a.opera&&"[object Opera]"==q.call(a.opera),n=!!b.attachEvent&&!n,w=t?"object":n?"script":"img",x=n?"script":w,y=Array.isArray||function(a){return"[object Array]"==q.call(a)},z=[],A={},B={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};m=function(a){function b(a){var b,c,d,a=a.split("!"),e=z.length,f=a.pop(),g=a.length,f={url:f,origUrl:f,prefixes:a};for(c=0;g>c;c++)d=a[c].split("="),(b=B[d.shift()])&&(f=b(f,d));for(c=0;e>c;c++)f=z[c](f);return f}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(A[i.url]?i.noexec=!0:A[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),A[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}),g(a,l,b,0,j);else if(Object(a)===a)for(i in h=function(){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}(),a)a.hasOwnProperty(i)&&(!c&&!--h&&(d(l)?l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}:l[i]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),n()}}(m[i])),g(a[i],l,b,i,j))}else!c&&n()}var h,i,j=!!a.test,k=a.load||a.both,l=a.callback||f,m=l,n=a.complete||f;c(j?a.yep:a.nope,!!k),k&&c(k)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(y(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):y(j)?m(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},m.addPrefix=function(a,b){B[a]=b},m.addFilter=function(a){z.push(a)},m.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",l=function(){b.removeEventListener("DOMContentLoaded",l,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k,l,n=b.createElement("script"),e=e||m.errorTimeout;n.src=a;for(l in d)n.setAttribute(l,d[l]);c=j?h:c||f,n.onreadystatechange=n.onload=function(){!k&&g(n.readyState)&&(k=1,c(),n.onload=n.onreadystatechange=null)},o(function(){k||(k=1,c(1))},e),i?n.onload():p.parentNode.insertBefore(n,p)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j,e=b.createElement("link"),c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(p.parentNode.insertBefore(e,p),o(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},function(a,b){"use strict";function c(a){var b,c=new RegExp("(^|)"+a+"=([^&]*)(&|$)","gi").exec(h);return(b=c)?b[2]:""}function d(){var a=b.painter.canvas.currentCanvasContainer.getCanvas(),c=new b.painter.model.shapeModel.ImageShape;""!=e?(c.init({x:0,y:0,width:f,height:g,src:e}),a.paint(c)):setTimeout(d,1e3)}var e="",f=0,g=0,h=String(window.document.location.href),i="data:";window.addEventListener("message",function(a){var b=(a.originalEvent||a).origin;b==location.origin&&"string"==typeof a.data&&a.data.slice(0,5)==i&&(e=a.data)}),a(function(){a(function(){var b=a("#loading"),e=a(".load",b),h=a(".check",b),i=a(".check-result",b),j=!1,k=a(".check-canvas",i),l=a("span",k),m=!1,n=a(".check-canvas-text",i),o=a("span",n),p=!1,q=a(".check-range",i),r=a("span",q),s=a(".select",i),t=a(".sorry",i);e.hide(),h.show(),i.show(),Modernizr.canvas===!0&&(j=!0,l.removeClass("unsupport").addClass("support")),Modernizr.canvastext&&(m=!0,o.removeClass("unsupport").addClass("support")),Modernizr.inputtypes.range&&(p=!0,r.removeClass("unsupport").addClass("support")),j&&m&&p&&(b.fadeOut(),f=c("w"),g=c("h"),""!=f&&""!=g&&d()),j?(s.show(),a("button",s).click(function(){b.fadeOut()})):t.show()})})}(jQuery,window);